<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#0ea5e9">
    <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#0f172a">
    <meta name="color-scheme" content="dark light">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="application-name" content="SpotHitch">
    <meta name="msapplication-TileColor" content="#0ea5e9">
    <meta name="msapplication-TileImage" content="icon-144.png">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <!-- SEO -->
    <title>SpotHitch - La communaut√© des autostoppeurs | Trouvez les meilleurs spots</title>
    <!-- Preload Critical Resources -->
    <link rel="preload" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="anonymous" as="style">
    <link rel="preload" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" as="script">
    <link rel="preload" href="icon-192.png" as="image">
    
    <meta name="description" content="SpotHitch - Trouvez les meilleurs spots d'auto-stop en Europe. Plus de 100 spots v√©rifi√©s, guides par pays, planificateur de voyage et communaut√© active.">
    <meta name="keywords" content="autostop, hitchhiking, spots, voyage, backpacking, europe, auto-stop, pouce, routard, aventure">
    <meta name="author" content="SpotHitch">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://antoine626.github.io/Spothitch">
    
    <!-- Open Graph (Facebook, LinkedIn) -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://antoine626.github.io/Spothitch">
    <meta property="og:title" content="SpotHitch - La communaut√© des autostoppeurs">
    <meta property="og:description" content="Trouvez les meilleurs spots d'auto-stop en Europe. Partagez vos exp√©riences et planifiez vos voyages.">
    <meta property="og:image" content="https://antoine626.github.io/Spothitch/og-image.png">
    <meta property="og:locale" content="fr_FR">
    <meta property="og:locale:alternate" content="en_US">
    
    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://antoine626.github.io/Spothitch">
    <meta name="twitter:title" content="SpotHitch - La communaut√© des autostoppeurs">
    <meta name="twitter:description" content="Trouvez les meilleurs spots d'auto-stop en Europe">
    <meta name="twitter:image" content="https://antoine626.github.io/Spothitch/screenshot-mobile.png">
    
    <!-- PWA -->
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon-192.png">
    <link rel="apple-touch-icon" sizes="152x152" href="icon-152.png">
    <link rel="apple-touch-icon" sizes="144x144" href="icon-144.png">
    <link rel="apple-touch-icon" sizes="120x120" href="icon-128.png">
    <link rel="apple-touch-icon" sizes="76x76" href="icon-96.png">
    <link rel="icon" type="image/png" sizes="32x32" href="favicon.png">
    <link rel="icon" type="image/png" sizes="16x16" href="favicon.png">
    
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.Default.css" />
    
    <!-- Fonts -->
    
    <!-- Resource Hints for Performance -->
    <link rel="modulepreload" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js">
    <meta http-equiv="x-dns-prefetch-control" content="on">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    <!-- Preconnect pour les APIs externes -->
    <link rel="preconnect" href="https://unpkg.com">
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    <link rel="preconnect" href="https://nominatim.openstreetmap.org">
    <link rel="preconnect" href="https://router.project-osrm.org">
    <link rel="dns-prefetch" href="https://basemaps.cartocdn.com">
    <!-- Critical CSS for First Paint -->
    <style>
        /* Critical styles for instant first paint */
        *{margin:0;padding:0;box-sizing:border-box}
        html{font-family:system-ui,-apple-system,sans-serif;background:#0f172a;color:#fff}
        body{min-height:100vh;overflow-x:hidden}
        
        /* Loading skeleton */
        .skeleton{background:linear-gradient(90deg,#1e293b 25%,#334155 50%,#1e293b 75%);
            background-size:200% 100%;animation:shimmer 1.5s infinite}
        @keyframes shimmer{0%{background-position:200% 0}100%{background-position:-200% 0}}
        
        /* Initial loading state */
        #app-loader{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;
            background:#0f172a;z-index:9999;transition:opacity .3s}
        #app-loader.hidden{opacity:0;pointer-events:none}
        .loader-spinner{width:48px;height:48px;border:4px solid #1e293b;border-top-color:#0ea5e9;
            border-radius:50%;animation:spin 1s linear infinite}
        @keyframes spin{to{transform:rotate(360deg)}}
        
        /* Hide content until loaded */
        #app{opacity:0;transition:opacity .3s}
        #app.loaded{opacity:1}
        
        /* Screen reader only */
        .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;
            overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
    </style>
    
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&family=Outfit:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin="anonymous"></script>
    <script src="https://unpkg.com/leaflet.markercluster@1.4.1/dist/leaflet.markercluster.js" defer></script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js" defer></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js" defer></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js" defer></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage-compat.js" defer></script>
    
    <style>
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        /* Variables de th√®me */
        :root {
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --bg-card: rgba(255, 255, 255, 0.05);
            --text-primary: #ffffff;
            --text-secondary: #94a3b8;
            --border-color: rgba(255, 255, 255, 0.1);
            --glass-bg: rgba(15, 23, 42, 0.7);
        }
        
        /* Th√®me clair - Sunset Vibes (Orange/Rose) */
        body.light-theme {
            --bg-primary: #FFF8F0;
            --bg-secondary: #FFF1E6;
            --bg-card: #ffffff;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --border-color: #fed7aa;
            --glass-bg: rgba(255, 248, 240, 0.95);
            --accent-primary: #F97316;
            --accent-secondary: #EC4899;
            --gradient-primary: linear-gradient(135deg, #F97316, #EC4899);
        }
        
        body.light-theme .btn-primary { 
            background: linear-gradient(135deg, #F97316, #EC4899) !important; 
            box-shadow: 0 4px 15px rgba(249, 115, 22, 0.3) !important;
        }
        body.light-theme .btn-primary:hover { 
            box-shadow: 0 8px 25px rgba(249, 115, 22, 0.4) !important;
        }
        body.light-theme .btn-ghost { 
            background: rgba(249, 115, 22, 0.1) !important; 
            color: #F97316 !important; 
        }
        body.light-theme .btn-ghost:hover { 
            background: rgba(249, 115, 22, 0.2) !important; 
        }
        body.light-theme .card {
            background: #ffffff !important;
            border: 1px solid #fed7aa !important;
            box-shadow: 0 4px 20px rgba(249, 115, 22, 0.1) !important;
        }
        body.light-theme .card:hover {
            border-color: #F97316 !important;
            box-shadow: 0 8px 30px rgba(249, 115, 22, 0.15) !important;
        }
        body.light-theme .input-modern {
            background: #ffffff !important;
            border: 2px solid #fed7aa !important;
            color: #1e293b !important;
        }
        body.light-theme .input-modern:focus {
            border-color: #F97316 !important;
            box-shadow: 0 0 0 3px rgba(249, 115, 22, 0.2) !important;
        }
        body.light-theme .input-modern::placeholder {
            color: #94a3b8 !important;
        }
        body.light-theme .text-sky-400, body.light-theme .text-sky-300 {
            color: #F97316 !important;
        }
        body.light-theme .text-emerald-400, body.light-theme .text-emerald-300 {
            color: #10b981 !important;
        }
        body.light-theme .bg-sky-500\/10, body.light-theme .bg-sky-500\/20 {
            background: rgba(249, 115, 22, 0.1) !important;
        }
        body.light-theme .border-sky-500\/20 {
            border-color: rgba(249, 115, 22, 0.3) !important;
        }
        body.light-theme .nav-btn.active {
            background: linear-gradient(135deg, #F97316, #EC4899) !important;
            color: white !important;
        }
        body.light-theme .spot-card {
            background: #ffffff !important;
            border: 1px solid #fed7aa !important;
        }
        body.light-theme .text-slate-400, body.light-theme .text-slate-500 {
            color: #64748b !important;
        }
        body.light-theme .text-slate-300 {
            color: #475569 !important;
        }
        body.light-theme .bg-white\/5 {
            background: rgba(249, 115, 22, 0.05) !important;
        }
        body.light-theme .chat-bubble.sent {
            background: linear-gradient(135deg, #F97316, #EC4899) !important;
            color: white !important;
        }
        body.light-theme .chat-bubble.received {
            background: #fff7ed !important;
            border: 1px solid #fed7aa !important;
            color: #1e293b !important;
        }
        
        body {
            margin: 0; 
            padding: 0; 
            font-family: 'Outfit', system-ui, sans-serif;
            background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
            color: var(--text-primary);
            overflow-x: hidden;
            min-height: 100vh;
            transition: background 0.3s ease, color 0.3s ease;
        }
        
        h1, h2, h3, h4, h5, h6 { font-family: 'Space Grotesk', sans-serif; }
        
        /* Animations */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } }
        @keyframes glow { 0%, 100% { box-shadow: 0 0 10px rgba(239, 68, 68, 0.5); } 50% { box-shadow: 0 0 25px rgba(239, 68, 68, 0.8); } }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }
        @keyframes confetti { 0% { transform: scale(0) rotate(0deg); opacity: 1; } 100% { transform: scale(2) rotate(720deg); opacity: 0; } }
        @keyframes ping { 75%, 100% { transform: scale(2); opacity: 0; } }
        
        .fade-in { animation: fadeIn 0.4s ease-out forwards; }
        .slide-up { animation: slideUp 0.4s ease-out forwards; }
        .pulse { animation: pulse 2s ease-in-out infinite; }
        .glow { animation: glow 2s ease-in-out infinite; }
        .bounce { animation: bounce 1s ease-in-out infinite; }
        
        .stagger-1 { animation-delay: 0.1s; opacity: 0; }
        .stagger-2 { animation-delay: 0.2s; opacity: 0; }
        .stagger-3 { animation-delay: 0.3s; opacity: 0; }
        .stagger-4 { animation-delay: 0.4s; opacity: 0; }
        
        /* Glass */
        .glass { background: rgba(255, 255, 255, 0.05); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .glass-dark { 
            background: var(--glass-bg); 
            backdrop-filter: blur(20px); 
            border-bottom: 1px solid var(--border-color); 
        }
        
        /* Cards */
        .card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: 20px;
            transition: all 0.3s ease;
        }
        .card:hover { border-color: rgba(14, 165, 233, 0.3); }
        
        /* Buttons */
        .btn {
            font-weight: 600; padding: 12px 24px; border-radius: 12px; border: none;
            cursor: pointer; transition: all 0.3s ease;
            display: inline-flex; align-items: center; justify-content: center; gap: 8px;
        }
        .btn-primary { background: linear-gradient(135deg, #0ea5e9, #0284c7); color: white; box-shadow: 0 4px 15px rgba(14, 165, 233, 0.3); }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 8px 25px rgba(14, 165, 233, 0.4); }
        .btn-success { background: linear-gradient(135deg, #10b981, #059669); color: white; box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3); }
        .btn-danger { background: linear-gradient(135deg, #ef4444, #dc2626); color: white; box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3); }
        .btn-ghost { background: rgba(255, 255, 255, 0.05); color: white; }
        .btn-ghost:hover { background: rgba(255, 255, 255, 0.1); }
        
        /* Input */
        .input-modern {
            width: 100%; padding: 14px 18px;
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px; color: white; font-size: 16px;
            transition: all 0.3s ease; outline: none;
        }
        .input-modern:focus { border-color: #0ea5e9; background: rgba(14, 165, 233, 0.1); }
        .input-modern::placeholder { color: rgba(255, 255, 255, 0.4); }
        
        /* Badge */
        .badge { display: inline-flex; align-items: center; gap: 6px; padding: 6px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; }
        .badge-primary { background: rgba(14, 165, 233, 0.2); color: #38bdf8; }
        .badge-success { background: rgba(16, 185, 129, 0.2); color: #34d399; }
        .badge-warning { background: rgba(245, 158, 11, 0.2); color: #fbbf24; }
        .badge-danger { background: rgba(239, 68, 68, 0.2); color: #f87171; }
        
        /* Progress */
        .progress-bar { height: 8px; background: rgba(255, 255, 255, 0.1); border-radius: 10px; overflow: hidden; }
        .progress-fill { height: 100%; border-radius: 10px; background: linear-gradient(90deg, #0ea5e9, #06b6d4); transition: width 0.5s ease; }
        
        /* Stars */
        .star-rating { display: flex; gap: 4px; }
        .star { cursor: pointer; font-size: 28px; transition: all 0.2s ease; filter: grayscale(1) opacity(0.3); }
        .star:hover, .star.active { filter: grayscale(0) opacity(1); transform: scale(1.2); }
        
        /* Map */
        #map { height: 100%; width: 100%; border-radius: 16px; z-index: 1; }
        .leaflet-container { background: #1e293b; }
        
        .custom-marker {
            display: flex; align-items: center; justify-content: center;
            width: 36px; height: 36px; border-radius: 50%;
            border: 3px solid white; box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            font-size: 14px; font-weight: bold; color: white;
        }
        .marker-top { background: linear-gradient(135deg, #ef4444, #dc2626); animation: glow 2s ease-in-out infinite; }
        .marker-good { background: linear-gradient(135deg, #10b981, #059669); }
        .marker-new { background: linear-gradient(135deg, #f59e0b, #d97706); }
        .marker-old { background: linear-gradient(135deg, #64748b, #475569); }
        .marker-user { background: linear-gradient(135deg, #0ea5e9, #0284c7); animation: pulse 2s ease-in-out infinite; }
        
        .leaflet-popup-content-wrapper { background: rgba(15, 23, 42, 0.95); color: white; border-radius: 16px; border: 1px solid rgba(255,255,255,0.1); }
        .leaflet-popup-tip { background: rgba(15, 23, 42, 0.95); }
        .leaflet-popup-content { margin: 12px 16px; }
        
        /* Toast */
        .toast {
            position: fixed; top: 80px; left: 50%; transform: translateX(-50%);
            padding: 16px 24px; border-radius: 12px; color: white; font-weight: 500;
            z-index: 9999; animation: fadeIn 0.3s ease-out;
            display: flex; align-items: center; gap: 12px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.4); max-width: 90vw;
        }
        .toast-success { background: linear-gradient(135deg, #10b981, #059669); }
        .toast-error { background: linear-gradient(135deg, #ef4444, #dc2626); }
        .toast-info { background: linear-gradient(135deg, #0ea5e9, #0284c7); }
        
        /* Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: rgba(255, 255, 255, 0.05); }
        ::-webkit-scrollbar-thumb { background: rgba(14, 165, 233, 0.5); border-radius: 10px; }
        
        .gradient-text { background: linear-gradient(135deg, #0ea5e9, #06b6d4, #10b981); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        
        /* Photo upload */
        .photo-upload {
            border: 2px dashed rgba(255,255,255,0.2); border-radius: 16px;
            padding: 40px 20px; text-align: center; cursor: pointer; transition: all 0.3s ease;
        }
        .photo-upload:hover { border-color: #0ea5e9; background: rgba(14, 165, 233, 0.1); }
        .photo-upload.has-photo { border-style: solid; border-color: #10b981; padding: 0; overflow: hidden; }
        .photo-upload img { width: 100%; height: 200px; object-fit: cover; }
        
        /* Trip planner */
        .trip-step { position: relative; padding-left: 40px; }
        .trip-step::before { content: ''; position: absolute; left: 15px; top: 30px; bottom: -20px; width: 2px; background: linear-gradient(180deg, #0ea5e9, #10b981); }
        .trip-step:last-child::before { display: none; }
        .trip-step-dot { position: absolute; left: 6px; top: 8px; width: 20px; height: 20px; border-radius: 50%; background: #0ea5e9; border: 3px solid #0f172a; }
        
        /* Live */
        .live-dot { width: 8px; height: 8px; background: #ef4444; border-radius: 50%; animation: pulse 1s ease-in-out infinite; }
        
        /* Spot type */
        .spot-type-badge { position: absolute; top: 12px; right: 12px; padding: 4px 10px; border-radius: 20px; font-size: 11px; font-weight: 700; text-transform: uppercase; }
        .spot-type-top { background: #ef4444; color: white; }
        .spot-type-good { background: #10b981; color: white; }
        .spot-type-new { background: #f59e0b; color: white; }
        .spot-type-old { background: #64748b; color: white; }
        
        /* Avatar */
        .avatar-option {
            width: 50px; height: 50px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 28px; cursor: pointer; transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.05); border: 3px solid transparent;
        }
        .avatar-option:hover { transform: scale(1.1); background: rgba(14, 165, 233, 0.2); }
        .avatar-option.selected { border-color: #0ea5e9; background: rgba(14, 165, 233, 0.3); }
        
        /* SOS */
        .sos-btn {
            position: fixed; bottom: 100px; right: 20px;
            width: 60px; height: 60px; border-radius: 50%;
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white; font-weight: bold; font-size: 12px;
            border: none; cursor: pointer; z-index: 45;
            box-shadow: 0 4px 20px rgba(239, 68, 68, 0.5);
            transition: all 0.3s ease;
            display: flex; align-items: center; justify-content: center;
        }
        .sos-btn:hover { transform: scale(1.1); }
        .sos-btn::before {
            content: ''; position: absolute; inset: -4px; border-radius: 50%;
            border: 2px solid rgba(239, 68, 68, 0.5); animation: ping 1.5s cubic-bezier(0, 0, 0.2, 1) infinite;
        }
        
        /* Chat */
        .chat-bubble { max-width: 80%; padding: 12px 16px; border-radius: 18px; margin-bottom: 8px; }
        .chat-bubble.sent { background: linear-gradient(135deg, #0ea5e9, #0284c7); margin-left: auto; border-bottom-right-radius: 4px; }
        .chat-bubble.received { background: rgba(255, 255, 255, 0.1); margin-right: auto; border-bottom-left-radius: 4px; }
        
        /* Reminder popup */
        .reminder-popup {
            position: fixed; bottom: 100px; left: 20px; right: 20px;
            background: linear-gradient(145deg, rgba(30, 41, 59, 0.98), rgba(15, 23, 42, 0.99));
            border: 1px solid rgba(14, 165, 233, 0.3); border-radius: 20px; padding: 20px;
            z-index: 50; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }
        
        /* Tutorial bubble - DYNAMIQUE */
        .tuto-overlay { 
            position: fixed; inset: 0; 
            background: rgba(0,0,0,0.75); 
            z-index: 100; 
        }
        .tuto-bubble {
            position: fixed; z-index: 103;
            background: linear-gradient(145deg, rgba(30, 41, 59, 0.98), rgba(15, 23, 42, 0.99));
            border: 2px solid #0ea5e9; border-radius: 20px; padding: 20px;
            box-shadow: 0 20px 60px rgba(14, 165, 233, 0.4);
            transition: opacity 0.3s ease;
        }
        .tuto-highlight-box {
            position: fixed; z-index: 102;
            border: 3px solid #0ea5e9;
            border-radius: 16px;
            background: rgba(14, 165, 233, 0.1);
            box-shadow: 0 0 40px rgba(14, 165, 233, 0.6);
            animation: pulse 1.5s ease-in-out infinite;
            pointer-events: none;
        }
        .tuto-dots { display: flex; gap: 8px; justify-content: center; }
        .tuto-dot { width: 10px; height: 10px; border-radius: 50%; background: rgba(255,255,255,0.3); transition: all 0.3s; }
        .tuto-dot.active { background: #0ea5e9; transform: scale(1.2); }
        .tuto-dot.done { background: #10b981; }
        
        /* FAB - Bouton flottant pour ajouter */
        .fab {
            position: fixed; bottom: 90px; right: 20px; z-index: 45;
            width: 60px; height: 60px; border-radius: 50%;
            background: linear-gradient(135deg, #10b981, #059669);
            color: white; font-size: 28px; border: none; cursor: pointer;
            box-shadow: 0 4px 20px rgba(16, 185, 129, 0.5);
            display: flex; align-items: center; justify-content: center;
            transition: all 0.3s ease;
        }
        .fab:hover { transform: scale(1.1); }
        .fab:active { transform: scale(0.95); }
        
        /* SOS d√©plac√© */
        .sos-header-btn {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white; padding: 8px 12px; border-radius: 12px;
            font-weight: bold; font-size: 12px; border: none; cursor: pointer;
            display: flex; align-items: center; gap: 6px;
            box-shadow: 0 2px 10px rgba(239, 68, 68, 0.4);
        }
        
        /* Boutons plus grands (min 48px) */
        .btn { min-height: 48px; }
        .badge { min-height: 36px; padding: 8px 14px; font-size: 13px; }
        
        /* Cards simplifi√©es */
        .spot-card-simple {
            background: linear-gradient(145deg, rgba(30, 41, 59, 0.9), rgba(15, 23, 42, 0.95));
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 20px; overflow: hidden; cursor: pointer;
            transition: all 0.3s ease;
        }
        .spot-card-simple:hover { border-color: rgba(14, 165, 233, 0.3); transform: translateY(-2px); }
        .spot-card-simple:active { transform: scale(0.98); }
        
        /* Message GPS */
        .gps-message {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.2), rgba(234, 88, 12, 0.2));
            border: 1px solid rgba(245, 158, 11, 0.3);
            border-radius: 16px; padding: 16px;
            display: flex; align-items: center; gap: 12px;
        }
        
        /* Wizard steps */
        .wizard-step { display: flex; align-items: center; gap: 8px; }
        .wizard-dot {
            width: 32px; height: 32px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-weight: bold; font-size: 14px;
            background: rgba(255,255,255,0.1); color: rgba(255,255,255,0.4);
            transition: all 0.3s;
        }
        .wizard-dot.active { background: #0ea5e9; color: white; }
        .wizard-dot.done { background: #10b981; color: white; }
        .wizard-line { flex: 1; height: 2px; background: rgba(255,255,255,0.1); }
        .wizard-line.done { background: #10b981; }
        
        /* Quiz */
        .quiz-option {
            padding: 16px; border-radius: 16px; cursor: pointer;
            background: rgba(255,255,255,0.05); border: 2px solid rgba(255,255,255,0.1);
            transition: all 0.3s ease; text-align: center; min-height: 60px;
            display: flex; align-items: center; justify-content: center;
        }
        .quiz-option:hover { border-color: #0ea5e9; background: rgba(14, 165, 233, 0.1); }
        .quiz-option.selected { border-color: #0ea5e9; background: rgba(14, 165, 233, 0.2); }
        .quiz-option.correct { border-color: #10b981; background: rgba(16, 185, 129, 0.2); }
        .quiz-option.wrong { border-color: #ef4444; background: rgba(239, 68, 68, 0.2); }
        .quiz-timer { width: 100%; height: 8px; background: rgba(255,255,255,0.1); border-radius: 10px; overflow: hidden; }
        .quiz-timer-fill { height: 100%; background: linear-gradient(90deg, #10b981, #0ea5e9); transition: width 0.1s linear; }
        .quiz-score-popup {
            position: fixed; inset: 0; z-index: 60; display: flex; align-items: center; justify-content: center;
            background: rgba(0,0,0,0.8);
        }
        
        /* ========== OVERRIDES TH√àME CLAIR ========== */
        body.light-theme .input-modern {
            background: #ffffff;
            border-color: #cbd5e1;
            color: #0f172a;
        }
        body.light-theme .input-modern:focus {
            border-color: #0ea5e9;
            background: #f0f9ff;
        }
        body.light-theme .input-modern::placeholder {
            color: #94a3b8;
        }
        
        body.light-theme .btn-ghost {
            background: #f1f5f9;
            color: #0f172a;
        }
        body.light-theme .btn-ghost:hover {
            background: #e2e8f0;
        }
        
        body.light-theme .btn-primary {
            background: linear-gradient(135deg, #0ea5e9, #0284c7);
            color: white;
        }
        
        body.light-theme .badge-primary {
            background: #e0f2fe;
            color: #0369a1;
        }
        
        body.light-theme .badge-success {
            background: #d1fae5;
            color: #065f46;
        }
        
        body.light-theme .badge-warning {
            background: #fef3c7;
            color: #92400e;
        }
        
        body.light-theme .badge-danger {
            background: #fee2e2;
            color: #991b1b;
        }
        
        body.light-theme .spot-card,
        body.light-theme .trip-card {
            background: #ffffff;
            border-color: #e2e8f0;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        body.light-theme .card {
            background: #ffffff;
            border-color: #e2e8f0;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }
        
        body.light-theme .gradient-text {
            background: linear-gradient(135deg, #0ea5e9, #0284c7);
            -webkit-background-clip: text;
            background-clip: text;
        }
        
        body.light-theme .tuto-overlay {
            background: rgba(15, 23, 42, 0.6);
        }
        
        body.light-theme .tuto-bubble {
            background: white;
            border: 2px solid #0ea5e9;
            color: #0f172a;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
        }
        
        body.light-theme .chat-bubble.received {
            background: #f1f5f9;
            color: #0f172a;
        }
        
        body.light-theme .chat-bubble.sent {
            background: #0ea5e9;
            color: white;
        }
        
        body.light-theme .glass-dark {
            background: rgba(255, 255, 255, 0.95);
            border-bottom: 1px solid #e2e8f0;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }
        
        body.light-theme .text-slate-400,
        body.light-theme .text-slate-500 {
            color: #64748b !important;
        }
        
    </style>

    <!-- Structured Data for SEO -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "SpotHitch",
        "alternateName": "La communaut√© des autostoppeurs",
        "url": "https://antoine626.github.io/Spothitch/",
        "description": "Trouvez les meilleurs spots d'auto-stop en Europe. Plus de 100 spots v√©rifi√©s, guides par pays, planificateur de voyage.",
        "applicationCategory": "TravelApplication",
        "operatingSystem": "Any",
        "browserRequirements": "Requires JavaScript. Requires HTML5.",
        "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "EUR"
        },
        "author": {
            "@type": "Person",
            "name": "antoine626",
            "url": "https://github.com/antoine626"
        },
        "aggregateRating": {
            "@type": "AggregateRating",
            "ratingValue": "4.5",
            "ratingCount": "100",
            "bestRating": "5",
            "worstRating": "1"
        },
        "featureList": [
            "Interactive map with hitchhiking spots",
            "Trip planner with route calculation",
            "Community chat",
            "Country guides",
            "Gamification system",
            "Offline support"
        ],
        "screenshot": "https://antoine626.github.io/Spothitch/screenshot-desktop.png",
        "softwareVersion": "1.1.0",
        "datePublished": "2025-12-23",
        "dateModified": "2025-12-26",
        "inLanguage": ["fr", "en", "es"]
    }
    </script>
    
</head>
<body>
    <a href="#app" class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 focus:z-[9999] focus:bg-sky-500 focus:text-white focus:px-4 focus:py-2 focus:rounded-lg">
        Aller au contenu principal
    </a>
    >
    
    <!-- App Loader -->
    <div id="app-loader">
        <div style="text-align:center">
            <div class="loader-spinner" style="margin:0 auto 16px"></div>
            <div style="color:#94a3b8;font-size:14px">Chargement de SpotHitch...</div>
        </div>
    </div>
    
    <div id="app" role="main"></div>

    <script>
        // ==================== STORAGE ====================
        
        // ==================== ERROR HANDLING ====================
        // Gestion globale des erreurs pour une meilleure UX
        
        window.onerror = function(msg, url, line, col, error) {
            console.error('Global error:', { msg, url, line, col, error });
            
            // Ne pas afficher les erreurs de script tiers
            if (url && !url.includes('github.io')) return;
            
            // Afficher une notification non intrusive
            showErrorToast('Une erreur est survenue. L\'app continue de fonctionner.');
            
            return true; // Emp√™che l'affichage de l'erreur par d√©faut
        };
        
        window.onunhandledrejection = function(event) {
            console.error('Unhandled promise rejection:', event.reason);
            
            // G√©rer les erreurs r√©seau silencieusement
            if (event.reason?.message?.includes('network') || 
                event.reason?.message?.includes('fetch')) {
                showErrorToast('Connexion instable. Mode hors-ligne activ√©.');
                return;
            }
        };
        
        function showErrorToast(message) {
            // Cr√©er un toast non intrusif
            const existing = document.getElementById('error-toast');
            if (existing) existing.remove();
            
            const toast = document.createElement('div');
            toast.id = 'error-toast';
            toast.style.cssText = `
                position: fixed; bottom: 100px; left: 50%; transform: translateX(-50%);
                background: #ef4444; color: white; padding: 12px 24px; border-radius: 12px;
                font-size: 14px; z-index: 10000; animation: slideUp 0.3s ease;
                box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            `;
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.style.animation = 'slideDown 0.3s ease';
                setTimeout(() => toast.remove(), 300);
            }, 4000);
        }
        
        // Styles pour les animations de toast
        const toastStyles = document.createElement('style');
        toastStyles.textContent = `
            @keyframes slideUp { from { opacity: 0; transform: translateX(-50%) translateY(20px); } }
            @keyframes slideDown { to { opacity: 0; transform: translateX(-50%) translateY(20px); } }
        `;
        document.head.appendChild(toastStyles);

        // ==================== WEB VITALS MONITORING ====================
        // Mesure LCP, FID, CLS pour le monitoring de performance
        
        if ('PerformanceObserver' in window) {
            // Largest Contentful Paint
            try {
                new PerformanceObserver((list) => {
                    const entries = list.getEntries();
                    const lastEntry = entries[entries.length - 1];
                    console.log('üìä LCP:', Math.round(lastEntry.startTime) + 'ms');
                }).observe({ type: 'largest-contentful-paint', buffered: true });
            } catch (e) {}
            
            // First Input Delay
            try {
                new PerformanceObserver((list) => {
                    const entries = list.getEntries();
                    entries.forEach(entry => {
                        console.log('üìä FID:', Math.round(entry.processingStart - entry.startTime) + 'ms');
                    });
                }).observe({ type: 'first-input', buffered: true });
            } catch (e) {}
            
            // Cumulative Layout Shift
            try {
                let clsValue = 0;
                new PerformanceObserver((list) => {
                    for (const entry of list.getEntries()) {
                        if (!entry.hadRecentInput) {
                            clsValue += entry.value;
                        }
                    }
                    console.log('üìä CLS:', clsValue.toFixed(4));
                }).observe({ type: 'layout-shift', buffered: true });
            } catch (e) {}
        }




        const Storage = {
            get: (key) => { try { const d = localStorage.getItem('spothitch_v4_' + key); return d ? JSON.parse(d) : null; } catch (e) { return null; } },
            set: (key, value) => { try { localStorage.setItem('spothitch_v4_' + key, JSON.stringify(value)); return true; } catch (e) { return false; } },
            remove: (key) => { try { localStorage.removeItem('spothitch_v4_' + key); return true; } catch (e) { return false; } }
        };

        // ==================== INDEXEDDB HELPER ====================
        // Cache offline pour les spots avec IndexedDB (pas de limite 5MB comme localStorage)
        const SpotHitchDB = {
            dbName: 'spothitch-cache',
            version: 1,
            db: null,
            
            async init() {
                if (this.db) return this.db;
                
                return new Promise((resolve, reject) => {
                    const request = indexedDB.open(this.dbName, this.version);
                    
                    request.onerror = () => reject(request.error);
                    
                    request.onsuccess = () => {
                        this.db = request.result;
                        resolve(this.db);
                    };
                    
                    request.onupgradeneeded = (event) => {
                        const db = event.target.result;
                        
                        // Store pour les spots
                        if (!db.objectStoreNames.contains('spots')) {
                            const spotsStore = db.createObjectStore('spots', { keyPath: 'id' });
                            spotsStore.createIndex('country', 'country', { unique: false });
                            spotsStore.createIndex('rating', 'rating', { unique: false });
                        }
                        
                        // Store pour les op√©rations en attente (sync offline)
                        if (!db.objectStoreNames.contains('pending-sync')) {
                            db.createObjectStore('pending-sync', { keyPath: 'id', autoIncrement: true });
                        }
                    };
                });
            },
            
            async saveSpots(spots) {
                const db = await this.init();
                const tx = db.transaction('spots', 'readwrite');
                const store = tx.objectStore('spots');
                
                for (const spot of spots) {
                    store.put({ ...spot, cachedAt: Date.now() });
                }
                
                return new Promise((resolve, reject) => {
                    tx.oncomplete = () => resolve();
                    tx.onerror = () => reject(tx.error);
                });
            },
            
            async getSpots() {
                const db = await this.init();
                const tx = db.transaction('spots', 'readonly');
                const store = tx.objectStore('spots');
                
                return new Promise((resolve, reject) => {
                    const request = store.getAll();
                    request.onsuccess = () => resolve(request.result || []);
                    request.onerror = () => reject(request.error);
                });
            },
            
            async addPendingSync(operation) {
                const db = await this.init();
                const tx = db.transaction('pending-sync', 'readwrite');
                const store = tx.objectStore('pending-sync');
                
                return new Promise((resolve, reject) => {
                    const request = store.add({ ...operation, createdAt: Date.now() });
                    request.onsuccess = () => resolve(request.result);
                    request.onerror = () => reject(request.error);
                });
            },
            
            async getPendingSync() {
                const db = await this.init();
                const tx = db.transaction('pending-sync', 'readonly');
                const store = tx.objectStore('pending-sync');
                
                return new Promise((resolve, reject) => {
                    const request = store.getAll();
                    request.onsuccess = () => resolve(request.result || []);
                    request.onerror = () => reject(request.error);
                });
            },
            
            async clearPendingSync() {
                const db = await this.init();
                const tx = db.transaction('pending-sync', 'readwrite');
                const store = tx.objectStore('pending-sync');
                
                return new Promise((resolve, reject) => {
                    const request = store.clear();
                    request.onsuccess = () => resolve();
                    request.onerror = () => reject(request.error);
                });
            }
        };
        
        // Initialiser IndexedDB au d√©marrage
        SpotHitchDB.init().then(() => console.log('üì¶ IndexedDB ready')).catch(() => {});

        // ==================== RENDER OPTIMIZATION ====================
        // Debounce et requestAnimationFrame pour des renders performants
        let renderScheduled = false;
        let pendingRenderCallback = null;
        
        function scheduleRender() {
            if (renderScheduled) return;
            renderScheduled = true;
            
            requestAnimationFrame(() => {
                renderScheduled = false;
                if (pendingRenderCallback) {
                    pendingRenderCallback();
                    pendingRenderCallback = null;
                } else {
                    actualRender();
                }
            });
        }
        
        // Debounce pour les renders rapides (ex: pendant le scroll)
        let renderDebounceTimer = null;
        function debouncedRender(delay = 16) {
            clearTimeout(renderDebounceTimer);
            renderDebounceTimer = setTimeout(scheduleRender, delay);
        }
        
        // Virtual DOM diff simplifi√© pour √©viter les re-renders complets
        const renderCache = new Map();
        function shouldRerender(componentId, newProps) {
            const cached = renderCache.get(componentId);
            if (!cached) {
                renderCache.set(componentId, JSON.stringify(newProps));
                return true;
            }
            const newPropsStr = JSON.stringify(newProps);
            if (cached === newPropsStr) return false;
            renderCache.set(componentId, newPropsStr);
            return true;
        }
        
        // Performance monitoring
        const perfMetrics = {
            renders: 0,
            lastRenderTime: 0,
            avgRenderTime: 0
        };
        
        function trackRenderPerformance(startTime) {
            const duration = performance.now() - startTime;
            perfMetrics.renders++;
            perfMetrics.lastRenderTime = duration;
            perfMetrics.avgRenderTime = (perfMetrics.avgRenderTime * (perfMetrics.renders - 1) + duration) / perfMetrics.renders;
            
            if (duration > 50) {
                console.warn(`‚ö†Ô∏è Slow render: ${duration.toFixed(2)}ms`);
            }
        }
        
        // Intersection Observer pour lazy loading
        const lazyObserver = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const el = entry.target;
                    if (el.dataset.src) {
                        el.src = el.dataset.src;
                        delete el.dataset.src;
                        lazyObserver.unobserve(el);
                    }
                    if (el.dataset.lazy) {
                        el.classList.remove('skeleton');
                        delete el.dataset.lazy;
                        lazyObserver.unobserve(el);
                    }
                }
            });
        }, { rootMargin: '100px' });
        
        // Memory management - nettoyer les anciennes donn√©es
        function cleanupOldData() {
            // Nettoyer le cache de render si trop grand
            if (renderCache.size > 100) {
                const entries = Array.from(renderCache.entries());
                entries.slice(0, 50).forEach(([key]) => renderCache.delete(key));
            }
            
            // Nettoyer le cache OSRM si trop grand
            if (typeof osrmCache !== 'undefined' && osrmCache.size > 50) {
                const entries = Array.from(osrmCache.entries());
                entries.slice(0, 25).forEach(([key]) => osrmCache.delete(key));
            }
        }
        
        // Ex√©cuter le nettoyage p√©riodiquement
        setInterval(cleanupOldData, 60000);



        // ==================== OSRM DEBOUNCE ====================
        // Rate limiting pour l'API OSRM (max 60 req/min)
        let osrmDebounceTimer = null;
        const osrmCache = new Map();
        
        async function getRouteDebounced(waypoints, delay = 500) {
            return new Promise((resolve, reject) => {
                clearTimeout(osrmDebounceTimer);
                osrmDebounceTimer = setTimeout(async () => {
                    try {
                        const cacheKey = waypoints.map(w => `${w.lat.toFixed(3)},${w.lng.toFixed(3)}`).join('|');
                        const cached = osrmCache.get(cacheKey);
                        if (cached && Date.now() - cached.ts < 300000) { resolve(cached.data); return; }
                        
                        const result = await getRoute(waypoints);
                        osrmCache.set(cacheKey, { data: result, ts: Date.now() });
                        if (osrmCache.size > 50) osrmCache.delete(osrmCache.keys().next().value);
                        resolve(result);
                    } catch (err) { reject(err); }
                }, delay);
            });
        }

        // ==================== IMAGE COMPRESSION ====================
        // Compresse les images avant upload
        async function compressImage(dataUrl, maxWidth = 1200, quality = 0.8) {
            return new Promise((resolve, reject) => {
                const img = new Image();
                img.onload = () => {
                    let { width, height } = img;
                    if (width > maxWidth) {
                        height = Math.round(height * (maxWidth / width));
                        width = maxWidth;
                    }
                    const canvas = document.createElement('canvas');
                    canvas.width = width;
                    canvas.height = height;
                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(img, 0, 0, width, height);
                    const compressed = canvas.toDataURL('image/jpeg', quality);
                    console.log(`üì∏ Compressed: ${Math.round(dataUrl.length/1024)}KB ‚Üí ${Math.round(compressed.length/1024)}KB`);
                    resolve(compressed);
                };
                img.onerror = () => reject(new Error('Image load failed'));
                img.src = dataUrl;
            });
        }
        
        async function compressImageFile(file, maxWidth = 1200, quality = 0.8) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = async (e) => {
                    try { resolve(await compressImage(e.target.result, maxWidth, quality)); }
                    catch (err) { reject(err); }
                };
                reader.onerror = () => reject(new Error('File read failed'));
                reader.readAsDataURL(file);
            });
        }


        // ==================== TRANSLATIONS ====================
        const translations = {
            fr: {
                appName: 'SpotHitch', tagline: 'La communaut√© des autostoppeurs',
                welcome: 'Bienvenue !', welcomeDesc: 'Rejoins la communaut√© des autostoppeurs',
                yourUsername: 'Ton pseudo', chooseAvatar: 'Choisis ton avatar', letsGo: "C'est parti !",
                spots: 'Spots', map: 'Carte', planner: 'Voyage', chat: 'Chat', profile: 'Profil',
                friends: 'Amis', guides: 'Guides', safety: 'S√©curit√©', missions: 'Missions',
                searchSpot: 'Rechercher un spot...', addSpot: 'Ajouter un spot',
                from: 'D√©part', to: 'Destination', description: 'Description du spot',
                takePhoto: 'Prendre une photo', photoRequired: 'üì∏ Photo obligatoire',
                chooseFromGallery: 'ou choisir depuis la galerie', create: 'Partager',
                reviews: 'avis', verified: 'V√©rifi√©',
                topSpot: 'Top', goodSpot: 'Bon', newSpot: 'Nouveau', oldSpot: 'Ancien',
                estimatedWait: 'Attente', lastUsed: 'Derni√®re utilisation',
                checkin: 'Check-in', checkinSuccess: 'Check-in enregistr√© !',
                rate: '√âvaluer', rateSpot: '√âvalue ce spot',
                waitTime: "Temps d'attente", accessibility: 'Accessibilit√©',
                safetyRating: 'S√©curit√©', visibility: 'Visibilit√©', traffic: 'Trafic',
                comment: 'Commentaire', submit: 'Publier',
                planTrip: 'Planifier un voyage', addStep: 'Ajouter une √©tape',
                startCity: 'Ville de d√©part', endCity: 'Destination',
                bestSpots: 'Top 3 spots', saveTrip: 'Sauvegarder',
                myTrips: 'Mes voyages', noTrips: 'Aucun voyage', startTrip: 'D√©marrer',
                activeTrip: 'Voyage en cours', endTrip: 'Terminer',
                level: 'Niveau', points: 'points', spotsShared: 'Spots',
                checkinsCount: 'Check-ins', reviewsGiven: 'Avis', streak: 'S√©rie',
                settings: 'Param√®tres', exportData: 'Exporter', resetApp: 'R√©initialiser',
                reminderTitle: 'Comment √©tait ce spot ?', reminderDesc: 'Partage ton exp√©rience !',
                remindLater: 'Plus tard',
                filterAll: 'Tous', filterTop: 'Top', filterRecent: 'R√©cents', filterNearby: 'Proches',
                sortBy: 'Trier', rating: 'Note', recent: 'R√©cent', popular: 'Populaire',
                noSpots: 'Aucun spot', beFirst: 'Sois le premier !',
                reportIssue: 'Signaler',
                // Chat
                general: 'G√©n√©ral', help: 'Aide', meetups: 'Rencontres', routes: 'Itin√©raires',
                typeMessage: '√âcris ton message...', send: 'Envoyer',
                // Friends
                online: 'En ligne', traveling: 'En voyage', addFriend: 'Ajouter',
                // Guides
                guidesTitle: 'Guides par pays', legal: 'L√©gal', difficulty: 'Difficult√©', tips: 'Conseils',
                // Safety
                safetyTips: 'Conseils de s√©curit√©', emergencyNumbers: "Num√©ros d'urgence",
                // SOS
                sosTitle: 'Mode Urgence', sosDesc: 'Partage ta position avec tes contacts',
                shareLocation: 'Partager ma position', stopSharing: 'Arr√™ter',
                emergencyContacts: "Contacts d'urgence", addContact: 'Ajouter',
                callEmergency: 'Appeler les secours', iAmSafe: 'Je suis en s√©curit√©',
                locationShared: 'Position partag√©e !',
                // Tutorial
                tutoSkip: 'Passer', tutoNext: 'Suivant', tutoPrev: 'Pr√©c√©dent', tutoFinish: 'Terminer',
                tuto1Title: 'üè† Fil d\'actualit√©', tuto1Desc: 'Ici tu vois l\'activit√© de tes amis et les spots populaires du moment. C\'est ton point de d√©part !',
                tuto2Title: 'üó∫Ô∏è Spots & Carte', tuto2Desc: 'Explore tous les spots en liste ou sur une carte interactive. 40 spots v√©rifi√©s dans 12 pays !',
                tuto3Title: '‚ûï Ajouter un spot', tuto3Desc: 'Partage tes meilleurs spots avec la communaut√©. Photo + localisation + description. Tu gagnes des points !',
                tuto4Title: 'üì∏ Les cartes de spots', tuto4Desc: 'Clique sur un spot pour voir les d√©tails complets, les avis, le bouton GPS pour naviguer, et plus encore.',
                tuto5Title: 'üí¨ Chat', tuto5Desc: 'Discute avec tes amis ou pose des questions sur un pays avant ton d√©part. Communaut√© active !',
                tuto6Title: 'üß≠ Planifier', tuto6Desc: 'Cr√©e ton itin√©raire et d√©couvre les meilleurs spots sur ta route. Estime le temps de voyage.',
                tuto7Title: 'üë§ Ton profil', tuto7Desc: 'Tes stats, badges, boutique de r√©compenses, quiz, et param√®tres. Consulte aussi les guides par pays.',
                tuto8Title: 'üÜò Bouton SOS', tuto8Desc: 'En urgence, partage ta position GPS en temps r√©el avec tes contacts de confiance. S√©curit√© avant tout !',
                // Quiz
                quiz: 'Quiz', quizTitle: 'Quiz Voyage', quizDesc: 'Teste tes connaissances !',
                quizSolo: 'Solo', quizVsFriend: 'VS Ami', quizWorld: 'Monde',
                quizCategories: 'Cat√©gories', quizCapitals: 'Capitales', quizFlags: 'Drapeaux',
                quizGeography: 'G√©ographie', quizCulture: 'Culture', quizHitchhiking: 'Autostop',
                quizStart: 'Commencer', quizQuestion: 'Question', quizScore: 'Score',
                quizCorrect: 'Bonne r√©ponse !', quizWrong: 'Mauvaise r√©ponse',
                quizFinished: 'Quiz termin√© !', quizYourScore: 'Ton score', quizBestScore: 'Meilleur score',
                quizPlayAgain: 'Rejouer', quizLeaderboard: 'Classement', quizChallenge: 'D√©fier',
                // GPS
                gpsDisabled: 'Active ta localisation pour voir les spots proches',
                gpsActivate: 'Activer le GPS',
                // Wizard
                wizardStep1: 'Photo', wizardStep2: 'Infos', wizardStep3: 'Confirmer',
                wizardTakePhoto: 'Prends une photo du spot', wizardAddInfo: 'Ajoute les informations',
                wizardConfirm: 'V√©rifie et publie', wizardBack: 'Retour', wizardNext: 'Suivant',
                wizardPublish: 'Publier le spot',
                // M√©t√©o
                weather: 'M√©t√©o', sunny: 'Ensoleill√©', cloudy: 'Nuageux', rainy: 'Pluvieux', weatherNow: 'M√©t√©o actuelle',
                // Filtres avanc√©s
                filters: 'Filtres', minRating: 'Note minimum', maxWait: 'Attente max', applyFilters: 'Appliquer', resetFilters: 'R√©initialiser',
                // Commentaires
                comments: 'Commentaires', addComment: 'Ajouter un commentaire', noComments: 'Aucun commentaire', writeComment: '√âcrire...',
                // Partage
                share: 'Partager', shareSpot: 'Partager ce spot', copyLink: 'Copier le lien', linkCopied: 'Lien copi√© !',
                // Hors-ligne
                offline: 'Hors-ligne', savedOffline: 'Sauvegard√©', saveOffline: 'Sauvegarder', offlineSpots: 'Spots sauvegard√©s',
                // Badges
                badges: 'Badges', badgeUnlocked: 'Badge d√©bloqu√© !', badgeFirstSpot: 'Premier Spot', badgeExplorer: 'Explorateur',
                badge10Checkins: '10 Check-ins', badgeReviewer: 'Critique', badgeHelper: 'Entraide', badgeQuizMaster: 'Quiz Master',
                badgeWeekStreak: 'Semaine Parfaite', badgeTraveler: 'Grand Voyageur', badgeLegend: 'L√©gende',
                // D√©fis
                challenges: 'D√©fis', weeklyChallenge: 'D√©fi de la semaine', dailyChallenge: 'D√©fi du jour',
                challengeProgress: 'Progression', challengeReward: 'R√©compense', challengeComplete: 'D√©fi termin√© !',
                // Messages priv√©s
                messages: 'Messages', privateMessage: 'Message priv√©', sendMessage: 'Envoyer', noMessages: 'Aucun message',
                // Position live
                liveLocation: 'Position live', shareLive: 'Partager en direct', stopLive: 'Arr√™ter', friendsNearby: 'Amis proches',
                // Historique
                history: 'Historique', tripHistory: 'Historique des trajets', totalDistance: 'Distance totale', totalTrips: 'Voyages',
                // Th√®me
                theme: 'Th√®me', darkMode: 'Mode sombre', lightMode: 'Mode clair',
                // Stats
                statistics: 'Statistiques', monthlyStats: 'Ce mois', yearlyStats: 'Cette ann√©e',
                // Auth
                login: 'Connexion', register: 'Inscription', logout: 'D√©connexion',
                // Navigation
                home: 'Accueil', feed: 'Fil', spotsMap: 'Spots & Carte',
                // Fil d'actualit√©
                activity: 'Activit√©', friendsActivity: 'Activit√© de tes amis',
                popularSpots: 'Spots populaires', sponsoredSpots: 'Spots recommand√©s',
                noActivity: 'Aucune activit√© r√©cente',
                sharedSpot: 'a partag√© un spot', checkedIn: 'a fait un check-in',
                reviewedSpot: 'a √©valu√© un spot', earnedBadge: 'a gagn√© un badge',
                // Chats
                chatRooms: 'Salons', friendsChat: 'Amis', countryChat: 'Chat pays',
                selectCountry: 'Choisis un pays', joinChat: 'Rejoindre',
                email: 'Email', password: 'Mot de passe', confirmPassword: 'Confirmer',
                forgotPassword: 'Mot de passe oubli√© ?', resetPassword: 'R√©initialiser',
                orContinueWith: 'Ou continuer avec', continueWithGoogle: 'Continuer avec Google',
                noAccount: 'Pas de compte ?', alreadyAccount: 'D√©j√† un compte ?',
                createAccount: 'Cr√©er un compte', loginNow: 'Se connecter',
                passwordResetSent: 'Email de r√©initialisation envoy√© !',
                authError: 'Erreur d\'authentification',
                passwordMismatch: 'Les mots de passe ne correspondent pas',
                weakPassword: 'Le mot de passe doit contenir au moins 6 caract√®res',
                emailInUse: 'Cet email est d√©j√† utilis√©',
                invalidEmail: 'Email invalide',
                userNotFound: 'Utilisateur non trouv√©',
                wrongPassword: 'Mot de passe incorrect',
                // Boutique & R√©compenses
                shop: 'Boutique', rewards: 'R√©compenses', myRewards: 'Mes r√©compenses',
                pointsRequired: 'points', redeem: '√âchanger', redeemed: 'Obtenu !',
                notEnoughPoints: 'Points insuffisants', useReward: 'Utiliser', expires: 'Expire le',
                rewardCode: 'Code promo', copyCode: 'Copier', codeCopied: 'Code copi√© !',
                noRewards: 'Aucune r√©compense', earnMore: 'Gagne des points pour d√©bloquer des r√©ductions !',
                availableRewards: 'R√©compenses disponibles', partnerOffers: 'Offres partenaires',
                // Niveaux VIP
                vipLevel: 'Niveau', bronze: 'Bronze', silver: 'Argent', gold: 'Or', diamond: 'Diamant',
                nextLevel: 'Prochain niveau', vipBonus: 'Bonus VIP', exclusiveOffers: 'Offres exclusives',
                // Validation spots
                validate: 'Valider', validated: 'Valid√©', validations: 'validations',
                spotValidated: 'Spot valid√© ! Le cr√©ateur a gagn√© des points',
                pendingValidation: 'En attente de validation', validatedSpot: 'Spot v√©rifi√©',
                yourSpotValidated: 'Ton spot a √©t√© valid√© !',
                // Boutique
                shop: 'Boutique', rewards: 'R√©compenses', myRewards: 'Mes r√©compenses',
                pointsRequired: 'points requis', redeem: '√âchanger', redeemed: 'Obtenu !',
                notEnoughPoints: 'Points insuffisants', useReward: 'Utiliser', expires: 'Expire le',
                rewardCode: 'Code promo', copyCode: 'Copier', codeCopied: 'Code copi√© !',
                noRewards: 'Aucune r√©compense', earnMore: 'Gagne des points pour d√©bloquer des r√©ductions !',
                // Pages l√©gales
                legal: 'L√©gal', termsOfService: 'Conditions d\'utilisation', privacyPolicy: 'Politique de confidentialit√©',
                legalNotice: 'Mentions l√©gales', backToApp: '‚Üê Retour', lastUpdated: 'Derni√®re mise √† jour',
                acceptTerms: 'En continuant, tu acceptes nos',
                // Signalement
                report: 'Signaler', reportSpot: 'Signaler ce spot', reportUser: 'Signaler cet utilisateur',
                reportReason: 'Raison du signalement', reportDetails: 'D√©tails (optionnel)',
                reportSubmit: 'Envoyer le signalement', reportSuccess: 'Signalement envoy√©. Merci !',
                reportError: 'Erreur lors du signalement', alreadyReported: 'Tu as d√©j√† signal√© ce contenu',
                reasonInaccurate: 'Informations incorrectes', reasonDangerous: 'Spot dangereux',
                reasonClosed: 'Spot ferm√©/inaccessible', reasonDuplicate: 'Doublon d\'un autre spot',
                reasonSpam: 'Spam ou publicit√©', reasonOffensive: 'Contenu offensant', reasonOther: 'Autre',
                underReview: 'En cours de v√©rification', cancel: 'Annuler'
            },
            en: {
                appName: 'SpotHitch', tagline: 'The hitchhiking community',
                welcome: 'Welcome!', welcomeDesc: 'Join the hitchhiking community',
                yourUsername: 'Username', chooseAvatar: 'Choose avatar', letsGo: "Let's go!",
                spots: 'Spots', map: 'Map', planner: 'Trips', chat: 'Chat', profile: 'Profile',
                friends: 'Friends', guides: 'Guides', safety: 'Safety', missions: 'Missions',
                searchSpot: 'Search spot...', addSpot: 'Add spot',
                from: 'From', to: 'To', description: 'Spot description',
                takePhoto: 'Take photo', photoRequired: 'üì∏ Photo required',
                chooseFromGallery: 'or choose from gallery', create: 'Share',
                reviews: 'reviews', verified: 'Verified',
                topSpot: 'Top', goodSpot: 'Good', newSpot: 'New', oldSpot: 'Old',
                estimatedWait: 'Wait', lastUsed: 'Last used',
                checkin: 'Check-in', checkinSuccess: 'Check-in recorded!',
                rate: 'Rate', rateSpot: 'Rate this spot',
                waitTime: 'Wait time', accessibility: 'Accessibility',
                safetyRating: 'Safety', visibility: 'Visibility', traffic: 'Traffic',
                comment: 'Comment', submit: 'Submit',
                planTrip: 'Plan a trip', addStep: 'Add stop',
                startCity: 'Starting city', endCity: 'Destination',
                bestSpots: 'Top 3 spots', saveTrip: 'Save',
                myTrips: 'My trips', noTrips: 'No trips', startTrip: 'Start',
                activeTrip: 'Active trip', endTrip: 'End trip',
                level: 'Level', points: 'points', spotsShared: 'Spots',
                checkinsCount: 'Check-ins', reviewsGiven: 'Reviews', streak: 'Streak',
                settings: 'Settings', exportData: 'Export', resetApp: 'Reset',
                reminderTitle: 'How was this spot?', reminderDesc: 'Share your experience!',
                remindLater: 'Later',
                filterAll: 'All', filterTop: 'Top', filterRecent: 'Recent', filterNearby: 'Nearby',
                sortBy: 'Sort', rating: 'Rating', recent: 'Recent', popular: 'Popular',
                noSpots: 'No spots', beFirst: 'Be the first!',
                reportIssue: 'Report',
                general: 'General', help: 'Help', meetups: 'Meetups', routes: 'Routes',
                typeMessage: 'Type message...', send: 'Send',
                online: 'Online', traveling: 'Traveling', addFriend: 'Add',
                guidesTitle: 'Country guides', legal: 'Legal', difficulty: 'Difficulty', tips: 'Tips',
                safetyTips: 'Safety tips', emergencyNumbers: 'Emergency numbers',
                sosTitle: 'Emergency Mode', sosDesc: 'Share your location with contacts',
                shareLocation: 'Share location', stopSharing: 'Stop',
                emergencyContacts: 'Emergency contacts', addContact: 'Add',
                callEmergency: 'Call emergency', iAmSafe: 'I am safe',
                locationShared: 'Location shared!',
                // Tutorial
                tutoSkip: 'Skip', tutoNext: 'Next', tutoPrev: 'Previous', tutoFinish: 'Finish',
                tuto1Title: 'üè† Activity Feed', tuto1Desc: 'See your friends\' activity and popular spots. This is your starting point!',
                tuto2Title: 'üó∫Ô∏è Spots & Map', tuto2Desc: 'Explore all spots as a list or on an interactive map. 40 verified spots in 12 countries!',
                tuto3Title: '‚ûï Add a spot', tuto3Desc: 'Share your best spots with the community. Photo + location + description. Earn points!',
                tuto4Title: 'üì∏ Spot cards', tuto4Desc: 'Tap a spot for full details, reviews, GPS navigation button, and more.',
                tuto5Title: 'üí¨ Chat', tuto5Desc: 'Chat with friends or ask questions about a country before your trip. Active community!',
                tuto6Title: 'üß≠ Plan', tuto6Desc: 'Create your itinerary and discover the best spots on your route. Estimate travel time.',
                tuto7Title: 'üë§ Your profile', tuto7Desc: 'Your stats, badges, rewards shop, quiz, and settings. Also check country guides.',
                tuto8Title: 'üÜò SOS Button', tuto8Desc: 'In emergency, share your live GPS location with trusted contacts. Safety first!',
                // Quiz
                quiz: 'Quiz', quizTitle: 'Travel Quiz', quizDesc: 'Test your knowledge!',
                quizSolo: 'Solo', quizVsFriend: 'VS Friend', quizWorld: 'World',
                quizCategories: 'Categories', quizCapitals: 'Capitals', quizFlags: 'Flags',
                quizGeography: 'Geography', quizCulture: 'Culture', quizHitchhiking: 'Hitchhiking',
                quizStart: 'Start', quizQuestion: 'Question', quizScore: 'Score',
                quizCorrect: 'Correct!', quizWrong: 'Wrong answer',
                quizFinished: 'Quiz finished!', quizYourScore: 'Your score', quizBestScore: 'Best score',
                quizPlayAgain: 'Play again', quizLeaderboard: 'Leaderboard', quizChallenge: 'Challenge',
                // GPS
                gpsDisabled: 'Enable location to see nearby spots',
                gpsActivate: 'Enable GPS',
                // Wizard
                wizardStep1: 'Photo', wizardStep2: 'Info', wizardStep3: 'Confirm',
                wizardTakePhoto: 'Take a photo of the spot', wizardAddInfo: 'Add information',
                wizardConfirm: 'Review and publish', wizardBack: 'Back', wizardNext: 'Next',
                wizardPublish: 'Publish spot',
                // Weather
                weather: 'Weather', sunny: 'Sunny', cloudy: 'Cloudy', rainy: 'Rainy', weatherNow: 'Current weather',
                // Advanced filters
                filters: 'Filters', minRating: 'Min rating', maxWait: 'Max wait', applyFilters: 'Apply', resetFilters: 'Reset',
                // Comments
                comments: 'Comments', addComment: 'Add comment', noComments: 'No comments', writeComment: 'Write...',
                // Share
                share: 'Share', shareSpot: 'Share this spot', copyLink: 'Copy link', linkCopied: 'Link copied!',
                // Offline
                offline: 'Offline', savedOffline: 'Saved', saveOffline: 'Save', offlineSpots: 'Saved spots',
                // Badges
                badges: 'Badges', badgeUnlocked: 'Badge unlocked!', badgeFirstSpot: 'First Spot', badgeExplorer: 'Explorer',
                badge10Checkins: '10 Check-ins', badgeReviewer: 'Reviewer', badgeHelper: 'Helper', badgeQuizMaster: 'Quiz Master',
                badgeWeekStreak: 'Perfect Week', badgeTraveler: 'Great Traveler', badgeLegend: 'Legend',
                // Challenges
                challenges: 'Challenges', weeklyChallenge: 'Weekly challenge', dailyChallenge: 'Daily challenge',
                challengeProgress: 'Progress', challengeReward: 'Reward', challengeComplete: 'Challenge complete!',
                // Private messages
                messages: 'Messages', privateMessage: 'Private message', sendMessage: 'Send', noMessages: 'No messages',
                // Live location
                liveLocation: 'Live location', shareLive: 'Share live', stopLive: 'Stop', friendsNearby: 'Friends nearby',
                // History
                history: 'History', tripHistory: 'Trip history', totalDistance: 'Total distance', totalTrips: 'Trips',
                // Theme
                theme: 'Theme', darkMode: 'Dark mode', lightMode: 'Light mode',
                // Stats
                statistics: 'Statistics', monthlyStats: 'This month', yearlyStats: 'This year',
                // Auth
                login: 'Login', register: 'Register', logout: 'Logout',
                // Navigation
                home: 'Home', feed: 'Feed', spotsMap: 'Spots & Map',
                // Activity Feed
                activity: 'Activity', friendsActivity: 'Friends activity',
                popularSpots: 'Popular spots', sponsoredSpots: 'Recommended spots',
                noActivity: 'No recent activity',
                sharedSpot: 'shared a spot', checkedIn: 'checked in',
                reviewedSpot: 'reviewed a spot', earnedBadge: 'earned a badge',
                // Chats
                chatRooms: 'Rooms', friendsChat: 'Friends', countryChat: 'Country chat',
                selectCountry: 'Choose a country', joinChat: 'Join',
                email: 'Email', password: 'Password', confirmPassword: 'Confirm',
                forgotPassword: 'Forgot password?', resetPassword: 'Reset',
                orContinueWith: 'Or continue with', continueWithGoogle: 'Continue with Google',
                noAccount: 'No account?', alreadyAccount: 'Already have an account?',
                createAccount: 'Create account', loginNow: 'Login now',
                passwordResetSent: 'Password reset email sent!',
                authError: 'Authentication error',
                passwordMismatch: 'Passwords do not match',
                weakPassword: 'Password must be at least 6 characters',
                emailInUse: 'This email is already in use',
                invalidEmail: 'Invalid email',
                userNotFound: 'User not found',
                wrongPassword: 'Wrong password',
                // Shop & Rewards
                shop: 'Shop', rewards: 'Rewards', myRewards: 'My rewards',
                pointsRequired: 'points', redeem: 'Redeem', redeemed: 'Redeemed!',
                notEnoughPoints: 'Not enough points', useReward: 'Use', expires: 'Expires',
                rewardCode: 'Promo code', copyCode: 'Copy', codeCopied: 'Code copied!',
                noRewards: 'No rewards', earnMore: 'Earn points to unlock discounts!',
                availableRewards: 'Available rewards', partnerOffers: 'Partner offers',
                // VIP Levels
                vipLevel: 'Level', bronze: 'Bronze', silver: 'Silver', gold: 'Gold', diamond: 'Diamond',
                nextLevel: 'Next level', vipBonus: 'VIP Bonus', exclusiveOffers: 'Exclusive offers',
                // Spot validation
                validate: 'Validate', validated: 'Validated', validations: 'validations',
                spotValidated: 'Spot validated! Creator earned points',
                pendingValidation: 'Pending validation', validatedSpot: 'Verified spot',
                yourSpotValidated: 'Your spot was validated!',
                // Legal pages
                legal: 'Legal', termsOfService: 'Terms of Service', privacyPolicy: 'Privacy Policy',
                legalNotice: 'Legal Notice', backToApp: '‚Üê Back', lastUpdated: 'Last updated',
                acceptTerms: 'By continuing, you agree to our',
                // Reporting
                report: 'Report', reportSpot: 'Report this spot', reportUser: 'Report this user',
                reportReason: 'Reason for report', reportDetails: 'Details (optional)',
                reportSubmit: 'Submit report', reportSuccess: 'Report submitted. Thank you!',
                reportError: 'Error submitting report', alreadyReported: 'You have already reported this',
                reasonInaccurate: 'Inaccurate information', reasonDangerous: 'Dangerous spot',
                reasonClosed: 'Spot closed/inaccessible', reasonDuplicate: 'Duplicate spot',
                reasonSpam: 'Spam or advertising', reasonOffensive: 'Offensive content', reasonOther: 'Other',
                underReview: 'Under review', cancel: 'Cancel'
            },
            es: {
                appName: 'SpotHitch', tagline: 'La comunidad de autoestopistas',
                welcome: '¬°Bienvenido!', welcomeDesc: '√önete a la comunidad de autoestopistas',
                yourUsername: 'Tu nombre de usuario', chooseAvatar: 'Elige tu avatar', letsGo: '¬°Vamos!',
                spots: 'Spots', map: 'Mapa', planner: 'Viaje', chat: 'Chat', profile: 'Perfil',
                friends: 'Amigos', guides: 'Gu√≠as', safety: 'Seguridad', missions: 'Misiones',
                searchSpot: 'Buscar un spot...', addSpot: 'A√±adir un spot',
                from: 'Origen', to: 'Destino', description: 'Descripci√≥n del spot',
                takePhoto: 'Tomar foto', photoRequired: 'üì∏ Foto obligatoria',
                chooseFromGallery: 'o elegir de la galer√≠a', create: 'Compartir',
                reviews: 'opiniones', verified: 'Verificado',
                topSpot: 'Top', goodSpot: 'Bueno', newSpot: 'Nuevo', oldSpot: 'Antiguo',
                estimatedWait: 'Espera', lastUsed: '√öltimo uso',
                checkin: 'Check-in', checkinSuccess: '¬°Check-in registrado!',
                rate: 'Evaluar', rateSpot: 'Eval√∫a este spot',
                waitTime: 'Tiempo de espera', accessibility: 'Accesibilidad',
                safetyRating: 'Seguridad', visibility: 'Visibilidad', traffic: 'Tr√°fico',
                comment: 'Comentario', submit: 'Publicar',
                planTrip: 'Planificar un viaje', addStep: 'A√±adir parada',
                startCity: 'Ciudad de origen', endCity: 'Destino',
                bestSpots: 'Top 3 spots', saveTrip: 'Guardar',
                myTrips: 'Mis viajes', noTrips: 'Ning√∫n viaje', startTrip: 'Iniciar',
                activeTrip: 'Viaje activo', endTrip: 'Terminar',
                level: 'Nivel', points: 'puntos', spotsShared: 'Spots',
                checkinsCount: 'Check-ins', reviewsGiven: 'Opiniones', streak: 'Racha',
                settings: 'Ajustes', exportData: 'Exportar', resetApp: 'Reiniciar',
                reminderTitle: '¬øC√≥mo fue este spot?', reminderDesc: '¬°Comparte tu experiencia!',
                remindLater: 'M√°s tarde',
                filterAll: 'Todos', filterTop: 'Top', filterRecent: 'Recientes', filterNearby: 'Cercanos',
                sortBy: 'Ordenar', rating: 'Valoraci√≥n', recent: 'Reciente', popular: 'Popular',
                noSpots: 'Sin spots', beFirst: '¬°S√© el primero!',
                reportIssue: 'Reportar',
                general: 'General', help: 'Ayuda', meetups: 'Encuentros', routes: 'Rutas',
                typeMessage: 'Escribe tu mensaje...', send: 'Enviar',
                online: 'En l√≠nea', traveling: 'Viajando', addFriend: 'A√±adir',
                guidesTitle: 'Gu√≠as por pa√≠s', legal: 'Legal', difficulty: 'Dificultad', tips: 'Consejos',
                safetyTips: 'Consejos de seguridad', emergencyNumbers: 'N√∫meros de emergencia',
                sosTitle: 'Modo Emergencia', sosDesc: 'Comparte tu ubicaci√≥n con tus contactos',
                shareLocation: 'Compartir ubicaci√≥n', stopSharing: 'Detener',
                emergencyContacts: 'Contactos de emergencia', addContact: 'A√±adir',
                callEmergency: 'Llamar a emergencias', iAmSafe: 'Estoy a salvo',
                locationShared: '¬°Ubicaci√≥n compartida!',
                tutoSkip: 'Saltar', tutoNext: 'Siguiente', tutoPrev: 'Anterior', tutoFinish: 'Terminar',
                tuto1Title: 'üè† Inicio', tuto1Desc: 'Aqu√≠ ves la actividad de tus amigos y los spots populares. ¬°Es tu punto de partida!',
                tuto2Title: 'üó∫Ô∏è Spots y Mapa', tuto2Desc: 'Explora todos los spots en lista o en un mapa interactivo. ¬°100 spots verificados en 25 pa√≠ses!',
                tuto3Title: '‚ûï A√±adir un spot', tuto3Desc: 'Comparte tus mejores spots con la comunidad. Foto + ubicaci√≥n + descripci√≥n. ¬°Ganas puntos!',
                tuto4Title: 'üì∏ Tarjetas de spots', tuto4Desc: 'Haz clic en un spot para ver todos los detalles, opiniones, bot√≥n GPS para navegar, y m√°s.',
                tuto5Title: 'üí¨ Chat', tuto5Desc: 'Habla con tus amigos o haz preguntas sobre un pa√≠s antes de tu viaje. ¬°Comunidad activa!',
                tuto6Title: 'üß≠ Planificar', tuto6Desc: 'Crea tu itinerario y descubre los mejores spots en tu ruta. Estima el tiempo de viaje.',
                tuto7Title: 'üë§ Tu perfil', tuto7Desc: 'Tus estad√≠sticas, insignias, tienda de recompensas, quiz y ajustes. Consulta tambi√©n las gu√≠as por pa√≠s.',
                tuto8Title: 'üÜò Bot√≥n SOS', tuto8Desc: 'En emergencia, comparte tu ubicaci√≥n GPS en tiempo real con tus contactos de confianza. ¬°Seguridad ante todo!',
                quiz: 'Quiz', quizTitle: 'Quiz de Viaje', quizDesc: '¬°Pon a prueba tus conocimientos!',
                quizSolo: 'Solo', quizVsFriend: 'VS Amigo', quizWorld: 'Mundo',
                quizCategories: 'Categor√≠as', quizCapitals: 'Capitales', quizFlags: 'Banderas',
                quizGeography: 'Geograf√≠a', quizCulture: 'Cultura', quizHitchhiking: 'Autoestop',
                quizStart: 'Empezar', quizQuestion: 'Pregunta', quizScore: 'Puntuaci√≥n',
                quizCorrect: '¬°Respuesta correcta!', quizWrong: 'Respuesta incorrecta',
                quizFinished: '¬°Quiz terminado!', quizYourScore: 'Tu puntuaci√≥n', quizBestScore: 'Mejor puntuaci√≥n',
                quizPlayAgain: 'Jugar de nuevo', quizLeaderboard: 'Clasificaci√≥n', quizChallenge: 'Desafiar',
                gpsDisabled: 'Activa tu ubicaci√≥n para ver los spots cercanos',
                gpsActivate: 'Activar GPS',
                wizardStep1: 'Foto', wizardStep2: 'Info', wizardStep3: 'Confirmar',
                wizardTakePhoto: 'Toma una foto del spot', wizardAddInfo: 'A√±ade la informaci√≥n',
                wizardConfirm: 'Verifica y publica', wizardBack: 'Atr√°s', wizardNext: 'Siguiente',
                wizardPublish: 'Publicar el spot',
                weather: 'Tiempo', sunny: 'Soleado', cloudy: 'Nublado', rainy: 'Lluvioso', weatherNow: 'Tiempo actual',
                filters: 'Filtros', minRating: 'Valoraci√≥n m√≠nima', maxWait: 'Espera m√°x', applyFilters: 'Aplicar', resetFilters: 'Reiniciar',
                comments: 'Comentarios', addComment: 'A√±adir comentario', noComments: 'Sin comentarios', writeComment: 'Escribir...',
                share: 'Compartir', shareSpot: 'Compartir este spot', copyLink: 'Copiar enlace', linkCopied: '¬°Enlace copiado!',
                offline: 'Sin conexi√≥n', savedOffline: 'Guardado', saveOffline: 'Guardar', offlineSpots: 'Spots guardados',
                badges: 'Insignias', badgeUnlocked: '¬°Insignia desbloqueada!', badgeFirstSpot: 'Primer Spot', badgeExplorer: 'Explorador',
                badge10Checkins: '10 Check-ins', badgeReviewer: 'Cr√≠tico', badgeHelper: 'Ayudante', badgeQuizMaster: 'Maestro Quiz',
                badgeWeekStreak: 'Semana Perfecta', badgeTraveler: 'Gran Viajero', badgeLegend: 'Leyenda',
                challenges: 'Desaf√≠os', weeklyChallenge: 'Desaf√≠o semanal', dailyChallenge: 'Desaf√≠o diario',
                challengeProgress: 'Progreso', challengeReward: 'Recompensa', challengeComplete: '¬°Desaf√≠o completado!',
                messages: 'Mensajes', privateMessage: 'Mensaje privado', sendMessage: 'Enviar', noMessages: 'Sin mensajes',
                liveLocation: 'Ubicaci√≥n en vivo', shareLive: 'Compartir en directo', stopLive: 'Detener', friendsNearby: 'Amigos cercanos',
                history: 'Historial', tripHistory: 'Historial de viajes', totalDistance: 'Distancia total', totalTrips: 'Viajes',
                theme: 'Tema', darkMode: 'Modo oscuro', lightMode: 'Modo claro',
                statistics: 'Estad√≠sticas', monthlyStats: 'Este mes', yearlyStats: 'Este a√±o',
                login: 'Iniciar sesi√≥n', register: 'Registrarse', logout: 'Cerrar sesi√≥n',
                home: 'Inicio', feed: 'Feed', spotsMap: 'Spots y Mapa',
                activity: 'Actividad', friendsActivity: 'Actividad de tus amigos',
                popularSpots: 'Spots populares', sponsoredSpots: 'Spots recomendados',
                noActivity: 'Sin actividad reciente',
                sharedSpot: 'comparti√≥ un spot', checkedIn: 'hizo check-in',
                reviewedSpot: 'evalu√≥ un spot', earnedBadge: 'gan√≥ una insignia',
                chatRooms: 'Salas', friendsChat: 'Amigos', countryChat: 'Chat de pa√≠s',
                selectCountry: 'Elige un pa√≠s', joinChat: 'Unirse',
                email: 'Correo electr√≥nico', password: 'Contrase√±a', confirmPassword: 'Confirmar',
                forgotPassword: '¬øOlvidaste tu contrase√±a?', resetPassword: 'Restablecer',
                orContinueWith: 'O continuar con', continueWithGoogle: 'Continuar con Google',
                noAccount: '¬øNo tienes cuenta?', alreadyAccount: '¬øYa tienes cuenta?',
                createAccount: 'Crear cuenta', loginNow: 'Iniciar sesi√≥n',
                passwordResetSent: '¬°Correo de restablecimiento enviado!',
                authError: 'Error de autenticaci√≥n',
                passwordMismatch: 'Las contrase√±as no coinciden',
                weakPassword: 'La contrase√±a debe tener al menos 6 caracteres',
                emailInUse: 'Este correo ya est√° en uso',
                invalidEmail: 'Correo inv√°lido',
                userNotFound: 'Usuario no encontrado',
                wrongPassword: 'Contrase√±a incorrecta',
                shop: 'Tienda', rewards: 'Recompensas', myRewards: 'Mis recompensas',
                pointsRequired: 'puntos', redeem: 'Canjear', redeemed: '¬°Canjeado!',
                notEnoughPoints: 'Puntos insuficientes', useReward: 'Usar', expires: 'Expira el',
                rewardCode: 'C√≥digo promo', copyCode: 'Copiar', codeCopied: '¬°C√≥digo copiado!',
                noRewards: 'Sin recompensas', earnMore: '¬°Gana puntos para desbloquear descuentos!',
                availableRewards: 'Recompensas disponibles', partnerOffers: 'Ofertas de socios',
                vipLevel: 'Nivel', bronze: 'Bronce', silver: 'Plata', gold: 'Oro', diamond: 'Diamante',
                nextLevel: 'Siguiente nivel', vipBonus: 'Bonus VIP', exclusiveOffers: 'Ofertas exclusivas',
                validate: 'Validar', validated: 'Validado', validations: 'validaciones',
                spotValidated: '¬°Spot validado! El creador gan√≥ puntos',
                pendingValidation: 'Pendiente de validaci√≥n', validatedSpot: 'Spot verificado',
                yourSpotValidated: '¬°Tu spot fue validado!',
                back: 'Atr√°s', viewOnMap: 'Ver en mapa', spotsOnRoute: 'spots en la ruta',
                countriesOnRoute: 'Pa√≠ses en tu ruta', seeGuide: 'Ver gu√≠a', takeQuiz: 'Hacer quiz'
            }
        };

        // ==================== DATA ====================
        // Source: Hitchwiki.org / Hitchmap.com - Licence ODBL
        // Attribution requise: "Donn√©es issues de Hitchwiki/Hitchmap (ODBL)"
        const sampleSpots = [
            // ==================== FRANCE ====================
            // Paris
            { id: 1, from: 'Paris', to: 'Lille / Bruxelles (A1)', description: 'Porte de la Chapelle - Sortir du m√©tro, aller vers le feu rouge. Beaucoup de trafic vers l\'A1. Spot classique mais patience requise. Se placer sur la voie qui monte sur l\'autoroute.', photoUrl: 'https://images.unsplash.com/photo-1502602898657-3e91760cbb34?w=600', creator: 'Hitchwiki', creatorAvatar: 'üó∫Ô∏è', coordinates: { lat: 48.8973, lng: 2.3597 }, ratings: { accessibility: 3.5, safety: 4.0, visibility: 3.5, traffic: 4.5 }, globalRating: 3.88, totalReviews: 156, avgWaitTime: 45, lastUsed: '2024-12-10', checkins: 523, verified: true, source: 'hitchwiki', country: 'FR', alerts: [], createdAt: '2020-01-15' },
            { id: 2, from: 'Paris', to: 'Lyon / Marseille (A6)', description: 'Porte d\'Orl√©ans - Se mettre au niveau de l\'acc√®s sur le p√©riph ext√©rieur/A6. Attention √† se mettre sur la gauche. Le feu permet de se faire voir. Aire des Lisses √† 35km.', photoUrl: 'https://images.unsplash.com/photo-1550340499-a6c60fc8287c?w=600', creator: 'Hitchwiki', creatorAvatar: 'üó∫Ô∏è', coordinates: { lat: 48.8234, lng: 2.3265 }, ratings: { accessibility: 3.8, safety: 4.2, visibility: 4.0, traffic: 4.3 }, globalRating: 4.08, totalReviews: 89, avgWaitTime: 35, lastUsed: '2024-12-12', checkins: 312, verified: true, source: 'hitchwiki', country: 'FR', alerts: [], createdAt: '2019-06-20' },
            { id: 3, from: 'Paris', to: 'Sud (A6)', description: 'Aire de Nemours - Base de d√©part favorite vers le sud. Tr√®s peu d\'attente si on demande directement aux chauffeurs. Accessible en bus depuis la gare.', photoUrl: 'https://images.unsplash.com/photo-1570125909232-eb263c188f7e?w=600', creator: 'Hitchwiki', creatorAvatar: 'üó∫Ô∏è', coordinates: { lat: 48.2647, lng: 2.6897 }, ratings: { accessibility: 4.5, safety: 4.7, visibility: 4.5, traffic: 4.8 }, globalRating: 4.63, totalReviews: 203, avgWaitTime: 12, lastUsed: '2024-12-14', checkins: 678, verified: true, source: 'hitchwiki', country: 'FR', alerts: [], createdAt: '2018-03-10' },
            
            // Lyon
            { id: 4, from: 'Lyon', to: 'Marseille / Sud (A7)', description: 'Mus√©e des Confluences - Tram T1 jusqu\'√† Mus√©e des Confluences. Se placer au milieu de la voie tout √† gauche. Demander √† se faire poser √† l\'aire de Solaize.', photoUrl: 'https://images.unsplash.com/photo-1524397057410-1e775ed476f3?w=600', creator: 'Hitchwiki', creatorAvatar: 'üó∫Ô∏è', coordinates: { lat: 45.7326, lng: 4.8189 }, ratings: { accessibility: 4.2, safety: 4.5, visibility: 4.3, traffic: 4.4 }, globalRating: 4.35, totalReviews: 134, avgWaitTime: 20, lastUsed: '2024-12-13', checkins: 445, verified: true, source: 'hitchwiki', country: 'FR', alerts: [], createdAt: '2019-08-15' },
            { id: 5, from: 'Lyon', to: 'Gen√®ve / Bourg (A42)', description: 'Quai de Sa√¥ne apr√®s le pont de Lattre de Tassigny. Remonter les files au feu rouge. M√®ne au p√©riph Nord vers A42 direction Gen√®ve.', photoUrl: 'https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=600', creator: 'Hitchwiki', creatorAvatar: 'üó∫Ô∏è', coordinates: { lat: 45.7721, lng: 4.8079 }, ratings: { accessibility: 3.8, safety: 4.3, visibility: 4.0, traffic: 3.9 }, globalRating: 4.00, totalReviews: 67, avgWaitTime: 30, lastUsed: '2024-12-08', checkins: 189, verified: true, source: 'hitchwiki', country: 'FR', alerts: [], createdAt: '2020-02-20' },
            { id: 6, from: 'Lyon', to: 'Paris / Nord (A6)', description: 'Aire de Paisy - Bus 10 depuis Gare de Vaise direction Porte de Lyon, arr√™t "Les Ormeaux". Derri√®re l\'aire, voitures vers A89 (ouest) ou A6 (nord).', photoUrl: 'https://images.unsplash.com/photo-1449824913935-59a10b8d2000?w=600', creator: 'Hitchwiki', creatorAvatar: 'üó∫Ô∏è', coordinates: { lat: 45.8234, lng: 4.7654 }, ratings: { accessibility: 4.4, safety: 4.6, visibility: 4.5, traffic: 4.7 }, globalRating: 4.55, totalReviews: 98, avgWaitTime: 15, lastUsed: '2024-12-11', checkins: 356, verified: true, source: 'hitchwiki', country: 'FR', alerts: [], createdAt: '2018-12-05' },
            
            // Rennes
            { id: 7, from: 'Rennes', to: 'Saint-Brieuc / Brest', description: 'Station Kennedy - M√©tro J.F. Kennedy puis marcher vers Boulevard d\'Anjou jusqu\'au rond-point Route de Saint-Brieuc. Spot classique de Bretagne, parfois 2-3 groupes.', photoUrl: 'https://images.unsplash.com/photo-1534351590666-13e3e96b5017?w=600', creator: 'Hitchwiki', creatorAvatar: 'üó∫Ô∏è', coordinates: { lat: 48.1216, lng: -1.6432 }, ratings: { accessibility: 4.5, safety: 4.7, visibility: 4.6, traffic: 4.5 }, globalRating: 4.58, totalReviews: 178, avgWaitTime: 18, lastUsed: '2024-12-14', checkins: 534, verified: true, source: 'hitchwiki', country: 'FR', alerts: [], createdAt: '2017-05-10' },
            { id: 8, from: 'Rennes', to: 'Paris / Le Mans (A81)', description: 'P√©age de La Gravelle - √Ä 40km de Rennes sur N157. Spot test√© avec 60 secondes d\'attente ! Prendre m√©tro A jusqu\'√† La Poterie puis marcher vers Caen/Le Mans.', photoUrl: 'https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=600', creator: 'Hitchwiki', creatorAvatar: 'üó∫Ô∏è', coordinates: { lat: 48.0534, lng: -1.0876 }, ratings: { accessibility: 4.7, safety: 4.8, visibility: 4.8, traffic: 4.9 }, globalRating: 4.80, totalReviews: 234, avgWaitTime: 8, lastUsed: '2024-12-15', checkins: 789, verified: true, source: 'hitchwiki', country: 'FR', alerts: [], createdAt: '2016-09-15' },
            { id: 9, from: 'Rennes', to: 'Caen / Mont-Saint-Michel', description: 'Prendre C1 vers Champs blancs jusqu\'au terminus. Continuer jusqu\'√† l\'intersection, droite vers le rond-point, direction rocade sur D97. Premi√®re aire √† 60km.', photoUrl: 'https://images.unsplash.com/photo-1590080875515-8a3a8dc5735e?w=600', creator: 'Hitchwiki', creatorAvatar: 'üó∫Ô∏è', coordinates: { lat: 48.1456, lng: -1.5987 }, ratings: { accessibility: 4.2, safety: 4.5, visibility: 4.3, traffic: 4.1 }, globalRating: 4.28, totalReviews: 56, avgWaitTime: 25, lastUsed: '2024-12-09', checkins: 167, verified: true, source: 'hitchwiki', country: 'FR', alerts: [], createdAt: '2019-07-20' },
            
            // Aix-en-Provence
            { id: 10, from: 'Aix-en-Provence', to: 'Marseille (A8)', description: 'Pont de l\'Arc - Au sud de la ville pr√®s des facult√©s. √âchangeur A8, la plupart des voitures vont vers Marseille. Autoroute gratuite, place sur le bas-c√¥t√©.', photoUrl: 'https://images.unsplash.com/photo-1533104816931-20fa691ff6ca?w=600', creator: 'Hitchwiki', creatorAvatar: 'üó∫Ô∏è', coordinates: { lat: 43.5156, lng: 5.4513 }, ratings: { accessibility: 4.3, safety: 4.5, visibility: 4.4, traffic: 4.6 }, globalRating: 4.45, totalReviews: 89, avgWaitTime: 15, lastUsed: '2024-12-12', checkins: 278, verified: true, source: 'hitchwiki', country: 'FR', alerts: [], createdAt: '2018-04-10' },
            { id: 11, from: 'Aix-en-Provence', to: 'Nice / Toulon (A8)', description: 'Pont de l\'Arc c√¥t√© est - Traverser le pont et se poster √† l\'entr√©e vers Nice/Toulon. T√©moignages d\'autostoppeurs sur la barri√®re de s√©curit√© !', photoUrl: 'https://images.unsplash.com/photo-1504893524553-b855bce32c67?w=600', creator: 'Hitchwiki', creatorAvatar: 'üó∫Ô∏è', coordinates: { lat: 43.5167, lng: 5.4534 }, ratings: { accessibility: 4.2, safety: 4.4, visibility: 4.3, traffic: 4.5 }, globalRating: 4.35, totalReviews: 67, avgWaitTime: 20, lastUsed: '2024-12-10', checkins: 198, verified: true, source: 'hitchwiki', country: 'FR', alerts: [], createdAt: '2019-02-15' },
            { id: 12, from: 'Aix-en-Provence', to: 'Digne / Sisteron', description: 'P√©age de Meyrargues - Marcher 20min vers Les Platanes, feu rouge fin de ville. Demander direction Pertuis, se faire d√©poser 2km avant au p√©age.', photoUrl: 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=600', creator: 'Hitchwiki', creatorAvatar: 'üó∫Ô∏è', coordinates: { lat: 43.6312, lng: 5.5234 }, ratings: { accessibility: 4.0, safety: 4.3, visibility: 4.2, traffic: 4.1 }, globalRating: 4.15, totalReviews: 45, avgWaitTime: 25, lastUsed: '2024-12-05', checkins: 123, verified: true, source: 'hitchwiki', country: 'FR', alerts: [], createdAt: '2020-06-10' },
            
            // Bordeaux
            { id: 13, from: 'Bordeaux', to: 'Toulouse (A62)', description: 'Station Total √† Langon - Sortie autoroute, station tr√®s fr√©quent√©e. Les gens sont sympas, demander directement aux conducteurs.', photoUrl: 'https://images.unsplash.com/photo-1570125909232-eb263c188f7e?w=600', creator: 'Hitchwiki', creatorAvatar: 'üó∫Ô∏è', coordinates: { lat: 44.5534, lng: -0.2456 }, ratings: { accessibility: 4.4, safety: 4.6, visibility: 4.5, traffic: 4.3 }, globalRating: 4.45, totalReviews: 112, avgWaitTime: 18, lastUsed: '2024-12-13', checkins: 345, verified: true, source: 'hitchwiki', country: 'FR', alerts: [], createdAt: '2018-08-20' },
            { id: 14, from: 'Bordeaux', to: 'Paris (A10)', description: 'Aire de Saint-Andr√©-de-Cubzac - Grande aire sur A10 direction nord. Restaurant et station essence, beaucoup de passage.', photoUrl: 'https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=600', creator: 'Hitchwiki', creatorAvatar: 'üó∫Ô∏è', coordinates: { lat: 44.9912, lng: -0.4234 }, ratings: { accessibility: 4.5, safety: 4.7, visibility: 4.6, traffic: 4.5 }, globalRating: 4.58, totalReviews: 145, avgWaitTime: 15, lastUsed: '2024-12-14', checkins: 423, verified: true, source: 'hitchwiki', country: 'FR', alerts: [], createdAt: '2017-11-10' },
            
            // Nantes
            { id: 15, from: 'Nantes', to: 'Rennes (N137)', description: 'Sortie nord de Nantes - Prendre tram jusqu\'√† Beaujoire puis marcher vers la N137. Spot bien visible avec place pour s\'arr√™ter.', photoUrl: 'https://images.unsplash.com/photo-1523531294919-4bcd7c65e216?w=600', creator: 'Hitchwiki', creatorAvatar: 'üó∫Ô∏è', coordinates: { lat: 47.2634, lng: -1.5234 }, ratings: { accessibility: 4.3, safety: 4.5, visibility: 4.4, traffic: 4.2 }, globalRating: 4.35, totalReviews: 78, avgWaitTime: 22, lastUsed: '2024-12-11', checkins: 234, verified: true, source: 'hitchwiki', country: 'FR', alerts: [], createdAt: '2019-04-15' },
            { id: 16, from: 'Nantes', to: 'Paris (A11)', description: 'P√©age d\'Ancenis - √Ä 30km de Nantes, excellent spot sur A11. Demander aux gens qui font le plein. Attente courte garantie.', photoUrl: 'https://images.unsplash.com/photo-1544620347-c4fd4a3d5957?w=600', creator: 'Hitchwiki', creatorAvatar: 'üó∫Ô∏è', coordinates: { lat: 47.3645, lng: -1.1876 }, ratings: { accessibility: 4.6, safety: 4.7, visibility: 4.6, traffic: 4.8 }, globalRating: 4.68, totalReviews: 167, avgWaitTime: 12, lastUsed: '2024-12-14', checkins: 512, verified: true, source: 'hitchwiki', country: 'FR', alerts: [], createdAt: '2016-08-20' },
            
            // Montpellier
            { id: 17, from: 'Montpellier', to: 'Barcelone (A9)', description: 'Aire de B√©ziers - Sur A9 direction Espagne. Grande station avec restaurant. Beaucoup de trafic international vers Barcelone.', photoUrl: 'https://images.unsplash.com/photo-1539037116277-4db20889f2d4?w=600', creator: 'Hitchwiki', creatorAvatar: 'üó∫Ô∏è', coordinates: { lat: 43.3423, lng: 3.2156 }, ratings: { accessibility: 4.4, safety: 4.5, visibility: 4.5, traffic: 4.6 }, globalRating: 4.50, totalReviews: 98, avgWaitTime: 18, lastUsed: '2024-12-12', checkins: 287, verified: true, source: 'hitchwiki', country: 'FR', alerts: [], createdAt: '2018-06-15' },
            
            // Strasbourg
            { id: 18, from: 'Strasbourg', to: 'Paris (A4)', description: 'Aire de Brumath - Sur A4 direction Paris. Station moderne, beaucoup de trajets longue distance. Attente g√©n√©ralement courte.', photoUrl: 'https://images.unsplash.com/photo-1467269204594-9661b134dd2b?w=600', creator: 'Hitchwiki', creatorAvatar: 'üó∫Ô∏è', coordinates: { lat: 48.7312, lng: 7.7123 }, ratings: { accessibility: 4.5, safety: 4.7, visibility: 4.6, traffic: 4.5 }, globalRating: 4.58, totalReviews: 123, avgWaitTime: 15, lastUsed: '2024-12-13', checkins: 378, verified: true, source: 'hitchwiki', country: 'FR', alerts: [], createdAt: '2017-09-10' },
            
            // ==================== ALLEMAGNE ====================
            { id: 19, from: 'Berlin', to: 'Prague (A13/A17)', description: 'Tankstelle Aral sortie sud de Berlin. Tr√®s fr√©quent√© par les voyageurs vers l\'Europe de l\'Est. Station essence moderne avec caf√©.', photoUrl: 'https://images.unsplash.com/photo-1560969184-10fe8719e047?w=600', creator: 'Hitchwiki', creatorAvatar: 'üó∫Ô∏è', coordinates: { lat: 52.4234, lng: 13.4567 }, ratings: { accessibility: 4.5, safety: 4.7, visibility: 4.6, traffic: 4.4 }, globalRating: 4.55, totalReviews: 167, avgWaitTime: 20, lastUsed: '2024-12-14', checkins: 456, verified: true, source: 'hitchwiki', country: 'DE', alerts: [], createdAt: '2017-10-15' },
            { id: 20, from: 'Berlin', to: 'Hamburg (A24)', description: 'Rastst√§tte direction nord. Station service avec restaurant, beaucoup de trafic vers Hamburg. Attente g√©n√©ralement courte.', photoUrl: 'https://images.unsplash.com/photo-1566404791232-af9fe0ae8f8b?w=600', creator: 'Hitchwiki', creatorAvatar: 'üó∫Ô∏è', coordinates: { lat: 52.5678, lng: 13.2345 }, ratings: { accessibility: 4.6, safety: 4.8, visibility: 4.7, traffic: 4.6 }, globalRating: 4.68, totalReviews: 189, avgWaitTime: 15, lastUsed: '2024-12-15', checkins: 523, verified: true, source: 'hitchwiki', country: 'DE', alerts: [], createdAt: '2016-05-20' },
            { id: 21, from: 'Munich', to: 'Salzburg / Vienne (A8)', description: 'Rasthof M√ºnchen-Ost. Grande station sur l\'autoroute vers l\'Autriche. Tr√®s international, beaucoup de touristes.', photoUrl: 'https://images.unsplash.com/photo-1595867818082-083862f3d630?w=600', creator: 'Hitchwiki', creatorAvatar: 'üó∫Ô∏è', coordinates: { lat: 48.1234, lng: 11.7890 }, ratings: { accessibility: 4.7, safety: 4.9, visibility: 4.8, traffic: 4.7 }, globalRating: 4.78, totalReviews: 234, avgWaitTime: 12, lastUsed: '2024-12-14', checkins: 678, verified: true, source: 'hitchwiki', country: 'DE', alerts: [], createdAt: '2015-08-10' },
            { id: 22, from: 'Frankfurt', to: 'Cologne (A3)', description: 'Rastst√§tte Limburg. Entre Frankfurt et Cologne, station tr√®s fr√©quent√©e. Excellent pour trajets vers Benelux.', photoUrl: 'https://images.unsplash.com/photo-1467269204594-9661b134dd2b?w=600', creator: 'Hitchwiki', creatorAvatar: 'üó∫Ô∏è', coordinates: { lat: 50.3845, lng: 8.0654 }, ratings: { accessibility: 4.5, safety: 4.7, visibility: 4.6, traffic: 4.5 }, globalRating: 4.58, totalReviews: 145, avgWaitTime: 18, lastUsed: '2024-12-12', checkins: 398, verified: true, source: 'hitchwiki', country: 'DE', alerts: [], createdAt: '2018-03-15' },
            
            // ==================== BELGIQUE ====================
            { id: 23, from: 'Brussels', to: 'Amsterdam (E19)', description: 'Station Q8 pr√®s de E19. Tr√®s fr√©quent√©e, beaucoup de trafic international. Position id√©ale pour les Pays-Bas.', photoUrl: 'https://images.unsplash.com/photo-1534351590666-13e3e96b5017?w=600', creator: 'Hitchwiki', creatorAvatar: 'üó∫Ô∏è', coordinates: { lat: 50.8534, lng: 4.3517 }, ratings: { accessibility: 4.6, safety: 4.7, visibility: 4.5, traffic: 4.6 }, globalRating: 4.60, totalReviews: 145, avgWaitTime: 15, lastUsed: '2024-12-14', checkins: 412, verified: true, source: 'hitchwiki', country: 'BE', alerts: [], createdAt: '2018-03-15' },
            { id: 24, from: 'Brussels', to: 'Paris (E19/A1)', description: 'Aire de service direction sud. Bon flux vers la France, station moderne avec douches pour les routiers.', photoUrl: 'https://images.unsplash.com/photo-1559070169-a3077159ee16?w=600', creator: 'Hitchwiki', creatorAvatar: 'üó∫Ô∏è', coordinates: { lat: 50.7890, lng: 4.2345 }, ratings: { accessibility: 4.4, safety: 4.6, visibility: 4.5, traffic: 4.5 }, globalRating: 4.50, totalReviews: 98, avgWaitTime: 20, lastUsed: '2024-12-12', checkins: 287, verified: true, source: 'hitchwiki', country: 'BE', alerts: [], createdAt: '2019-06-20' },
            { id: 25, from: 'Antwerp', to: 'Rotterdam (A1)', description: 'Station essence sortie E19 nord. Tr√®s bon spot pour les Pays-Bas, beaucoup de trafic commercial.', photoUrl: 'https://images.unsplash.com/photo-1512470876302-972faa2aa9a4?w=600', creator: 'Hitchwiki', creatorAvatar: 'üó∫Ô∏è', coordinates: { lat: 51.2234, lng: 4.4012 }, ratings: { accessibility: 4.5, safety: 4.6, visibility: 4.5, traffic: 4.7 }, globalRating: 4.58, totalReviews: 112, avgWaitTime: 12, lastUsed: '2024-12-13', checkins: 334, verified: true, source: 'hitchwiki', country: 'BE', alerts: [], createdAt: '2018-09-10' },
            
            // ==================== PAYS-BAS ====================
            { id: 26, from: 'Amsterdam', to: 'Utrecht / Germany', description: 'Tankstation A2 richting Utrecht. Les N√©erlandais sont tr√®s sympas, un des pays les plus faciles pour l\'autostop.', photoUrl: 'https://images.unsplash.com/photo-1512470876302-972faa2aa9a4?w=600', creator: 'Hitchwiki', creatorAvatar: 'üó∫Ô∏è', coordinates: { lat: 52.3456, lng: 4.9012 }, ratings: { accessibility: 4.8, safety: 4.9, visibility: 4.8, traffic: 4.7 }, globalRating: 4.80, totalReviews: 267, avgWaitTime: 10, lastUsed: '2024-12-15', checkins: 734, verified: true, source: 'hitchwiki', country: 'NL', alerts: [], createdAt: '2016-04-10' },
            { id: 27, from: 'Rotterdam', to: 'Antwerp (A16)', description: 'Tankstation A16 zuid. Direction Belgique et France, station moderne tr√®s fr√©quent√©e.', photoUrl: 'https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=600', creator: 'Hitchwiki', creatorAvatar: 'üó∫Ô∏è', coordinates: { lat: 51.8912, lng: 4.4567 }, ratings: { accessibility: 4.7, safety: 4.8, visibility: 4.7, traffic: 4.6 }, globalRating: 4.70, totalReviews: 178, avgWaitTime: 12, lastUsed: '2024-12-14', checkins: 489, verified: true, source: 'hitchwiki', country: 'NL', alerts: [], createdAt: '2017-07-15' },
            
            // ==================== ESPAGNE ====================
            { id: 28, from: 'Barcelona', to: 'Valencia (AP-7)', description: '√Årea de servicio sur de Barcelona. √âviter les heures chaudes (13h-17h). Station avec restaurant climatis√©.', photoUrl: 'https://images.unsplash.com/photo-1583422409516-2895a77efded?w=600', creator: 'Hitchwiki', creatorAvatar: 'üó∫Ô∏è', coordinates: { lat: 41.3234, lng: 2.1567 }, ratings: { accessibility: 4.2, safety: 4.4, visibility: 4.3, traffic: 4.0 }, globalRating: 4.23, totalReviews: 89, avgWaitTime: 30, lastUsed: '2024-12-10', checkins: 234, verified: true, source: 'hitchwiki', country: 'ES', alerts: [], createdAt: '2019-09-15' },
            { id: 29, from: 'Madrid', to: 'Sevilla (A-4)', description: 'Estaci√≥n de servicio A-4 sur. Grand axe vers l\'Andalousie. Beaucoup de routiers et voyageurs.', photoUrl: 'https://images.unsplash.com/photo-1539037116277-4db20889f2d4?w=600', creator: 'Hitchwiki', creatorAvatar: 'üó∫Ô∏è', coordinates: { lat: 40.3456, lng: -3.7012 }, ratings: { accessibility: 4.3, safety: 4.5, visibility: 4.4, traffic: 4.2 }, globalRating: 4.35, totalReviews: 112, avgWaitTime: 25, lastUsed: '2024-12-11', checkins: 312, verified: true, source: 'hitchwiki', country: 'ES', alerts: [], createdAt: '2018-11-20' },
            { id: 30, from: 'Madrid', to: 'Barcelona (A-2)', description: '√Årea de Guadalajara - Sur A-2 direction Barcelone. Beaucoup de passage, station avec bon restaurant.', photoUrl: 'https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=600', creator: 'Hitchwiki', creatorAvatar: 'üó∫Ô∏è', coordinates: { lat: 40.6312, lng: -3.1654 }, ratings: { accessibility: 4.4, safety: 4.5, visibility: 4.4, traffic: 4.3 }, globalRating: 4.40, totalReviews: 134, avgWaitTime: 22, lastUsed: '2024-12-13', checkins: 378, verified: true, source: 'hitchwiki', country: 'ES', alerts: [], createdAt: '2017-06-10' },
            
            // ==================== ITALIE ====================
            { id: 31, from: 'Milan', to: 'Rome (A1)', description: 'Autogrill Milano Sud. Les Autogrill italiens sont parfaits pour l\'autostop. Caf√© excellent, beaucoup de passage.', photoUrl: 'https://images.unsplash.com/photo-1515542622106-78bda8ba0e5b?w=600', creator: 'Hitchwiki', creatorAvatar: 'üó∫Ô∏è', coordinates: { lat: 45.4234, lng: 9.1890 }, ratings: { accessibility: 4.5, safety: 4.6, visibility: 4.5, traffic: 4.4 }, globalRating: 4.50, totalReviews: 156, avgWaitTime: 20, lastUsed: '2024-12-13', checkins: 423, verified: true, source: 'hitchwiki', country: 'IT', alerts: [], createdAt: '2017-07-15' },
            { id: 32, from: 'Rome', to: 'Naples (A1)', description: 'Autogrill Roma Sud - Direction Naples et sud de l\'Italie. Tr√®s fr√©quent√©, beaucoup de touristes.', photoUrl: 'https://images.unsplash.com/photo-1529260830199-42c24126f198?w=600', creator: 'Hitchwiki', creatorAvatar: 'üó∫Ô∏è', coordinates: { lat: 41.8234, lng: 12.4890 }, ratings: { accessibility: 4.4, safety: 4.5, visibility: 4.4, traffic: 4.3 }, globalRating: 4.40, totalReviews: 123, avgWaitTime: 22, lastUsed: '2024-12-12', checkins: 356, verified: true, source: 'hitchwiki', country: 'IT', alerts: [], createdAt: '2018-04-20' },
            
            // ==================== POLOGNE ====================
            { id: 33, from: 'Warsaw', to: 'Krakow (A4)', description: 'Stacja Orlen sortie sud de Varsovie. Les stations Orlen sont excellentes en Pologne. Personnel sympa.', photoUrl: 'https://images.unsplash.com/photo-1519197924294-4ba991a11128?w=600', creator: 'Hitchwiki', creatorAvatar: 'üó∫Ô∏è', coordinates: { lat: 52.1567, lng: 21.0345 }, ratings: { accessibility: 4.4, safety: 4.5, visibility: 4.4, traffic: 4.3 }, globalRating: 4.40, totalReviews: 78, avgWaitTime: 22, lastUsed: '2024-12-09', checkins: 198, verified: true, source: 'hitchwiki', country: 'PL', alerts: [], createdAt: '2019-05-10' },
            { id: 34, from: 'Krakow', to: 'Prague (E40)', description: 'Station BP sortie ouest. Direction R√©publique tch√®que, beaucoup de trafic international.', photoUrl: 'https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=600', creator: 'Hitchwiki', creatorAvatar: 'üó∫Ô∏è', coordinates: { lat: 50.0567, lng: 19.9012 }, ratings: { accessibility: 4.3, safety: 4.5, visibility: 4.4, traffic: 4.2 }, globalRating: 4.35, totalReviews: 67, avgWaitTime: 25, lastUsed: '2024-12-08', checkins: 167, verified: true, source: 'hitchwiki', country: 'PL', alerts: [], createdAt: '2019-08-15' },
            
            // ==================== PORTUGAL ====================
            { id: 35, from: 'Lisbon', to: 'Porto (A1)', description: 'Posto de combust√≠vel A1 norte. Axe principal Portugal, beaucoup de trafic. Les Portugais sont tr√®s accueillants.', photoUrl: 'https://images.unsplash.com/photo-1585208798174-6cedd86e019a?w=600', creator: 'Hitchwiki', creatorAvatar: 'üó∫Ô∏è', coordinates: { lat: 38.7890, lng: -9.1234 }, ratings: { accessibility: 4.3, safety: 4.6, visibility: 4.4, traffic: 4.2 }, globalRating: 4.38, totalReviews: 67, avgWaitTime: 25, lastUsed: '2024-12-08', checkins: 178, verified: true, source: 'hitchwiki', country: 'PT', alerts: [], createdAt: '2020-02-15' },
            
            // ==================== AUTRICHE ====================
            { id: 36, from: 'Vienna', to: 'Salzburg (A1)', description: 'Raststation Wien West. Sur A1 direction Salzburg et Allemagne. Station moderne, bon caf√©.', photoUrl: 'https://images.unsplash.com/photo-1516550893923-42d28e5677af?w=600', creator: 'Hitchwiki', creatorAvatar: 'üó∫Ô∏è', coordinates: { lat: 48.1890, lng: 16.2345 }, ratings: { accessibility: 4.6, safety: 4.8, visibility: 4.7, traffic: 4.5 }, globalRating: 4.65, totalReviews: 145, avgWaitTime: 15, lastUsed: '2024-12-13', checkins: 412, verified: true, source: 'hitchwiki', country: 'AT', alerts: [], createdAt: '2017-11-10' },
            
            // ==================== SUISSE ====================
            { id: 37, from: 'Geneva', to: 'Lausanne (A1)', description: 'Station service sortie Gen√®ve. Les Suisses s\'arr√™tent facilement, trajets souvent courts mais efficaces.', photoUrl: 'https://images.unsplash.com/photo-1530122037265-a5f1f91d3b99?w=600', creator: 'Hitchwiki', creatorAvatar: 'üó∫Ô∏è', coordinates: { lat: 46.2012, lng: 6.1456 }, ratings: { accessibility: 4.5, safety: 4.9, visibility: 4.6, traffic: 4.3 }, globalRating: 4.58, totalReviews: 89, avgWaitTime: 18, lastUsed: '2024-12-11', checkins: 256, verified: true, source: 'hitchwiki', country: 'CH', alerts: [], createdAt: '2018-05-20' },
            
            // ==================== R√âPUBLIQUE TCH√àQUE ====================
            { id: 38, from: 'Prague', to: 'Berlin (D8)', description: 'ƒåerpac√≠ stanice D8 nord. Direction Allemagne, station moderne. Les Tch√®ques sont sympas mais parlent peu anglais.', photoUrl: 'https://images.unsplash.com/photo-1541849546-216549ae216d?w=600', creator: 'Hitchwiki', creatorAvatar: 'üó∫Ô∏è', coordinates: { lat: 50.1234, lng: 14.4567 }, ratings: { accessibility: 4.4, safety: 4.6, visibility: 4.5, traffic: 4.3 }, globalRating: 4.45, totalReviews: 98, avgWaitTime: 20, lastUsed: '2024-12-10', checkins: 287, verified: true, source: 'hitchwiki', country: 'CZ', alerts: [], createdAt: '2018-09-15' },
            
            // ==================== IRLANDE ====================
            { id: 39, from: 'Dublin', to: 'Cork (M7/M8)', description: 'Station Applegreen sortie sud Dublin. L\'Irlande est excellente pour le stop ! Les Irlandais adorent discuter.', photoUrl: 'https://images.unsplash.com/photo-1590089415225-401ed6f9db8e?w=600', creator: 'Hitchwiki', creatorAvatar: 'üó∫Ô∏è', coordinates: { lat: 53.3012, lng: -6.2654 }, ratings: { accessibility: 4.7, safety: 4.9, visibility: 4.7, traffic: 4.5 }, globalRating: 4.70, totalReviews: 189, avgWaitTime: 12, lastUsed: '2024-12-14', checkins: 523, verified: true, source: 'hitchwiki', country: 'IE', alerts: [], createdAt: '2016-06-10' },
            { id: 41, from: 'Dublin', to: 'Galway (M6)', description: 'Station Circle K √† Lucan. M50 direction ouest puis M4/M6 vers Galway. Beaucoup de trafic le week-end.', photoUrl: 'https://images.unsplash.com/photo-1590089415225-401ed6f9db8e?w=600', creator: 'Hitchwiki', creatorAvatar: 'üó∫Ô∏è', coordinates: { lat: 53.3541, lng: -6.4489 }, ratings: { accessibility: 4.5, safety: 4.8, visibility: 4.6, traffic: 4.4 }, globalRating: 4.58, totalReviews: 134, avgWaitTime: 18, lastUsed: '2024-12-10', checkins: 312, verified: true, source: 'hitchwiki', country: 'IE', alerts: [], createdAt: '2018-04-15' },
            { id: 42, from: 'Galway', to: 'Dublin (M6)', description: 'Station essence sortie est de Galway sur N6. Spot tranquille avec bon trafic vers Dublin.', photoUrl: 'https://images.unsplash.com/photo-1590089415225-401ed6f9db8e?w=600', creator: 'Hitchwiki', creatorAvatar: 'üó∫Ô∏è', coordinates: { lat: 53.2743, lng: -8.9956 }, ratings: { accessibility: 4.6, safety: 4.7, visibility: 4.5, traffic: 4.3 }, globalRating: 4.53, totalReviews: 98, avgWaitTime: 20, lastUsed: '2024-12-08', checkins: 245, verified: true, source: 'hitchwiki', country: 'IE', alerts: [], createdAt: '2019-06-20' },
            
            // ==================== CROATIE ====================
            { id: 40, from: 'Zagreb', to: 'Split (A1)', description: 'INA station sortie Zagreb sud. Direction c√¥te dalmate, beaucoup de touristes en √©t√©. Les Croates sont accueillants.', photoUrl: 'https://images.unsplash.com/photo-1555990538-1d578fd51938?w=600', creator: 'Hitchwiki', creatorAvatar: 'üó∫Ô∏è', coordinates: { lat: 45.7890, lng: 15.9567 }, ratings: { accessibility: 4.3, safety: 4.5, visibility: 4.4, traffic: 4.2 }, globalRating: 4.35, totalReviews: 78, avgWaitTime: 25, lastUsed: '2024-12-09', checkins: 198, verified: true, source: 'hitchwiki', country: 'HR', alerts: [], createdAt: '2019-07-20' },
            { id: 43, from: 'Split', to: 'Dubrovnik (A1)', description: 'Station INA sortie Split direction sud. Route c√¥ti√®re magnifique, beaucoup de touristes en √©t√©.', photoUrl: 'https://images.unsplash.com/photo-1555990538-1d578fd51938?w=600', creator: 'Hitchwiki', creatorAvatar: 'üó∫Ô∏è', coordinates: { lat: 43.5081, lng: 16.4402 }, ratings: { accessibility: 4.2, safety: 4.6, visibility: 4.4, traffic: 4.1 }, globalRating: 4.33, totalReviews: 67, avgWaitTime: 30, lastUsed: '2024-12-05', checkins: 156, verified: true, source: 'hitchwiki', country: 'HR', alerts: [], createdAt: '2020-08-10' },
            
            // ==================== SCANDINAVIE ====================
            { id: 44, from: 'Copenhagen', to: 'Malm√∂ (√òresund)', description: 'Station pr√®s du pont √òresund. Passage vers la Su√®de facile, beaucoup de navetteurs.', photoUrl: 'https://images.unsplash.com/photo-1513622470522-26c3c8a854bc?w=600', creator: 'Hitchwiki', creatorAvatar: 'üó∫Ô∏è', coordinates: { lat: 55.6156, lng: 12.6553 }, ratings: { accessibility: 4.4, safety: 4.9, visibility: 4.5, traffic: 4.3 }, globalRating: 4.53, totalReviews: 145, avgWaitTime: 22, lastUsed: '2024-12-11', checkins: 389, verified: true, source: 'hitchwiki', country: 'DK', alerts: [], createdAt: '2017-05-15' },
            { id: 45, from: 'Stockholm', to: 'G√∂teborg (E4)', description: 'Station Statoil sortie sud Stockholm. Les Su√©dois sont polis mais r√©serv√©s, patience recommand√©e.', photoUrl: 'https://images.unsplash.com/photo-1509356843151-3e7d96241e11?w=600', creator: 'Hitchwiki', creatorAvatar: 'üó∫Ô∏è', coordinates: { lat: 59.2867, lng: 18.0067 }, ratings: { accessibility: 4.3, safety: 4.9, visibility: 4.4, traffic: 4.0 }, globalRating: 4.40, totalReviews: 112, avgWaitTime: 35, lastUsed: '2024-12-07', checkins: 267, verified: true, source: 'hitchwiki', country: 'SE', alerts: [], createdAt: '2018-08-20' },
            { id: 46, from: 'Oslo', to: 'Bergen (E16)', description: 'Station Circle K √† Sandvika. Route spectaculaire vers Bergen √† travers les fjords.', photoUrl: 'https://images.unsplash.com/photo-1531366936337-7c912a4589a7?w=600', creator: 'Hitchwiki', creatorAvatar: 'üó∫Ô∏è', coordinates: { lat: 59.8912, lng: 10.5234 }, ratings: { accessibility: 4.2, safety: 4.9, visibility: 4.3, traffic: 3.8 }, globalRating: 4.30, totalReviews: 89, avgWaitTime: 40, lastUsed: '2024-12-03', checkins: 198, verified: true, source: 'hitchwiki', country: 'NO', alerts: [], createdAt: '2019-07-10' },
            { id: 47, from: 'Helsinki', to: 'Turku (E18)', description: 'Station ABC sortie ouest Helsinki. Finlande = attente longue mais conducteurs sympas.', photoUrl: 'https://images.unsplash.com/photo-1538332576228-eb5b4c4de6f5?w=600', creator: 'Hitchwiki', creatorAvatar: 'üó∫Ô∏è', coordinates: { lat: 60.1587, lng: 24.8056 }, ratings: { accessibility: 4.1, safety: 4.9, visibility: 4.2, traffic: 3.7 }, globalRating: 4.23, totalReviews: 76, avgWaitTime: 45, lastUsed: '2024-11-28', checkins: 145, verified: true, source: 'hitchwiki', country: 'FI', alerts: [], createdAt: '2020-06-15' },
            
            // ==================== EUROPE DE L'EST ====================
            { id: 48, from: 'Budapest', to: 'Vienna (M1)', description: 'MOL station sortie ouest Budapest. Autoroute directe vers Vienne, beaucoup de trafic international.', photoUrl: 'https://images.unsplash.com/photo-1541849546-216549ae216d?w=600', creator: 'Hitchwiki', creatorAvatar: 'üó∫Ô∏è', coordinates: { lat: 47.4984, lng: 18.9256 }, ratings: { accessibility: 4.5, safety: 4.6, visibility: 4.5, traffic: 4.4 }, globalRating: 4.50, totalReviews: 167, avgWaitTime: 18, lastUsed: '2024-12-13', checkins: 423, verified: true, source: 'hitchwiki', country: 'HU', alerts: [], createdAt: '2017-03-20' },
            { id: 49, from: 'Budapest', to: 'Zagreb (M7)', description: 'Station pr√®s du lac Balaton direction sud-ouest. Route vers la Croatie, populaire en √©t√©.', photoUrl: 'https://images.unsplash.com/photo-1541849546-216549ae216d?w=600', creator: 'Hitchwiki', creatorAvatar: 'üó∫Ô∏è', coordinates: { lat: 47.4312, lng: 18.8456 }, ratings: { accessibility: 4.4, safety: 4.5, visibility: 4.4, traffic: 4.2 }, globalRating: 4.38, totalReviews: 98, avgWaitTime: 25, lastUsed: '2024-12-08', checkins: 287, verified: true, source: 'hitchwiki', country: 'HU', alerts: [], createdAt: '2018-06-10' },
            { id: 50, from: 'Bucharest', to: 'Brasov (A3)', description: 'Petrom station sortie nord Bucarest. Direction montagnes des Carpates et Transylvanie.', photoUrl: 'https://images.unsplash.com/photo-1585409677983-0f6c41ca9c3b?w=600', creator: 'Hitchwiki', creatorAvatar: 'üó∫Ô∏è', coordinates: { lat: 44.4567, lng: 26.1234 }, ratings: { accessibility: 4.2, safety: 4.3, visibility: 4.2, traffic: 4.0 }, globalRating: 4.18, totalReviews: 87, avgWaitTime: 28, lastUsed: '2024-12-06', checkins: 198, verified: true, source: 'hitchwiki', country: 'RO', alerts: [], createdAt: '2019-09-15' },
            { id: 51, from: 'Sofia', to: 'Plovdiv (A1)', description: 'Shell station sortie est Sofia. L\'autoroute Trakia m√®ne √† Plovdiv en 1h30.', photoUrl: 'https://images.unsplash.com/photo-1558271736-cd043ef2e855?w=600', creator: 'Hitchwiki', creatorAvatar: 'üó∫Ô∏è', coordinates: { lat: 42.7012, lng: 23.3345 }, ratings: { accessibility: 4.3, safety: 4.4, visibility: 4.3, traffic: 4.1 }, globalRating: 4.28, totalReviews: 76, avgWaitTime: 25, lastUsed: '2024-12-04', checkins: 167, verified: true, source: 'hitchwiki', country: 'BG', alerts: [], createdAt: '2020-04-20' },
            
            // ==================== GR√àCE ====================
            { id: 52, from: 'Athens', to: 'Thessaloniki (A1)', description: 'Station BP √† Metamorfosi, nord d\'Ath√®nes. Autoroute Egnatia vers le nord, long trajet.', photoUrl: 'https://images.unsplash.com/photo-1555993539-1732b0258235?w=600', creator: 'Hitchwiki', creatorAvatar: 'üó∫Ô∏è', coordinates: { lat: 38.0567, lng: 23.7567 }, ratings: { accessibility: 4.1, safety: 4.4, visibility: 4.2, traffic: 3.9 }, globalRating: 4.15, totalReviews: 98, avgWaitTime: 35, lastUsed: '2024-12-02', checkins: 234, verified: true, source: 'hitchwiki', country: 'GR', alerts: [], createdAt: '2018-10-10' },
            { id: 53, from: 'Thessaloniki', to: 'Athens (A1)', description: 'Station Avin sortie sud. Direction Ath√®nes, 4-5h de route. Grecs tr√®s accueillants.', photoUrl: 'https://images.unsplash.com/photo-1555993539-1732b0258235?w=600', creator: 'Hitchwiki', creatorAvatar: 'üó∫Ô∏è', coordinates: { lat: 40.6123, lng: 22.9567 }, ratings: { accessibility: 4.2, safety: 4.5, visibility: 4.3, traffic: 4.0 }, globalRating: 4.25, totalReviews: 112, avgWaitTime: 30, lastUsed: '2024-12-05', checkins: 289, verified: true, source: 'hitchwiki', country: 'GR', alerts: [], createdAt: '2017-08-15' },
            
            // ==================== PLUS D'ESPAGNE ====================
            { id: 54, from: 'Madrid', to: 'Seville (A4)', description: 'Repsol station sortie sud Madrid sur A4. Route vers l\'Andalousie, beaucoup de camions.', photoUrl: 'https://images.unsplash.com/photo-1543783207-ec64e4d95325?w=600', creator: 'Hitchwiki', creatorAvatar: 'üó∫Ô∏è', coordinates: { lat: 40.3456, lng: -3.7012 }, ratings: { accessibility: 4.3, safety: 4.5, visibility: 4.4, traffic: 4.2 }, globalRating: 4.35, totalReviews: 134, avgWaitTime: 28, lastUsed: '2024-12-10', checkins: 345, verified: true, source: 'hitchwiki', country: 'ES', alerts: [], createdAt: '2018-02-20' },
            { id: 55, from: 'Barcelona', to: 'Valencia (AP-7)', description: 'Aire de service sur AP-7 sud Barcelona. Costa Brava direction sud, trafic touristique.', photoUrl: 'https://images.unsplash.com/photo-1583422409516-2895a77efded?w=600', creator: 'Hitchwiki', creatorAvatar: 'üó∫Ô∏è', coordinates: { lat: 41.3234, lng: 2.1456 }, ratings: { accessibility: 4.4, safety: 4.6, visibility: 4.5, traffic: 4.3 }, globalRating: 4.45, totalReviews: 156, avgWaitTime: 22, lastUsed: '2024-12-12', checkins: 412, verified: true, source: 'hitchwiki', country: 'ES', alerts: [], createdAt: '2017-06-15' },
            { id: 56, from: 'Seville', to: 'Lisbon (A49)', description: 'Cepsa station ouest de S√©ville. Fronti√®re portugaise √† 2h, belle route.', photoUrl: 'https://images.unsplash.com/photo-1515443961218-a51367888e4b?w=600', creator: 'Hitchwiki', creatorAvatar: 'üó∫Ô∏è', coordinates: { lat: 37.3891, lng: -6.0123 }, ratings: { accessibility: 4.2, safety: 4.5, visibility: 4.3, traffic: 4.0 }, globalRating: 4.25, totalReviews: 89, avgWaitTime: 30, lastUsed: '2024-12-07', checkins: 198, verified: true, source: 'hitchwiki', country: 'ES', alerts: [], createdAt: '2019-04-10' },
            
            // ==================== PLUS DE PORTUGAL ====================
            { id: 57, from: 'Lisbon', to: 'Porto (A1)', description: 'Galp station sortie nord Lisbonne. A1 directe vers Porto, 3h de route.', photoUrl: 'https://images.unsplash.com/photo-1585208798174-6cedd86e019a?w=600', creator: 'Hitchwiki', creatorAvatar: 'üó∫Ô∏è', coordinates: { lat: 38.7678, lng: -9.1345 }, ratings: { accessibility: 4.5, safety: 4.7, visibility: 4.5, traffic: 4.3 }, globalRating: 4.50, totalReviews: 145, avgWaitTime: 20, lastUsed: '2024-12-11', checkins: 378, verified: true, source: 'hitchwiki', country: 'PT', alerts: [], createdAt: '2017-09-20' },
            { id: 58, from: 'Porto', to: 'Lisbon (A1)', description: 'Station BP sortie sud Porto. Portugais tr√®s accueillants, offrent souvent √† manger.', photoUrl: 'https://images.unsplash.com/photo-1555881400-74d7acaacd8b?w=600', creator: 'Hitchwiki', creatorAvatar: 'üó∫Ô∏è', coordinates: { lat: 41.1345, lng: -8.6234 }, ratings: { accessibility: 4.6, safety: 4.8, visibility: 4.6, traffic: 4.4 }, globalRating: 4.60, totalReviews: 167, avgWaitTime: 18, lastUsed: '2024-12-13', checkins: 423, verified: true, source: 'hitchwiki', country: 'PT', alerts: [], createdAt: '2016-11-10' },
            
            // ==================== PLUS D'ITALIE ====================
            { id: 59, from: 'Rome', to: 'Florence (A1)', description: 'Autogrill apr√®s le p√©age nord de Rome. Direction Toscane, paysages magnifiques.', photoUrl: 'https://images.unsplash.com/photo-1515542622106-78bda8ba0e5b?w=600', creator: 'Hitchwiki', creatorAvatar: 'üó∫Ô∏è', coordinates: { lat: 41.9567, lng: 12.5234 }, ratings: { accessibility: 4.3, safety: 4.5, visibility: 4.4, traffic: 4.2 }, globalRating: 4.35, totalReviews: 134, avgWaitTime: 25, lastUsed: '2024-12-09', checkins: 356, verified: true, source: 'hitchwiki', country: 'IT', alerts: [], createdAt: '2018-05-15' },
            { id: 60, from: 'Florence', to: 'Venice (A1/A13)', description: 'Autogrill Firenze Nord. Direction Bologne puis Venise, 3h de route.', photoUrl: 'https://images.unsplash.com/photo-1534445867742-43195f401b6c?w=600', creator: 'Hitchwiki', creatorAvatar: 'üó∫Ô∏è', coordinates: { lat: 43.8234, lng: 11.2567 }, ratings: { accessibility: 4.4, safety: 4.6, visibility: 4.5, traffic: 4.3 }, globalRating: 4.45, totalReviews: 145, avgWaitTime: 22, lastUsed: '2024-12-11', checkins: 389, verified: true, source: 'hitchwiki', country: 'IT', alerts: [], createdAt: '2017-07-20' },
            { id: 61, from: 'Milan', to: 'Turin (A4)', description: 'Area di servizio ouest de Milan sur A4. Turin √† 1h30, beaucoup de navetteurs.', photoUrl: 'https://images.unsplash.com/photo-1513581166391-887a96ddeafd?w=600', creator: 'Hitchwiki', creatorAvatar: 'üó∫Ô∏è', coordinates: { lat: 45.4567, lng: 9.1234 }, ratings: { accessibility: 4.5, safety: 4.6, visibility: 4.5, traffic: 4.4 }, globalRating: 4.50, totalReviews: 123, avgWaitTime: 20, lastUsed: '2024-12-12', checkins: 312, verified: true, source: 'hitchwiki', country: 'IT', alerts: [], createdAt: '2018-03-10' },
            { id: 62, from: 'Naples', to: 'Rome (A1)', description: 'Agip station sortie nord Naples. Direction Rome, 2h30 de route. Sud de l\'Italie = plus chaleureux.', photoUrl: 'https://images.unsplash.com/photo-1516483638261-f4dbaf036963?w=600', creator: 'Hitchwiki', creatorAvatar: 'üó∫Ô∏è', coordinates: { lat: 40.8912, lng: 14.2456 }, ratings: { accessibility: 4.2, safety: 4.3, visibility: 4.2, traffic: 4.1 }, globalRating: 4.20, totalReviews: 98, avgWaitTime: 28, lastUsed: '2024-12-06', checkins: 234, verified: true, source: 'hitchwiki', country: 'IT', alerts: [], createdAt: '2019-08-15' },
            
            // ==================== PLUS DE FRANCE ====================
            { id: 63, from: 'Marseille', to: 'Montpellier (A9)', description: 'Aire de repos apr√®s le p√©age ouest Marseille. Direction Montpellier puis Espagne.', photoUrl: 'https://images.unsplash.com/photo-1524231757912-21f4fe3a7200?w=600', creator: 'Hitchwiki', creatorAvatar: 'üó∫Ô∏è', coordinates: { lat: 43.2912, lng: 5.3456 }, ratings: { accessibility: 4.4, safety: 4.5, visibility: 4.4, traffic: 4.3 }, globalRating: 4.40, totalReviews: 112, avgWaitTime: 22, lastUsed: '2024-12-10', checkins: 298, verified: true, source: 'hitchwiki', country: 'FR', alerts: [], createdAt: '2018-04-20' },
            { id: 64, from: 'Nice', to: 'Italy (A8)', description: 'Aire de Beausoleil avant la fronti√®re italienne. Derni√®re aire fran√ßaise vers l\'Italie.', photoUrl: 'https://images.unsplash.com/photo-1491166617655-0723a0999cfc?w=600', creator: 'Hitchwiki', creatorAvatar: 'üó∫Ô∏è', coordinates: { lat: 43.7456, lng: 7.4234 }, ratings: { accessibility: 4.5, safety: 4.7, visibility: 4.5, traffic: 4.4 }, globalRating: 4.53, totalReviews: 134, avgWaitTime: 20, lastUsed: '2024-12-12', checkins: 345, verified: true, source: 'hitchwiki', country: 'FR', alerts: [], createdAt: '2017-06-10' },
            { id: 65, from: 'Toulouse', to: 'Bordeaux (A62)', description: 'Aire de service sur A62 direction nord. Route des vins vers Bordeaux !', photoUrl: 'https://images.unsplash.com/photo-1508050919630-b135583b29ab?w=600', creator: 'Hitchwiki', creatorAvatar: 'üó∫Ô∏è', coordinates: { lat: 43.6567, lng: 1.4234 }, ratings: { accessibility: 4.4, safety: 4.6, visibility: 4.4, traffic: 4.2 }, globalRating: 4.40, totalReviews: 98, avgWaitTime: 25, lastUsed: '2024-12-08', checkins: 256, verified: true, source: 'hitchwiki', country: 'FR', alerts: [], createdAt: '2019-02-15' },
            { id: 66, from: 'Lille', to: 'Brussels (A1/E17)', description: 'Station Total pr√®s de la fronti√®re belge. Passage vers Belgique rapide.', photoUrl: 'https://images.unsplash.com/photo-1548248823-ce16a73b6d49?w=600', creator: 'Hitchwiki', creatorAvatar: 'üó∫Ô∏è', coordinates: { lat: 50.6345, lng: 3.0678 }, ratings: { accessibility: 4.5, safety: 4.7, visibility: 4.5, traffic: 4.4 }, globalRating: 4.53, totalReviews: 145, avgWaitTime: 18, lastUsed: '2024-12-13', checkins: 378, verified: true, source: 'hitchwiki', country: 'FR', alerts: [], createdAt: '2017-10-20' },
            
            // ==================== PLUS DE BELGIQUE ====================
            { id: 67, from: 'Brussels', to: 'Amsterdam (E19)', description: 'Station Q8 √† Machelen direction nord. Vers les Pays-Bas, trajet court et facile.', photoUrl: 'https://images.unsplash.com/photo-1549882167-eeee2406c9e5?w=600', creator: 'Hitchwiki', creatorAvatar: 'üó∫Ô∏è', coordinates: { lat: 50.8912, lng: 4.4123 }, ratings: { accessibility: 4.6, safety: 4.8, visibility: 4.6, traffic: 4.5 }, globalRating: 4.63, totalReviews: 167, avgWaitTime: 15, lastUsed: '2024-12-14', checkins: 456, verified: true, source: 'hitchwiki', country: 'BE', alerts: [], createdAt: '2016-08-10' },
            { id: 68, from: 'Antwerp', to: 'Rotterdam (E19)', description: 'Station pr√®s du port d\'Anvers. Direction Rotterdam et Amsterdam, tr√®s fr√©quent√©.', photoUrl: 'https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=600', creator: 'Hitchwiki', creatorAvatar: 'üó∫Ô∏è', coordinates: { lat: 51.2456, lng: 4.4234 }, ratings: { accessibility: 4.5, safety: 4.7, visibility: 4.5, traffic: 4.4 }, globalRating: 4.53, totalReviews: 134, avgWaitTime: 18, lastUsed: '2024-12-11', checkins: 389, verified: true, source: 'hitchwiki', country: 'BE', alerts: [], createdAt: '2017-04-15' },
            
            // ==================== PLUS DES PAYS-BAS ====================
            { id: 69, from: 'Amsterdam', to: 'Brussels (A2/E19)', description: 'Station Shell sortie sud Amsterdam. Pays-Bas = facile, tout le monde parle anglais.', photoUrl: 'https://images.unsplash.com/photo-1534351590666-13e3e96b5017?w=600', creator: 'Hitchwiki', creatorAvatar: 'üó∫Ô∏è', coordinates: { lat: 52.3234, lng: 4.8567 }, ratings: { accessibility: 4.7, safety: 4.9, visibility: 4.7, traffic: 4.5 }, globalRating: 4.70, totalReviews: 189, avgWaitTime: 15, lastUsed: '2024-12-14', checkins: 512, verified: true, source: 'hitchwiki', country: 'NL', alerts: [], createdAt: '2015-09-20' },
            { id: 70, from: 'Rotterdam', to: 'Antwerp (A16)', description: 'Station BP pr√®s du port de Rotterdam. Direction Belgique, beaucoup de camions.', photoUrl: 'https://images.unsplash.com/photo-1534351590666-13e3e96b5017?w=600', creator: 'Hitchwiki', creatorAvatar: 'üó∫Ô∏è', coordinates: { lat: 51.9012, lng: 4.4567 }, ratings: { accessibility: 4.6, safety: 4.8, visibility: 4.6, traffic: 4.4 }, globalRating: 4.60, totalReviews: 145, avgWaitTime: 18, lastUsed: '2024-12-12', checkins: 423, verified: true, source: 'hitchwiki', country: 'NL', alerts: [], createdAt: '2017-02-10' },
            
            // ==================== PLUS DE SUISSE ====================
            { id: 71, from: 'Geneva', to: 'Lausanne (A1)', description: 'Station pr√®s de l\'a√©roport de Gen√®ve. Direction Lausanne et Bern, autoroute payante (vignette).', photoUrl: 'https://images.unsplash.com/photo-1530122037265-a5f1f91d3b99?w=600', creator: 'Hitchwiki', creatorAvatar: 'üó∫Ô∏è', coordinates: { lat: 46.2234, lng: 6.1345 }, ratings: { accessibility: 4.3, safety: 4.9, visibility: 4.4, traffic: 4.1 }, globalRating: 4.43, totalReviews: 112, avgWaitTime: 25, lastUsed: '2024-12-09', checkins: 287, verified: true, source: 'hitchwiki', country: 'CH', alerts: [], createdAt: '2018-07-15' },
            { id: 72, from: 'Zurich', to: 'Munich (A1)', description: 'Rastst√§tte sortie est Zurich. Direction Allemagne via le lac de Constance.', photoUrl: 'https://images.unsplash.com/photo-1515488764276-beab7607c1e6?w=600', creator: 'Hitchwiki', creatorAvatar: 'üó∫Ô∏è', coordinates: { lat: 47.3912, lng: 8.5456 }, ratings: { accessibility: 4.4, safety: 4.9, visibility: 4.5, traffic: 4.2 }, globalRating: 4.50, totalReviews: 134, avgWaitTime: 22, lastUsed: '2024-12-10', checkins: 312, verified: true, source: 'hitchwiki', country: 'CH', alerts: [], createdAt: '2017-11-20' },
            
            // ==================== PLUS D'ALLEMAGNE ====================
            { id: 73, from: 'Hamburg', to: 'Copenhagen (A7/E45)', description: 'Rastst√§tte nord de Hamburg. Direction Danemark via le ferry ou le pont.', photoUrl: 'https://images.unsplash.com/photo-1467269204594-9661b134dd2b?w=600', creator: 'Hitchwiki', creatorAvatar: 'üó∫Ô∏è', coordinates: { lat: 53.6123, lng: 10.0234 }, ratings: { accessibility: 4.5, safety: 4.8, visibility: 4.5, traffic: 4.3 }, globalRating: 4.53, totalReviews: 145, avgWaitTime: 20, lastUsed: '2024-12-11', checkins: 378, verified: true, source: 'hitchwiki', country: 'DE', alerts: [], createdAt: '2017-05-10' },
            { id: 74, from: 'Cologne', to: 'Amsterdam (A3/A57)', description: 'Rastst√§tte pr√®s de l\'a√©roport de Cologne. Direction Benelux, tr√®s fr√©quent√©.', photoUrl: 'https://images.unsplash.com/photo-1513635269975-59663e0ac1ad?w=600', creator: 'Hitchwiki', creatorAvatar: 'üó∫Ô∏è', coordinates: { lat: 50.9567, lng: 6.9678 }, ratings: { accessibility: 4.6, safety: 4.8, visibility: 4.6, traffic: 4.5 }, globalRating: 4.63, totalReviews: 178, avgWaitTime: 15, lastUsed: '2024-12-13', checkins: 456, verified: true, source: 'hitchwiki', country: 'DE', alerts: [], createdAt: '2016-09-15' },
            { id: 75, from: 'Stuttgart', to: 'Munich (A8)', description: 'Rastst√§tte est de Stuttgart sur A8. Belle autoroute vers la Bavi√®re.', photoUrl: 'https://images.unsplash.com/photo-1467269204594-9661b134dd2b?w=600', creator: 'Hitchwiki', creatorAvatar: 'üó∫Ô∏è', coordinates: { lat: 48.7345, lng: 9.2456 }, ratings: { accessibility: 4.5, safety: 4.7, visibility: 4.5, traffic: 4.4 }, globalRating: 4.53, totalReviews: 145, avgWaitTime: 18, lastUsed: '2024-12-10', checkins: 389, verified: true, source: 'hitchwiki', country: 'DE', alerts: [], createdAt: '2018-02-20' },
            
            // ==================== PLUS DE POLOGNE ====================
            { id: 76, from: 'Warsaw', to: 'Krakow (A4)', description: 'Stacja Orlen sortie sud Varsovie. A4 vers Cracovie, 3-4h de route.', photoUrl: 'https://images.unsplash.com/photo-1519197924294-4ba991a11128?w=600', creator: 'Hitchwiki', creatorAvatar: 'üó∫Ô∏è', coordinates: { lat: 52.1567, lng: 21.0123 }, ratings: { accessibility: 4.4, safety: 4.6, visibility: 4.4, traffic: 4.2 }, globalRating: 4.40, totalReviews: 134, avgWaitTime: 22, lastUsed: '2024-12-09', checkins: 312, verified: true, source: 'hitchwiki', country: 'PL', alerts: [], createdAt: '2018-06-15' },
            { id: 77, from: 'Krakow', to: 'Prague (E40)', description: 'Station BP sortie ouest Cracovie. Direction Tch√©quie via Katowice.', photoUrl: 'https://images.unsplash.com/photo-1519197924294-4ba991a11128?w=600', creator: 'Hitchwiki', creatorAvatar: 'üó∫Ô∏è', coordinates: { lat: 50.0456, lng: 19.8567 }, ratings: { accessibility: 4.3, safety: 4.5, visibility: 4.3, traffic: 4.1 }, globalRating: 4.30, totalReviews: 98, avgWaitTime: 28, lastUsed: '2024-12-05', checkins: 234, verified: true, source: 'hitchwiki', country: 'PL', alerts: [], createdAt: '2019-04-20' },
            
            // ==================== PLUS DE TCH√âQUIE ====================
            { id: 78, from: 'Prague', to: 'Vienna (D1/E65)', description: 'Benzina station sortie sud-est Prague. Direction Brno puis Vienne.', photoUrl: 'https://images.unsplash.com/photo-1541849546-216549ae216d?w=600', creator: 'Hitchwiki', creatorAvatar: 'üó∫Ô∏è', coordinates: { lat: 50.0234, lng: 14.5345 }, ratings: { accessibility: 4.5, safety: 4.7, visibility: 4.5, traffic: 4.3 }, globalRating: 4.50, totalReviews: 156, avgWaitTime: 20, lastUsed: '2024-12-11', checkins: 389, verified: true, source: 'hitchwiki', country: 'CZ', alerts: [], createdAt: '2017-08-10' },
            { id: 79, from: 'Brno', to: 'Vienna (D1)', description: 'Station MOL sortie sud Brno. Fronti√®re autrichienne √† 1h, beaucoup de trafic.', photoUrl: 'https://images.unsplash.com/photo-1541849546-216549ae216d?w=600', creator: 'Hitchwiki', creatorAvatar: 'üó∫Ô∏è', coordinates: { lat: 49.1567, lng: 16.6234 }, ratings: { accessibility: 4.4, safety: 4.6, visibility: 4.4, traffic: 4.3 }, globalRating: 4.43, totalReviews: 123, avgWaitTime: 22, lastUsed: '2024-12-08', checkins: 298, verified: true, source: 'hitchwiki', country: 'CZ', alerts: [], createdAt: '2018-10-15' },
            
            // ==================== PLUS D'AUTRICHE ====================
            { id: 80, from: 'Vienna', to: 'Salzburg (A1)', description: 'OMV station sortie ouest Vienne. A1 vers Salzburg, paysages alpins superbes.', photoUrl: 'https://images.unsplash.com/photo-1516550893923-42d28e5677af?w=600', creator: 'Hitchwiki', creatorAvatar: 'üó∫Ô∏è', coordinates: { lat: 48.1789, lng: 16.2345 }, ratings: { accessibility: 4.5, safety: 4.8, visibility: 4.5, traffic: 4.4 }, globalRating: 4.55, totalReviews: 167, avgWaitTime: 18, lastUsed: '2024-12-12', checkins: 423, verified: true, source: 'hitchwiki', country: 'AT', alerts: [], createdAt: '2016-12-10' },
            { id: 81, from: 'Salzburg', to: 'Munich (A8)', description: 'Station OMV pr√®s de la fronti√®re allemande. 1h30 jusqu\'√† Munich.', photoUrl: 'https://images.unsplash.com/photo-1516550893923-42d28e5677af?w=600', creator: 'Hitchwiki', creatorAvatar: 'üó∫Ô∏è', coordinates: { lat: 47.8234, lng: 13.0456 }, ratings: { accessibility: 4.6, safety: 4.9, visibility: 4.6, traffic: 4.5 }, globalRating: 4.65, totalReviews: 145, avgWaitTime: 15, lastUsed: '2024-12-13', checkins: 378, verified: true, source: 'hitchwiki', country: 'AT', alerts: [], createdAt: '2017-03-15' },
            { id: 82, from: 'Innsbruck', to: 'Italy (A13)', description: 'Station au col du Brenner. Passage vers l\'Italie, vue spectaculaire sur les Alpes.', photoUrl: 'https://images.unsplash.com/photo-1516550893923-42d28e5677af?w=600', creator: 'Hitchwiki', creatorAvatar: 'üó∫Ô∏è', coordinates: { lat: 47.2567, lng: 11.3789 }, ratings: { accessibility: 4.3, safety: 4.8, visibility: 4.4, traffic: 4.2 }, globalRating: 4.43, totalReviews: 112, avgWaitTime: 25, lastUsed: '2024-12-07', checkins: 267, verified: true, source: 'hitchwiki', country: 'AT', alerts: [], createdAt: '2018-09-20' },
            
            // ==================== UK (avant/apr√®s Brexit) ====================
            { id: 83, from: 'London', to: 'Dover (M20)', description: 'Maidstone Services sur M20. Direction ferry vers Calais. UK = conduite √† gauche !', photoUrl: 'https://images.unsplash.com/photo-1513635269975-59663e0ac1ad?w=600', creator: 'Hitchwiki', creatorAvatar: 'üó∫Ô∏è', coordinates: { lat: 51.2789, lng: 0.5234 }, ratings: { accessibility: 4.2, safety: 4.7, visibility: 4.3, traffic: 4.0 }, globalRating: 4.30, totalReviews: 112, avgWaitTime: 35, lastUsed: '2024-12-05', checkins: 234, verified: true, source: 'hitchwiki', country: 'GB', alerts: [], createdAt: '2019-01-15' },
            { id: 84, from: 'Edinburgh', to: 'London (M1/A1)', description: 'Station pr√®s de Musselburgh. Long trajet vers Londres, 6-7h minimum.', photoUrl: 'https://images.unsplash.com/photo-1506377585622-bedcbb027afc?w=600', creator: 'Hitchwiki', creatorAvatar: 'üó∫Ô∏è', coordinates: { lat: 55.9234, lng: -3.1456 }, ratings: { accessibility: 4.1, safety: 4.6, visibility: 4.2, traffic: 3.8 }, globalRating: 4.18, totalReviews: 89, avgWaitTime: 40, lastUsed: '2024-11-28', checkins: 178, verified: true, source: 'hitchwiki', country: 'GB', alerts: [], createdAt: '2019-08-20' },
            
            // ==================== SLOV√âNIE ====================
            { id: 85, from: 'Ljubljana', to: 'Zagreb (A2)', description: 'Petrol station sortie sud Ljubljana. Fronti√®re croate √† 1h30.', photoUrl: 'https://images.unsplash.com/photo-1569347923350-6e6c27f5e58b?w=600', creator: 'Hitchwiki', creatorAvatar: 'üó∫Ô∏è', coordinates: { lat: 46.0234, lng: 14.5345 }, ratings: { accessibility: 4.4, safety: 4.7, visibility: 4.4, traffic: 4.2 }, globalRating: 4.43, totalReviews: 98, avgWaitTime: 22, lastUsed: '2024-12-08', checkins: 234, verified: true, source: 'hitchwiki', country: 'SI', alerts: [], createdAt: '2018-07-10' },
            { id: 86, from: 'Ljubljana', to: 'Venice (A1)', description: 'Station ouest Ljubljana direction Italie. 2h jusqu\'√† Trieste/Venise.', photoUrl: 'https://images.unsplash.com/photo-1569347923350-6e6c27f5e58b?w=600', creator: 'Hitchwiki', creatorAvatar: 'üó∫Ô∏è', coordinates: { lat: 46.0567, lng: 14.4789 }, ratings: { accessibility: 4.3, safety: 4.6, visibility: 4.4, traffic: 4.1 }, globalRating: 4.35, totalReviews: 87, avgWaitTime: 25, lastUsed: '2024-12-05', checkins: 198, verified: true, source: 'hitchwiki', country: 'SI', alerts: [], createdAt: '2019-05-15' },
            
            // ==================== SLOVAQUIE ====================
            { id: 87, from: 'Bratislava', to: 'Vienna (D4)', description: 'Slovnaft station sortie ouest Bratislava. Vienne √† 45min seulement !', photoUrl: 'https://images.unsplash.com/photo-1555990538-1d578fd51938?w=600', creator: 'Hitchwiki', creatorAvatar: 'üó∫Ô∏è', coordinates: { lat: 48.1234, lng: 17.0567 }, ratings: { accessibility: 4.6, safety: 4.7, visibility: 4.5, traffic: 4.5 }, globalRating: 4.58, totalReviews: 145, avgWaitTime: 15, lastUsed: '2024-12-12', checkins: 356, verified: true, source: 'hitchwiki', country: 'SK', alerts: [], createdAt: '2017-06-20' },
            { id: 88, from: 'Bratislava', to: 'Budapest (E75)', description: 'Station sortie est vers Hongrie. Fronti√®re hongroise rapide.', photoUrl: 'https://images.unsplash.com/photo-1555990538-1d578fd51938?w=600', creator: 'Hitchwiki', creatorAvatar: 'üó∫Ô∏è', coordinates: { lat: 48.1567, lng: 17.1789 }, ratings: { accessibility: 4.4, safety: 4.6, visibility: 4.4, traffic: 4.3 }, globalRating: 4.43, totalReviews: 112, avgWaitTime: 20, lastUsed: '2024-12-09', checkins: 278, verified: true, source: 'hitchwiki', country: 'SK', alerts: [], createdAt: '2018-04-10' },
            
            // ==================== LUXEMBOURG ====================
            { id: 89, from: 'Luxembourg City', to: 'Brussels (E411)', description: 'Station Aral sortie nord Luxembourg. Petit pays = travers√©e rapide vers Belgique.', photoUrl: 'https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=600', creator: 'Hitchwiki', creatorAvatar: 'üó∫Ô∏è', coordinates: { lat: 49.6234, lng: 6.1345 }, ratings: { accessibility: 4.5, safety: 4.9, visibility: 4.5, traffic: 4.3 }, globalRating: 4.55, totalReviews: 98, avgWaitTime: 18, lastUsed: '2024-12-10', checkins: 234, verified: true, source: 'hitchwiki', country: 'LU', alerts: [], createdAt: '2018-11-15' },
            
            // ==================== SERBIE ====================
            { id: 90, from: 'Belgrade', to: 'Budapest (E75)', description: 'NIS station sortie nord Belgrade. Direction Hongrie, 4h de route.', photoUrl: 'https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=600', creator: 'Hitchwiki', creatorAvatar: 'üó∫Ô∏è', coordinates: { lat: 44.8234, lng: 20.4567 }, ratings: { accessibility: 4.2, safety: 4.4, visibility: 4.2, traffic: 4.0 }, globalRating: 4.20, totalReviews: 76, avgWaitTime: 30, lastUsed: '2024-12-03', checkins: 167, verified: true, source: 'hitchwiki', country: 'RS', alerts: [], createdAt: '2020-02-20' },
            
            // ==================== BOSNIE ====================
            { id: 91, from: 'Sarajevo', to: 'Zagreb (M5)', description: 'Station sortie nord Sarajevo. Route de montagne vers la Croatie, paysages superbes.', photoUrl: 'https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=600', creator: 'Hitchwiki', creatorAvatar: 'üó∫Ô∏è', coordinates: { lat: 43.8789, lng: 18.4234 }, ratings: { accessibility: 4.0, safety: 4.3, visibility: 4.1, traffic: 3.8 }, globalRating: 4.05, totalReviews: 56, avgWaitTime: 35, lastUsed: '2024-11-25', checkins: 123, verified: true, source: 'hitchwiki', country: 'BA', alerts: [], createdAt: '2020-09-10' },
            
            // ==================== ESTONIE / LETTONIE / LITUANIE ====================
            { id: 92, from: 'Tallinn', to: 'Riga (E67)', description: 'Station Circle K sortie sud Tallinn. Via Baltica vers la Lettonie, 4h de route.', photoUrl: 'https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=600', creator: 'Hitchwiki', creatorAvatar: 'üó∫Ô∏è', coordinates: { lat: 59.4012, lng: 24.7345 }, ratings: { accessibility: 4.2, safety: 4.7, visibility: 4.3, traffic: 3.9 }, globalRating: 4.28, totalReviews: 78, avgWaitTime: 32, lastUsed: '2024-12-01', checkins: 145, verified: true, source: 'hitchwiki', country: 'EE', alerts: [], createdAt: '2019-07-15' },
            { id: 93, from: 'Riga', to: 'Vilnius (A4)', description: 'Neste station sortie sud Riga. Direction Lituanie, bons conducteurs baltes.', photoUrl: 'https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=600', creator: 'Hitchwiki', creatorAvatar: 'üó∫Ô∏è', coordinates: { lat: 56.9234, lng: 24.1234 }, ratings: { accessibility: 4.3, safety: 4.6, visibility: 4.3, traffic: 4.0 }, globalRating: 4.30, totalReviews: 89, avgWaitTime: 28, lastUsed: '2024-12-04', checkins: 178, verified: true, source: 'hitchwiki', country: 'LV', alerts: [], createdAt: '2019-05-20' },
            { id: 94, from: 'Vilnius', to: 'Warsaw (E28)', description: 'Station Orlen sortie sud-ouest Vilnius. Direction Pologne via Kaunas.', photoUrl: 'https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=600', creator: 'Hitchwiki', creatorAvatar: 'üó∫Ô∏è', coordinates: { lat: 54.6567, lng: 25.2345 }, ratings: { accessibility: 4.2, safety: 4.5, visibility: 4.2, traffic: 4.0 }, globalRating: 4.23, totalReviews: 87, avgWaitTime: 30, lastUsed: '2024-12-02', checkins: 167, verified: true, source: 'hitchwiki', country: 'LT', alerts: [], createdAt: '2019-09-10' },
            
            // ==================== PLUS DE SPOTS POPULAIRES ====================
            { id: 95, from: 'Calais', to: 'Paris (A26/A1)', description: 'Station pr√®s du port de Calais. Arriv√©e du ferry UK, beaucoup de trafic international.', photoUrl: 'https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=600', creator: 'Hitchwiki', creatorAvatar: 'üó∫Ô∏è', coordinates: { lat: 50.9512, lng: 1.8567 }, ratings: { accessibility: 4.6, safety: 4.7, visibility: 4.6, traffic: 4.5 }, globalRating: 4.60, totalReviews: 234, avgWaitTime: 12, lastUsed: '2024-12-15', checkins: 678, verified: true, source: 'hitchwiki', country: 'FR', alerts: [], createdAt: '2015-06-10' },
            { id: 96, from: 'Dunkerque', to: 'Belgium (E40)', description: 'Station Total sortie vers Belgique. Alternative √† Calais, moins fr√©quent√©.', photoUrl: 'https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=600', creator: 'Hitchwiki', creatorAvatar: 'üó∫Ô∏è', coordinates: { lat: 51.0234, lng: 2.3678 }, ratings: { accessibility: 4.4, safety: 4.6, visibility: 4.4, traffic: 4.2 }, globalRating: 4.40, totalReviews: 112, avgWaitTime: 20, lastUsed: '2024-12-10', checkins: 287, verified: true, source: 'hitchwiki', country: 'FR', alerts: [], createdAt: '2018-03-15' },
            { id: 97, from: 'Grenoble', to: 'Lyon (A48)', description: 'Aire de Voreppe direction Lyon. Sortie des Alpes vers la vall√©e du Rh√¥ne.', photoUrl: 'https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=600', creator: 'Hitchwiki', creatorAvatar: 'üó∫Ô∏è', coordinates: { lat: 45.2123, lng: 5.6234 }, ratings: { accessibility: 4.4, safety: 4.6, visibility: 4.4, traffic: 4.2 }, globalRating: 4.40, totalReviews: 98, avgWaitTime: 22, lastUsed: '2024-12-08', checkins: 234, verified: true, source: 'hitchwiki', country: 'FR', alerts: [], createdAt: '2019-02-10' },
            { id: 98, from: 'Dijon', to: 'Paris (A6)', description: 'Aire de Beaune sur A6. C√©l√®bre r√©gion viticole, beaucoup de trafic vers Paris.', photoUrl: 'https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=600', creator: 'Hitchwiki', creatorAvatar: 'üó∫Ô∏è', coordinates: { lat: 47.0234, lng: 4.8345 }, ratings: { accessibility: 4.5, safety: 4.7, visibility: 4.5, traffic: 4.4 }, globalRating: 4.53, totalReviews: 145, avgWaitTime: 18, lastUsed: '2024-12-11', checkins: 378, verified: true, source: 'hitchwiki', country: 'FR', alerts: [], createdAt: '2017-07-20' },
            { id: 99, from: 'Perpignan', to: 'Barcelona (AP-7)', description: 'Derni√®re station fran√ßaise avant l\'Espagne. Fronti√®re catalane √† 30min.', photoUrl: 'https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=600', creator: 'Hitchwiki', creatorAvatar: 'üó∫Ô∏è', coordinates: { lat: 42.6987, lng: 2.8956 }, ratings: { accessibility: 4.4, safety: 4.6, visibility: 4.4, traffic: 4.3 }, globalRating: 4.43, totalReviews: 134, avgWaitTime: 20, lastUsed: '2024-12-09', checkins: 312, verified: true, source: 'hitchwiki', country: 'FR', alerts: [], createdAt: '2018-08-15' },
            { id: 100, from: 'Biarritz', to: 'San Sebastian (A63)', description: 'Station sortie sud Biarritz. Pays Basque espagnol √† 30min, surf et tapas !', photoUrl: 'https://images.unsplash.com/photo-1558618666-fcd25c85cd64?w=600', creator: 'Hitchwiki', creatorAvatar: 'üó∫Ô∏è', coordinates: { lat: 43.4234, lng: -1.5567 }, ratings: { accessibility: 4.5, safety: 4.7, visibility: 4.5, traffic: 4.3 }, globalRating: 4.50, totalReviews: 145, avgWaitTime: 18, lastUsed: '2024-12-12', checkins: 356, verified: true, source: 'hitchwiki', country: 'FR', alerts: [], createdAt: '2017-09-10' }
        ];

        const sampleFriends = [
            { id: 1, username: 'Marie_Adventure', avatar: 'üë©‚Äçü¶∞', score: 1250, online: true, traveling: true, location: 'Lyon ‚Üí Marseille' },
            { id: 2, username: 'Tom_Roadtrip', avatar: 'üßî', score: 980, online: true, traveling: false, location: 'Paris' },
            { id: 3, username: 'Sophie_Nomad', avatar: 'üë±‚Äç‚ôÄÔ∏è', score: 875, online: false, traveling: false, location: 'Barcelona' }
        ];

        const sampleMessages = [
            { id: 1, room: 'general', user: 'Marie_Adventure', avatar: 'üë©‚Äçü¶∞', text: 'Salut ! Quelqu\'un part vers Lyon ?', time: '14:32', isMe: false },
            { id: 2, room: 'general', user: 'Tom_Roadtrip', avatar: 'üßî', text: 'Moi demain matin !', time: '14:35', isMe: false },
            { id: 3, room: 'help', user: 'NewHitcher', avatar: 'üßí', text: 'C\'est ma premi√®re fois, des conseils ?', time: '10:15', isMe: false },
            { id: 4, room: 'help', user: 'Sophie_Nomad', avatar: 'üë±‚Äç‚ôÄÔ∏è', text: 'Toujours sourire et avoir de l\'eau !', time: '10:20', isMe: false }
        ];

        // Guides pays complets - Group√©s par continent
        // Sources: Exp√©rience communaut√©, reformul√© pour √©viter copier-coller
        const countryGuides = [
            // ==================== EUROPE OCCIDENTALE ====================
            { 
                code: 'FR', flag: 'üá´üá∑', name: 'France', continent: 'europe-west',
                legal: '‚úÖ', difficulty: '‚≠ê‚≠ê', avgWait: 25, safety: 4.5, emergency: '112',
                tips: { 
                    fr: 'Les aires de repos sur autoroutes et les p√©ages sont les meilleurs endroits. √âvite absolument Paris intra-muros o√π c\'est quasi impossible. Le sud de la France est plus facile en √©t√© gr√¢ce au tourisme. Un panneau avec ta destination augmente tes chances. Les camionneurs sont souvent sympas mais font de longues distances.', 
                    en: 'Highway rest areas and toll booths are the best spots. Avoid central Paris where it\'s nearly impossible. Southern France is easier in summer due to tourism. A sign with your destination increases your chances. Truck drivers are often friendly but go long distances.',
                    es: 'Las √°reas de descanso en autopistas y los peajes son los mejores lugares. Evita el centro de Par√≠s donde es casi imposible. El sur de Francia es m√°s f√°cil en verano por el turismo. Un cartel con tu destino aumenta tus posibilidades.'
                },
                bestSpots: ['Aires de service', 'P√©ages', 'Stations essence sortie autoroute'],
                avoid: ['Paris centre', 'Nuit sur autoroute', 'Entr√©es de tunnel'],
                phrases: { hello: 'Bonjour', thanks: 'Merci', where: 'O√π allez-vous ?', hitchhike: 'Je fais du stop' }
            },
            { 
                code: 'DE', flag: 'üá©üá™', name: 'Allemagne', continent: 'europe-west',
                legal: '‚úÖ', difficulty: '‚≠ê‚≠ê', avgWait: 20, safety: 4.8, emergency: '112',
                tips: { 
                    fr: 'Les Tankstelle (stations-service) sur autoroutes sont parfaites. Les Allemands sont ponctuels et fiables, ils te d√©poseront exactement o√π promis. Sur les Autobahn sans limite de vitesse, certains roulent tr√®s vite. Rastst√§tte = aire de repos, Ausfahrt = sortie.', 
                    en: 'Tankstelle (gas stations) on highways are perfect. Germans are punctual and reliable, they\'ll drop you exactly where promised. On Autobahn without speed limits, some drive very fast. Rastst√§tte = rest area, Ausfahrt = exit.',
                    es: 'Las Tankstelle (gasolineras) en autopistas son perfectas. Los alemanes son puntuales y fiables. En las Autobahn sin l√≠mite de velocidad, algunos conducen muy r√°pido.'
                },
                bestSpots: ['Rastst√§tte', 'Tankstelle Aral/Shell', 'Entr√©es autoroute'],
                avoid: ['Centre-ville grandes villes', 'Heures de pointe'],
                phrases: { hello: 'Hallo', thanks: 'Danke', where: 'Wohin fahren Sie?', hitchhike: 'Ich trampe' }
            },
            { 
                code: 'BE', flag: 'üáßüá™', name: 'Belgique', continent: 'europe-west',
                legal: '‚úÖ', difficulty: '‚≠ê', avgWait: 18, safety: 4.7, emergency: '112',
                tips: { 
                    fr: 'Petit pays, tu peux le traverser en 2-3 heures. Flamand au nord (n√©erlandais), fran√ßais au sud (Wallonie). Les stations essence sur autoroutes sont excellentes. Bruxelles est un bon hub mais le centre est compliqu√©.', 
                    en: 'Small country, you can cross it in 2-3 hours. Flemish in the north (Dutch), French in the south (Wallonia). Gas stations on highways are excellent. Brussels is a good hub but the center is tricky.',
                    es: 'Pa√≠s peque√±o, puedes cruzarlo en 2-3 horas. Flamenco en el norte, franc√©s en el sur. Las gasolineras en autopistas son excelentes.'
                },
                bestSpots: ['Stations Total/Q8', 'Aires autoroute E40/E19', 'Sortie Bruxelles'],
                avoid: ['Centre Bruxelles', 'Ring aux heures de pointe'],
                phrases: { hello: 'Bonjour/Hallo', thanks: 'Merci/Dank u', where: 'O√π allez-vous?', hitchhike: 'Je fais de l\'auto-stop' }
            },
            { 
                code: 'NL', flag: 'üá≥üá±', name: 'Pays-Bas', continent: 'europe-west',
                legal: '‚úÖ', difficulty: '‚≠ê', avgWait: 15, safety: 4.9, emergency: '112',
                tips: { 
                    fr: 'Un des pays les plus faciles ! Presque tout le monde parle anglais couramment. Petit pays donc trajets courts. Les N√©erlandais sont directs mais super sympas. Le v√©lo est roi, beaucoup de gens comprennent l\'esprit voyage.', 
                    en: 'One of the easiest countries! Almost everyone speaks fluent English. Small country so short trips. Dutch are direct but super friendly. Cycling is king, many people understand the travel spirit.',
                    es: 'Uno de los pa√≠ses m√°s f√°ciles. Casi todos hablan ingl√©s. Pa√≠s peque√±o, viajes cortos. Los holandeses son directos pero muy amables.'
                },
                bestSpots: ['Stations Shell/BP', 'Parkings P+R', 'Entr√©es A2/A12'],
                avoid: ['Amsterdam centre', 'Rotterdam port zone industrielle'],
                phrases: { hello: 'Hallo', thanks: 'Dank je wel', where: 'Waar gaat u naartoe?', hitchhike: 'Ik ben aan het liften' }
            },
            { 
                code: 'LU', flag: 'üá±üá∫', name: 'Luxembourg', continent: 'europe-west',
                legal: '‚úÖ', difficulty: '‚≠ê', avgWait: 12, safety: 4.9, emergency: '112',
                tips: { 
                    fr: 'Minuscule pays, tu le traverses en 30 minutes ! Beaucoup de travailleurs frontaliers (France, Belgique, Allemagne) = trajets faciles. L\'essence est moins ch√®re donc les stations sont bond√©es.', 
                    en: 'Tiny country, you cross it in 30 minutes! Many cross-border workers (France, Belgium, Germany) = easy rides. Gas is cheaper so stations are packed.',
                    es: 'Pa√≠s diminuto, lo cruzas en 30 minutos. Muchos trabajadores transfronterizos = viajes f√°ciles.'
                },
                bestSpots: ['Stations essence (moins ch√®res)', 'Aire de Berchem'],
                avoid: ['Ville de Luxembourg aux heures de bureau'],
                phrases: { hello: 'Moien', thanks: 'Merci', where: 'O√π allez-vous?', hitchhike: 'Je fais du stop' }
            },
            { 
                code: 'CH', flag: 'üá®üá≠', name: 'Suisse', continent: 'europe-west',
                legal: '‚úÖ', difficulty: '‚≠ê‚≠ê', avgWait: 25, safety: 4.9, emergency: '112',
                tips: { 
                    fr: 'Vignette autoroute obligatoire (40 CHF/an) mais les conducteurs l\'ont d√©j√†. 4 langues : allemand (nord), fran√ßais (ouest), italien (sud), romanche. Pays tr√®s s√ªr mais cher. Les Suisses sont r√©serv√©s mais fiables.', 
                    en: 'Highway vignette required (40 CHF/year) but drivers already have it. 4 languages: German (north), French (west), Italian (south), Romansh. Very safe but expensive. Swiss are reserved but reliable.',
                    es: 'Se requiere vi√±eta de autopista. 4 idiomas seg√∫n la regi√≥n. Pa√≠s muy seguro pero caro.'
                },
                bestSpots: ['Stations Migrolino/Coop Pronto', 'Aires de repos'],
                avoid: ['Tunnels alpins', 'Heures de pointe Zurich/Gen√®ve'],
                phrases: { hello: 'Gr√ºezi/Bonjour/Ciao', thanks: 'Danke/Merci/Grazie', where: 'O√π allez-vous?', hitchhike: 'Autostop' }
            },
            { 
                code: 'AT', flag: 'üá¶üáπ', name: 'Autriche', continent: 'europe-west',
                legal: '‚úÖ', difficulty: '‚≠ê‚≠ê', avgWait: 20, safety: 4.8, emergency: '112',
                tips: { 
                    fr: 'Vignette autoroute obligatoire. Les stations OMV sont recommand√©es. Paysages alpins magnifiques, beaucoup de touristes en transit. Les Autrichiens sont polis et accueillants. Attention aux cols de montagne en hiver.', 
                    en: 'Highway vignette required. OMV stations recommended. Beautiful alpine scenery, many tourists in transit. Austrians are polite and welcoming. Be careful with mountain passes in winter.',
                    es: 'Se requiere vi√±eta de autopista. Estaciones OMV recomendadas. Paisajes alpinos hermosos. Los austriacos son amables.'
                },
                bestSpots: ['Stations OMV', 'Rastplatz sur A1/A2', 'Innsbruck sorties'],
                avoid: ['Cols de montagne la nuit', 'Vienne centre'],
                phrases: { hello: 'Gr√º√ü Gott', thanks: 'Danke sch√∂n', where: 'Wohin fahren Sie?', hitchhike: 'Ich trampe' }
            },
            // ==================== EUROPE DU SUD ====================
            { 
                code: 'ES', flag: 'üá™üá∏', name: 'Espagne', continent: 'europe-south',
                legal: '‚úÖ', difficulty: '‚≠ê‚≠ê‚≠ê', avgWait: 35, safety: 4.3, emergency: '112',
                tips: { 
                    fr: 'Les aires de service sur les autopistas (autoroutes payantes) sont bonnes. Espagnols tr√®s chaleureux mais peu parlent anglais. √âvite la siesta (14h-17h) o√π tout est mort. L\'√©t√© est difficile dans le sud (chaleur extr√™me).', 
                    en: 'Rest areas on autopistas (toll highways) are good. Spanish very warm but few speak English. Avoid siesta (2pm-5pm) when everything is dead. Summer is hard in the south (extreme heat).',
                    es: 'Las √°reas de servicio en autopistas son buenas. Evita la siesta (14h-17h). El verano es dif√≠cil en el sur por el calor extremo.'
                },
                bestSpots: ['√Åreas de servicio Repsol', 'Peajes', 'Gasolineras sortie ville'],
                avoid: ['Centre Madrid/Barcelona', 'Autoroute pendant siesta', 'Sud en ao√ªt'],
                phrases: { hello: 'Hola', thanks: 'Gracias', where: '¬øAd√≥nde va?', hitchhike: 'Hago autostop' }
            },
            { 
                code: 'PT', flag: 'üáµüáπ', name: 'Portugal', continent: 'europe-south',
                legal: '‚úÖ', difficulty: '‚≠ê‚≠ê', avgWait: 28, safety: 4.5, emergency: '112',
                tips: { 
                    fr: 'Les Portugais sont incroyablement accueillants, ils offrent souvent √† manger ! Les stations Galp sont partout. L\'attente peut √™tre longue car moins de trafic qu\'en Espagne. Le sud (Algarve) est tr√®s touristique en √©t√©.', 
                    en: 'Portuguese are incredibly welcoming, they often offer food! Galp stations are everywhere. Waits can be long due to less traffic than Spain. The south (Algarve) is very touristy in summer.',
                    es: 'Los portugueses son incre√≠blemente acogedores, a menudo ofrecen comida. Las estaciones Galp est√°n por todas partes.'
                },
                bestSpots: ['Stations Galp', 'Aires A1/A2', 'Sortie Lisbonne nord'],
                avoid: ['Centre Lisbonne', 'Routes secondaires isol√©es'],
                phrases: { hello: 'Ol√°', thanks: 'Obrigado/a', where: 'Para onde vai?', hitchhike: 'Estou a fazer boleia' }
            },
            { 
                code: 'IT', flag: 'üáÆüáπ', name: 'Italie', continent: 'europe-south',
                legal: '‚úÖ', difficulty: '‚≠ê‚≠ê‚≠ê', avgWait: 30, safety: 4.2, emergency: '112',
                tips: { 
                    fr: 'Les Autogrill (restos/stations sur autoroute) sont excellents. Le sud est plus chaleureux et facile que le nord. Les Italiens adorent discuter et sont curieux. Attention aux autoroutes ch√®res ! Beaucoup de trajets locaux.', 
                    en: 'Autogrill (highway restaurants/stations) are excellent. The south is warmer and easier than the north. Italians love to chat and are curious. Watch out for expensive tolls! Many local trips.',
                    es: 'Los Autogrill son excelentes. El sur es m√°s c√°lido que el norte. Los italianos adoran charlar.'
                },
                bestSpots: ['Autogrill', 'Stations Eni/Agip', 'Entr√©es autostrada'],
                avoid: ['Rome/Milan centre', 'Autoroute la nuit', 'Naples zone port'],
                phrases: { hello: 'Ciao', thanks: 'Grazie', where: 'Dove va?', hitchhike: 'Faccio l\'autostop' }
            },
            { 
                code: 'GR', flag: 'üá¨üá∑', name: 'Gr√®ce', continent: 'europe-south',
                legal: '‚úÖ', difficulty: '‚≠ê‚≠ê‚≠ê', avgWait: 35, safety: 4.1, emergency: '112',
                tips: { 
                    fr: 'Les Grecs sont super accueillants et adorent les voyageurs ! Moins de trafic qu\'en Europe de l\'Ouest. Les ferries entre √Æles sont une alternative. L\'√©t√© est tr√®s touristique. Ath√®nes est compliqu√©e, pr√©f√®re la p√©riph√©rie.', 
                    en: 'Greeks are super welcoming and love travelers! Less traffic than Western Europe. Ferries between islands are an alternative. Summer is very touristy. Athens is tricky, prefer the outskirts.',
                    es: 'Los griegos son muy acogedores. Menos tr√°fico que en Europa occidental. Los ferris entre islas son una alternativa.'
                },
                bestSpots: ['Stations BP/Shell', 'P√©ages Egnatia', 'Sortie Thessalonique'],
                avoid: ['Ath√®nes centre', 'Routes de montagne la nuit'],
                phrases: { hello: 'ŒìŒµŒπŒ± œÉŒ±œÇ (Yia sas)', thanks: 'ŒïœÖœáŒ±œÅŒπœÉœÑœé (Efharisto)', where: 'Œ†Œøœç œÄŒ¨œÑŒµ? (Pou pate?)', hitchhike: 'ŒöŒ¨ŒΩœâ œâœÑŒøœÉœÑœåœÄ' }
            },
            { 
                code: 'MT', flag: 'üá≤üáπ', name: 'Malte', continent: 'europe-south',
                legal: '‚úÖ', difficulty: '‚≠ê', avgWait: 10, safety: 4.6, emergency: '112',
                tips: { 
                    fr: '√éle minuscule ! Tout le monde parle anglais. Les Maltais sont tr√®s sympas. Tu peux faire le tour en quelques heures. Bus bon march√© comme alternative.', 
                    en: 'Tiny island! Everyone speaks English. Maltese are very friendly. You can tour the island in a few hours. Cheap buses as alternative.',
                    es: 'Isla diminuta. Todos hablan ingl√©s. Los malteses son muy amables.'
                },
                bestSpots: ['N\'importe o√π sur les routes principales', 'Sortie La Valette'],
                avoid: ['Rien de particulier'],
                phrases: { hello: 'Hello', thanks: 'Thank you/Grazzi', where: 'Where are you going?', hitchhike: 'Hitchhiking' }
            },
            { 
                code: 'CY', flag: 'üá®üáæ', name: 'Chypre', continent: 'europe-south',
                legal: '‚úÖ', difficulty: '‚≠ê‚≠ê', avgWait: 20, safety: 4.4, emergency: '112',
                tips: { 
                    fr: '√éle divis√©e (nord = turc, sud = grec). Le sud est plus facile. Conduite √† gauche ! Les Chypriotes sont accueillants. L\'√©t√© est tr√®s chaud.', 
                    en: 'Divided island (north = Turkish, south = Greek). South is easier. Drive on the left! Cypriots are welcoming. Summer is very hot.',
                    es: 'Isla dividida. El sur es m√°s f√°cil. Conducci√≥n por la izquierda. Verano muy caluroso.'
                },
                bestSpots: ['Stations Petrolina', 'Routes vers Paphos/Limassol'],
                avoid: ['Ligne verte (fronti√®re)', 'Centre Nicosie'],
                phrases: { hello: 'ŒìŒµŒπŒ± œÉŒ±œÇ', thanks: 'ŒïœÖœáŒ±œÅŒπœÉœÑœé', where: 'Œ†Œøœç œÄŒ¨œÑŒµ?', hitchhike: 'Autostop' }
            },
            // ==================== EUROPE DU NORD ====================
            { 
                code: 'GB', flag: 'üá¨üáß', name: 'Royaume-Uni', continent: 'europe-north',
                legal: '‚úÖ', difficulty: '‚≠ê‚≠ê‚≠ê', avgWait: 35, safety: 4.5, emergency: '999',
                tips: { 
                    fr: 'Conduite √† gauche ! L\'autostop est moins courant qu\'avant mais fonctionne encore, surtout hors des grandes villes. L\'√âcosse et le Pays de Galles sont plus faciles. Services stations sur motorways.', 
                    en: 'Drive on the left! Hitchhiking is less common than before but still works, especially outside big cities. Scotland and Wales are easier. Service stations on motorways.',
                    es: 'Conducci√≥n por la izquierda. El autostop es menos com√∫n pero funciona fuera de las grandes ciudades.'
                },
                bestSpots: ['Motorway services', 'Roundabouts sortie ville', 'Routes A en √âcosse'],
                avoid: ['Londres', 'M25', 'Grandes villes'],
                phrases: { hello: 'Hello', thanks: 'Thank you', where: 'Where are you headed?', hitchhike: 'I\'m hitchhiking' }
            },
            { 
                code: 'IE', flag: 'üáÆüá™', name: 'Irlande', continent: 'europe-north',
                legal: '‚úÖ', difficulty: '‚≠ê', avgWait: 15, safety: 4.8, emergency: '112',
                tips: { 
                    fr: 'Les Irlandais sont parmi les plus sympas du monde pour l\'autostop ! Tr√®s bavards et curieux. Les routes secondaires marchent bien. Conduite √† gauche. Le temps change vite, prends un imperm√©able !', 
                    en: 'Irish are among the friendliest in the world for hitchhiking! Very chatty and curious. Secondary roads work well. Drive on the left. Weather changes fast, bring a raincoat!',
                    es: 'Los irlandeses son de los m√°s amables del mundo. Muy charladores. Conducci√≥n por la izquierda.'
                },
                bestSpots: ['N\'importe quel rond-point', 'Routes N1-N4', 'Sortie Dublin'],
                avoid: ['Dublin centre', 'M50 (p√©riph√©rique)'],
                phrases: { hello: 'Hello/Dia duit', thanks: 'Thanks/Go raibh maith agat', where: 'Where are you headed?', hitchhike: 'I\'m hitching' }
            },
            { 
                code: 'DK', flag: 'üá©üá∞', name: 'Danemark', continent: 'europe-north',
                legal: '‚úÖ', difficulty: '‚≠ê‚≠ê', avgWait: 22, safety: 4.8, emergency: '112',
                tips: { 
                    fr: 'Petit pays, trajets courts. Tout le monde parle anglais parfaitement. Les Danois sont r√©serv√©s mais sympas. Le pont vers la Su√®de est cher en voiture donc facile de trouver des lifts.', 
                    en: 'Small country, short trips. Everyone speaks perfect English. Danes are reserved but nice. The bridge to Sweden is expensive by car so easy to find rides.',
                    es: 'Pa√≠s peque√±o, viajes cortos. Todos hablan ingl√©s perfectamente. Los daneses son reservados pero amables.'
                },
                bestSpots: ['Stations Shell/OK', 'Entr√©es E45/E20', 'Avant le pont √òresund'],
                avoid: ['Copenhague centre', '√éles sans ferry direct'],
                phrases: { hello: 'Hej', thanks: 'Tak', where: 'Hvor skal du hen?', hitchhike: 'Jeg blaffer' }
            },
            { 
                code: 'SE', flag: 'üá∏üá™', name: 'Su√®de', continent: 'europe-north',
                legal: '‚úÖ', difficulty: '‚≠ê‚≠ê', avgWait: 25, safety: 4.9, emergency: '112',
                tips: { 
                    fr: 'Grands espaces, trajets longs entre les villes. Les Su√©dois sont r√©serv√©s mais tr√®s polis. Tout le monde parle anglais. L\'√©t√© (minuit soleil) est id√©al. L\'hiver est tr√®s rude et sombre.', 
                    en: 'Wide open spaces, long trips between cities. Swedes are reserved but very polite. Everyone speaks English. Summer (midnight sun) is ideal. Winter is harsh and dark.',
                    es: 'Grandes espacios, viajes largos. Los suecos son reservados pero muy educados. Todos hablan ingl√©s.'
                },
                bestSpots: ['Stations Circle K/Preem', 'E4/E6', 'Rondpoints sortie ville'],
                avoid: ['Stockholm centre', 'Routes du nord en hiver'],
                phrases: { hello: 'Hej', thanks: 'Tack', where: 'Vart ska du?', hitchhike: 'Jag liftar' }
            },
            { 
                code: 'NO', flag: 'üá≥üá¥', name: 'Norv√®ge', continent: 'europe-north',
                legal: '‚úÖ', difficulty: '‚≠ê‚≠ê‚≠ê', avgWait: 30, safety: 4.9, emergency: '112',
                tips: { 
                    fr: 'Paysages incroyables mais distances √©normes ! Les Norv√©giens sont r√©serv√©s. Beaucoup de ferries (gratuits pour passagers souvent). Tr√®s cher, emporte de la nourriture. L\'√©t√© est la meilleure saison.', 
                    en: 'Incredible landscapes but huge distances! Norwegians are reserved. Many ferries (often free for passengers). Very expensive, bring food. Summer is the best season.',
                    es: 'Paisajes incre√≠bles pero distancias enormes. Los noruegos son reservados. Muchos ferries. Muy caro.'
                },
                bestSpots: ['Stations Circle K', 'Files d\'attente ferries', 'E6/E18'],
                avoid: ['Oslo centre', 'Routes de montagne en hiver'],
                phrases: { hello: 'Hei', thanks: 'Takk', where: 'Hvor skal du?', hitchhike: 'Jeg haiker' }
            },
            { 
                code: 'FI', flag: 'üá´üáÆ', name: 'Finlande', continent: 'europe-north',
                legal: '‚úÖ', difficulty: '‚≠ê‚≠ê‚≠ê', avgWait: 35, safety: 4.8, emergency: '112',
                tips: { 
                    fr: 'Les Finlandais sont tr√®s r√©serv√©s (c√©l√®bre humour finlandais sur le silence !). Mais une fois dans la voiture, ils s\'ouvrent. Distances √©normes au nord. √ât√© = moustiques mais jour permanent !', 
                    en: 'Finns are very reserved (famous Finnish humor about silence!). But once in the car, they open up. Huge distances in the north. Summer = mosquitoes but permanent daylight!',
                    es: 'Los finlandeses son muy reservados. Distancias enormes en el norte. Verano = mosquitos pero luz permanente.'
                },
                bestSpots: ['Stations ABC/Neste', 'E4/E75', 'Sortie Helsinki'],
                avoid: ['Helsinki centre', 'Laponie en hiver sans pr√©paration'],
                phrases: { hello: 'Moi', thanks: 'Kiitos', where: 'Minne olet menossa?', hitchhike: 'Liftaan' }
            },
            { 
                code: 'IS', flag: 'üáÆüá∏', name: 'Islande', continent: 'europe-north',
                legal: '‚úÖ', difficulty: '‚≠ê‚≠ê', avgWait: 20, safety: 5.0, emergency: '112',
                tips: { 
                    fr: 'Paradis de l\'autostop ! Petite population mais tr√®s accueillante. La route 1 fait le tour de l\'√Æle. L\'√©t√© est la seule saison viable (jour permanent). Tr√®s cher, emporte tout !', 
                    en: 'Hitchhiking paradise! Small population but very welcoming. Route 1 circles the island. Summer is the only viable season (permanent daylight). Very expensive, bring everything!',
                    es: 'Para√≠so del autostop. Poblaci√≥n peque√±a pero muy acogedora. La ruta 1 rodea la isla. Solo viable en verano.'
                },
                bestSpots: ['Stations N1/Ol√≠s', 'Route 1 partout', 'Sortie Reykjavik'],
                avoid: ['Routes F (4x4 only)', 'Hiver'],
                phrases: { hello: 'H√¶', thanks: 'Takk', where: 'Hvert ertu a√∞ fara?', hitchhike: '√âg er a√∞ p√∫tta' }
            },
            // ==================== EUROPE DE L'EST ====================
            { 
                code: 'PL', flag: 'üáµüá±', name: 'Pologne', continent: 'europe-east',
                legal: '‚úÖ', difficulty: '‚≠ê‚≠ê', avgWait: 25, safety: 4.4, emergency: '112',
                tips: { 
                    fr: 'Les stations Orlen sont excellentes et partout. Les Polonais sont tr√®s g√©n√©reux, ils offrent souvent √† manger ! Les routes s\'am√©liorent √©norm√©ment. Peu parlent anglais mais tr√®s d√©brouillards avec les gestes.', 
                    en: 'Orlen stations are excellent and everywhere. Polish are very generous, often offer food! Roads are improving a lot. Few speak English but very resourceful with gestures.',
                    es: 'Las estaciones Orlen son excelentes. Los polacos son muy generosos, a menudo ofrecen comida.'
                },
                bestSpots: ['Stations Orlen', 'MOP (aires autoroute)', 'A2/A4'],
                avoid: ['Varsovie centre', 'Routes secondaires la nuit'],
                phrases: { hello: 'Cze≈õƒá', thanks: 'Dziƒôkujƒô', where: 'DokƒÖd pan jedzie?', hitchhike: '≈Åapiƒô stopa' }
            },
            { 
                code: 'CZ', flag: 'üá®üáø', name: 'Tch√©quie', continent: 'europe-east',
                legal: '‚úÖ', difficulty: '‚≠ê‚≠ê', avgWait: 22, safety: 4.5, emergency: '112',
                tips: { 
                    fr: 'Les stations essence sont de bons spots. Les Tch√®ques sont r√©serv√©s au d√©but mais deviennent sympas. Prague est difficile, pr√©f√®re la p√©riph√©rie. La bi√®re est moins ch√®re que l\'eau !', 
                    en: 'Gas stations are good spots. Czechs are reserved at first but become friendly. Prague is difficult, prefer the outskirts. Beer is cheaper than water!',
                    es: 'Las gasolineras son buenos puntos. Los checos son reservados pero amables. Praga es dif√≠cil.'
                },
                bestSpots: ['Stations Benzina/MOL', 'D1/D5', 'Sortie Prague'],
                avoid: ['Prague centre', 'Routes de montagne l\'hiver'],
                phrases: { hello: 'Ahoj', thanks: 'Dƒõkuji', where: 'Kam jedete?', hitchhike: 'Stopuju' }
            },
            { 
                code: 'SK', flag: 'üá∏üá∞', name: 'Slovaquie', continent: 'europe-east',
                legal: '‚úÖ', difficulty: '‚≠ê‚≠ê', avgWait: 23, safety: 4.4, emergency: '112',
                tips: { 
                    fr: 'Petit pays sympa, facile √† traverser. Les Slovaques sont accueillants. Paysages de montagnes magnifiques (Tatras). Bratislava est proche de Vienne.', 
                    en: 'Nice small country, easy to cross. Slovaks are welcoming. Beautiful mountain landscapes (Tatras). Bratislava is close to Vienna.',
                    es: 'Pa√≠s peque√±o y agradable. Los eslovacos son acogedores. Paisajes monta√±osos hermosos.'
                },
                bestSpots: ['Stations Slovnaft', 'D1/D2', 'Sortie Bratislava'],
                avoid: ['Bratislava centre', 'Routes de montagne l\'hiver'],
                phrases: { hello: 'Ahoj', thanks: 'ƒéakujem', where: 'Kam idete?', hitchhike: 'Stopujem' }
            },
            { 
                code: 'HU', flag: 'üá≠üá∫', name: 'Hongrie', continent: 'europe-east',
                legal: '‚úÖ', difficulty: '‚≠ê‚≠ê', avgWait: 25, safety: 4.3, emergency: '112',
                tips: { 
                    fr: 'Les Hongrois sont chaleureux une fois la glace bris√©e. Peu parlent anglais hors de Budapest. Les stations MOL sont bonnes. Vignette autoroute obligatoire (e-vignette).', 
                    en: 'Hungarians are warm once the ice is broken. Few speak English outside Budapest. MOL stations are good. Highway vignette required (e-vignette).',
                    es: 'Los h√∫ngaros son c√°lidos. Pocos hablan ingl√©s fuera de Budapest. Se requiere vi√±eta de autopista.'
                },
                bestSpots: ['Stations MOL', 'M1/M7', 'Sortie Budapest'],
                avoid: ['Budapest centre', 'Routes secondaires isol√©es'],
                phrases: { hello: 'Szia', thanks: 'K√∂sz√∂n√∂m', where: 'Merre megy?', hitchhike: 'Stoppolok' }
            },
            { 
                code: 'RO', flag: 'üá∑üá¥', name: 'Roumanie', continent: 'europe-east',
                legal: '‚úÖ', difficulty: '‚≠ê‚≠ê‚≠ê', avgWait: 30, safety: 4.1, emergency: '112',
                tips: { 
                    fr: 'Les Roumains sont tr√®s accueillants et curieux ! Beaucoup parlent fran√ßais (langue latine). Les routes sont en am√©lioration mais restent difficiles. La Transylvanie est magnifique.', 
                    en: 'Romanians are very welcoming and curious! Many speak French (Latin language). Roads are improving but still difficult. Transylvania is beautiful.',
                    es: 'Los rumanos son muy acogedores. Muchos hablan franc√©s. Las carreteras est√°n mejorando.'
                },
                bestSpots: ['Stations Petrom/OMV', 'E81/E85', 'Sortie Bucarest'],
                avoid: ['Bucarest centre', 'Routes de montagne la nuit'],
                phrases: { hello: 'BunƒÉ', thanks: 'Mul»õumesc', where: 'Unde merge»õi?', hitchhike: 'Fac autostopul' }
            },
            { 
                code: 'BG', flag: 'üáßüá¨', name: 'Bulgarie', continent: 'europe-east',
                legal: '‚úÖ', difficulty: '‚≠ê‚≠ê‚≠ê', avgWait: 32, safety: 4.0, emergency: '112',
                tips: { 
                    fr: 'Les Bulgares sont accueillants mais r√©serv√©s. Attention : hochement de t√™te = non, secouement = oui ! Routes en am√©lioration. Moins de trafic que l\'Europe de l\'Ouest.', 
                    en: 'Bulgarians are welcoming but reserved. Warning: head nod = no, shake = yes! Roads improving. Less traffic than Western Europe.',
                    es: 'Los b√∫lgaros son acogedores pero reservados. Atenci√≥n: asentir = no, sacudir = s√≠.'
                },
                bestSpots: ['Stations Shell/Lukoil', 'A1/A2', 'Sortie Sofia'],
                avoid: ['Sofia centre', 'Fronti√®re turque la nuit'],
                phrases: { hello: '–ó–¥—Ä–∞–≤–µ–π (Zdravey)', thanks: '–ë–ª–∞–≥–æ–¥–∞—Ä—è (Blagodarya)', where: '–ù–∞–∫—ä–¥–µ –æ—Ç–∏–≤–∞—Ç–µ?', hitchhike: '–ü—Ä–∞–≤—è –∞–≤—Ç–æ—Å—Ç–æ–ø' }
            },
            { 
                code: 'HR', flag: 'üá≠üá∑', name: 'Croatie', continent: 'europe-east',
                legal: '‚úÖ', difficulty: '‚≠ê‚≠ê', avgWait: 28, safety: 4.4, emergency: '112',
                tips: { 
                    fr: 'Les stations INA sont partout. La c√¥te dalmate est tr√®s touristique en √©t√© = facile ! Les Croates sont accueillants. Zagreb est un bon hub. Autoroutes ch√®res.', 
                    en: 'INA stations are everywhere. Dalmatian coast is very touristy in summer = easy! Croatians are welcoming. Zagreb is a good hub. Expensive highways.',
                    es: 'Las estaciones INA est√°n por todas partes. La costa d√°lmata es muy tur√≠stica en verano.'
                },
                bestSpots: ['Stations INA', 'A1/A3', 'Sortie Zagreb'],
                avoid: ['Zagreb centre', '√éles sans ferry direct'],
                phrases: { hello: 'Bok', thanks: 'Hvala', where: 'Kamo idete?', hitchhike: '≈†topam' }
            },
            { 
                code: 'SI', flag: 'üá∏üáÆ', name: 'Slov√©nie', continent: 'europe-east',
                legal: '‚úÖ', difficulty: '‚≠ê‚≠ê', avgWait: 22, safety: 4.6, emergency: '112',
                tips: { 
                    fr: 'Petit pays entre Italie et Croatie. Les Slov√®nes sont r√©serv√©s mais polis. Paysages alpins magnifiques. Ljubljana est tr√®s agr√©able. Vignette autoroute obligatoire.', 
                    en: 'Small country between Italy and Croatia. Slovenians are reserved but polite. Beautiful alpine landscapes. Ljubljana is very pleasant. Highway vignette required.',
                    es: 'Pa√≠s peque√±o entre Italia y Croacia. Los eslovenos son reservados pero educados.'
                },
                bestSpots: ['Stations Petrol', 'A1/A2', 'Sortie Ljubljana'],
                avoid: ['Ljubljana centre', 'Tunnels de montagne'],
                phrases: { hello: '≈Ωivjo', thanks: 'Hvala', where: 'Kam greste?', hitchhike: '≈†topam' }
            },
            { 
                code: 'RS', flag: 'üá∑üá∏', name: 'Serbie', continent: 'europe-east',
                legal: '‚úÖ', difficulty: '‚≠ê‚≠ê', avgWait: 25, safety: 4.2, emergency: '112',
                tips: { 
                    fr: 'Les Serbes sont tr√®s hospitaliers et g√©n√©reux ! La cuisine est excellente. Belgrade est une ville festive. Peu parlent anglais mais tr√®s d√©brouillards.', 
                    en: 'Serbians are very hospitable and generous! Cuisine is excellent. Belgrade is a party city. Few speak English but very resourceful.',
                    es: 'Los serbios son muy hospitalarios y generosos. La cocina es excelente. Pocos hablan ingl√©s.'
                },
                bestSpots: ['Stations NIS/Gazprom', 'A1/E75', 'Sortie Belgrade'],
                avoid: ['Belgrade centre', 'Kosovo (situation complexe)'],
                phrases: { hello: 'Zdravo', thanks: 'Hvala', where: 'Gde idete?', hitchhike: 'Stopam' }
            },
            { 
                code: 'BA', flag: 'üáßüá¶', name: 'Bosnie', continent: 'europe-east',
                legal: '‚úÖ', difficulty: '‚≠ê‚≠ê‚≠ê', avgWait: 30, safety: 4.0, emergency: '112',
                tips: { 
                    fr: 'Les Bosniaques sont incroyablement accueillants ! Caf√© offert presque √† chaque trajet. Routes de montagne sinueuses. Sarajevo et Mostar sont magnifiques.', 
                    en: 'Bosnians are incredibly welcoming! Coffee offered on almost every ride. Winding mountain roads. Sarajevo and Mostar are beautiful.',
                    es: 'Los bosnios son incre√≠blemente acogedores. Caf√© ofrecido en casi cada viaje. Carreteras de monta√±a sinuosas.'
                },
                bestSpots: ['Stations INA/Nestro', 'M17', 'Sortie Sarajevo'],
                avoid: ['Routes secondaires la nuit', 'Zones rurales recul√©es'],
                phrases: { hello: 'Zdravo', thanks: 'Hvala', where: 'Gdje idete?', hitchhike: 'Stopam' }
            },
            { 
                code: 'ME', flag: 'üá≤üá™', name: 'Mont√©n√©gro', continent: 'europe-east',
                legal: '‚úÖ', difficulty: '‚≠ê‚≠ê', avgWait: 25, safety: 4.3, emergency: '112',
                tips: { 
                    fr: 'Petit pays c√¥tier magnifique. Les Mont√©n√©grins sont accueillants. La c√¥te est touristique en √©t√©. Routes de montagne spectaculaires mais √©troites.', 
                    en: 'Beautiful small coastal country. Montenegrins are welcoming. Coast is touristy in summer. Spectacular but narrow mountain roads.',
                    es: 'Peque√±o pa√≠s costero hermoso. Los montenegrinos son acogedores. La costa es tur√≠stica en verano.'
                },
                bestSpots: ['Stations Jugopetrol', 'E80/E65', 'Sortie Podgorica'],
                avoid: ['Routes de montagne la nuit', 'Kotor en plein √©t√© (bond√©)'],
                phrases: { hello: 'Zdravo', thanks: 'Hvala', where: 'Gdje idete?', hitchhike: 'Stopam' }
            },
            { 
                code: 'MK', flag: 'üá≤üá∞', name: 'Mac√©doine du Nord', continent: 'europe-east',
                legal: '‚úÖ', difficulty: '‚≠ê‚≠ê', avgWait: 25, safety: 4.1, emergency: '112',
                tips: { 
                    fr: 'Les Mac√©doniens sont tr√®s hospitaliers ! Skopje est une ville fascinante. Peu de trafic mais les gens s\'arr√™tent facilement.', 
                    en: 'Macedonians are very hospitable! Skopje is a fascinating city. Little traffic but people stop easily.',
                    es: 'Los macedonios son muy hospitalarios. Skopje es fascinante. Poco tr√°fico pero la gente para f√°cilmente.'
                },
                bestSpots: ['Stations Makpetrol', 'E75', 'Sortie Skopje'],
                avoid: ['Fronti√®re Kosovo', 'Routes secondaires isol√©es'],
                phrases: { hello: 'Zdravo', thanks: 'Blagodaram', where: 'Kade odite?', hitchhike: 'Stopam' }
            },
            { 
                code: 'AL', flag: 'üá¶üá±', name: 'Albanie', continent: 'europe-east',
                legal: '‚úÖ', difficulty: '‚≠ê‚≠ê‚≠ê', avgWait: 28, safety: 3.9, emergency: '112',
                tips: { 
                    fr: 'Les Albanais sont incroyablement accueillants avec les √©trangers ! Infrastructure routi√®re en am√©lioration rapide. Conduite parfois chaotique. Plages magnifiques au sud.', 
                    en: 'Albanians are incredibly welcoming to foreigners! Road infrastructure improving fast. Driving sometimes chaotic. Beautiful beaches in the south.',
                    es: 'Los albaneses son incre√≠blemente acogedores. Infraestructura vial mejorando. Conducci√≥n a veces ca√≥tica.'
                },
                bestSpots: ['Stations Kastrati', 'SH4/SH8', 'Sortie Tirana'],
                avoid: ['Tirana centre', 'Routes de montagne la nuit'],
                phrases: { hello: 'P√´rsh√´ndetje', thanks: 'Faleminderit', where: 'Ku po shkoni?', hitchhike: 'B√´j autostop' }
            },
            { 
                code: 'UA', flag: 'üá∫üá¶', name: 'Ukraine', continent: 'europe-east',
                legal: '‚ö†Ô∏è', difficulty: '‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê', avgWait: 0, safety: 1.0, emergency: '112',
                tips: { 
                    fr: '‚ö†Ô∏è CONFLIT EN COURS - VOYAGE D√âCONSEILL√â. Avant 2022 : Ukrainiens super accueillants, trajets longs, routes difficiles. V√©rifier la situation avant tout voyage.', 
                    en: '‚ö†Ô∏è ONGOING CONFLICT - TRAVEL NOT RECOMMENDED. Before 2022: Ukrainians super welcoming, long trips, difficult roads. Check situation before any travel.',
                    es: '‚ö†Ô∏è CONFLICTO EN CURSO - VIAJE NO RECOMENDADO. Verificar la situaci√≥n antes de viajar.'
                },
                bestSpots: ['Non recommand√© actuellement'],
                avoid: ['Tout le pays actuellement'],
                phrases: { hello: '–ü—Ä–∏–≤—ñ—Ç (Pryvit)', thanks: '–î—è–∫—É—é (Dyakuyu)', where: '–ö—É–¥–∏ –≤–∏ —ó–¥–µ—Ç–µ?', hitchhike: '–ê–≤—Ç–æ—Å—Ç–æ–ø' }
            },
            { 
                code: 'MD', flag: 'üá≤üá©', name: 'Moldavie', continent: 'europe-east',
                legal: '‚úÖ', difficulty: '‚≠ê‚≠ê‚≠ê', avgWait: 30, safety: 3.8, emergency: '112',
                tips: { 
                    fr: 'Les Moldaves sont accueillants. Beaucoup parlent russe ou roumain. Pays pauvre mais g√©n√©reux. √âviter la Transnistrie (r√©gion s√©paratiste).', 
                    en: 'Moldovans are welcoming. Many speak Russian or Romanian. Poor but generous country. Avoid Transnistria (separatist region).',
                    es: 'Los moldavos son acogedores. Muchos hablan ruso o rumano. Pa√≠s pobre pero generoso.'
                },
                bestSpots: ['Stations Lukoil', 'E584', 'Sortie Chi»ôinƒÉu'],
                avoid: ['Transnistrie', 'Nuit'],
                phrases: { hello: 'BunƒÉ', thanks: 'Mul»õumesc', where: 'Unde merge»õi?', hitchhike: 'Fac autostopul' }
            },
            { 
                code: 'BY', flag: 'üáßüáæ', name: 'Bi√©lorussie', continent: 'europe-east',
                legal: '‚ö†Ô∏è', difficulty: '‚≠ê‚≠ê‚≠ê‚≠ê', avgWait: 0, safety: 2.5, emergency: '112',
                tips: { 
                    fr: '‚ö†Ô∏è SITUATION POLITIQUE TENDUE. Visa obligatoire pour beaucoup. Contr√¥les fr√©quents. Bi√©lorusses gentils mais r√©gime autoritaire. D√©conseill√© actuellement.', 
                    en: '‚ö†Ô∏è TENSE POLITICAL SITUATION. Visa required for many. Frequent checks. Belarusians kind but authoritarian regime. Not recommended currently.',
                    es: '‚ö†Ô∏è SITUACI√ìN POL√çTICA TENSA. Visa obligatorio. Controles frecuentes. No recomendado actualmente.'
                },
                bestSpots: ['Non recommand√© actuellement'],
                avoid: ['Tout le pays actuellement'],
                phrases: { hello: '–ü—Ä—ã–≤—ñ—Ç–∞–Ω–Ω–µ', thanks: '–î–∑—è–∫—É–π', where: '–ö—É–¥—ã –≤—ã –µ–¥–∑–µ—Ü–µ?', hitchhike: '–ê—û—Ç–∞—Å—Ç–æ–ø' }
            },
            { 
                code: 'LT', flag: 'üá±üáπ', name: 'Lituanie', continent: 'europe-east',
                legal: '‚úÖ', difficulty: '‚≠ê‚≠ê', avgWait: 22, safety: 4.5, emergency: '112',
                tips: { 
                    fr: 'Les Lituaniens sont r√©serv√©s mais sympathiques. Beaucoup parlent anglais, surtout les jeunes. Vilnius est magnifique. Bon hub vers la Pologne.', 
                    en: 'Lithuanians are reserved but friendly. Many speak English, especially young people. Vilnius is beautiful. Good hub to Poland.',
                    es: 'Los lituanos son reservados pero amables. Muchos hablan ingl√©s. Vilnius es hermosa.'
                },
                bestSpots: ['Stations Circle K', 'A1/A2', 'Sortie Vilnius'],
                avoid: ['Vilnius centre', 'Fronti√®re russe'],
                phrases: { hello: 'Labas', thanks: 'Aƒçi≈´', where: 'Kur va≈æiuojate?', hitchhike: 'Keliauju autostopu' }
            },
            { 
                code: 'LV', flag: 'üá±üáª', name: 'Lettonie', continent: 'europe-east',
                legal: '‚úÖ', difficulty: '‚≠ê‚≠ê', avgWait: 24, safety: 4.4, emergency: '112',
                tips: { 
                    fr: 'Les Lettons sont r√©serv√©s mais polis. Riga est une ville superbe. Beaucoup parlent russe aussi. Bon hub entre Lituanie et Estonie.', 
                    en: 'Latvians are reserved but polite. Riga is a superb city. Many also speak Russian. Good hub between Lithuania and Estonia.',
                    es: 'Los letones son reservados pero educados. Riga es una ciudad magn√≠fica.'
                },
                bestSpots: ['Stations Circle K/Viada', 'A1/A2', 'Sortie Riga'],
                avoid: ['Riga centre', 'Fronti√®re russe'],
                phrases: { hello: 'Sveiki', thanks: 'Paldies', where: 'Kurp j≈´s braucat?', hitchhike: 'Es stopƒìju' }
            },
            { 
                code: 'EE', flag: 'üá™üá™', name: 'Estonie', continent: 'europe-east',
                legal: '‚úÖ', difficulty: '‚≠ê‚≠ê', avgWait: 25, safety: 4.6, emergency: '112',
                tips: { 
                    fr: 'Les Estoniens sont tr√®s r√©serv√©s (comme les Finlandais). Tallinn est magnifique. Pays tr√®s digital et moderne. Ferry facile vers Helsinki.', 
                    en: 'Estonians are very reserved (like Finns). Tallinn is beautiful. Very digital and modern country. Easy ferry to Helsinki.',
                    es: 'Los estonios son muy reservados. Tallin es hermosa. Pa√≠s muy digital y moderno.'
                },
                bestSpots: ['Stations Circle K/Olerex', 'E20/E67', 'Sortie Tallinn'],
                avoid: ['Tallinn centre', 'Fronti√®re russe'],
                phrases: { hello: 'Tere', thanks: 'Ait√§h', where: 'Kuhu te l√§hete?', hitchhike: 'Ma h√§√§letatan' }
            },
            // ==================== TURQUIE ====================
            { 
                code: 'TR', flag: 'üáπüá∑', name: 'Turquie', continent: 'asia',
                legal: '‚úÖ', difficulty: '‚≠ê‚≠ê', avgWait: 20, safety: 4.2, emergency: '112',
                tips: { 
                    fr: 'Les Turcs sont INCROYABLEMENT hospitaliers ! Th√© offert √† chaque trajet. Camionneurs super sympas. La c√¥te √©g√©enne et m√©diterran√©enne sont faciles. Est plus difficile.', 
                    en: 'Turks are INCREDIBLY hospitable! Tea offered on every ride. Truck drivers super friendly. Aegean and Mediterranean coasts are easy. East is harder.',
                    es: 'Los turcos son INCRE√çBLEMENTE hospitalarios. T√© ofrecido en cada viaje. Camioneros muy amables.'
                },
                bestSpots: ['Stations Petrol Ofisi/Shell', 'D100/E80', 'Sortie Istanbul'],
                avoid: ['Istanbul centre', 'Fronti√®res Syrie/Irak', 'Est (r√©gions kurdes)'],
                phrases: { hello: 'Merhaba', thanks: 'Te≈üekk√ºrler', where: 'Nereye gidiyorsunuz?', hitchhike: 'Otostop yapƒ±yorum' }
            },
            // ==================== MAROC ====================
            { 
                code: 'MA', flag: 'üá≤üá¶', name: 'Maroc', continent: 'africa',
                legal: '‚úÖ', difficulty: '‚≠ê‚≠ê', avgWait: 20, safety: 4.0, emergency: '15/19',
                tips: { 
                    fr: 'Les Marocains sont tr√®s accueillants ! L\'autostop est courant localement. N√©gocier le prix avant si c\'est un taxi d√©guis√©. Le fran√ßais est largement parl√©. Attention √† la chaleur l\'√©t√©.', 
                    en: 'Moroccans are very welcoming! Hitchhiking is common locally. Negotiate price before if it\'s a disguised taxi. French is widely spoken. Watch out for summer heat.',
                    es: 'Los marroqu√≠es son muy acogedores. El autostop es com√∫n localmente. El franc√©s se habla mucho.'
                },
                bestSpots: ['Stations Afriquia/Shell', 'Routes nationales', 'Sortie villes'],
                avoid: ['M√©dinas (vieilles villes)', 'Routes d√©sert seul', 'Nuit zones isol√©es'],
                phrases: { hello: 'Salam', thanks: 'Choukran', where: 'Fin ghadi?', hitchhike: 'Stop' }
            },
            // ==================== ASIE CENTRALE (bonus) ====================
            { 
                code: 'GE', flag: 'üá¨üá™', name: 'G√©orgie', continent: 'asia',
                legal: '‚úÖ', difficulty: '‚≠ê', avgWait: 15, safety: 4.3, emergency: '112',
                tips: { 
                    fr: 'PARADIS de l\'autostop ! Les G√©orgiens sont parmi les plus accueillants au monde. Vin et nourriture offerts constamment. Marshrutkas (minibus) comme alternative.', 
                    en: 'Hitchhiking PARADISE! Georgians are among the most welcoming in the world. Wine and food constantly offered. Marshrutkas (minibuses) as alternative.',
                    es: 'PARA√çSO del autostop. Los georgianos son de los m√°s acogedores del mundo. Vino y comida ofrecidos constantemente.'
                },
                bestSpots: ['N\'importe o√π sur les routes principales', 'Sortie Tbilisi', 'Route militaire'],
                avoid: ['Abkhazie/Oss√©tie du Sud (conflits gel√©s)'],
                phrases: { hello: 'Gamarjoba', thanks: 'Madloba', where: 'Sad midikhart º?', hitchhike: 'Avtostopi' }
            }
        ];

        // Groupement par continent
        const continents = {
            'europe-west': { name: { fr: 'Europe Occidentale', en: 'Western Europe', es: 'Europa Occidental' }, icon: 'üè∞' },
            'europe-north': { name: { fr: 'Europe du Nord', en: 'Northern Europe', es: 'Europa del Norte' }, icon: '‚ùÑÔ∏è' },
            'europe-south': { name: { fr: 'Europe du Sud', en: 'Southern Europe', es: 'Europa del Sur' }, icon: '‚òÄÔ∏è' },
            'europe-east': { name: { fr: 'Europe de l\'Est', en: 'Eastern Europe', es: 'Europa del Este' }, icon: 'üèõÔ∏è' },
            'asia': { name: { fr: 'Asie', en: 'Asia', es: 'Asia' }, icon: 'üïå' },
            'africa': { name: { fr: 'Afrique', en: 'Africa', es: '√Åfrica' }, icon: 'üåç' }
        };

        const safetyTips = {
            fr: [
                { icon: 'üìç', title: 'Partage ta position', desc: 'Envoie ta localisation √† un proche' },
                { icon: 'üåÖ', title: 'Voyage de jour', desc: '√âvite la nuit, surtout seul(e)' },
                { icon: 'üéí', title: 'Voyage l√©ger', desc: 'Sac visible = confiance' },
                { icon: 'üòä', title: 'Contact visuel', desc: 'Souris aux conducteurs' },
                { icon: 'üöó', title: 'Fais confiance √† ton instinct', desc: 'Tu peux refuser' },
                { icon: 'üì±', title: 'Batterie charg√©e', desc: 'T√©l√©phone toujours charg√©' }
            ],
            en: [
                { icon: 'üìç', title: 'Share location', desc: 'Send location to someone' },
                { icon: 'üåÖ', title: 'Travel by day', desc: 'Avoid night, especially alone' },
                { icon: 'üéí', title: 'Travel light', desc: 'Visible bag = trust' },
                { icon: 'üòä', title: 'Eye contact', desc: 'Smile at drivers' },
                { icon: 'üöó', title: 'Trust your gut', desc: 'You can refuse' },
                { icon: 'üì±', title: 'Charged phone', desc: 'Always charged' }
            ],
            es: [
                { icon: 'üìç', title: 'Comparte ubicaci√≥n', desc: 'Env√≠a tu ubicaci√≥n a alguien' },
                { icon: 'üåÖ', title: 'Viaja de d√≠a', desc: 'Evita la noche, especialmente solo/a' },
                { icon: 'üéí', title: 'Viaja ligero', desc: 'Mochila visible = confianza' },
                { icon: 'üòä', title: 'Contacto visual', desc: 'Sonr√≠e a los conductores' },
                { icon: 'üöó', title: 'Conf√≠a en tu instinto', desc: 'Puedes rechazar' },
                { icon: 'üì±', title: 'Bater√≠a cargada', desc: 'Tel√©fono siempre cargado' }
            ]
        };

        // Badges disponibles
        const allBadges = [
            { id: 'first_spot', icon: 'üìç', name: 'badgeFirstSpot', condition: (u) => u.spotsShared >= 1, reward: 50 },
            { id: 'explorer', icon: 'üó∫Ô∏è', name: 'badgeExplorer', condition: (u) => u.spotsShared >= 5, reward: 100 },
            { id: '10_checkins', icon: 'üì∏', name: 'badge10Checkins', condition: (u) => u.checkinsCount >= 10, reward: 150 },
            { id: 'reviewer', icon: '‚≠ê', name: 'badgeReviewer', condition: (u) => u.reviewsGiven >= 10, reward: 100 },
            { id: 'helper', icon: 'ü§ù', name: 'badgeHelper', condition: (u) => u.helpGiven >= 5, reward: 200 },
            { id: 'quiz_master', icon: 'üß†', name: 'badgeQuizMaster', condition: (u) => u.quizWins >= 5, reward: 150 },
            { id: 'week_streak', icon: 'üî•', name: 'badgeWeekStreak', condition: (u) => u.streak >= 7, reward: 250 },
            { id: 'traveler', icon: '‚úàÔ∏è', name: 'badgeTraveler', condition: (u) => u.tripsCompleted >= 5, reward: 300 },
            { id: 'legend', icon: 'üëë', name: 'badgeLegend', condition: (u) => u.score >= 5000, reward: 500 }
        ];

        // D√©fis
        const allChallenges = [
            { id: 'daily_checkin', type: 'daily', icon: 'üì∏', target: 1, reward: 20, desc: { fr: 'Fais 1 check-in aujourd\'hui', en: 'Do 1 check-in today' } },
            { id: 'daily_review', type: 'daily', icon: '‚≠ê', target: 1, reward: 15, desc: { fr: '√âvalue 1 spot', en: 'Rate 1 spot' } },
            { id: 'weekly_spots', type: 'weekly', icon: 'üìç', target: 3, reward: 100, desc: { fr: 'Partage 3 spots cette semaine', en: 'Share 3 spots this week' } },
            { id: 'weekly_checkins', type: 'weekly', icon: 'üì∏', target: 5, reward: 150, desc: { fr: 'Fais 5 check-ins cette semaine', en: 'Do 5 check-ins this week' } },
            { id: 'weekly_quiz', type: 'weekly', icon: 'üß†', target: 3, reward: 75, desc: { fr: 'Joue 3 quiz cette semaine', en: 'Play 3 quizzes this week' } }
        ];

        // Commentaires exemple
        const sampleComments = [
            { spotId: 1, id: 1, user: 'Tom_Roadtrip', avatar: 'üßî', text: 'Spot classique ! Un peu long mais √ßa marche.', date: '2024-12-14', likes: 5 },
            { spotId: 3, id: 2, user: 'Sophie_Nomad', avatar: 'üë±‚Äç‚ôÄÔ∏è', text: 'Aire de Nemours = le meilleur spot pour quitter Paris vers le sud !', date: '2024-12-13', likes: 12 },
            { spotId: 8, id: 3, user: 'Marie_Adventure', avatar: 'üë©‚Äçü¶∞', text: 'P√©age de La Gravelle, j\'ai attendu 1 minute ! Record battu.', date: '2024-12-12', likes: 18 },
            { spotId: 26, id: 4, user: 'Hans_Hitch', avatar: 'üßî', text: 'Les Pays-Bas c\'est le paradis du stop. 10 min max.', date: '2024-12-11', likes: 9 },
            { spotId: 39, id: 5, user: 'Irish_Traveler', avatar: 'üßë‚Äçüé§', text: 'L\'Irlande est incroyable pour le stop. Tout le monde s\'arr√™te !', date: '2024-12-10', likes: 15 },
            { spotId: 21, id: 6, user: 'Alpine_Hiker', avatar: 'üë±‚Äç‚ôÄÔ∏è', text: 'Munich-Salzburg tr√®s facile. Station propre avec bon caf√©.', date: '2024-12-09', likes: 7 }
        ];

        // Messages priv√©s exemple
        const samplePrivateMessages = [
            { id: 1, from: 'Marie_Adventure', fromAvatar: 'üë©‚Äçü¶∞', text: 'Salut ! Tu vas vers Lyon demain ?', date: '14:30', read: false },
            { id: 2, from: 'Tom_Roadtrip', fromAvatar: 'üßî', text: 'Merci pour le conseil sur le spot !', date: '10:15', read: true }
        ];

        // M√©t√©o simul√©e
        const getWeatherForSpot = (spotId) => {
            const conditions = ['sunny', 'sunny', 'cloudy', 'sunny', 'rainy'];
            const temps = [18, 22, 15, 20, 12];
            const icons = { sunny: '‚òÄÔ∏è', cloudy: '‚òÅÔ∏è', rainy: 'üåßÔ∏è' };
            const idx = (spotId - 1) % 5;
            return { condition: conditions[idx], temp: temps[idx], icon: icons[conditions[idx]] };
        };

        // Niveaux VIP
        const vipLevels = [
            { id: 'bronze', name: 'bronze', icon: 'ü•â', minPoints: 0, discount: 0, color: 'from-amber-700 to-amber-600' },
            { id: 'silver', name: 'silver', icon: 'ü•à', minPoints: 500, discount: 10, color: 'from-slate-400 to-slate-300' },
            { id: 'gold', name: 'gold', icon: 'ü•á', minPoints: 2000, discount: 15, color: 'from-yellow-500 to-amber-400' },
            { id: 'diamond', name: 'diamond', icon: 'üíé', minPoints: 5000, discount: 25, color: 'from-sky-400 to-purple-500' }
        ];

        // R√©compenses partenaires (sans stations essence)
        const shopRewards = [
            // Transport
            { id: 1, category: 'transport', partner: 'BlaBlaCar', logo: 'üöó', title: { fr: '-5‚Ç¨ sur ton trajet', en: '-5‚Ç¨ on your trip' }, cost: 200, code: 'SPOT5BLA', vipOnly: false },
            { id: 2, category: 'transport', partner: 'FlixBus', logo: 'üöå', title: { fr: '-15% sur ton billet', en: '-15% on your ticket' }, cost: 350, code: 'FLIXSPOT15', vipOnly: false },
            { id: 3, category: 'transport', partner: 'Omio', logo: 'üöÜ', title: { fr: '-10‚Ç¨ sur ta r√©servation', en: '-10‚Ç¨ on booking' }, cost: 500, code: 'OMIO10SPOT', vipOnly: false },
            { id: 4, category: 'transport', partner: 'Trainline', logo: 'üöÑ', title: { fr: '-20% sur ton train', en: '-20% on your train' }, cost: 800, code: 'TRAIN20SP', vipOnly: true },
            
            // H√©bergement
            { id: 5, category: 'housing', partner: 'Hostelworld', logo: 'üõèÔ∏è', title: { fr: '-10% sur ton hostel', en: '-10% on your hostel' }, cost: 400, code: 'HOSTEL10', vipOnly: false },
            { id: 6, category: 'housing', partner: 'Booking.com', logo: 'üè®', title: { fr: '-15‚Ç¨ sur ta r√©servation', en: '-15‚Ç¨ on booking' }, cost: 700, code: 'BOOK15SPOT', vipOnly: false },
            { id: 7, category: 'housing', partner: 'Airbnb', logo: 'üè†', title: { fr: '-25‚Ç¨ premi√®re r√©sa', en: '-25‚Ç¨ first booking' }, cost: 1000, code: 'AIRSPOT25', vipOnly: true },
            
            // Nourriture
            { id: 8, category: 'food', partner: 'Starbucks', logo: '‚òï', title: { fr: 'Caf√© offert', en: 'Free coffee' }, cost: 100, code: 'STARCAFE', vipOnly: false },
            { id: 9, category: 'food', partner: 'Subway', logo: 'ü•™', title: { fr: 'Menu -20%', en: 'Menu -20%' }, cost: 150, code: 'SUB20SPOT', vipOnly: false },
            { id: 10, category: 'food', partner: 'McDonald\'s', logo: 'üçî', title: { fr: 'McMenu offert', en: 'Free McMenu' }, cost: 250, code: 'MCSPOT', vipOnly: false },
            
            // √âquipement
            { id: 11, category: 'gear', partner: 'Decathlon', logo: 'üéí', title: { fr: '-15% √©quipement', en: '-15% on gear' }, cost: 600, code: 'DECA15SPOT', vipOnly: false },
            { id: 12, category: 'gear', partner: 'Amazon', logo: 'üì¶', title: { fr: '-10‚Ç¨ voyage', en: '-10‚Ç¨ travel' }, cost: 450, code: 'AMZSPOT10', vipOnly: false },
            
            // Assurance
            { id: 13, category: 'insurance', partner: 'Chapka', logo: 'üõ°Ô∏è', title: { fr: '-20% assurance', en: '-20% insurance' }, cost: 500, code: 'CHAPKA20', vipOnly: false },
            { id: 14, category: 'insurance', partner: 'WorldNomads', logo: 'üåç', title: { fr: '-15% couverture', en: '-15% coverage' }, cost: 550, code: 'NOMAD15', vipOnly: false },
            
            // Apps & Services
            { id: 15, category: 'apps', partner: 'Spotify', logo: 'üéµ', title: { fr: '1 mois Premium', en: '1 month Premium' }, cost: 300, code: 'SPOTIFYSPOT', vipOnly: false },
            { id: 16, category: 'apps', partner: 'Maps.me', logo: 'üó∫Ô∏è', title: { fr: 'Pro 3 mois', en: '3 months Pro' }, cost: 200, code: 'MAPSPRO3', vipOnly: false },
            
            // VIP exclusives
            { id: 17, category: 'vip', partner: 'SpotHitch', logo: '‚≠ê', title: { fr: 'Double points 7j', en: 'Double points 7d' }, cost: 1500, code: 'DOUBLE7', vipOnly: true },
            { id: 18, category: 'vip', partner: 'Interrail', logo: 'üöÇ', title: { fr: '-50‚Ç¨ ton pass', en: '-50‚Ç¨ your pass' }, cost: 2500, code: 'RAIL50VIP', vipOnly: true }
        ];

        // Cat√©gories de r√©compenses
        const rewardCategories = [
            { id: 'all', icon: 'üéÅ', name: { fr: 'Tout', en: 'All' } },
            { id: 'transport', icon: 'üöå', name: { fr: 'Transport', en: 'Transport' } },
            { id: 'housing', icon: 'üõèÔ∏è', name: { fr: 'H√©bergement', en: 'Housing' } },
            { id: 'food', icon: 'üçî', name: { fr: 'Nourriture', en: 'Food' } },
            { id: 'gear', icon: 'üéí', name: { fr: '√âquipement', en: 'Gear' } },
            { id: 'insurance', icon: 'üõ°Ô∏è', name: { fr: 'Assurance', en: 'Insurance' } },
            { id: 'apps', icon: 'üì±', name: { fr: 'Apps', en: 'Apps' } }
        ];

        // ==================== QUIZ DATA ====================
        const quizQuestions = {
            capitals: [
                { q: { fr: 'Quelle est la capitale de la Slov√©nie ?', en: 'What is the capital of Slovenia?' }, options: ['Zagreb', 'Ljubljana', 'Bratislava', 'Sarajevo'], correct: 1 },
                { q: { fr: 'Quelle est la capitale de la Norv√®ge ?', en: 'What is the capital of Norway?' }, options: ['Stockholm', 'Helsinki', 'Oslo', 'Copenhagen'], correct: 2 },
                { q: { fr: 'Quelle est la capitale du Portugal ?', en: 'What is the capital of Portugal?' }, options: ['Madrid', 'Lisbonne', 'Porto', 'S√©ville'], correct: 1 },
                { q: { fr: 'Quelle est la capitale de la Roumanie ?', en: 'What is the capital of Romania?' }, options: ['Budapest', 'Sofia', 'Belgrade', 'Bucarest'], correct: 3 },
                { q: { fr: 'Quelle est la capitale de l\'Irlande ?', en: 'What is the capital of Ireland?' }, options: ['Belfast', 'Dublin', 'Cork', 'Galway'], correct: 1 }
            ],
            flags: [
                { q: { fr: 'üáµüá± Quel pays ?', en: 'üáµüá± Which country?' }, options: ['Pologne', 'Indon√©sie', 'Monaco', 'Singapour'], correct: 0 },
                { q: { fr: 'üá≠üá∫ Quel pays ?', en: 'üá≠üá∫ Which country?' }, options: ['Bulgarie', 'Hongrie', 'Italie', 'Irlande'], correct: 1 },
                { q: { fr: 'üá®üáø Quel pays ?', en: 'üá®üáø Which country?' }, options: ['Slovaquie', 'Slov√©nie', 'Tch√©quie', 'Croatie'], correct: 2 },
                { q: { fr: 'üáßüá™ Quel pays ?', en: 'üáßüá™ Which country?' }, options: ['Allemagne', 'Belgique', 'Roumanie', 'Tchad'], correct: 1 },
                { q: { fr: 'üá¶üáπ Quel pays ?', en: 'üá¶üáπ Which country?' }, options: ['Suisse', 'Pologne', 'Autriche', 'Lettonie'], correct: 2 }
            ],
            geography: [
                { q: { fr: 'Le Danube traverse combien de pays ?', en: 'How many countries does the Danube flow through?' }, options: ['6', '8', '10', '12'], correct: 2 },
                { q: { fr: 'Quel est le plus long fleuve d\'Europe ?', en: 'What is the longest river in Europe?' }, options: ['Danube', 'Rhin', 'Volga', 'Loire'], correct: 2 },
                { q: { fr: 'Combien de pays dans l\'UE (2024) ?', en: 'How many EU countries (2024)?' }, options: ['25', '27', '28', '30'], correct: 1 },
                { q: { fr: 'Quel pays a le plus de fronti√®res en Europe ?', en: 'Which country has the most borders in Europe?' }, options: ['France', 'Allemagne', 'Russie', 'Autriche'], correct: 2 },
                { q: { fr: 'Quelle mer borde la Croatie ?', en: 'Which sea borders Croatia?' }, options: ['Mer Noire', 'Mer Baltique', 'Mer Adriatique', 'Mer du Nord'], correct: 2 }
            ],
            culture: [
                { q: { fr: 'Le pierogi est un plat de quel pays ?', en: 'Pierogi is a dish from which country?' }, options: ['Russie', 'Pologne', 'Ukraine', 'Tch√©quie'], correct: 1 },
                { q: { fr: 'La paella vient de quelle r√©gion ?', en: 'Paella comes from which region?' }, options: ['Catalogne', 'Andalousie', 'Valence', 'Madrid'], correct: 2 },
                { q: { fr: 'Le fado est une musique de quel pays ?', en: 'Fado is music from which country?' }, options: ['Espagne', 'Br√©sil', 'Portugal', 'Italie'], correct: 2 },
                { q: { fr: 'Oktoberfest se d√©roule dans quelle ville ?', en: 'Oktoberfest takes place in which city?' }, options: ['Berlin', 'Munich', 'Vienne', 'Zurich'], correct: 1 },
                { q: { fr: 'Le carnaval de Venise a lieu en quel mois ?', en: 'Venice Carnival takes place in which month?' }, options: ['Janvier', 'F√©vrier', 'Mars', 'Avril'], correct: 1 }
            ],
            hitchhiking: [
                { q: { fr: 'Dans quel pays l\'autostop est le plus facile ?', en: 'In which country is hitchhiking easiest?' }, options: ['France', 'Pays-Bas', 'Espagne', 'Italie'], correct: 1 },
                { q: { fr: 'O√π l\'autostop sur autoroute est interdit ?', en: 'Where is hitchhiking on highways forbidden?' }, options: ['Allemagne', 'France', 'Tous les pays', 'Aucun'], correct: 2 },
                { q: { fr: 'Meilleur endroit pour faire du stop ?', en: 'Best place to hitchhike?' }, options: ['Centre ville', 'Station essence', 'Gare', 'A√©roport'], correct: 1 },
                { q: { fr: 'Quelle app est connue pour le stop ?', en: 'Which app is known for hitchhiking?' }, options: ['BlaBlaCar', 'Hitchwiki', 'Uber', 'Maps'], correct: 1 },
                { q: { fr: 'Conseil n¬∞1 pour l\'autostop ?', en: 'Tip #1 for hitchhiking?' }, options: ['Voyager la nuit', 'Sourire', 'Gros sac', 'Panneau illisible'], correct: 1 }
            ]
        };

        const quizLeaderboard = Storage.get('quizLeaderboard') || [
            { username: 'Marie_Adventure', avatar: 'üë©‚Äçü¶∞', score: 450, date: '2024-12-14' },
            { username: 'Tom_Roadtrip', avatar: 'üßî', score: 380, date: '2024-12-13' },
            { username: 'Sophie_Nomad', avatar: 'üë±‚Äç‚ôÄÔ∏è', score: 320, date: '2024-12-12' }
        ];

        // ==================== FIREBASE CONFIG ====================
        // ‚ö†Ô∏è REMPLACE CES VALEURS PAR TES PROPRES CL√âS FIREBASE
        // Cr√©e un projet sur https://console.firebase.google.com
        const firebaseConfig = {
            apiKey: "AIzaSyAQ7-VOm2mgqINlp8HOcOt7TWpioy06E5c",
            authDomain: "spothitch.firebaseapp.com",
            projectId: "spothitch",
            storageBucket: "spothitch.firebasestorage.app",
            messagingSenderId: "314974309234",
            appId: "1:314974309234:web:88a3bf8a027e353c3b6beb",
            measurementId: "G-D39NTD0X33"
        };
        
        // Initialiser Firebase (seulement si configur√©)
        let firebaseApp = null;
        let firebaseAuth = null;
        let firebaseDb = null;
        let firebaseStorage = null;
        
        const isFirebaseConfigured = firebaseConfig.apiKey !== "YOUR_API_KEY";
        
        if (isFirebaseConfigured && typeof firebase !== 'undefined') {
            try {
                firebaseApp = firebase.initializeApp(firebaseConfig);
                firebaseAuth = firebase.auth();
                firebaseDb = firebase.firestore();
                firebaseStorage = firebase.storage();
                console.log('‚úÖ Firebase initialis√©');
            } catch (e) {
                console.warn('‚ö†Ô∏è Erreur Firebase:', e);
            }
        } else {
            console.log('‚ÑπÔ∏è Firebase non configur√© - Mode d√©mo');
        }
        
        // ==================== FIREBASE SYNC ====================
        
        // Charger les spots depuis Firebase
        async function loadSpotsFromFirebase() {
            if (!firebaseDb) return;
            try {
                const snapshot = await firebaseDb.collection('spots').orderBy('createdAt', 'desc').get();
                const firebaseSpots = [];
                snapshot.forEach(doc => {
                    firebaseSpots.push({ id: doc.id, ...doc.data() });
                });
                if (firebaseSpots.length > 0) {
                    state.spots = firebaseSpots;
                    console.log(`‚úÖ ${firebaseSpots.length} spots charg√©s depuis Firebase`);
                }
            } catch (e) {
                console.warn('‚ö†Ô∏è Erreur chargement spots:', e);
            }
        }
        
        // Sauvegarder un spot dans Firebase
        async function saveSpotToFirebase(spot) {
            if (!firebaseDb) return spot;
            try {
                // Si le spot a un ID num√©rique (local), cr√©er un nouveau doc
                if (typeof spot.id === 'number') {
                    const docRef = await firebaseDb.collection('spots').add({
                        ...spot,
                        id: null, // sera remplac√© par l'ID Firebase
                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    spot.id = docRef.id;
                    await docRef.update({ id: docRef.id });
                } else {
                    // Mettre √† jour un spot existant
                    await firebaseDb.collection('spots').doc(spot.id).set(spot, { merge: true });
                }
                console.log('‚úÖ Spot sauvegard√©:', spot.id);
                return spot;
            } catch (e) {
                console.warn('‚ö†Ô∏è Erreur sauvegarde spot:', e);
                return spot;
            }
        }
        
        // Upload photo vers Firebase Storage
        async function uploadPhotoToFirebase(dataUrl, spotId) {
            if (!firebaseStorage) return dataUrl;
            try {
                // Convertir data URL en blob
                const response = await fetch(dataUrl);
                const blob = await response.blob();
                
                // Upload vers Storage
                const ref = firebaseStorage.ref().child(`spots/${spotId}_${Date.now()}.jpg`);
                await ref.put(blob);
                
                // R√©cup√©rer l'URL publique
                const url = await ref.getDownloadURL();
                console.log('‚úÖ Photo upload√©e:', url);
                return url;
            } catch (e) {
                console.warn('‚ö†Ô∏è Erreur upload photo:', e);
                return dataUrl; // Fallback: garder le data URL
            }
        }
        
        // Sauvegarder validation dans Firebase
        async function saveValidationToFirebase(spotId, userId) {
            if (!firebaseDb) return;
            try {
                await firebaseDb.collection('validations').add({
                    spotId: spotId,
                    userId: userId,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                // Mettre √† jour le compteur sur le spot
                const spotRef = firebaseDb.collection('spots').doc(String(spotId));
                await spotRef.update({
                    validationCount: firebase.firestore.FieldValue.increment(1)
                });
            } catch (e) {
                console.warn('‚ö†Ô∏è Erreur sauvegarde validation:', e);
            }
        }
        
        // Sauvegarder commentaire dans Firebase
        async function saveCommentToFirebase(comment) {
            if (!firebaseDb) return;
            try {
                await firebaseDb.collection('comments').add({
                    ...comment,
                    createdAt: firebase.firestore.FieldValue.serverTimestamp()
                });
            } catch (e) {
                console.warn('‚ö†Ô∏è Erreur sauvegarde commentaire:', e);
            }
        }
        
        // Charger au d√©marrage si Firebase est configur√©
        if (isFirebaseConfigured) {
            loadSpotsFromFirebase();
            
            // √âcouter les changements d'authentification
            firebaseAuth.onAuthStateChanged(async (user) => {
                if (user) {
                    // Charger ou cr√©er le profil depuis Firestore
                    const userDoc = await firebaseDb.collection('users').doc(user.uid).get();
                    if (userDoc.exists) {
                        state.user = { uid: user.uid, ...userDoc.data() };
                    } else {
                        // Nouveau utilisateur
                        const newProfile = {
                            uid: user.uid,
                            email: user.email,
                            username: user.displayName || user.email.split('@')[0],
                            avatar: 'üë§',
                            points: 0,
                            level: 1,
                            spotsShared: 0,
                            badges: [],
                            createdAt: new Date().toISOString()
                        };
                        await firebaseDb.collection('users').doc(user.uid).set(newProfile);
                        state.user = newProfile;
                    }
                    Storage.set('user', state.user);
                    render();
                }
            });
        }
        
        // Chat temps r√©el
        let chatUnsubscribe = null;
        function subscribeToChatRoom(room) {
            if (chatUnsubscribe) chatUnsubscribe();
            if (!firebaseDb) return;
            
            chatUnsubscribe = firebaseDb.collection('messages')
                .where('room', '==', room)
                .orderBy('createdAt', 'desc')
                .limit(50)
                .onSnapshot((snapshot) => {
                    const messages = snapshot.docs.map(doc => ({
                        id: doc.id,
                        ...doc.data(),
                        time: doc.data().createdAt?.toDate().toLocaleTimeString('fr-FR', {hour: '2-digit', minute: '2-digit'}) || ''
                    })).reverse();
                    state.chatMessages = messages;
                    render();
                });
        }
        
        async function sendChatMessage(room, text) {
            if (!firebaseDb || !state.user || !text.trim()) return;
            await firebaseDb.collection('messages').add({
                room: room,
                text: text.trim(),
                userId: state.user.uid,
                username: state.user.username,
                avatar: state.user.avatar,
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            });
        }
        
        // Signaler un spot
        async function reportSpot(spotId, reason, details) {
            if (!firebaseDb || !state.user) return;
            await firebaseDb.collection('reports').add({
                spotId: spotId,
                reason: reason,
                details: details,
                reporterId: state.user.uid,
                createdAt: firebase.firestore.FieldValue.serverTimestamp(),
                status: 'pending'
            });
            showToast(state.lang === 'fr' ? 'Signalement envoy√©' : 'Report sent');
        }
        
        // Compression d'image avant upload
        async function compressImage(dataUrl, maxWidth = 800, quality = 0.7) {
            return new Promise((resolve) => {
                const img = new Image();
                img.onload = () => {
                    const canvas = document.createElement('canvas');
                    const ratio = Math.min(maxWidth / img.width, 1);
                    canvas.width = img.width * ratio;
                    canvas.height = img.height * ratio;
                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                    resolve(canvas.toDataURL('image/jpeg', quality));
                };
                img.src = dataUrl;
            });
        }

        // ==================== CONFIGURATION CARTE ====================
        // üó∫Ô∏è CartoDB - 100% GRATUIT, illimit√©, haute qualit√©
        // - Mode clair : Voyager (color√©, tr√®s lisible, noms de rues clairs)
        // - Mode sombre : Dark Matter (moderne, √©l√©gant)
        
        function getMapTileUrl(theme) {
            if (theme === 'light') {
                // CartoDB Voyager - Le plus beau gratuit, tr√®s net au zoom
                return 'https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png';
            } else {
                // CartoDB Dark Matter - Parfait pour mode sombre
                return 'https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png';
            }
        }
        
        function getMapAttribution() {
            return '&copy; <a href="https://openstreetmap.org">OSM</a> &copy; <a href="https://carto.com/">CARTO</a>';
        }

        // ==================== STATE ====================
        let state = {
            lang: Storage.get('lang') || 'fr',
            theme: Storage.get('theme') || 'dark',
            user: Storage.get('user') || null,
            spots: Storage.get('spots') || [...sampleSpots],
            trips: Storage.get('trips') || [
                {
                    id: 'example-trip-1',
                    steps: ['Paris', 'Lyon', 'Munich', 'Berlin'],
                    createdAt: new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString() // Il y a 7 jours
                }
            ],
            checkins: Storage.get('checkins') || [],
            messages: Storage.get('messages') || [...sampleMessages],
            friends: Storage.get('friends') || [...sampleFriends],
            emergencyContacts: Storage.get('emergencyContacts') || [],
            activeTrip: null,
            activeTab: 'home', // Chang√© de 'spots' √† 'home'
            activeChatRoom: 'friends', // Chang√© de 'general' √† 'friends'
            activeChatCountry: null, // Nouveau : pour chat pays
            selectedSpot: null,
            showAddSpot: false,
            showMap: false,
            showRateSpot: false,
            showReminder: false,
            showWelcome: !Storage.get('user'),
            showMenu: false,
            showSOS: false,
            searchQuery: '',
            tempUsername: 'Traveler_' + Math.floor(Math.random() * 1000),
            activeFilter: 'all',
            sortBy: 'rating',
            userLocation: null,
            isLocating: false,
            plannerSteps: [{ city: 'Brussels' }, { city: 'Paris' }, { city: 'Lyon' }],
            pendingPhoto: null,
            mapInstance: null,
            selectedAvatar: 'üë§',
            lastCheckinSpot: null,
            activeChatRoom: 'general',
            newMessage: '',
            isSharingLocation: false,
            // Tutorial
            showTutorial: !Storage.get('tutorialDone'),
            tutorialStep: 0,
            // Quiz
            quizMode: null, // 'solo', 'friend', 'world'
            quizCategory: null,
            quizQuestions: [],
            quizCurrentIndex: 0,
            quizScore: 0,
            quizAnswered: false,
            quizSelectedAnswer: null,
            quizTimeLeft: 15,
            quizTimerInterval: null,
            quizFinished: false,
            quizBestScore: Storage.get('quizBestScore') || 0,
            // Wizard ajout spot
            addSpotStep: 1,
            addSpotData: { photo: null, from: '', to: '', description: '' },
            // Nouvelles fonctionnalit√©s
            showFilters: false,
            filterMinRating: 0,
            filterMaxWait: 60,
            filterCountry: 'all',
            comments: Storage.get('comments') || [...sampleComments],
            savedSpots: Storage.get('savedSpots') || [],
            showPlannerMap: false,
            guideContinent: 'all',
            selectedCountryGuide: null,
            selectedSavedTrip: null,
            currentRouteSpots: [],
            guidesRead: Storage.get('guidesRead') || 0,
            quizzesCompleted: Storage.get('quizzesCompleted') || 0,
            messagesSent: Storage.get('messagesSent') || 0,
            countriesVisited: Storage.get('countriesVisited') || [],
            helpGiven: Storage.get('helpGiven') || 0,
            userLeague: Storage.get('userLeague') || 'bronze',
            seasonPoints: Storage.get('seasonPoints') || 0,
            locationHistory: Storage.get('locationHistory') || [],
            recentSpotVisits: Storage.get('recentSpotVisits') || {}, // Pour validation : {spotId: timestamp}
            reviewedSpots: Storage.get('reviewedSpots') || [], // Spots d√©j√† notifi√©s pour review
            userBadges: Storage.get('userBadges') || [],
            challengeProgress: Storage.get('challengeProgress') || {},
            privateMessages: Storage.get('privateMessages') || [...samplePrivateMessages],
            tripHistory: Storage.get('tripHistory') || [],
            theme: Storage.get('theme') || 'dark',
            showBadgePopup: null,
            showComments: false,
            showPrivateMessages: false,
            showChallenges: false,
            showBadges: false,
            showCountryGuidePrompt: false,
            countryGuidePromptCountry: null,
            countriesViewed: Storage.get('countriesViewed') || {}, // {countryCode: timestamp}
            quizNotifications: Storage.get('quizNotifications') || [], // Pays √† quiz
            showStats: false,
            liveSharing: Storage.get('liveSharing') || false,
            // Boutique & R√©compenses
            showShop: false,
            showMyRewards: false,
            shopCategory: 'all',
            earnedRewards: Storage.get('earnedRewards') || [],
            totalPointsEarned: Storage.get('totalPointsEarned') || 0,
            // Validation spots
            spotValidations: Storage.get('spotValidations') || { 1: 12, 2: 8, 3: 15, 4: 10, 5: 6, 6: 11, 7: 14, 8: 18, 9: 5, 10: 9, 19: 13, 21: 16, 23: 11, 26: 17, 31: 10, 39: 15 },
            validatedByMe: Storage.get('validatedByMe') || [],
            // Auth
            authScreen: Storage.get('user') ? null : 'login', // 'login', 'register', 'forgot', 'profile-setup', null
            authEmail: '',
            authPassword: '',
            authConfirmPassword: '',
            authError: null,
            authLoading: false,
            firebaseUser: null,
            // Pages l√©gales
            legalPage: null, // 'cgu', 'privacy', 'legal', null
            // Signalement
            showReportModal: false,
            reportTarget: null, // { type: 'spot' | 'user', id: string, name: string }
            reportReason: '',
            reportDetails: '',
            reportLoading: false
        };

        const t = (key) => translations[state.lang][key] || key;

        // ==================== GEO ====================
        const Geo = {
            currentPosition: null,
            async getCurrentPosition() {
                return new Promise((resolve, reject) => {
                    if (!navigator.geolocation) { reject(new Error('No geolocation')); return; }
                    navigator.geolocation.getCurrentPosition(
                        (pos) => { this.currentPosition = { lat: pos.coords.latitude, lng: pos.coords.longitude }; resolve(this.currentPosition); },
                        reject, { enableHighAccuracy: true, timeout: 10000 }
                    );
                });
            },
            calculateDistance(lat1, lng1, lat2, lng2) {
                const R = 6371;
                const dLat = (lat2 - lat1) * Math.PI / 180;
                const dLng = (lng2 - lng1) * Math.PI / 180;
                const a = Math.sin(dLat/2)**2 + Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) * Math.sin(dLng/2)**2;
                return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            },
            formatDistance(km) { return km < 1 ? `${Math.round(km * 1000)}m` : km < 10 ? `${km.toFixed(1)}km` : `${Math.round(km)}km`; }
        };

        // ==================== UTILITIES ====================
        function showToast(msg, type = 'success') {
            document.querySelectorAll('.toast').forEach(t => t.remove());
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            toast.innerHTML = `<span>${type === 'success' ? '‚úì' : '‚úï'}</span><span>${msg}</span>`;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }

        function showConfetti() {
            const c = document.createElement('div');
            c.style.cssText = 'position:fixed;inset:0;pointer-events:none;z-index:9999;';
            ['üéâ', '‚ú®', '‚≠ê', 'üöó', 'üëç'].forEach(() => {
                const e = document.createElement('div');
                e.textContent = ['üéâ', '‚ú®', '‚≠ê'][Math.floor(Math.random() * 3)];
                e.style.cssText = `position:absolute;left:${Math.random()*100}%;top:${Math.random()*100}%;font-size:${20+Math.random()*20}px;animation:confetti 1s ease-out forwards;`;
                c.appendChild(e);
            });
            document.body.appendChild(c);
            setTimeout(() => c.remove(), 1500);
        }

        // ==================== S√âCURIT√â XSS ====================
        function escapeHtml(text) {
            if (!text) return '';
            if (typeof text !== 'string') text = String(text);
            const map = { '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#039;', '/': '&#x2F;', '`': '&#x60;', '=': '&#x3D;' };
            return text.replace(/[&<>"'`=\/]/g, char => map[char]);
        }

        function sanitizeInput(input, maxLength = 500) {
            if (!input) return '';
            if (typeof input !== 'string') input = String(input);
            return input.trim().replace(/[<>]/g, '').replace(/javascript:/gi, '').replace(/on\w+=/gi, '').substring(0, maxLength);
        }

        // ==================== SIGNALEMENT ====================
        const REPORT_REASONS = [
            { id: 'inaccurate', icon: '‚ùå', key: 'reasonInaccurate' },
            { id: 'dangerous', icon: '‚ö†Ô∏è', key: 'reasonDangerous' },
            { id: 'closed', icon: 'üö´', key: 'reasonClosed' },
            { id: 'duplicate', icon: 'üìã', key: 'reasonDuplicate' },
            { id: 'spam', icon: 'üóëÔ∏è', key: 'reasonSpam' },
            { id: 'offensive', icon: 'üö®', key: 'reasonOffensive' },
            { id: 'other', icon: '‚ùì', key: 'reasonOther' }
        ];

        function openReportModal(type, id, name) {
            state.showReportModal = true;
            state.reportTarget = { type, id, name };
            state.reportReason = '';
            state.reportDetails = '';
            render();
        }

        function closeReportModal() {
            state.showReportModal = false;
            state.reportTarget = null;
            state.reportReason = '';
            state.reportDetails = '';
            render();
        }

        async function submitReport() {
            if (!state.reportReason) {
                showToast(t('reportReason'), 'error');
                return;
            }
            state.reportLoading = true;
            render();
            
            try {
                if (isFirebaseConfigured && db) {
                    const reportData = {
                        targetType: state.reportTarget.type,
                        targetId: state.reportTarget.id,
                        targetName: state.reportTarget.name,
                        reason: state.reportReason,
                        details: sanitizeInput(state.reportDetails),
                        reporterId: state.user?.odosId || 'anonymous',
                        status: 'pending',
                        createdAt: new Date().toISOString()
                    };
                    await db.collection('reports').add(reportData);
                }
                showToast(t('reportSuccess'), 'success');
                closeReportModal();
            } catch (error) {
                console.error('Report error:', error);
                showToast(t('reportError'), 'error');
            }
            state.reportLoading = false;
            render();
        }

        function saveState() {
            Storage.set('user', state.user);
            Storage.set('spots', state.spots);
            Storage.set('trips', state.trips);
            Storage.set('checkins', state.checkins);
            Storage.set('messages', state.messages);
            Storage.set('friends', state.friends);
            Storage.set('emergencyContacts', state.emergencyContacts);
        }

        function addPoints(pts) {
            if (state.user) {
                state.user.score += pts;
                state.user.level = Math.floor(state.user.score / 100) + 1;
                saveState();
            }
        }
        
        // Syst√®me de ligues et championnat
        function addSeasonPoints(pts) {
            state.seasonPoints = (state.seasonPoints || 0) + pts;
            Storage.set('seasonPoints', state.seasonPoints);
            updateLeague();
        }
        
        function updateLeague() {
            const pts = state.seasonPoints || 0;
            let newLeague = 'bronze';
            if (pts >= 5000) newLeague = 'diamond';
            else if (pts >= 2000) newLeague = 'gold';
            else if (pts >= 500) newLeague = 'silver';
            
            if (newLeague !== state.userLeague) {
                state.userLeague = newLeague;
                Storage.set('userLeague', newLeague);
                const leagueNames = {
                    bronze: 'ü•â Bronze', silver: 'ü•à Argent', gold: 'ü•á Or', diamond: 'üíé Diamant'
                };
                showToast(`üéâ ${state.lang === 'fr' ? 'Nouvelle ligue' : 'New league'}: ${leagueNames[newLeague]}!`);
            }
        }
        
        function getLeagueInfo(league) {
            const leagues = {
                bronze: { name: { fr: 'Bronze', en: 'Bronze', es: 'Bronce' }, icon: 'ü•â', color: '#CD7F32', minPoints: 0, bonus: 1 },
                silver: { name: { fr: 'Argent', en: 'Silver', es: 'Plata' }, icon: 'ü•à', color: '#C0C0C0', minPoints: 500, bonus: 1.25 },
                gold: { name: { fr: 'Or', en: 'Gold', es: 'Oro' }, icon: 'ü•á', color: '#FFD700', minPoints: 2000, bonus: 1.5 },
                diamond: { name: { fr: 'Diamant', en: 'Diamond', es: 'Diamante' }, icon: 'üíé', color: '#B9F2FF', minPoints: 5000, bonus: 2 }
            };
            return leagues[league] || leagues.bronze;
        }
        
        // Enregistrer position pour historique (pour validation spots)
        function recordLocation() {
            if (state.userLocation) {
                const history = state.locationHistory || [];
                const now = Date.now();
                const twelveHoursAgo = now - (12 * 60 * 60 * 1000);
                
                // Garder seulement les 12 derni√®res heures
                const filtered = history.filter(loc => loc.timestamp > twelveHoursAgo);
                
                // Ajouter nouvelle position
                filtered.push({
                    lat: state.userLocation.lat,
                    lng: state.userLocation.lng,
                    timestamp: now
                });
                
                // Garder max 100 positions
                state.locationHistory = filtered.slice(-100);
                Storage.set('locationHistory', state.locationHistory);
            }
        }
        
        // Enregistrer position toutes les 5 minutes si GPS actif
        setInterval(() => {
            if (state.userLocation) recordLocation();
        }, 5 * 60 * 1000);

        function getSpotType(spot) {
            const days = Math.floor((new Date() - new Date(spot.lastUsed)) / 86400000);
            if (spot.globalRating >= 4.5 && spot.totalReviews >= 30) return 'top';
            if (spot.globalRating >= 4.0 && spot.totalReviews >= 10) return 'good';
            if (days > 180) return 'old';
            if (spot.totalReviews < 5) return 'new';
            return 'good';
        }

        function formatDate(d) {
            const diff = Math.floor((new Date() - new Date(d)) / 86400000);
            if (diff === 0) return state.lang === 'fr' ? "Aujourd'hui" : 'Today';
            if (diff === 1) return state.lang === 'fr' ? 'Hier' : 'Yesterday';
            if (diff < 7) return `${diff}j`;
            return new Date(d).toLocaleDateString();
        }

        async function getUserLocation() {
            state.isLocating = true; render();
            try {
                state.userLocation = await Geo.getCurrentPosition();
                state.isLocating = false; render();
                return state.userLocation;
            } catch (e) {
                state.isLocating = false;
                showToast('Location error', 'error');
                render();
                return null;
            }
        }

        function getSpotsForRoute(from, to) {
            return state.spots.filter(s => 
                (s.from.toLowerCase().includes(from.toLowerCase()) || from.toLowerCase().includes(s.from.toLowerCase())) &&
                (s.to.toLowerCase().includes(to.toLowerCase()) || to.toLowerCase().includes(s.to.toLowerCase()))
            ).sort((a, b) => b.globalRating - a.globalRating).slice(0, 3);
        }

        // ==================== PAGES L√âGALES ====================
        function renderLegalPage() {
            const content = {
                'cgu': renderCGU(),
                'privacy': renderPrivacyPolicy(),
                'legal': renderLegalNotice()
            };
            return `
                <div class="min-h-screen bg-slate-900">
                    <div class="max-w-4xl mx-auto px-4 py-8">
                        <button onclick="state.legalPage=null;render();" class="mb-6 text-sky-400 hover:text-sky-300 flex items-center gap-2 text-lg">
                            <span>‚Üê</span> ${t('backToApp')}
                        </button>
                        <div class="card p-6 md:p-8">${content[state.legalPage] || ''}</div>
                        <div class="text-center mt-8 text-slate-500 text-sm">
                            <p>¬© ${new Date().getFullYear()} SpotHitch - ${t('lastUpdated')}: 23/12/2024</p>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderCGU() {
            const isFr = state.lang === 'fr';
            return isFr ? `
                <h1 class="text-3xl font-bold mb-6 text-sky-400">üìú Conditions G√©n√©rales d'Utilisation</h1>
                <p class="text-slate-400 mb-8">Derni√®re mise √† jour : 23 d√©cembre 2024</p>
                <div class="space-y-6 text-slate-300 leading-relaxed">
                    <section><h2 class="text-xl font-semibold text-white mb-3">1. Objet</h2><p>Les pr√©sentes CGU r√©gissent l'utilisation de SpotHitch, plateforme communautaire d√©di√©e au partage d'informations sur les spots d'auto-stop en Europe.</p></section>
                    <section><h2 class="text-xl font-semibold text-white mb-3">2. Acceptation</h2><p>En utilisant SpotHitch, vous acceptez ces conditions. Si vous n'acceptez pas, veuillez ne pas utiliser l'application.</p></section>
                    <section><h2 class="text-xl font-semibold text-white mb-3">3. Services</h2><p>SpotHitch permet de : consulter une carte des spots, ajouter des spots, valider et noter les spots, planifier des itin√©raires, acc√©der aux guides par pays, participer au chat communautaire.</p></section>
                    <section><h2 class="text-xl font-semibold text-white mb-3">4. Compte utilisateur</h2><p>Vous vous engagez √† fournir des informations exactes, maintenir la confidentialit√© de vos identifiants, et ne pas cr√©er plusieurs comptes.</p></section>
                    <section><h2 class="text-xl font-semibold text-white mb-3">5. Contenu utilisateur</h2><p>En publiant du contenu, vous garantissez en avoir les droits et accordez √† SpotHitch une licence pour l'afficher. Le contenu ill√©gal ou offensant est interdit.</p></section>
                    <section><h2 class="text-xl font-semibold text-white mb-3">6. Responsabilit√©</h2><p class="p-3 bg-amber-500/10 border border-amber-500/30 rounded-lg">‚ö†Ô∏è L'auto-stop comporte des risques. SpotHitch fournit des informations √† titre indicatif. Vous utilisez ces informations √† vos propres risques.</p></section>
                    <section><h2 class="text-xl font-semibold text-white mb-3">7. Contact</h2><p>üìß contact@spothitch.app</p></section>
                </div>
            ` : `
                <h1 class="text-3xl font-bold mb-6 text-sky-400">üìú Terms of Service</h1>
                <p class="text-slate-400 mb-8">Last updated: December 23, 2024</p>
                <div class="space-y-6 text-slate-300 leading-relaxed">
                    <section><h2 class="text-xl font-semibold text-white mb-3">1. Purpose</h2><p>These Terms govern the use of SpotHitch, a community platform for sharing hitchhiking spot information in Europe.</p></section>
                    <section><h2 class="text-xl font-semibold text-white mb-3">2. Acceptance</h2><p>By using SpotHitch, you agree to these terms. If you don't accept, please don't use the app.</p></section>
                    <section><h2 class="text-xl font-semibold text-white mb-3">3. Services</h2><p>SpotHitch allows you to: view spot maps, add spots, validate and rate spots, plan routes, access country guides, participate in community chat.</p></section>
                    <section><h2 class="text-xl font-semibold text-white mb-3">4. User Account</h2><p>You agree to provide accurate information, maintain credential confidentiality, and not create multiple accounts.</p></section>
                    <section><h2 class="text-xl font-semibold text-white mb-3">5. User Content</h2><p>By posting content, you guarantee you have the rights and grant SpotHitch a license to display it. Illegal or offensive content is prohibited.</p></section>
                    <section><h2 class="text-xl font-semibold text-white mb-3">6. Liability</h2><p class="p-3 bg-amber-500/10 border border-amber-500/30 rounded-lg">‚ö†Ô∏è Hitchhiking involves risks. SpotHitch provides information for reference only. You use this information at your own risk.</p></section>
                    <section><h2 class="text-xl font-semibold text-white mb-3">7. Contact</h2><p>üìß contact@spothitch.app</p></section>
                </div>
            `;
        }

        function renderPrivacyPolicy() {
            const isFr = state.lang === 'fr';
            return isFr ? `
                <h1 class="text-3xl font-bold mb-6 text-sky-400">üîí Politique de Confidentialit√©</h1>
                <p class="text-slate-400 mb-8">Derni√®re mise √† jour : 23 d√©cembre 2024</p>
                <div class="space-y-6 text-slate-300 leading-relaxed">
                    <section><h2 class="text-xl font-semibold text-white mb-3">1. Introduction</h2><p>Nous prot√©geons votre vie priv√©e conform√©ment au RGPD.</p></section>
                    <section><h2 class="text-xl font-semibold text-white mb-3">2. Donn√©es collect√©es</h2><p><strong>Fournies :</strong> Email, pseudo, avatar, spots, messages.<br/><strong>Automatiques :</strong> IP, navigateur, g√©olocalisation (si autoris√©e).</p></section>
                    <section><h2 class="text-xl font-semibold text-white mb-3">3. Utilisation</h2><p>Gestion du compte, affichage des spots, gamification, am√©lioration du service, mod√©ration.</p></section>
                    <section><h2 class="text-xl font-semibold text-white mb-3">4. Partage</h2><p class="p-3 bg-green-500/10 border border-green-500/30 rounded-lg">‚úÖ Nous ne vendons jamais vos donn√©es. Partage uniquement avec Firebase (h√©bergement) et autres utilisateurs (contenu public).</p></section>
                    <section><h2 class="text-xl font-semibold text-white mb-3">5. Vos droits RGPD</h2>
                        <div class="grid grid-cols-2 gap-2 mt-3">
                            <div class="bg-slate-800/50 p-3 rounded-lg"><strong class="text-sky-300">üìã Acc√®s</strong><br/><span class="text-sm">Obtenir vos donn√©es</span></div>
                            <div class="bg-slate-800/50 p-3 rounded-lg"><strong class="text-sky-300">‚úèÔ∏è Rectification</strong><br/><span class="text-sm">Corriger vos donn√©es</span></div>
                            <div class="bg-slate-800/50 p-3 rounded-lg"><strong class="text-sky-300">üóëÔ∏è Effacement</strong><br/><span class="text-sm">Supprimer vos donn√©es</span></div>
                            <div class="bg-slate-800/50 p-3 rounded-lg"><strong class="text-sky-300">üì¶ Portabilit√©</strong><br/><span class="text-sm">R√©cup√©rer vos donn√©es</span></div>
                        </div>
                    </section>
                    <section><h2 class="text-xl font-semibold text-white mb-3">6. Contact DPO</h2><p>üìß privacy@spothitch.app</p></section>
                </div>
            ` : `
                <h1 class="text-3xl font-bold mb-6 text-sky-400">üîí Privacy Policy</h1>
                <p class="text-slate-400 mb-8">Last updated: December 23, 2024</p>
                <div class="space-y-6 text-slate-300 leading-relaxed">
                    <section><h2 class="text-xl font-semibold text-white mb-3">1. Introduction</h2><p>We protect your privacy in accordance with GDPR.</p></section>
                    <section><h2 class="text-xl font-semibold text-white mb-3">2. Data Collected</h2><p><strong>Provided:</strong> Email, username, avatar, spots, messages.<br/><strong>Automatic:</strong> IP, browser, geolocation (if authorized).</p></section>
                    <section><h2 class="text-xl font-semibold text-white mb-3">3. Usage</h2><p>Account management, spot display, gamification, service improvement, moderation.</p></section>
                    <section><h2 class="text-xl font-semibold text-white mb-3">4. Sharing</h2><p class="p-3 bg-green-500/10 border border-green-500/30 rounded-lg">‚úÖ We never sell your data. Sharing only with Firebase (hosting) and other users (public content).</p></section>
                    <section><h2 class="text-xl font-semibold text-white mb-3">5. Your GDPR Rights</h2>
                        <div class="grid grid-cols-2 gap-2 mt-3">
                            <div class="bg-slate-800/50 p-3 rounded-lg"><strong class="text-sky-300">üìã Access</strong><br/><span class="text-sm">Get your data</span></div>
                            <div class="bg-slate-800/50 p-3 rounded-lg"><strong class="text-sky-300">‚úèÔ∏è Rectification</strong><br/><span class="text-sm">Correct your data</span></div>
                            <div class="bg-slate-800/50 p-3 rounded-lg"><strong class="text-sky-300">üóëÔ∏è Erasure</strong><br/><span class="text-sm">Delete your data</span></div>
                            <div class="bg-slate-800/50 p-3 rounded-lg"><strong class="text-sky-300">üì¶ Portability</strong><br/><span class="text-sm">Retrieve your data</span></div>
                        </div>
                    </section>
                    <section><h2 class="text-xl font-semibold text-white mb-3">6. DPO Contact</h2><p>üìß privacy@spothitch.app</p></section>
                </div>
            `;
        }

        function renderLegalNotice() {
            const isFr = state.lang === 'fr';
            return isFr ? `
                <h1 class="text-3xl font-bold mb-6 text-sky-400">‚öñÔ∏è Mentions L√©gales</h1>
                <p class="text-slate-400 mb-8">Derni√®re mise √† jour : 23 d√©cembre 2024</p>
                <div class="space-y-6 text-slate-300 leading-relaxed">
                    <section><h2 class="text-xl font-semibold text-white mb-3">1. √âditeur</h2><div class="bg-slate-800/50 p-4 rounded-lg"><strong>SpotHitch</strong><br/>üìß contact@spothitch.app</div></section>
                    <section><h2 class="text-xl font-semibold text-white mb-3">2. H√©bergement</h2><div class="bg-slate-800/50 p-4 rounded-lg"><strong>Google Firebase</strong><br/>Google LLC, Mountain View, CA, USA</div></section>
                    <section><h2 class="text-xl font-semibold text-white mb-3">3. Cr√©dits</h2><p>Cartographie: Leaflet.js + OpenStreetMap<br/>Tiles: CartoDB<br/>Routing: OSRM<br/>Backend: Firebase</p></section>
                    <section><h2 class="text-xl font-semibold text-white mb-3">4. Avertissement</h2><p class="p-3 bg-amber-500/10 border border-amber-500/30 rounded-lg">‚ö†Ô∏è L'auto-stop comporte des risques. SpotHitch ne peut √™tre tenu responsable des incidents.</p></section>
                </div>
            ` : `
                <h1 class="text-3xl font-bold mb-6 text-sky-400">‚öñÔ∏è Legal Notice</h1>
                <p class="text-slate-400 mb-8">Last updated: December 23, 2024</p>
                <div class="space-y-6 text-slate-300 leading-relaxed">
                    <section><h2 class="text-xl font-semibold text-white mb-3">1. Publisher</h2><div class="bg-slate-800/50 p-4 rounded-lg"><strong>SpotHitch</strong><br/>üìß contact@spothitch.app</div></section>
                    <section><h2 class="text-xl font-semibold text-white mb-3">2. Hosting</h2><div class="bg-slate-800/50 p-4 rounded-lg"><strong>Google Firebase</strong><br/>Google LLC, Mountain View, CA, USA</div></section>
                    <section><h2 class="text-xl font-semibold text-white mb-3">3. Credits</h2><p>Mapping: Leaflet.js + OpenStreetMap<br/>Tiles: CartoDB<br/>Routing: OSRM<br/>Backend: Firebase</p></section>
                    <section><h2 class="text-xl font-semibold text-white mb-3">4. Disclaimer</h2><p class="p-3 bg-amber-500/10 border border-amber-500/30 rounded-lg">‚ö†Ô∏è Hitchhiking involves risks. SpotHitch cannot be held responsible for incidents.</p></section>
                </div>
            `;
        }

        function renderReportModal() {
            if (!state.showReportModal || !state.reportTarget) return '';
            return `
                <div class="fixed inset-0 z-50 flex items-center justify-center p-4" style="background: rgba(0,0,0,0.8);">
                    <div class="card p-6 max-w-md w-full fade-in">
                        <div class="flex justify-between items-center mb-4">
                            <h2 class="text-xl font-bold text-red-400 flex items-center gap-2"><span>üö®</span> ${t('reportSpot')}</h2>
                            <button onclick="closeReportModal()" class="text-slate-400 hover:text-white text-2xl" aria-label="Fermer">√ó</button>
                        </div>
                        <div class="bg-slate-800/50 p-3 rounded-lg mb-4">
                            <p class="text-sm text-slate-400">Spot</p>
                            <p class="text-white">${escapeHtml(state.reportTarget.name)}</p>
                        </div>
                        <div class="mb-4">
                            <label class="block text-sm font-medium mb-2">${t('reportReason')} *</label>
                            <div class="space-y-2">
                                ${REPORT_REASONS.map(r => `
                                    <button onclick="state.reportReason='${r.id}';render();"
                                        class="w-full text-left px-4 py-3 rounded-lg flex items-center gap-3 ${state.reportReason === r.id ? 'bg-red-500/20 border-2 border-red-500' : 'bg-slate-800/50 border-2 border-transparent hover:bg-slate-700/50'}">
                                        <span>${r.icon}</span><span>${t(r.key)}</span>${state.reportReason === r.id ? '<span class="ml-auto">‚úì</span>' : ''}
                                    </button>
                                `).join('')}
                            </div>
                        </div>
                        <div class="mb-6">
                            <label class="block text-sm font-medium mb-2">${t('reportDetails')}</label>
                            <textarea class="input-modern w-full h-20 resize-none" oninput="state.reportDetails=this.value" maxlength="500" placeholder="${state.lang === 'fr' ? 'D√©cris le probl√®me...' : 'Describe the issue...'}">${state.reportDetails}</textarea>
                        </div>
                        <div class="flex gap-3">
                            <button onclick="closeReportModal()" class="flex-1 btn btn-ghost">${t('cancel')}</button>
                            <button onclick="submitReport()" class="flex-1 btn bg-red-500 hover:bg-red-600 text-white" ${!state.reportReason || state.reportLoading ? 'disabled style="opacity:0.5"' : ''}>
                                ${state.reportLoading ? '‚è≥' : 'üö®'} ${t('reportSubmit')}
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        // ==================== RENDER ====================
        function render() {
            // Pages l√©gales (priorit√© maximale)
            if (state.legalPage) {
                document.getElementById('app').innerHTML = renderLegalPage();
                return;
            }
            
            // √âcran d'authentification
            if (state.authScreen && !state.user) { 
                document.getElementById('app').innerHTML = renderAuthScreen(); 
                return; 
            }
            
            // √âcran de bienvenue (setup profil apr√®s auth)
            if (state.showWelcome && state.user && !state.user.username) { 
                document.getElementById('app').innerHTML = renderProfileSetup(); 
                return; 
            }
            
            // Legacy: ancien √©cran de bienvenue si pas de Firebase
            if (state.showWelcome && !isFirebaseConfigured) { 
                document.getElementById('app').innerHTML = renderWelcome(); 
                return; 
            }
            
            const tutoMainZ = state.showTutorial ? 'position: relative; z-index: 101;' : '';
            
            document.getElementById('app').innerHTML = `
                ${renderHeader()}
                ${state.showMenu ? renderSideMenu() : ''}
                <main class="max-w-6xl mx-auto px-4 pt-4 pb-28" style="${tutoMainZ}">
                    ${state.activeTab === 'home' ? renderHome() : ''}
                    ${state.activeTab === 'spots' ? renderSpotsAndMap() : ''}
                    ${state.activeTab === 'planner' ? renderPlanner() : ''}
                    ${state.activeTab === 'chat' ? renderChat() : ''}
                    ${state.activeTab === 'profile' ? renderProfile() : ''}
                    ${state.activeTab === 'friends' ? renderFriends() : ''}
                    ${state.activeTab === 'guides' ? renderGuides() : ''}
                    ${state.activeTab === 'safety' ? renderSafety() : ''}
                    ${state.activeTab === 'missions' ? renderMissions() : ''}
                    ${state.activeTab === 'quiz' ? renderQuiz() : ''}
                    ${state.activeTab === 'offline' ? renderOfflineSpots() : ''}
                </main>
                ${renderBottomNav()}
                ${renderFAB()}
                ${state.showSOS ? renderSOSModal() : ''}
                ${state.showAddSpot ? renderAddSpotModal() : ''}
                ${state.selectedSpot ? renderSpotDetail() : ''}
                ${state.showRateSpot ? renderRateModal() : ''}
                ${state.showReminder ? renderReminder() : ''}
                ${state.showTutorial ? renderTutorial() : ''}
                ${state.showCountryGuidePrompt ? renderCountryGuidePrompt() : ''}
                ${state.showFilters ? renderFiltersModal() : ''}
                ${state.showBadges ? renderBadgesModal() : ''}
                ${state.showChallenges ? renderChallengesModal() : ''}
                ${state.showPrivateMessages ? renderMessagesModal() : ''}
                ${state.showStats ? renderStatsModal() : ''}
                ${state.showBadgePopup ? renderBadgePopup() : ''}
                ${state.showShop ? renderShopModal() : ''}
                ${state.showMyRewards ? renderMyRewardsModal() : ''}
                ${state.showReportModal ? renderReportModal() : ''}
            `;
            
            if (state.activeTab === 'spots' && !state.mapInstance) setTimeout(initMap, 100);
        }

        function renderWelcome() {
            const avatars = ['üë§', 'üë®', 'üë©', 'üßë', 'üë±‚Äç‚ôÇÔ∏è', 'üë±‚Äç‚ôÄÔ∏è', 'üë®‚Äçü¶∞', 'üë©‚Äçü¶∞', 'üßî', 'üë©‚Äçüé§', 'üßë‚Äçüé§', 'üßù‚Äç‚ôÄÔ∏è'];
            return `
                <div class="min-h-screen flex items-center justify-center p-4" style="background: radial-gradient(ellipse at top, #1e3a5f 0%, #0f172a 50%, #000 100%);">
                    <div class="card p-8 max-w-md w-full text-center">
                        <div class="w-20 h-20 mx-auto mb-6 rounded-2xl bg-gradient-to-br from-sky-500 to-emerald-500 flex items-center justify-center shadow-lg shadow-sky-500/30">
                            <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
                            </svg>
                        </div>
                        <h1 class="text-3xl font-bold mb-2 tracking-tight">${t('appName')}</h1>
                        <p class="text-slate-400 mb-8">${t('tagline')}</p>
                        <div class="mb-6">
                            <label class="block text-sm font-medium text-slate-300 mb-3 text-left">${t('chooseAvatar')}</label>
                            <div id="avatar-grid" class="flex flex-wrap gap-2 justify-center">
                                ${avatars.map(a => `<div class="avatar-option ${state.selectedAvatar === a ? 'selected' : ''}" onclick="selectAvatar('${a}')">${a}</div>`).join('')}
                            </div>
                        </div>
                        <div class="mb-6 text-left">
                            <label class="block text-sm font-medium text-slate-300 mb-2">${t('yourUsername')}</label>
                            <input type="text" id="username-input" class="input-modern" placeholder="Ex: Alex_Voyageur" value="${state.tempUsername || ''}" oninput="state.tempUsername=this.value" />
                        </div>
                        <button onclick="completeWelcome()" class="btn btn-primary w-full text-lg py-4 mb-4">${t('letsGo')}</button>
                        <div class="flex justify-center gap-4">
                            <button onclick="changeLangNoRender('fr')" class="px-4 py-2 rounded-lg transition-all ${state.lang === 'fr' ? 'bg-sky-500/30 text-sky-300' : 'text-slate-400 hover:text-white'}">üá´üá∑ Fran√ßais</button>
                            <button onclick="changeLangNoRender('en')" class="px-4 py-2 rounded-lg transition-all ${state.lang === 'en' ? 'bg-sky-500/30 text-sky-300' : 'text-slate-400 hover:text-white'}">üá¨üáß English</button>
                            <button onclick="changeLangNoRender('es')" class="px-4 py-2 rounded-lg transition-all ${state.lang === 'es' ? 'bg-sky-500/30 text-sky-300' : 'text-slate-400 hover:text-white'}">üá™üá∏ Espa√±ol</button>
                        </div>
                    </div>
                </div>
            `;
        }

        // ==================== AUTH SCREENS ====================
        
        function renderAuthScreen() {
            const screen = state.authScreen;
            
            return `
                <div class="min-h-screen flex items-center justify-center p-4" style="background: radial-gradient(ellipse at top, #1e3a5f 0%, #0f172a 50%, #000 100%);">
                    <div class="card p-8 max-w-md w-full">
                        <!-- Logo -->
                        <div class="text-center mb-8">
                            <div class="w-20 h-20 mx-auto mb-6 rounded-2xl bg-gradient-to-br from-sky-500 to-emerald-500 flex items-center justify-center shadow-lg shadow-sky-500/30">
                                <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
                                </svg>
                            </div>
                            <h1 class="text-3xl font-bold tracking-tight">${t('appName')}</h1>
                            <p class="text-slate-400 mt-2">${t('tagline')}</p>
                        </div>
                        
                        ${screen === 'login' ? renderLoginForm() : ''}
                        ${screen === 'register' ? renderRegisterForm() : ''}
                        ${screen === 'forgot' ? renderForgotPasswordForm() : ''}
                        
                        <!-- Langue -->
                        <div class="flex justify-center gap-4 mt-6 pt-6 border-t border-white/10">
                            <button onclick="changeLang('fr')" class="px-3 py-1 rounded-lg text-sm transition-all ${state.lang === 'fr' ? 'bg-sky-500/30 text-sky-300' : 'text-slate-400 hover:text-white'}">üá´üá∑ FR</button>
                            <button onclick="changeLang('en')" class="px-3 py-1 rounded-lg text-sm transition-all ${state.lang === 'en' ? 'bg-sky-500/30 text-sky-300' : 'text-slate-400 hover:text-white'}">üá¨üáß EN</button>
                            <button onclick="changeLang('es')" class="px-3 py-1 rounded-lg text-sm transition-all ${state.lang === 'es' ? 'bg-sky-500/30 text-sky-300' : 'text-slate-400 hover:text-white'}">üá™üá∏ ES</button>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function renderLoginForm() {
            return `
                <div class="space-y-4">
                    <h2 class="text-xl font-bold text-center mb-6">${t('login')}</h2>
                    
                    ${state.authError ? `
                        <div class="p-3 rounded-xl bg-red-500/20 border border-red-500/30 text-red-400 text-sm text-center">
                            ${state.authError}
                        </div>
                    ` : ''}
                    
                    <div>
                        <label class="block text-sm font-medium text-slate-300 mb-2">${t('email')}</label>
                        <input type="email" id="auth-email" class="input-modern" placeholder="email@exemple.com" value="${state.authEmail}" oninput="state.authEmail=this.value" />
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-slate-300 mb-2">${t('password')}</label>
                        <input type="password" id="auth-password" class="input-modern" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" value="${state.authPassword}" oninput="state.authPassword=this.value" />
                    </div>
                    
                    <button onclick="handleLogin()" class="btn btn-primary w-full py-4 text-lg" ${state.authLoading ? 'disabled' : ''}>
                        ${state.authLoading ? '‚è≥' : ''} ${t('login')}
                    </button>
                    
                    <button onclick="state.authScreen='forgot';state.authError=null;render();" class="text-sky-400 text-sm text-center w-full hover:underline">
                        ${t('forgotPassword')}
                    </button>
                    
                    <div class="relative my-6">
                        <div class="absolute inset-0 flex items-center"><div class="w-full border-t border-white/10"></div></div>
                        <div class="relative flex justify-center text-sm"><span class="px-4 bg-slate-800 text-slate-400">${t('orContinueWith')}</span></div>
                    </div>
                    
                    <button onclick="handleGoogleLogin()" class="btn btn-ghost w-full py-4 border border-white/20 flex items-center justify-center gap-3">
                        <svg class="w-5 h-5" viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
                        ${t('continueWithGoogle')}
                    </button>
                    
                    <p class="text-center text-slate-400 text-sm mt-6">
                        ${t('noAccount')} 
                        <button onclick="state.authScreen='register';state.authError=null;render();" class="text-sky-400 hover:underline">${t('createAccount')}</button>
                    </p>
                </div>
            `;
        }
        
        function renderRegisterForm() {
            return `
                <div class="space-y-4">
                    <h2 class="text-xl font-bold text-center mb-6">${t('register')}</h2>
                    
                    ${state.authError ? `
                        <div class="p-3 rounded-xl bg-red-500/20 border border-red-500/30 text-red-400 text-sm text-center">
                            ${state.authError}
                        </div>
                    ` : ''}
                    
                    <div>
                        <label class="block text-sm font-medium text-slate-300 mb-2">${t('email')}</label>
                        <input type="email" id="auth-email" class="input-modern" placeholder="email@exemple.com" value="${state.authEmail}" oninput="state.authEmail=this.value" />
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-slate-300 mb-2">${t('password')}</label>
                        <input type="password" id="auth-password" class="input-modern" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" value="${state.authPassword}" oninput="state.authPassword=this.value" />
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-slate-300 mb-2">${t('confirmPassword')}</label>
                        <input type="password" id="auth-confirm" class="input-modern" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" value="${state.authConfirmPassword}" oninput="state.authConfirmPassword=this.value" />
                    </div>
                    
                    <button onclick="handleRegister()" class="btn btn-primary w-full py-4 text-lg" ${state.authLoading ? 'disabled' : ''}>
                        ${state.authLoading ? '‚è≥' : ''} ${t('createAccount')}
                    </button>
                    
                    <div class="relative my-6">
                        <div class="absolute inset-0 flex items-center"><div class="w-full border-t border-white/10"></div></div>
                        <div class="relative flex justify-center text-sm"><span class="px-4 bg-slate-800 text-slate-400">${t('orContinueWith')}</span></div>
                    </div>
                    
                    <button onclick="handleGoogleLogin()" class="btn btn-ghost w-full py-4 border border-white/20 flex items-center justify-center gap-3">
                        <svg class="w-5 h-5" viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
                        ${t('continueWithGoogle')}
                    </button>
                    
                    <p class="text-center text-slate-400 text-sm mt-6">
                        ${t('alreadyAccount')} 
                        <button onclick="state.authScreen='login';state.authError=null;render();" class="text-sky-400 hover:underline">${t('loginNow')}</button>
                    </p>
                    
                    <div class="mt-6 pt-4 border-t border-white/10 text-center text-xs text-slate-500">
                        <p class="mb-2">${t('acceptTerms')}</p>
                        <div class="flex flex-wrap justify-center gap-2">
                            <button onclick="state.legalPage='cgu';render();" class="text-sky-400 hover:underline">${t('termsOfService')}</button>
                            <span>‚Ä¢</span>
                            <button onclick="state.legalPage='privacy';render();" class="text-sky-400 hover:underline">${t('privacyPolicy')}</button>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function renderForgotPasswordForm() {
            return `
                <div class="space-y-4">
                    <h2 class="text-xl font-bold text-center mb-6">${t('resetPassword')}</h2>
                    
                    ${state.authError ? `
                        <div class="p-3 rounded-xl ${state.authError.includes('envoy√©') || state.authError.includes('sent') ? 'bg-emerald-500/20 border-emerald-500/30 text-emerald-400' : 'bg-red-500/20 border-red-500/30 text-red-400'} border text-sm text-center">
                            ${state.authError}
                        </div>
                    ` : ''}
                    
                    <p class="text-slate-400 text-sm text-center">
                        ${state.lang === 'fr' ? 'Entre ton email pour recevoir un lien de r√©initialisation' : 'Enter your email to receive a reset link'}
                    </p>
                    
                    <div>
                        <label class="block text-sm font-medium text-slate-300 mb-2">${t('email')}</label>
                        <input type="email" id="auth-email" class="input-modern" placeholder="email@exemple.com" value="${state.authEmail}" oninput="state.authEmail=this.value" />
                    </div>
                    
                    <button onclick="handleForgotPassword()" class="btn btn-primary w-full py-4 text-lg" ${state.authLoading ? 'disabled' : ''}>
                        ${state.authLoading ? '‚è≥' : ''} ${t('resetPassword')}
                    </button>
                    
                    <button onclick="state.authScreen='login';state.authError=null;render();" class="text-sky-400 text-sm text-center w-full hover:underline">
                        ‚Üê ${t('login')}
                    </button>
                </div>
            `;
        }
        
        function renderProfileSetup() {
            const avatars = ['üë§', 'üë®', 'üë©', 'üßë', 'üë±‚Äç‚ôÇÔ∏è', 'üë±‚Äç‚ôÄÔ∏è', 'üë®‚Äçü¶∞', 'üë©‚Äçü¶∞', 'üßî', 'üë©‚Äçüé§', 'üßë‚Äçüé§', 'üßù‚Äç‚ôÄÔ∏è'];
            return `
                <div class="min-h-screen flex items-center justify-center p-4" style="background: radial-gradient(ellipse at top, #1e3a5f 0%, #0f172a 50%, #000 100%);">
                    <div class="card p-8 max-w-md w-full text-center">
                        <div class="text-6xl mb-4">üéâ</div>
                        <h1 class="text-2xl font-bold mb-2">${state.lang === 'fr' ? 'Bienvenue !' : 'Welcome!'}</h1>
                        <p class="text-slate-400 mb-6">${state.lang === 'fr' ? 'Personnalise ton profil' : 'Customize your profile'}</p>
                        
                        <div class="mb-6">
                            <label class="block text-sm font-medium text-slate-300 mb-3">${t('chooseAvatar')}</label>
                            <div class="flex flex-wrap gap-2 justify-center">
                                ${avatars.map(a => `<div class="avatar-option ${state.selectedAvatar === a ? 'selected' : ''}" onclick="selectAvatar('${a}')">${a}</div>`).join('')}
                            </div>
                        </div>
                        
                        <div class="mb-6 text-left">
                            <label class="block text-sm font-medium text-slate-300 mb-2">${t('yourUsername')}</label>
                            <input type="text" id="username-input" class="input-modern" placeholder="Ex: Alex_Voyageur" value="${state.tempUsername || ''}" oninput="state.tempUsername=this.value" />
                        </div>
                        
                        <button onclick="completeProfileSetup()" class="btn btn-primary w-full text-lg py-4">${t('letsGo')}</button>
                    </div>
                </div>
            `;
        }

        // ==================== FIL D'ACTUALIT√â ====================
        
        function renderHome() {
            // Activit√©s r√©centes des amis (simul√©)
            const activities = [
                { user: 'Marie_Adventure', avatar: 'üë©‚Äçü¶∞', action: 'sharedSpot', spot: 3, time: '2h' },
                { user: 'Tom_Roadtrip', avatar: 'üßî', action: 'checkedIn', spot: 8, time: '5h' },
                { user: 'Sophie_Nomad', avatar: 'üë±‚Äç‚ôÄÔ∏è', action: 'earnedBadge', badge: 'üèÜ', time: '1j' }
            ];
            
            // Spots populaires
            const popularSpots = [...state.spots].sort((a, b) => b.checkins - a.checkins).slice(0, 3);
            
            return `
                <div class="space-y-4">
                    <!-- Bienvenue -->
                    <div class="card p-6 fade-in text-center bg-gradient-to-r from-sky-500/10 to-emerald-500/10">
                        <h2 class="text-2xl font-bold mb-2">${state.lang === 'fr' ? 'Salut' : 'Hey'} ${escapeHtml(state.user?.username) || 'Voyageur'} ! üëã</h2>
                        <p class="text-slate-400">${state.lang === 'fr' ? 'Pr√™t pour l\'aventure ?' : 'Ready for adventure?'}</p>
                    </div>
                    
                    <!-- Activit√© des amis -->
                    <div class="card p-5 fade-in stagger-1">
                        <h3 class="font-bold mb-4 flex items-center gap-2">
                            <span class="text-xl">üë•</span>
                            ${t('friendsActivity')}
                        </h3>
                        <div class="space-y-3">
                            ${activities.map(act => {
                                const spot = state.spots.find(s => s.id === act.spot);
                                return `
                                    <div class="flex items-center gap-3 p-3 rounded-xl bg-white/5 hover:bg-white/10 transition-all cursor-pointer" onclick="if(${act.spot}){state.selectedSpot=${act.spot};render();}">
                                        <span class="text-3xl">${act.avatar}</span>
                                        <div class="flex-1">
                                            <p class="text-sm">
                                                <span class="font-bold">${act.user}</span>
                                                <span class="text-slate-400"> ${t(act.action)}</span>
                                                ${act.spot && spot ? ` <span class="text-sky-400">${spot.from} ‚Üí ${spot.to}</span>` : ''}
                                                ${act.badge ? ` ${act.badge}` : ''}
                                            </p>
                                            <p class="text-xs text-slate-500">${act.time}</p>
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                    
                    <!-- Spots populaires -->
                    <div class="card p-5 fade-in stagger-2">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="font-bold flex items-center gap-2">
                                <span class="text-xl">üî•</span>
                                ${t('popularSpots')}
                            </h3>
                            <button onclick="state.activeTab='spots';render();" class="text-sm text-sky-400 hover:underline">
                                ${state.lang === 'fr' ? 'Voir tout' : 'See all'} ‚Üí
                            </button>
                        </div>
                        <div class="grid gap-3">
                            ${popularSpots.map(spot => `
                                <div onclick="state.selectedSpot=${spot.id};render();" class="flex gap-3 p-3 rounded-xl bg-white/5 hover:bg-white/10 transition-all cursor-pointer">
                                    <img src="${spot.photoUrl}" class="w-20 h-20 rounded-lg object-cover" />
                                    <div class="flex-1">
                                        <div class="flex items-center gap-2 mb-1">
                                            <span class="font-bold">${spot.from}</span>
                                            <span class="text-sky-400">‚Üí</span>
                                            <span class="font-bold">${spot.to}</span>
                                        </div>
                                        <div class="flex items-center gap-3 text-sm text-slate-400">
                                            <span>‚≠ê ${spot.globalRating.toFixed(1)}</span>
                                            <span>üì∏ ${spot.checkins}</span>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
        }
        
        // ==================== SPOTS & CARTE ====================
        
        function renderSpotsAndMap() {
            return `
                <div class="space-y-4">
                    <!-- Recherche et filtres -->
                    <div class="card p-4 fade-in">
                        <div class="relative mb-4">
                            <input type="text" id="search-input" class="input-modern pl-12 pr-12" placeholder="${t('searchSpot')}" value="${state.searchQuery}" oninput="handleSearch(this.value)" />
                            <span class="absolute left-4 top-1/2 -translate-y-1/2 text-xl">üîç</span>
                            <button onclick="state.showFilters=true;render();" aria-label="Ouvrir les filtres" class="absolute right-3 top-1/2 -translate-y-1/2 p-2 rounded-lg hover:bg-white/10">
                                <span class="text-lg">‚öôÔ∏è</span>
                            </button>
                        </div>
                        
                        <!-- Filtres rapides -->
                        <div class="flex gap-2 overflow-x-auto pb-2">
                            ${['all', 'top', 'recent', 'nearby'].map(f => `
                                <button onclick="state.activeFilter='${f}';render();" class="badge ${state.activeFilter === f ? 'badge-success' : 'badge-primary'} cursor-pointer whitespace-nowrap">
                                    ${f === 'all' ? 'üìç' : f === 'top' ? 'üî•' : f === 'recent' ? 'üïê' : 'üì°'} ${t('filter' + f.charAt(0).toUpperCase() + f.slice(1))}
                                </button>
                            `).join('')}
                        </div>
                    </div>
                    
                    ${renderMap()}
                </div>
            `;
        }

        function renderHeader() {
            const tutoZ = state.showTutorial ? 'z-index: 101;' : '';
            return `
                <header class="glass-dark sticky top-0 z-40" style="${tutoZ}">
                    <div class="max-w-6xl mx-auto px-4 py-3 flex items-center justify-between">
                        <div class="flex items-center gap-2" onclick="state.activeTab='home';render();" style="cursor:pointer;">
                            <div class="w-9 h-9 rounded-xl bg-gradient-to-br from-sky-500 to-emerald-500 flex items-center justify-center">
                                <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/>
                                </svg>
                            </div>
                            <span class="text-lg font-bold tracking-tight">${t('appName')}</span>
                        </div>
                        <div class="flex items-center gap-3">
                            <button id="btn-sos" onclick="state.showSOS=true;render();" class="sos-header-btn">
                                SOS
                            </button>
                            <button onclick="state.activeTab='profile';render();" class="flex items-center gap-2 p-2 rounded-xl hover:bg-white/10 transition-all">
                                <span class="text-2xl">${state.user?.avatar || 'üë§'}</span>
                            </button>
                        </div>
                    </div>
                </header>
            `;
        }

        function renderSideMenu() {
            const items = [
                { id: 'spots', icon: 'üìç', label: t('spots') },
                { id: 'map', icon: 'üó∫Ô∏è', label: t('map') },
                { id: 'planner', icon: 'üß≠', label: t('planner') },
                { id: 'chat', icon: 'üí¨', label: t('chat') },
                { id: 'friends', icon: 'üë•', label: t('friends') },
                { id: 'quiz', icon: 'üß†', label: t('quiz') },
                { id: 'guides', icon: 'üìö', label: t('guides') },
                { id: 'safety', icon: 'üõ°Ô∏è', label: t('safety') },
                { id: 'missions', icon: 'üéØ', label: t('missions') }
            ];
            return `
                <div class="fixed inset-0 z-50" onclick="state.showMenu=false;render();">
                    <div class="absolute inset-0 bg-black/60"></div>
                    <div class="absolute left-0 top-0 bottom-0 w-72 glass-dark p-6 slide-up" onclick="event.stopPropagation();">
                        <div class="flex items-center gap-3 mb-8">
                            <span class="text-4xl">${state.user?.avatar}</span>
                            <div>
                                <p class="font-bold">${state.user?.username}</p>
                                <p class="text-sm text-slate-400">${t('level')} ${state.user?.level || 1}</p>
                            </div>
                        </div>
                        <nav class="space-y-2">
                            ${items.map(item => `
                                <button onclick="changeTab('${item.id}')" class="w-full flex items-center gap-4 p-4 rounded-xl transition-all ${state.activeTab === item.id ? 'bg-sky-500/20 text-sky-300' : 'hover:bg-white/5'}">
                                    <span class="text-xl">${item.icon}</span><span class="font-medium">${item.label}</span>
                                </button>
                            `).join('')}
                        </nav>
                    </div>
                </div>
            `;
        }

        function renderBottomNav() {
            const tabs = [
                { id: 'home', icon: 'üè†', label: t('home') },
                { id: 'spots', icon: 'üó∫Ô∏è', label: t('spotsMap') },
                { id: 'planner', icon: 'üß≠', label: t('planner') },
                { id: 'chat', icon: 'üí¨', label: t('chat') },
                { id: 'profile', icon: 'üë§', label: t('profile') }
            ];
            const tutoZ = state.showTutorial ? 'z-index: 101;' : '';
            return `
                <nav class="fixed bottom-0 left-0 right-0 glass-dark z-40 safe-area-bottom" style="${tutoZ}">
                    <div class="max-w-6xl mx-auto px-2 py-2 flex items-center justify-around">
                        ${tabs.map(tab => `
                            <button id="nav-${tab.id}" onclick="changeTab('${tab.id}')" class="flex flex-col items-center gap-1 py-2 px-4 rounded-2xl transition-all min-w-[60px] ${state.activeTab === tab.id ? 'bg-sky-500/20 text-sky-300' : 'text-slate-400 hover:text-white'}">
                                <span class="text-xl">${tab.icon}</span>
                                <span class="text-[10px] font-medium">${tab.label}</span>
                            </button>
                        `).join('')}
                    </div>
                </nav>
            `;
        }

        function renderFAB() {
            // Afficher sur home et spots
            if (state.activeTab !== 'home' && state.activeTab !== 'spots') return '';
            const tutoZ = state.showTutorial ? 'z-index: 101;' : '';
            return `<button id="fab-add" onclick="state.showAddSpot=true;state.addSpotStep=1;render();" class="fab" style="${tutoZ}" title="${t('addSpot')}">‚ûï</button>`;
        }

        function renderSOSModal() {
            return `
                <div class="fixed inset-0 z-50 flex items-center justify-center p-4">
                    <div class="absolute inset-0 bg-black/80" onclick="state.showSOS=false;render();"></div>
                    <div class="card p-6 max-w-md w-full relative z-10 fade-in border-red-500/30">
                        <div class="text-center mb-6">
                            <div class="text-6xl mb-4">üÜò</div>
                            <h2 class="text-2xl font-bold text-red-400">${t('sosTitle')}</h2>
                            <p class="text-slate-400 text-sm mt-2">${t('sosDesc')}</p>
                        </div>
                        <div class="space-y-3 mb-6">
                            ${state.isSharingLocation ? `
                                <button onclick="state.isSharingLocation=false;render();" class="btn btn-ghost w-full py-4 border-2 border-red-500/50">
                                    <span class="live-dot"></span> ${t('stopSharing')}
                                </button>
                            ` : `
                                <button onclick="state.isSharingLocation=true;showToast(t('locationShared'));render();" class="btn btn-danger w-full py-4">
                                    üìç ${t('shareLocation')}
                                </button>
                            `}
                            <a href="tel:112" class="btn btn-primary w-full py-4 block text-center">üìû ${t('callEmergency')} (112)</a>
                        </div>
                        <div class="mb-6">
                            <h3 class="font-bold mb-3">${t('emergencyContacts')}</h3>
                            ${state.emergencyContacts.length === 0 ? `<p class="text-slate-500 text-sm text-center py-4">Aucun contact</p>` : 
                                state.emergencyContacts.map(c => `
                                    <div class="flex items-center gap-3 p-3 rounded-xl bg-white/5 mb-2">
                                        <span class="text-2xl">üë§</span>
                                        <div class="flex-1"><p class="font-medium">${c.name}</p><p class="text-sm text-slate-400">${c.phone}</p></div>
                                        <a href="tel:${c.phone}" class="btn btn-ghost px-3 py-2">üìû</a>
                                    </div>
                                `).join('')}
                            <button onclick="addEmergencyContact()" class="btn btn-ghost w-full mt-2">‚ûï ${t('addContact')}</button>
                        </div>
                        <button onclick="state.showSOS=false;render();" class="btn btn-success w-full py-4">‚úì ${t('iAmSafe')}</button>
                    </div>
                </div>
            `;
        }

        function renderSpots() {
            let spots = [...state.spots];
            if (state.searchQuery) {
                const q = state.searchQuery.toLowerCase();
                spots = spots.filter(s => s.from.toLowerCase().includes(q) || s.to.toLowerCase().includes(q));
            }
            if (state.activeFilter === 'top') spots = spots.filter(s => getSpotType(s) === 'top');
            else if (state.activeFilter === 'recent') spots = spots.filter(s => (new Date() - new Date(s.lastUsed)) / 86400000 < 7);
            else if (state.activeFilter === 'nearby' && state.userLocation) spots = spots.filter(s => Geo.calculateDistance(state.userLocation.lat, state.userLocation.lng, s.coordinates.lat, s.coordinates.lng) <= 100);
            
            // Filtre par pays
            if (state.filterCountry && state.filterCountry !== 'all') {
                spots = spots.filter(s => s.country === state.filterCountry);
            }
            
            if (state.sortBy === 'rating') spots.sort((a, b) => b.globalRating - a.globalRating);
            else if (state.sortBy === 'recent') spots.sort((a, b) => new Date(b.lastUsed) - new Date(a.lastUsed));
            else if (state.sortBy === 'popular') spots.sort((a, b) => b.checkins - a.checkins);
            
            // Appliquer les filtres avanc√©s
            if (state.filterMinRating > 0) {
                spots = spots.filter(s => s.globalRating >= state.filterMinRating);
            }
            if (state.filterMaxWait < 60) {
                spots = spots.filter(s => s.avgWaitTime <= state.filterMaxWait);
            }
            
            if (state.userLocation) spots = spots.map(s => ({ ...s, distance: Geo.calculateDistance(state.userLocation.lat, state.userLocation.lng, s.coordinates.lat, s.coordinates.lng) }));
            
            // Message si filtre "nearby" sans GPS
            const showGpsMessage = state.activeFilter === 'nearby' && !state.userLocation;
            
            // Liste des pays disponibles
            const countries = [...new Set(state.spots.map(s => s.country).filter(Boolean))].sort();
            const countryFlags = { FR: 'üá´üá∑', DE: 'üá©üá™', BE: 'üáßüá™', NL: 'üá≥üá±', ES: 'üá™üá∏', IT: 'üáÆüáπ', PL: 'üáµüá±', PT: 'üáµüáπ', AT: 'üá¶üáπ', CH: 'üá®üá≠', CZ: 'üá®üáø', IE: 'üáÆüá™', HR: 'üá≠üá∑' };
            
            return `
                <div class="space-y-4">
                    <!-- Recherche et filtres -->
                    <div class="card p-4 fade-in">
                        <div class="relative mb-4">
                            <input type="text" id="search-input" class="input-modern pl-12 pr-12" placeholder="${t('searchSpot')}" value="${state.searchQuery}" oninput="handleSearch(this.value)" />
                            <span class="absolute left-4 top-1/2 -translate-y-1/2 text-xl">üîç</span>
                            <button onclick="state.showFilters=true;render();" aria-label="Ouvrir les filtres" class="absolute right-3 top-1/2 -translate-y-1/2 p-2 rounded-lg hover:bg-white/10">
                                <span class="text-lg">‚öôÔ∏è</span>
                            </button>
                        </div>
                        
                        <!-- Filtres par type -->
                        <div class="flex gap-2 overflow-x-auto pb-2 mb-3">
                            ${['all', 'top', 'recent', 'nearby'].map(f => `
                                <button onclick="state.activeFilter='${f}';render();" class="badge ${state.activeFilter === f ? 'badge-success' : 'badge-primary'} cursor-pointer whitespace-nowrap">
                                    ${f === 'all' ? 'üìç' : f === 'top' ? 'üî•' : f === 'recent' ? 'üïê' : 'üì°'} ${t('filter' + f.charAt(0).toUpperCase() + f.slice(1))}
                                </button>
                            `).join('')}
                            <button onclick="state.activeTab='offline';render();" class="badge badge-warning cursor-pointer whitespace-nowrap">
                                üì• ${t('offline')} (${state.savedSpots.length})
                            </button>
                        </div>
                        
                        <!-- Filtres par pays -->
                        <div class="flex gap-2 overflow-x-auto pb-1">
                            <button onclick="state.filterCountry='all';render();" class="badge ${!state.filterCountry || state.filterCountry === 'all' ? 'badge-success' : 'badge-ghost'} cursor-pointer whitespace-nowrap text-xs">
                                üåç ${state.lang === 'fr' ? 'Tous' : 'All'}
                            </button>
                            ${countries.map(c => `
                                <button onclick="state.filterCountry='${c}';render();" class="badge ${state.filterCountry === c ? 'badge-success' : 'badge-ghost'} cursor-pointer whitespace-nowrap text-xs">
                                    ${countryFlags[c] || 'üè≥Ô∏è'} ${c}
                                </button>
                            `).join('')}
                        </div>
                    </div>
                    
                    <!-- Compteur de spots -->
                    <div class="text-sm text-slate-400 px-1">
                        ${spots.length} spot${spots.length > 1 ? 's' : ''} ${state.filterCountry && state.filterCountry !== 'all' ? `${state.lang === 'fr' ? 'en' : 'in'} ${countryFlags[state.filterCountry] || ''} ${state.filterCountry}` : ''}
                    </div>
                    
                    <!-- Message GPS si besoin -->
                    ${showGpsMessage ? `
                        <div class="gps-message fade-in">
                            <span class="text-3xl">üìç</span>
                            <div class="flex-1">
                                <p class="font-medium">${t('gpsDisabled')}</p>
                            </div>
                            <button onclick="getUserLocation().then(render)" class="btn btn-primary py-2 px-4 text-sm">
                                ${t('gpsActivate')}
                            </button>
                        </div>
                    ` : ''}
                    
                    <!-- Liste des spots -->
                    ${spots.length === 0 && !showGpsMessage ? `
                        <div class="card p-12 text-center">
                            <div class="text-6xl mb-4">üìç</div>
                            <h3 class="text-xl font-bold mb-2">${t('noSpots')}</h3>
                            <p class="text-slate-400">${t('beFirst')}</p>
                        </div>
                    ` : `
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            ${spots.map((spot, i) => {
                                const type = getSpotType(spot);
                                const colors = { top: 'spot-type-top', good: 'spot-type-good', new: 'spot-type-new', old: 'spot-type-old' };
                                const weather = getWeatherForSpot(spot.id);
                                const isSaved = state.savedSpots.includes(spot.id);
                                const validationCount = state.spotValidations[spot.id] || 0;
                                const isVerified = validationCount >= 5 || spot.verified;
                                return `
                                    <div ${i === 0 ? 'id="first-spot-card"' : ''} onclick="state.selectedSpot=${spot.id};render();" class="spot-card-simple fade-in stagger-${Math.min(i + 1, 4)}">
                                        <div class="relative">
                                            <img src="${spot.photoUrl}" class="w-full h-44 object-cover" onerror="this.src='https://images.unsplash.com/photo-1469854523086-cc02fe5d8800?w=600'" />
                                            <span class="spot-type-badge ${colors[type]}">${type === 'top' ? 'üî• Top' : type === 'new' ? '‚ú® New' : ''}</span>
                                            <span class="absolute top-3 right-3 px-2 py-1 rounded-lg bg-black/50 text-sm">${weather.icon} ${weather.temp}¬∞</span>
                                            ${spot.distance ? `<span class="absolute bottom-3 right-3 badge badge-primary">${Geo.formatDistance(spot.distance)}</span>` : ''}
                                            ${isSaved ? `<span class="absolute bottom-3 left-3 text-emerald-400">üì•</span>` : ''}
                                        </div>
                                        <div class="p-4">
                                            <div class="flex items-center gap-2 mb-3">
                                                <h3 class="font-bold text-lg">${spot.from}</h3>
                                                <span class="text-sky-400">‚Üí</span>
                                                <h3 class="font-bold text-lg">${spot.to}</h3>
                                                ${isVerified ? '<span class="px-2 py-0.5 rounded-full bg-emerald-500/20 text-emerald-400 text-xs font-bold">‚úì V√©rifi√©</span>' : `<span class="text-xs text-slate-500">${validationCount}/5</span>`}
                                            </div>
                                            <div class="flex items-center justify-between">
                                                <div class="flex items-center gap-4">
                                                    <span class="text-amber-400 font-bold">‚≠ê ${spot.globalRating.toFixed(1)}</span>
                                                    <span class="text-slate-400">‚è±Ô∏è ~${spot.avgWaitTime}min</span>
                                                </div>
                                                <span class="text-slate-500 text-sm">${spot.totalReviews} ${t('reviews')}</span>
                                            </div>
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    `}
                </div>
            `;
        }

        function renderSpotDetail() {
            const spot = state.spots.find(s => s.id === state.selectedSpot);
            if (!spot) return '';
            const weather = getWeatherForSpot(spot.id);
            const spotComments = state.comments.filter(c => c.spotId === spot.id);
            const isSaved = state.savedSpots.includes(spot.id);
            const validationCount = state.spotValidations[spot.id] || 0;
            const hasValidated = state.validatedByMe.includes(spot.id);
            const isMySpot = spot.creator === state.user?.username;
            const isVerified = validationCount >= 5;
            
            return `
                <div class="fixed inset-0 z-50 flex items-end sm:items-center justify-center" onclick="if(event.target===this){state.selectedSpot=null;render();}">
                    <div class="absolute inset-0 bg-black/70"></div>
                    <div class="card w-full sm:max-w-2xl max-h-[90vh] overflow-y-auto relative z-10 slide-up sm:rounded-2xl rounded-t-3xl">
                        <div class="relative">
                            <img src="${spot.photoUrl}" class="w-full h-56 object-cover" />
                            <button onclick="state.selectedSpot=null;render();" class="absolute top-4 right-4 w-10 h-10 rounded-full bg-black/50 text-white text-xl flex items-center justify-center" aria-label="Fermer">√ó</button>
                            <div class="absolute top-4 left-4 px-3 py-2 rounded-xl bg-black/50 flex items-center gap-2">
                                <span class="text-xl">${weather.icon}</span>
                                <span class="font-bold">${weather.temp}¬∞C</span>
                            </div>
                            ${isVerified ? `
                                <div class="absolute top-4 left-1/2 -translate-x-1/2 px-3 py-1 rounded-full bg-emerald-500/90 text-white text-sm font-bold flex items-center gap-1">
                                    ‚úì ${t('validatedSpot')}
                                </div>
                            ` : ''}
                            <div class="absolute bottom-4 left-4 right-4">
                                <h2 class="text-2xl font-bold text-white drop-shadow-lg">${spot.from} ‚Üí ${spot.to}</h2>
                            </div>
                        </div>
                        <div class="p-5">
                            <!-- Barre de validation -->
                            <div class="p-4 rounded-xl ${isVerified ? 'bg-emerald-500/20 border border-emerald-500/30' : 'bg-amber-500/10 border border-amber-500/20'} mb-4">
                                <div class="flex items-center justify-between mb-2">
                                    <div class="flex items-center gap-2">
                                        <span class="text-xl">${isVerified ? '‚úÖ' : 'üîÑ'}</span>
                                        <span class="font-medium">${isVerified ? t('validatedSpot') : t('pendingValidation')}</span>
                                    </div>
                                    <span class="text-sm text-slate-400">${validationCount}/5 ${t('validations')}</span>
                                </div>
                                <div class="progress-bar mb-3">
                                    <div class="progress-fill ${isVerified ? 'bg-emerald-500' : 'bg-amber-500'}" style="width: ${Math.min(validationCount / 5 * 100, 100)}%"></div>
                                </div>
                                ${!isMySpot && !hasValidated ? `
                                    <button onclick="validateSpot(${spot.id})" class="btn btn-primary w-full py-3">
                                        ‚úì ${t('validate')} (+5 pts pour toi, +5 pts pour ${spot.creator})
                                    </button>
                                ` : hasValidated ? `
                                    <p class="text-center text-emerald-400 text-sm">‚úì ${t('validated')}</p>
                                ` : `
                                    <p class="text-center text-slate-400 text-sm">${state.lang === 'fr' ? 'C\'est ton spot' : 'This is your spot'}</p>
                                `}
                            </div>
                            
                            <!-- Actions rapides -->
                            <div class="grid grid-cols-3 gap-2 mb-4">
                                <button onclick="toggleSaveSpot(${spot.id})" class="btn ${isSaved ? 'btn-success' : 'btn-ghost'} py-3">
                                    ${isSaved ? '‚úì ' + t('savedOffline') : 'üì• ' + t('saveOffline')}
                                </button>
                                <button onclick="openNavigation(${spot.coordinates.lat}, ${spot.coordinates.lng})" class="btn btn-primary py-3">
                                    üß≠ GPS
                                </button>
                                <button onclick="shareSpot(${spot.id})" class="btn btn-ghost py-3">
                                    üì§ ${t('share')}
                                </button>
                            </div>
                            
                            <!-- Bouton signaler -->
                            <button onclick="openReportModal('spot', ${spot.id}, '${escapeHtml(spot.from)} ‚Üí ${escapeHtml(spot.to)}')" class="w-full mb-4 p-3 rounded-xl bg-slate-800/50 text-slate-400 hover:text-red-400 hover:bg-red-500/10 text-sm flex items-center justify-center gap-2 transition-all">
                                üö© ${t('report')}
                            </button>
                            
                            <p class="text-slate-300 mb-4">${escapeHtml(spot.description)}</p>
                            
                            <div class="flex items-center gap-3 mb-4 p-3 rounded-xl bg-white/5">
                                <span class="text-3xl">${spot.creatorAvatar}</span>
                                <div class="flex-1"><p class="font-medium">${spot.creator}</p><p class="text-sm text-slate-400">${formatDate(spot.createdAt)}</p></div>
                            </div>
                            
                            <div class="grid grid-cols-4 gap-2 mb-4">
                                <div class="p-3 rounded-xl bg-white/5 text-center"><p class="text-xl mb-1">‚≠ê</p><p class="font-bold text-sm">${spot.globalRating.toFixed(1)}</p></div>
                                <div class="p-3 rounded-xl bg-white/5 text-center"><p class="text-xl mb-1">‚è±Ô∏è</p><p class="font-bold text-sm">~${spot.avgWaitTime}m</p></div>
                                <div class="p-3 rounded-xl bg-white/5 text-center"><p class="text-xl mb-1">üì∏</p><p class="font-bold text-sm">${spot.checkins}</p></div>
                                <div class="p-3 rounded-xl ${isVerified ? 'bg-emerald-500/20' : 'bg-white/5'} text-center"><p class="text-xl mb-1">‚úì</p><p class="font-bold text-sm">${validationCount}</p></div>
                            </div>
                            
                            <div class="p-4 rounded-xl bg-white/5 mb-4">
                                <h4 class="font-bold mb-3">${t('rating')}</h4>
                                ${['accessibility', 'safety', 'visibility', 'traffic'].map(key => `
                                    <div class="flex items-center gap-3 mb-2">
                                        <span class="text-sm text-slate-400 w-24">${t(key === 'safety' ? 'safetyRating' : key)}</span>
                                        <div class="flex-1 progress-bar"><div class="progress-fill" style="width: ${(spot.ratings[key] / 5) * 100}%"></div></div>
                                        <span class="text-sm font-medium w-8">${spot.ratings[key].toFixed(1)}</span>
                                    </div>
                                `).join('')}
                            </div>
                            
                            <!-- Commentaires -->
                            <div class="p-4 rounded-xl bg-white/5 mb-4">
                                <div class="flex items-center justify-between mb-3">
                                    <h4 class="font-bold">üí¨ ${t('comments')} (${spotComments.length})</h4>
                                </div>
                                ${spotComments.length === 0 ? `
                                    <p class="text-slate-500 text-sm text-center py-3">${t('noComments')}</p>
                                ` : `
                                    <div class="space-y-3 max-h-40 overflow-y-auto mb-3">
                                        ${spotComments.slice(0, 3).map(c => `
                                            <div class="flex gap-3 p-2 rounded-lg bg-white/5">
                                                <span class="text-2xl">${c.avatar}</span>
                                                <div class="flex-1">
                                                    <div class="flex items-center gap-2">
                                                        <span class="font-medium text-sm">${c.user}</span>
                                                        <span class="text-slate-500 text-xs">${c.date}</span>
                                                    </div>
                                                    <p class="text-sm text-slate-300">${c.text}</p>
                                                    <button onclick="likeComment(${c.id})" class="text-xs text-slate-400 mt-1">‚ù§Ô∏è ${c.likes}</button>
                                                </div>
                                            </div>
                                        `).join('')}
                                    </div>
                                `}
                                <div class="flex gap-2">
                                    <input type="text" id="new-comment" class="input-modern flex-1 text-sm py-2" placeholder="${t('writeComment')}" />
                                    <button onclick="addComment(${spot.id})" class="btn btn-primary px-4 py-2">üì§</button>
                                </div>
                            </div>
                            
                            <div class="flex gap-3">
                                <button onclick="doCheckin(${spot.id})" class="btn btn-success flex-1 py-3">üì∏ ${t('checkin')}</button>
                                <button onclick="state.showRateSpot=true;render();" class="btn btn-primary flex-1 py-3">‚≠ê ${t('rate')}</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderMap() {
            return `
                <div class="space-y-4">
                    <div class="card p-4 fade-in">
                        <div class="flex items-center justify-between mb-4">
                            <h2 class="text-xl font-bold">üó∫Ô∏è ${t('map')}</h2>
                            ${!state.userLocation ? `
                                <button onclick="getUserLocation().then(()=>{if(state.mapInstance)state.mapInstance.remove();state.mapInstance=null;render();})" class="btn btn-primary text-sm py-2">
                                    ${state.isLocating ? '‚è≥' : 'üìç'} GPS
                                </button>
                            ` : '<span class="badge badge-success">üìç GPS OK</span>'}
                        </div>
                        <div class="flex flex-wrap gap-3 text-sm">
                            <div class="flex items-center gap-2"><div class="w-4 h-4 rounded-full bg-red-500"></div><span class="text-slate-400">${t('topSpot')}</span></div>
                            <div class="flex items-center gap-2"><div class="w-4 h-4 rounded-full bg-emerald-500"></div><span class="text-slate-400">${t('goodSpot')}</span></div>
                            <div class="flex items-center gap-2"><div class="w-4 h-4 rounded-full bg-amber-500"></div><span class="text-slate-400">${t('newSpot')}</span></div>
                            <div class="flex items-center gap-2"><div class="w-4 h-4 rounded-full bg-slate-500"></div><span class="text-slate-400">${t('oldSpot')}</span></div>
                        </div>
                    </div>
                    <div class="card overflow-hidden fade-in stagger-1" style="height: 500px;"><div id="map"></div></div>
                </div>
            `;
        }

        function initMap() {
            const el = document.getElementById('map');
            if (!el) return;
            
            // Si la carte existe mais l'√©l√©ment DOM a chang√©, supprimer l'ancienne
            if (state.mapInstance) {
                try {
                    if (!state.mapInstance.getContainer() || !document.body.contains(state.mapInstance.getContainer())) {
                        state.mapInstance.remove();
                        state.mapInstance = null;
                    } else {
                        return;
                    }
                } catch (e) {
                    state.mapInstance = null;
                }
            }
            
            let center = [48.85, 2.35], zoom = 5;
            if (state.userLocation) { center = [state.userLocation.lat, state.userLocation.lng]; zoom = 8; }
            state.mapInstance = L.map('map').setView(center, zoom);
            
            // Tuiles avec support Stadia Maps
            L.tileLayer(getMapTileUrl(state.theme), { 
                attribution: getMapAttribution(),
                maxZoom: 19
            }).addTo(state.mapInstance);
            
            // Position utilisateur
            if (state.userLocation) {
                const icon = L.divIcon({ className: 'custom-marker marker-user', html: 'üìç', iconSize: [36, 36], iconAnchor: [18, 18] });
                L.marker([state.userLocation.lat, state.userLocation.lng], { icon }).addTo(state.mapInstance).bindPopup('<b>Toi</b>');
            }
            
            // Clustering des spots
            const markers = L.markerClusterGroup({
                chunkedLoading: true,
                maxClusterRadius: 50,
                spiderfyOnMaxZoom: true,
                showCoverageOnHover: false
            });
            
            state.spots.forEach(spot => {
                const type = getSpotType(spot);
                const cls = { top: 'marker-top', good: 'marker-good', new: 'marker-new', old: 'marker-old' }[type];
                const icon = L.divIcon({ className: `custom-marker ${cls}`, html: `<span style="font-size:14px;">${spot.globalRating.toFixed(1)}</span>`, iconSize: [36, 36], iconAnchor: [18, 18] });
                const marker = L.marker([spot.coordinates.lat, spot.coordinates.lng], { icon });
                marker.bindPopup(`<div style="min-width:200px;"><img src="${spot.photoUrl}" loading="lazy" style="width:100%;height:80px;object-fit:cover;border-radius:8px;margin-bottom:8px;"/><h3 style="font-weight:bold;">${spot.from} ‚Üí ${spot.to}</h3><p style="font-size:12px;color:#94a3b8;">‚≠ê ${spot.globalRating.toFixed(1)} ‚Ä¢ ‚è±Ô∏è ~${spot.avgWaitTime}min</p><button onclick="state.selectedSpot='${spot.id}';render();" style="width:100%;padding:8px;background:linear-gradient(135deg,#0ea5e9,#0284c7);color:white;border:none;border-radius:8px;cursor:pointer;font-weight:600;margin-top:8px;">Voir</button></div>`);
                markers.addLayer(marker);
            });
            
            state.mapInstance.addLayer(markers);
        }

        function renderPlanner() {
            // Calculer les spots entre d√©part et arriv√©e
            let routeSpots = [];
            if (state.plannerSteps[0].city && state.plannerSteps[state.plannerSteps.length - 1].city) {
                routeSpots = getSpotsBetween(state.plannerSteps[0].city, state.plannerSteps[state.plannerSteps.length - 1].city);
            }
            
            return `
                <div class="space-y-4">
                    <div class="card p-5 fade-in">
                        <h2 class="text-xl font-bold mb-4">üß≠ ${t('planTrip')}</h2>
                        <div class="space-y-4">
                            ${state.plannerSteps.map((step, i) => `
                                <div class="trip-step">
                                    <div class="trip-step-dot" style="${i === 0 ? 'background:#0ea5e9;' : i === state.plannerSteps.length - 1 ? 'background:#10b981;' : ''}"></div>
                                    <div class="flex gap-2">
                                        <input type="text" class="input-modern flex-1" placeholder="${i === 0 ? t('startCity') : i === state.plannerSteps.length - 1 ? t('endCity') : '√âtape ' + i}" value="${step.city}" oninput="updatePlannerStep(${i}, this.value)" />
                                        ${i > 0 && i < state.plannerSteps.length - 1 ? `<button onclick="removePlannerStep(${i})" class="btn btn-ghost px-3 text-red-400" aria-label="Fermer">‚úï</button>` : ''}
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                        <button onclick="addPlannerStep()" class="btn btn-ghost w-full mt-4">‚ûï ${t('addStep')}</button>
                        
                        ${(() => {
                            // D√©tecter les pays dans l'itin√©raire
                            const countriesInRoute = new Set();
                            const countryMap = {
                                'FR': ['france', 'paris', 'lyon', 'marseille', 'toulouse', 'bordeaux', 'lille', 'nantes', 'strasbourg', 'rennes'],
                                'DE': ['allemagne', 'germany', 'berlin', 'munich', 'hamburg', 'cologne', 'frankfurt', 'stuttgart'],
                                'BE': ['belgique', 'belgium', 'bruxelles', 'brussels', 'antwerp', 'anvers', 'gent'],
                                'ES': ['espagne', 'spain', 'madrid', 'barcelona', 'valencia', 'sevilla', 'malaga'],
                                'IT': ['italie', 'italy', 'rome', 'milan', 'naples', 'turin', 'florence', 'venice'],
                                'NL': ['pays-bas', 'netherlands', 'amsterdam', 'rotterdam', 'utrecht'],
                                'PL': ['pologne', 'poland', 'warsaw', 'krakow', 'wroclaw', 'poznan'],
                                'PT': ['portugal', 'lisbon', 'porto', 'braga'],
                                'AT': ['autriche', 'austria', 'vienna', 'salzburg', 'innsbruck'],
                                'CH': ['suisse', 'switzerland', 'geneva', 'zurich', 'bern', 'lausanne'],
                                'CZ': ['czech', 'prague', 'brno'],
                                'IE': ['ireland', 'dublin', 'cork', 'galway'],
                                'HR': ['croatia', 'zagreb', 'split', 'dubrovnik']
                            };
                            const countryNames = {
                                'FR': { fr: 'France', en: 'France', flag: 'üá´üá∑' },
                                'DE': { fr: 'Allemagne', en: 'Germany', flag: 'üá©üá™' },
                                'BE': { fr: 'Belgique', en: 'Belgium', flag: 'üáßüá™' },
                                'ES': { fr: 'Espagne', en: 'Spain', flag: 'üá™üá∏' },
                                'IT': { fr: 'Italie', en: 'Italy', flag: 'üáÆüáπ' },
                                'NL': { fr: 'Pays-Bas', en: 'Netherlands', flag: 'üá≥üá±' },
                                'PL': { fr: 'Pologne', en: 'Poland', flag: 'üáµüá±' },
                                'PT': { fr: 'Portugal', en: 'Portugal', flag: 'üáµüáπ' },
                                'AT': { fr: 'Autriche', en: 'Austria', flag: 'üá¶üáπ' },
                                'CH': { fr: 'Suisse', en: 'Switzerland', flag: 'üá®üá≠' },
                                'CZ': { fr: 'R√©p. Tch√®que', en: 'Czech Rep.', flag: 'üá®üáø' },
                                'IE': { fr: 'Irlande', en: 'Ireland', flag: 'üáÆüá™' },
                                'HR': { fr: 'Croatie', en: 'Croatia', flag: 'üá≠üá∑' }
                            };
                            
                            state.plannerSteps.forEach(step => {
                                if (step.city) {
                                    const cityLower = step.city.toLowerCase();
                                    for (const [code, keywords] of Object.entries(countryMap)) {
                                        if (keywords.some(k => cityLower.includes(k))) {
                                            countriesInRoute.add(code);
                                        }
                                    }
                                }
                            });
                            
                            if (countriesInRoute.size > 0) {
                                return `
                                    <div class="mt-6 p-4 rounded-xl bg-sky-500/10 border border-sky-500/20">
                                        <h3 class="font-bold mb-3 flex items-center gap-2">
                                            <span>üåç</span>
                                            ${state.lang === 'fr' ? 'Pays sur ton itin√©raire' : 'Countries on your route'}
                                        </h3>
                                        <div class="grid grid-cols-1 gap-2">
                                            ${Array.from(countriesInRoute).map(code => {
                                                const country = countryNames[code];
                                                const name = state.lang === 'fr' ? country.fr : country.en;
                                                return `
                                                    <div class="flex items-center gap-3 p-3 rounded-xl bg-white/5">
                                                        <span class="text-3xl">${country.flag}</span>
                                                        <span class="flex-1 font-medium">${name}</span>
                                                        <button onclick="openCountryGuide('${code}')" class="btn btn-ghost px-3 py-2">
                                                            üìö ${state.lang === 'fr' ? 'Guide' : 'Guide'}
                                                        </button>
                                                        <button onclick="openCountryQuiz('${code}')" class="btn btn-primary px-3 py-2">
                                                            üß† ${state.lang === 'fr' ? 'Quiz' : 'Quiz'}
                                                        </button>
                                                    </div>
                                                `;
                                            }).join('')}
                                        </div>
                                    </div>
                                `;
                            }
                            return '';
                        })()}
                        
                        ${routeSpots.length > 0 ? `
                            <div class="mt-6 p-4 rounded-xl bg-emerald-500/10 border border-emerald-500/20">
                                <div class="flex items-center justify-between mb-3">
                                    <h3 class="font-bold text-emerald-300">üìç ${routeSpots.length} spots trouv√©s sur l'itin√©raire</h3>
                                    <div class="flex gap-2">
                                        <button onclick="togglePlannerMap()" class="btn btn-ghost py-2 px-3">
                                            üó∫Ô∏è ${state.lang === 'fr' ? 'Carte' : state.lang === 'es' ? 'Mapa' : 'Map'}
                                        </button>
                                        <button onclick="saveAllRouteSpots()" class="btn btn-primary py-2 px-4">
                                            üíæ ${state.lang === 'fr' ? 'Enregistrer tout' : state.lang === 'es' ? 'Guardar todo' : 'Save all'}
                                        </button>
                                    </div>
                                </div>
                                
                                ${state.showPlannerMap ? `
                                    <div class="mb-4">
                                        <div id="route-estimate" class="mb-2 p-2 rounded-lg bg-white/5 text-center text-sm text-slate-400">
                                            ${state.lang === 'fr' ? 'Calcul de l\'itin√©raire...' : state.lang === 'es' ? 'Calculando ruta...' : 'Calculating route...'}
                                        </div>
                                        <div class="rounded-xl overflow-hidden" style="height: 350px;">
                                            <div id="planner-map" style="height: 100%;"></div>
                                        </div>
                                    </div>
                                ` : ''}
                                
                                <div class="space-y-2 max-h-64 overflow-y-auto">
                                    ${routeSpots.map(s => `
                                        <div class="flex items-center gap-3 p-3 rounded-xl bg-white/5 cursor-pointer hover:bg-white/10 transition-all" onclick="focusSpotOnPlannerMap(${s.id})">
                                            <img src="${s.photoUrl}" loading="lazy" class="w-16 h-16 rounded-lg object-cover" />
                                            <div class="flex-1">
                                                <p class="font-medium">${s.from} ‚Üí ${s.to}</p>
                                                <div class="flex items-center gap-3 text-xs text-slate-400">
                                                    <span>‚≠ê ${s.globalRating.toFixed(1)}</span>
                                                    <span>‚è±Ô∏è ${s.avgWaitTime}min</span>
                                                </div>
                                            </div>
                                            <button onclick="event.stopPropagation();toggleSaveSpot('${s.id}')" class="btn ${state.savedSpots.includes(s.id) ? 'btn-success' : 'btn-ghost'} px-3 py-2">
                                                ${state.savedSpots.includes(s.id) ? '‚úì' : 'üì•'}
                                            </button>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        ` : ''}
                        
                        <button onclick="saveTrip()" class="btn btn-primary w-full mt-4 py-3" ${!state.plannerSteps[0].city || !state.plannerSteps[state.plannerSteps.length - 1].city ? 'disabled style="opacity:0.5"' : ''}>
                            üíæ ${t('saveTrip')}
                        </button>
                    </div>
                    
                    <div class="card p-5 fade-in stagger-1">
                        <h3 class="font-bold mb-4">üìã ${t('myTrips')}</h3>
                        ${state.trips.length === 0 ? `<p class="text-slate-500 text-center py-8">${t('noTrips')}</p>` : `
                            <div class="space-y-3">
                                ${state.trips.map(trip => `
                                    <div class="p-4 rounded-xl bg-white/5 cursor-pointer hover:bg-white/10 transition-all" onclick="openSavedTrip('${trip.id}')">
                                        <div class="flex items-center justify-between mb-2">
                                            <h4 class="font-bold">${trip.steps[0]} ‚Üí ${trip.steps[trip.steps.length - 1]}</h4>
                                            <div class="flex gap-2">
                                                <button onclick="event.stopPropagation();openSavedTrip('${trip.id}')" class="text-sky-400 text-sm">üó∫Ô∏è</button>
                                                <button onclick="event.stopPropagation();deleteTrip('${trip.id}')" class="text-red-400 text-sm">üóëÔ∏è</button>
                                            </div>
                                        </div>
                                        <p class="text-sm text-slate-400">${trip.steps.join(' ‚Üí ')}</p>
                                        <p class="text-xs text-slate-500 mt-1">${trip.steps.length} ${state.lang === 'fr' ? '√©tapes' : state.lang === 'es' ? 'pasos' : 'steps'}</p>
                                    </div>
                                `).join('')}
                            </div>
                        `}
                    </div>
                    
                    ${state.selectedSavedTrip ? renderSavedTripDetail() : ''}
                </div>
            `;
        }
        
        // Afficher le d√©tail d'un voyage sauvegard√©
        function renderSavedTripDetail() {
            const trip = state.trips.find(t => t.id === state.selectedSavedTrip);
            if (!trip) return '';
            
            const lang = state.lang === 'es' ? 'es' : state.lang === 'en' ? 'en' : 'fr';
            
            // D√©tecter les pays travers√©s
            const countryMap = {
                'FR': ['france', 'paris', 'lyon', 'marseille', 'toulouse', 'bordeaux', 'lille', 'nantes', 'strasbourg', 'rennes', 'nice', 'montpellier'],
                'DE': ['allemagne', 'germany', 'berlin', 'munich', 'hamburg', 'cologne', 'frankfurt', 'stuttgart', 'm√ºnchen'],
                'BE': ['belgique', 'belgium', 'bruxelles', 'brussels', 'antwerp', 'anvers', 'gent'],
                'ES': ['espagne', 'spain', 'madrid', 'barcelona', 'valencia', 'sevilla', 'malaga', 'bilbao'],
                'IT': ['italie', 'italy', 'rome', 'milan', 'naples', 'turin', 'florence', 'venice', 'roma', 'milano'],
                'NL': ['pays-bas', 'netherlands', 'amsterdam', 'rotterdam', 'utrecht'],
                'PL': ['pologne', 'poland', 'warsaw', 'krakow', 'wroclaw', 'poznan', 'varsovie', 'cracovie'],
                'PT': ['portugal', 'lisbon', 'porto', 'braga', 'lisbonne'],
                'AT': ['autriche', 'austria', 'vienna', 'salzburg', 'innsbruck', 'vienne'],
                'CH': ['suisse', 'switzerland', 'geneva', 'zurich', 'bern', 'lausanne', 'gen√®ve'],
                'CZ': ['czech', 'prague', 'brno', 'tch√©quie'],
                'IE': ['ireland', 'dublin', 'cork', 'galway', 'irlande'],
                'HR': ['croatia', 'zagreb', 'split', 'dubrovnik', 'croatie']
            };
            
            const countriesInTrip = new Set();
            trip.steps.forEach(step => {
                const stepLower = step.toLowerCase();
                for (const [code, keywords] of Object.entries(countryMap)) {
                    if (keywords.some(k => stepLower.includes(k))) {
                        countriesInTrip.add(code);
                    }
                }
            });
            
            const countryGuidesForTrip = countryGuides.filter(g => countriesInTrip.has(g.code));
            
            return `
                <div class="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4" onclick="state.selectedSavedTrip=null;render();">
                    <div class="bg-slate-900 rounded-2xl max-w-3xl w-full max-h-[90vh] overflow-y-auto" onclick="event.stopPropagation();">
                        <div class="p-6 space-y-6">
                            <!-- Header -->
                            <div class="flex items-center justify-between">
                                <h2 class="text-2xl font-bold">üß≠ ${trip.steps[0]} ‚Üí ${trip.steps[trip.steps.length - 1]}</h2>
                                <button onclick="state.selectedSavedTrip=null;render();" class="text-slate-400 hover:text-white text-2xl" aria-label="Fermer">‚úï</button>
                            </div>
                            
                            <!-- Itin√©raire -->
                            <div class="p-4 rounded-xl bg-white/5">
                                <h3 class="font-bold mb-3">üìç ${lang === 'fr' ? 'Itin√©raire' : lang === 'es' ? 'Itinerario' : 'Route'}</h3>
                                <div class="flex flex-wrap items-center gap-2">
                                    ${trip.steps.map((step, i) => `
                                        <span class="px-3 py-1 rounded-lg bg-sky-500/20 text-sky-300">${step}</span>
                                        ${i < trip.steps.length - 1 ? '<span class="text-slate-500">‚Üí</span>' : ''}
                                    `).join('')}
                                </div>
                            </div>
                            
                            <!-- Carte du voyage -->
                            <div class="rounded-xl overflow-hidden" style="height: 250px;">
                                <div id="saved-trip-map" style="height: 100%;"></div>
                            </div>
                            
                            <!-- Pays travers√©s avec conseils -->
                            ${countryGuidesForTrip.length > 0 ? `
                                <div class="space-y-4">
                                    <h3 class="font-bold">üåç ${lang === 'fr' ? 'Conseils pour les pays travers√©s' : lang === 'es' ? 'Consejos para los pa√≠ses' : 'Tips for countries on route'}</h3>
                                    ${countryGuidesForTrip.map(g => `
                                        <div class="p-4 rounded-xl bg-white/5 border border-white/10">
                                            <div class="flex items-center gap-3 mb-3">
                                                <span class="text-4xl">${g.flag}</span>
                                                <div>
                                                    <h4 class="font-bold text-lg">${g.name}</h4>
                                                    <div class="flex gap-2">
                                                        <span class="badge badge-success text-xs">${g.legal}</span>
                                                        <span class="badge badge-primary text-xs">${g.difficulty}</span>
                                                        <span class="text-xs text-slate-400">‚è±Ô∏è ~${g.avgWait}min</span>
                                                    </div>
                                                </div>
                                            </div>
                                            <p class="text-slate-300 text-sm mb-3">üí° ${g.tips[lang] || g.tips.fr}</p>
                                            <div class="grid grid-cols-2 gap-2 text-xs">
                                                <div class="p-2 rounded-lg bg-emerald-500/10">
                                                    <span class="text-emerald-300">üëã</span> ${g.phrases?.hello || '-'}
                                                </div>
                                                <div class="p-2 rounded-lg bg-purple-500/10">
                                                    <span class="text-purple-300">üôè</span> ${g.phrases?.thanks || '-'}
                                                </div>
                                            </div>
                                            <div class="mt-2 text-xs text-red-400">üìû ${lang === 'fr' ? 'Urgences' : 'Emergency'}: ${g.emergency}</div>
                                        </div>
                                    `).join('')}
                                </div>
                            ` : ''}
                            
                            <!-- Boutons -->
                            <div class="flex gap-3">
                                <button onclick="loadTripToPlanner('${trip.id}')" class="btn btn-primary flex-1">
                                    üìù ${lang === 'fr' ? 'Modifier' : lang === 'es' ? 'Editar' : 'Edit'}
                                </button>
                                <button onclick="state.selectedSavedTrip=null;render();" class="btn btn-ghost flex-1">
                                    ‚úì ${lang === 'fr' ? 'Fermer' : lang === 'es' ? 'Cerrar' : 'Close'}
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        window.openSavedTrip = function(tripId) {
            state.selectedSavedTrip = tripId;
            render();
            setTimeout(() => initSavedTripMap(tripId), 100);
        };
        
        window.loadTripToPlanner = function(tripId) {
            const trip = state.trips.find(t => t.id === tripId);
            if (trip) {
                state.plannerSteps = trip.steps.map(city => ({ city }));
                state.selectedSavedTrip = null;
                render();
            }
        };
        
        function initSavedTripMap(tripId) {
            const trip = state.trips.find(t => t.id === tripId);
            if (!trip) return;
            
            const el = document.getElementById('saved-trip-map');
            if (!el) return;
            
            const map = L.map('saved-trip-map').setView([48.85, 2.35], 5);
            
            L.tileLayer(getMapTileUrl(state.theme), { 
                attribution: getMapAttribution(),
                maxZoom: 19 
            }).addTo(map);
            
            // G√©ocoder et afficher les √©tapes
            geocodeAndDisplayTrip(map, trip.steps);
        }
        
        async function geocodeAndDisplayTrip(map, steps) {
            const coords = [];
            for (const step of steps) {
                try {
                    const response = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(step)}&limit=1`);
                    const data = await response.json();
                    if (data.length > 0) {
                        coords.push([parseFloat(data[0].lat), parseFloat(data[0].lon)]);
                    }
                } catch (e) {}
            }
            
            if (coords.length >= 2) {
                // Tracer la route
                const waypoints = coords.map(c => `${c[1]},${c[0]}`).join(';');
                try {
                    const response = await fetch(`https://router.project-osrm.org/route/v1/driving/${waypoints}?overview=full&geometries=geojson`);
                    const data = await response.json();
                    if (data.routes && data.routes[0]) {
                        const routeCoords = data.routes[0].geometry.coordinates.map(c => [c[1], c[0]]);
                        L.polyline(routeCoords, { color: '#0ea5e9', weight: 4 }).addTo(map);
                    }
                } catch (e) {
                    L.polyline(coords, { color: '#0ea5e9', weight: 3, dashArray: '5,10' }).addTo(map);
                }
                
                // Ajouter les marqueurs
                coords.forEach((coord, i) => {
                    const color = i === 0 ? '#0ea5e9' : i === coords.length - 1 ? '#10b981' : '#f59e0b';
                    const icon = L.divIcon({
                        className: 'step-marker',
                        html: `<div style="background:${color};color:white;width:30px;height:30px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:bold;font-size:14px;box-shadow:0 2px 6px rgba(0,0,0,0.3);border:2px solid white;">${i+1}</div>`,
                        iconSize: [30, 30],
                        iconAnchor: [15, 15]
                    });
                    L.marker(coord, { icon }).addTo(map).bindPopup(`<b>${steps[i]}</b>`);
                });
                
                map.fitBounds(coords, { padding: [30, 30] });
            }
        }
        
        // Trouver tous les spots entre 2 villes (recherche large)
        function getSpotsBetween(from, to) {
            from = from.toLowerCase();
            to = to.toLowerCase();
            
            return state.spots.filter(s => {
                const spotFrom = s.from.toLowerCase();
                const spotTo = s.to.toLowerCase();
                const spotCity = s.city ? s.city.toLowerCase() : '';
                
                // Cherche les spots qui contiennent une des villes
                return spotFrom.includes(from) || spotFrom.includes(to) ||
                       spotTo.includes(from) || spotTo.includes(to) ||
                       spotCity.includes(from) || spotCity.includes(to) ||
                       from.includes(spotFrom) || to.includes(spotFrom) ||
                       from.includes(spotTo) || to.includes(spotTo);
            }).sort((a, b) => b.globalRating - a.globalRating);
        }

        function renderChat() {
            // Si un pays est s√©lectionn√©, afficher ce chat
            if (state.activeChatCountry) {
                const msgs = []; // Messages du chat pays (√† impl√©menter avec Firebase)
                const countryFlags = { FR: 'üá´üá∑', DE: 'üá©üá™', BE: 'üáßüá™', NL: 'üá≥üá±', ES: 'üá™üá∏', IT: 'üáÆüáπ', PL: 'üáµüá±', PT: 'üáµüáπ', AT: 'üá¶üáπ', CH: 'üá®üá≠', CZ: 'üá®üáø', IE: 'üáÆüá™', HR: 'üá≠üá∑' };
                
                return `
                    <div class="space-y-4">
                        <!-- Retour -->
                        <button onclick="state.activeChatCountry=null;render();" class="flex items-center gap-2 text-sky-400 hover:underline">
                            ‚Üê ${t('back')}
                        </button>
                        
                        <!-- Header pays -->
                        <div class="card p-5 fade-in text-center">
                            <div class="text-5xl mb-2">${countryFlags[state.activeChatCountry] || 'üè≥Ô∏è'}</div>
                            <h3 class="font-bold">${state.activeChatCountry}</h3>
                            <p class="text-sm text-slate-400">${state.lang === 'fr' ? 'Chat de voyage' : 'Travel chat'}</p>
                        </div>
                        
                        <!-- Messages -->
                        <div class="card p-4 h-96 overflow-y-auto flex flex-col gap-3 fade-in stagger-1">
                            ${msgs.length === 0 ? `
                                <div class="flex-1 flex flex-col items-center justify-center text-slate-500">
                                    <span class="text-5xl mb-3">üí¨</span>
                                    <p>${state.lang === 'fr' ? 'Aucun message pour l\'instant' : 'No messages yet'}</p>
                                    <p class="text-xs mt-2">${state.lang === 'fr' ? 'Sois le premier √† poser une question !' : 'Be the first to ask!'}</p>
                                </div>
                            ` : msgs.map(msg => `
                                <div class="chat-bubble ${msg.isMe ? 'sent' : 'received'}">
                                    ${!msg.isMe ? `<div class="flex items-center gap-2 mb-1"><span>${msg.avatar}</span><span class="text-xs font-medium text-sky-300">${msg.user}</span></div>` : ''}
                                    <p class="text-sm">${escapeHtml(msg.text ||  "")}</p>
                                    <p class="text-xs text-right mt-1 opacity-60">${msg.time}</p>
                                </div>
                            `).join('')}
                        </div>
                        
                        <!-- Input -->
                        <div class="card p-3 flex gap-3 fade-in stagger-2">
                            <input type="text" class="input-modern flex-1" placeholder="${t('typeMessage')}" value="${state.newMessage}" oninput="state.newMessage=this.value;" onkeypress="if(event.key==='Enter')sendMessage();" />
                            <button onclick="sendMessage()" class="btn btn-primary px-6">${t('send')}</button>
                        </div>
                    </div>
                `;
            }
            
            // Liste des salons
            const rooms = [
                { id: 'friends', name: t('friendsChat'), icon: 'üë•', type: 'friends' },
                { id: 'countries', name: t('countryChat'), icon: 'üåç', type: 'countries' }
            ];
            
            return `
                <div class="space-y-4">
                    <!-- S√©lection salon -->
                    <div class="flex gap-2 overflow-x-auto pb-2 fade-in">
                        ${rooms.map(r => `
                            <button onclick="state.activeChatRoom='${r.id}';render();" class="flex items-center gap-2 px-4 py-2 rounded-xl whitespace-nowrap transition-all ${state.activeChatRoom === r.id ? 'bg-sky-500/20 text-sky-300' : 'bg-white/5 hover:bg-white/10'}">
                                <span>${r.icon}</span><span class="font-medium">${r.name}</span>
                            </button>
                        `).join('')}
                    </div>
                    
                    ${state.activeChatRoom === 'friends' ? renderFriendsChat() : renderCountriesChat()}
                </div>
            `;
        }
        
        function renderFriendsChat() {
            const msgs = state.privateMessages || [];
            return `
                <div class="space-y-4">
                    <div class="card p-4 h-96 overflow-y-auto flex flex-col gap-3 fade-in stagger-1">
                        ${msgs.length === 0 ? `
                            <div class="flex-1 flex flex-col items-center justify-center text-slate-500">
                                <span class="text-5xl mb-3">üë•</span>
                                <p>${state.lang === 'fr' ? 'Aucun message' : 'No messages'}</p>
                                <p class="text-xs mt-2">${state.lang === 'fr' ? 'Discute avec tes amis ici' : 'Chat with your friends here'}</p>
                            </div>
                        ` : msgs.map(msg => `
                            <div class="chat-bubble ${msg.isMe ? 'sent' : 'received'}">
                                ${!msg.isMe ? `<div class="flex items-center gap-2 mb-1"><span>${msg.fromAvatar}</span><span class="text-xs font-medium text-sky-300">${msg.from}</span></div>` : ''}
                                <p class="text-sm">${msg.text}</p>
                                <p class="text-xs text-right mt-1 opacity-60">${msg.date}</p>
                            </div>
                        `).join('')}
                    </div>
                    <div class="card p-3 flex gap-3 fade-in stagger-2">
                        <input type="text" class="input-modern flex-1" placeholder="${t('typeMessage')}" value="${state.newMessage}" oninput="state.newMessage=this.value;" onkeypress="if(event.key==='Enter')sendMessage();" />
                        <button onclick="sendMessage()" class="btn btn-primary px-6">${t('send')}</button>
                    </div>
                </div>
            `;
        }
        
        function renderCountriesChat() {
            const countries = [
                { code: 'FR', flag: 'üá´üá∑', name: 'France' },
                { code: 'DE', flag: 'üá©üá™', name: 'Allemagne' },
                { code: 'BE', flag: 'üáßüá™', name: 'Belgique' },
                { code: 'NL', flag: 'üá≥üá±', name: 'Pays-Bas' },
                { code: 'ES', flag: 'üá™üá∏', name: 'Espagne' },
                { code: 'IT', flag: 'üáÆüáπ', name: 'Italie' },
                { code: 'PL', flag: 'üáµüá±', name: 'Pologne' },
                { code: 'PT', flag: 'üáµüáπ', name: 'Portugal' },
                { code: 'AT', flag: 'üá¶üáπ', name: 'Autriche' },
                { code: 'CH', flag: 'üá®üá≠', name: 'Suisse' },
                { code: 'CZ', flag: 'üá®üáø', name: 'Tch√©quie' },
                { code: 'IE', flag: 'üáÆüá™', name: 'Irlande' },
                { code: 'HR', flag: 'üá≠üá∑', name: 'Croatie' }
            ];
            
            return `
                <div class="space-y-4">
                    <div class="card p-5 fade-in text-center">
                        <h3 class="font-bold mb-2">${t('selectCountry')}</h3>
                        <p class="text-sm text-slate-400">${state.lang === 'fr' ? 'Pose tes questions avant de partir' : 'Ask questions before your trip'}</p>
                    </div>
                    <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
                        ${countries.map(c => `
                            <button onclick="state.activeChatCountry='${c.code}';render();" class="card p-4 hover:bg-white/10 transition-all text-center">
                                <div class="text-4xl mb-2">${c.flag}</div>
                                <p class="font-medium">${c.name}</p>
                            </button>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function renderFriends() {
            return `
                <div class="space-y-4">
                    <h2 class="text-2xl font-bold fade-in">üë• ${t('friends')} (${state.friends.length})</h2>
                    <div class="space-y-3">
                        ${state.friends.map((f, i) => `
                            <div class="card p-4 fade-in stagger-${Math.min(i + 1, 4)}">
                                <div class="flex items-center gap-4">
                                    <div class="relative">
                                        <span class="text-4xl">${f.avatar}</span>
                                        <div class="absolute -bottom-1 -right-1 w-4 h-4 rounded-full border-2 border-slate-900 ${f.online ? 'bg-emerald-500' : 'bg-slate-500'}"></div>
                                    </div>
                                    <div class="flex-1">
                                        <div class="flex items-center gap-2">
                                            <h3 class="font-bold">${f.username}</h3>
                                            ${f.traveling ? `<span class="badge badge-danger text-xs"><span class="live-dot mr-1"></span>${t('traveling')}</span>` : ''}
                                        </div>
                                        <p class="text-sm text-slate-400">${f.location}</p>
                                        <p class="text-xs text-slate-500">‚ö° ${f.score} ${t('points')}</p>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function renderGuides() {
            // Grouper les pays par continent
            const groupedByContinent = {};
            countryGuides.forEach(g => {
                const cont = g.continent || 'other';
                if (!groupedByContinent[cont]) groupedByContinent[cont] = [];
                groupedByContinent[cont].push(g);
            });
            
            const lang = state.lang === 'es' ? 'es' : state.lang === 'en' ? 'en' : 'fr';
            
            return `
                <div class="space-y-6">
                    <h2 class="text-2xl font-bold fade-in">üìö ${t('guidesTitle')}</h2>
                    
                    <!-- Filtre par continent -->
                    <div class="flex flex-wrap gap-2 fade-in">
                        <button onclick="state.guideContinent='all';render();" class="btn ${!state.guideContinent || state.guideContinent === 'all' ? 'btn-primary' : 'btn-ghost'} py-2 px-4">
                            üåç ${lang === 'fr' ? 'Tous' : lang === 'es' ? 'Todos' : 'All'}
                        </button>
                        ${Object.entries(continents).map(([key, cont]) => `
                            <button onclick="state.guideContinent='${key}';render();" class="btn ${state.guideContinent === key ? 'btn-primary' : 'btn-ghost'} py-2 px-4">
                                ${cont.icon} ${cont.name[lang]}
                            </button>
                        `).join('')}
                    </div>
                    
                    <!-- Liste des pays -->
                    ${Object.entries(groupedByContinent).filter(([key]) => !state.guideContinent || state.guideContinent === 'all' || key === state.guideContinent).map(([contKey, countries]) => `
                        <div class="space-y-4 fade-in">
                            <h3 class="text-xl font-bold flex items-center gap-2">
                                ${continents[contKey]?.icon || 'üåê'} ${continents[contKey]?.name[lang] || contKey}
                                <span class="text-sm font-normal text-slate-400">(${countries.length} ${lang === 'fr' ? 'pays' : lang === 'es' ? 'pa√≠ses' : 'countries'})</span>
                            </h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                ${countries.map((g, i) => `
                                    <div class="card p-5 cursor-pointer hover:scale-[1.02] transition-all" onclick="openCountryDetail('${g.code}')">
                                        <div class="flex items-center gap-4 mb-4">
                                            <span class="text-5xl">${g.flag}</span>
                                            <div class="flex-1">
                                                <h4 class="font-bold text-xl">${g.name}</h4>
                                                <div class="flex flex-wrap items-center gap-2 mt-1">
                                                    <span class="badge ${g.legal === '‚úÖ' ? 'badge-success' : 'badge-danger'}">${g.legal}</span>
                                                    <span class="badge badge-primary">${g.difficulty}</span>
                                                    <span class="text-xs text-slate-400">‚è±Ô∏è ~${g.avgWait}min</span>
                                                </div>
                                            </div>
                                        </div>
                                        <p class="text-slate-400 text-sm line-clamp-2">üí° ${g.tips[lang] || g.tips.en || g.tips.fr}</p>
                                        <div class="flex items-center justify-between mt-3 pt-3 border-t border-white/10">
                                            <span class="text-xs text-slate-500">üìû ${g.emergency}</span>
                                            <span class="text-sky-400 text-sm">${lang === 'fr' ? 'Voir d√©tails ‚Üí' : lang === 'es' ? 'Ver detalles ‚Üí' : 'View details ‚Üí'}</span>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `).join('')}
                </div>
                
                ${state.selectedCountryGuide ? renderCountryDetail() : ''}
            `;
        }
        
        // D√©tail d'un pays
        function renderCountryDetail() {
            const g = countryGuides.find(c => c.code === state.selectedCountryGuide);
            if (!g) return '';
            
            const lang = state.lang === 'es' ? 'es' : state.lang === 'en' ? 'en' : 'fr';
            
            return `
                <div class="fixed inset-0 bg-black/80 backdrop-blur-sm z-50 flex items-center justify-center p-4" onclick="state.selectedCountryGuide=null;render();">
                    <div class="bg-slate-900 rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto" onclick="event.stopPropagation();">
                        <div class="p-6 space-y-6">
                            <!-- Header -->
                            <div class="flex items-center gap-4">
                                <span class="text-6xl">${g.flag}</span>
                                <div class="flex-1">
                                    <h2 class="text-2xl font-bold">${g.name}</h2>
                                    <div class="flex flex-wrap gap-2 mt-2">
                                        <span class="badge ${g.legal === '‚úÖ' ? 'badge-success' : 'badge-danger'}">${g.legal} ${lang === 'fr' ? 'L√©gal' : lang === 'es' ? 'Legal' : 'Legal'}</span>
                                        <span class="badge badge-primary">${g.difficulty}</span>
                                        <span class="badge badge-warning">‚è±Ô∏è ~${g.avgWait}min</span>
                                        <span class="badge badge-info">üõ°Ô∏è ${g.safety}/5</span>
                                    </div>
                                </div>
                                <button onclick="state.selectedCountryGuide=null;render();" class="text-slate-400 hover:text-white text-2xl" aria-label="Fermer">‚úï</button>
                            </div>
                            
                            <!-- Conseils -->
                            <div class="p-4 rounded-xl bg-sky-500/10 border border-sky-500/20">
                                <h3 class="font-bold mb-2">üí° ${lang === 'fr' ? 'Conseils' : lang === 'es' ? 'Consejos' : 'Tips'}</h3>
                                <p class="text-slate-300">${g.tips[lang] || g.tips.en || g.tips.fr}</p>
                            </div>
                            
                            <!-- Meilleurs spots -->
                            ${g.bestSpots ? `
                                <div class="p-4 rounded-xl bg-emerald-500/10 border border-emerald-500/20">
                                    <h3 class="font-bold mb-2 text-emerald-300">‚úÖ ${lang === 'fr' ? 'Meilleurs spots' : lang === 'es' ? 'Mejores spots' : 'Best spots'}</h3>
                                    <ul class="list-disc list-inside text-slate-300 space-y-1">
                                        ${g.bestSpots.map(s => `<li>${s}</li>`).join('')}
                                    </ul>
                                </div>
                            ` : ''}
                            
                            <!-- √Ä √©viter -->
                            ${g.avoid ? `
                                <div class="p-4 rounded-xl bg-red-500/10 border border-red-500/20">
                                    <h3 class="font-bold mb-2 text-red-300">‚ö†Ô∏è ${lang === 'fr' ? '√Ä √©viter' : lang === 'es' ? 'Evitar' : 'Avoid'}</h3>
                                    <ul class="list-disc list-inside text-slate-300 space-y-1">
                                        ${g.avoid.map(a => `<li>${a}</li>`).join('')}
                                    </ul>
                                </div>
                            ` : ''}
                            
                            <!-- Phrases utiles -->
                            ${g.phrases ? `
                                <div class="p-4 rounded-xl bg-purple-500/10 border border-purple-500/20">
                                    <h3 class="font-bold mb-3 text-purple-300">üí¨ ${lang === 'fr' ? 'Phrases utiles' : lang === 'es' ? 'Frases √∫tiles' : 'Useful phrases'}</h3>
                                    <div class="grid grid-cols-2 gap-3">
                                        <div class="p-3 rounded-lg bg-white/5">
                                            <p class="text-xs text-slate-500">${lang === 'fr' ? 'Bonjour' : lang === 'es' ? 'Hola' : 'Hello'}</p>
                                            <p class="font-bold text-lg">${g.phrases.hello}</p>
                                        </div>
                                        <div class="p-3 rounded-lg bg-white/5">
                                            <p class="text-xs text-slate-500">${lang === 'fr' ? 'Merci' : lang === 'es' ? 'Gracias' : 'Thanks'}</p>
                                            <p class="font-bold text-lg">${g.phrases.thanks}</p>
                                        </div>
                                        <div class="p-3 rounded-lg bg-white/5 col-span-2">
                                            <p class="text-xs text-slate-500">${lang === 'fr' ? 'O√π allez-vous ?' : lang === 'es' ? '¬øAd√≥nde va?' : 'Where are you going?'}</p>
                                            <p class="font-bold text-lg">${g.phrases.where}</p>
                                        </div>
                                        ${g.phrases.hitchhike ? `
                                            <div class="p-3 rounded-lg bg-white/5 col-span-2">
                                                <p class="text-xs text-slate-500">${lang === 'fr' ? 'Je fais du stop' : lang === 'es' ? 'Hago autostop' : 'I\'m hitchhiking'}</p>
                                                <p class="font-bold text-lg">${g.phrases.hitchhike}</p>
                                            </div>
                                        ` : ''}
                                    </div>
                                </div>
                            ` : ''}
                            
                            <!-- Urgences -->
                            <div class="p-4 rounded-xl bg-red-500/10 border border-red-500/20">
                                <h3 class="font-bold mb-2 text-red-300">üìû ${lang === 'fr' ? 'Urgences' : lang === 'es' ? 'Emergencias' : 'Emergency'}</h3>
                                <a href="tel:${g.emergency}" class="inline-flex items-center gap-2 text-2xl font-bold text-red-400">
                                    üì± ${g.emergency}
                                </a>
                            </div>
                            
                            <!-- Boutons -->
                            <div class="flex gap-3">
                                <button onclick="state.countryFilter='${g.code}';state.activeTab='spots';state.selectedCountryGuide=null;render();" class="btn btn-primary flex-1">
                                    üìç ${lang === 'fr' ? 'Voir les spots' : lang === 'es' ? 'Ver spots' : 'View spots'}
                                </button>
                                <button onclick="openCountryQuiz('${g.code}')" class="btn btn-ghost flex-1">
                                    üß† Quiz
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        window.openCountryDetail = function(code) {
            state.selectedCountryGuide = code;
            // Track guide read for challenges
            if (!state.guidesReadList) state.guidesReadList = [];
            if (!state.guidesReadList.includes(code)) {
                state.guidesReadList.push(code);
                state.guidesRead = state.guidesReadList.length;
                Storage.set('guidesRead', state.guidesRead);
                Storage.set('guidesReadList', state.guidesReadList);
            }
            render();
        };

        function renderSafety() {
            const tips = safetyTips[state.lang];
            return `
                <div class="space-y-4">
                    <h2 class="text-2xl font-bold fade-in">üõ°Ô∏è ${t('safetyTips')}</h2>
                    <div class="card p-5 bg-gradient-to-br from-amber-500/20 to-orange-500/20 border-amber-500/30 fade-in stagger-1">
                        <div class="flex items-start gap-4">
                            <span class="text-4xl">‚ö†Ô∏è</span>
                            <p class="text-slate-300 text-sm">${state.lang === 'fr' ? "L'autostop comporte des risques. Fais toujours confiance √† ton instinct." : 'Hitchhiking involves risks. Always trust your instincts.'}</p>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                        ${tips.map((tip, i) => `
                            <div class="card p-4 fade-in stagger-${Math.min(i + 2, 4)}">
                                <div class="flex items-start gap-3">
                                    <span class="text-3xl">${tip.icon}</span>
                                    <div><h3 class="font-bold mb-1">${tip.title}</h3><p class="text-sm text-slate-400">${tip.desc}</p></div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    <div class="card p-5 fade-in stagger-4">
                        <h3 class="font-bold mb-4">üìû ${t('emergencyNumbers')}</h3>
                        <div class="grid grid-cols-4 gap-2">
                            ${[{ flag: 'üá™üá∫', num: '112' }, { flag: 'üá´üá∑', num: '17' }, { flag: 'üá¨üáß', num: '999' }, { flag: 'üá∫üá∏', num: '911' }].map(e => `
                                <a href="tel:${e.num}" class="p-3 rounded-xl bg-white/5 text-center hover:bg-white/10 transition-all">
                                    <span class="text-xl">${e.flag}</span><p class="font-bold text-red-400">${e.num}</p>
                                </a>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
        }

        function renderMissions() {
            const lang = state.lang === 'es' ? 'es' : state.lang === 'en' ? 'en' : 'fr';
            const leagueInfo = getLeagueInfo(state.userLeague || 'bronze');
            
            // Challenges adapt√©s aux voyageurs
            const preparationChallenges = [
                { id: 'p1', icon: 'üìö', title: { fr: 'Lire 3 guides pays', en: 'Read 3 country guides', es: 'Leer 3 gu√≠as' }, target: 3, current: state.guidesRead || 0, reward: 30, category: 'preparation' },
                { id: 'p2', icon: 'üß†', title: { fr: 'Faire 5 quiz', en: 'Complete 5 quizzes', es: 'Completar 5 quiz' }, target: 5, current: state.quizzesCompleted || 0, reward: 40, category: 'preparation' },
                { id: 'p3', icon: 'üìç', title: { fr: 'Sauvegarder 10 spots', en: 'Save 10 spots', es: 'Guardar 10 spots' }, target: 10, current: state.savedSpots?.length || 0, reward: 25, category: 'preparation' },
                { id: 'p4', icon: 'üß≠', title: { fr: 'Planifier 1 voyage', en: 'Plan 1 trip', es: 'Planificar 1 viaje' }, target: 1, current: state.trips?.length || 0, reward: 20, category: 'preparation' }
            ];
            
            const travelChallenges = [
                { id: 't1', icon: 'üì∏', title: { fr: 'Partager 1 spot', en: 'Share 1 spot', es: 'Compartir 1 spot' }, target: 1, current: state.user?.spotsShared || 0, reward: 50, category: 'travel' },
                { id: 't2', icon: '‚úÖ', title: { fr: 'Valider 3 spots', en: 'Validate 3 spots', es: 'Validar 3 spots' }, target: 3, current: state.validatedByMe?.length || 0, reward: 35, category: 'travel' },
                { id: 't3', icon: 'üí¨', title: { fr: 'Envoyer 5 messages', en: 'Send 5 messages', es: 'Enviar 5 mensajes' }, target: 5, current: state.messagesSent || 0, reward: 20, category: 'travel' },
                { id: 't4', icon: '‚≠ê', title: { fr: '√âvaluer 3 spots', en: 'Review 3 spots', es: 'Evaluar 3 spots' }, target: 3, current: state.user?.reviewsGiven || 0, reward: 30, category: 'travel' }
            ];
            
            const longTermChallenges = [
                { id: 'l1', icon: 'üåç', title: { fr: 'Visiter 5 pays', en: 'Visit 5 countries', es: 'Visitar 5 pa√≠ses' }, target: 5, current: state.countriesVisited?.length || 0, reward: 200, category: 'longterm' },
                { id: 'l2', icon: 'üèÜ', title: { fr: 'Atteindre niveau 10', en: 'Reach level 10', es: 'Alcanzar nivel 10' }, target: 10, current: state.user?.level || 1, reward: 150, category: 'longterm' },
                { id: 'l3', icon: 'ü§ù', title: { fr: 'Aider 10 personnes', en: 'Help 10 people', es: 'Ayudar a 10 personas' }, target: 10, current: state.helpGiven || 0, reward: 100, category: 'longterm' },
                { id: 'l4', icon: 'üìç', title: { fr: 'Partager 20 spots', en: 'Share 20 spots', es: 'Compartir 20 spots' }, target: 20, current: state.user?.spotsShared || 0, reward: 300, category: 'longterm' }
            ];
            
            // Calcul progression ligue
            const nextLeague = {
                bronze: { next: 'silver', points: 500 },
                silver: { next: 'gold', points: 2000 },
                gold: { next: 'diamond', points: 5000 },
                diamond: { next: null, points: 999999 }
            }[state.userLeague || 'bronze'];
            
            const currentPoints = state.seasonPoints || 0;
            const progressToNext = nextLeague.next ? Math.min((currentPoints / nextLeague.points) * 100, 100) : 100;
            
            return `
                <div class="space-y-6">
                    <h2 class="text-2xl font-bold fade-in">üéØ ${t('missions')}</h2>
                    
                    <!-- Syst√®me de ligues -->
                    <div class="card p-5 fade-in bg-gradient-to-br from-${leagueInfo.icon === 'üíé' ? 'cyan' : leagueInfo.icon === 'ü•á' ? 'yellow' : leagueInfo.icon === 'ü•à' ? 'gray' : 'orange'}-500/10 to-transparent border-${leagueInfo.icon === 'üíé' ? 'cyan' : leagueInfo.icon === 'ü•á' ? 'yellow' : leagueInfo.icon === 'ü•à' ? 'gray' : 'orange'}-500/20">
                        <div class="flex items-center gap-4 mb-4">
                            <div class="text-5xl">${leagueInfo.icon}</div>
                            <div class="flex-1">
                                <h3 class="text-xl font-bold">${lang === 'fr' ? 'Ligue' : lang === 'es' ? 'Liga' : 'League'} ${leagueInfo.name[lang]}</h3>
                                <p class="text-slate-400 text-sm">${lang === 'fr' ? 'Saison Hiver 2024' : lang === 'es' ? 'Temporada Invierno 2024' : 'Winter 2024 Season'}</p>
                            </div>
                            <div class="text-right">
                                <p class="text-2xl font-bold" style="color: ${leagueInfo.color}">${currentPoints}</p>
                                <p class="text-xs text-slate-400">${lang === 'fr' ? 'pts saison' : 'season pts'}</p>
                            </div>
                        </div>
                        
                        ${nextLeague.next ? `
                            <div class="mb-2">
                                <div class="flex justify-between text-xs text-slate-400 mb-1">
                                    <span>${leagueInfo.name[lang]}</span>
                                    <span>${getLeagueInfo(nextLeague.next).name[lang]}</span>
                                </div>
                                <div class="progress-bar" style="height: 8px;">
                                    <div class="progress-fill" style="width: ${progressToNext}%; background: ${leagueInfo.color};"></div>
                                </div>
                                <p class="text-center text-xs text-slate-500 mt-1">${currentPoints}/${nextLeague.points}</p>
                            </div>
                        ` : `
                            <p class="text-center text-emerald-400">‚ú® ${lang === 'fr' ? 'Ligue maximale atteinte !' : 'Maximum league reached!'}</p>
                        `}
                        
                        <div class="grid grid-cols-4 gap-2 mt-4 text-center text-xs">
                            ${['bronze', 'silver', 'gold', 'diamond'].map(l => {
                                const info = getLeagueInfo(l);
                                const isActive = l === state.userLeague;
                                return `
                                    <div class="p-2 rounded-lg ${isActive ? 'bg-white/10 ring-2 ring-white/30' : 'opacity-50'}">
                                        <span class="text-xl">${info.icon}</span>
                                        <p class="${isActive ? 'font-bold' : ''}">${info.name[lang]}</p>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                        
                        <p class="text-center text-xs text-slate-500 mt-3">
                            ${lang === 'fr' ? `Bonus ligue : x${leagueInfo.bonus} points` : `League bonus: x${leagueInfo.bonus} points`}
                        </p>
                    </div>
                    
                    <!-- Challenges Pr√©paration -->
                    <div class="fade-in stagger-1">
                        <h3 class="font-bold mb-3 flex items-center gap-2">
                            üìö ${lang === 'fr' ? 'Pr√©paration' : lang === 'es' ? 'Preparaci√≥n' : 'Preparation'}
                            <span class="text-xs text-slate-500">${lang === 'fr' ? '(avant le voyage)' : '(before traveling)'}</span>
                        </h3>
                        <div class="grid grid-cols-2 gap-3">
                            ${preparationChallenges.map(c => renderChallengeCard(c, lang)).join('')}
                        </div>
                    </div>
                    
                    <!-- Challenges En voyage -->
                    <div class="fade-in stagger-2">
                        <h3 class="font-bold mb-3 flex items-center gap-2">
                            üöó ${lang === 'fr' ? 'En voyage' : lang === 'es' ? 'Viajando' : 'While traveling'}
                            <span class="text-xs text-slate-500">${lang === 'fr' ? '(pendant le voyage)' : '(during travel)'}</span>
                        </h3>
                        <div class="grid grid-cols-2 gap-3">
                            ${travelChallenges.map(c => renderChallengeCard(c, lang)).join('')}
                        </div>
                    </div>
                    
                    <!-- Challenges Long terme -->
                    <div class="fade-in stagger-3">
                        <h3 class="font-bold mb-3 flex items-center gap-2">
                            üèÜ ${lang === 'fr' ? 'Long terme' : lang === 'es' ? 'Largo plazo' : 'Long term'}
                            <span class="text-xs text-slate-500">${lang === 'fr' ? '(sans limite)' : '(no limit)'}</span>
                        </h3>
                        <div class="grid grid-cols-2 gap-3">
                            ${longTermChallenges.map(c => renderChallengeCard(c, lang)).join('')}
                        </div>
                    </div>
                    
                    <!-- Classement -->
                    <div class="card p-5 fade-in stagger-4">
                        <h3 class="font-bold mb-4">üèÖ ${lang === 'fr' ? 'Classement saison' : lang === 'es' ? 'Clasificaci√≥n temporada' : 'Season ranking'}</h3>
                        <div class="space-y-2">
                            ${[
                                { rank: 1, name: 'Marie_Adventure', pts: 4820, league: 'gold' },
                                { rank: 2, name: 'Tom_Roadtrip', pts: 3150, league: 'gold' },
                                { rank: 3, name: 'Sophie_Nomad', pts: 2890, league: 'gold' },
                                { rank: 4, name: state.user?.username || 'Toi', pts: currentPoints, league: state.userLeague, isMe: true },
                                { rank: 5, name: 'Alex_Wanderer', pts: Math.max(currentPoints - 100, 0), league: 'silver' }
                            ].sort((a,b) => b.pts - a.pts).map((p, i) => `
                                <div class="flex items-center gap-3 p-3 rounded-xl ${p.isMe ? 'bg-sky-500/20 border border-sky-500/30' : 'bg-white/5'}">
                                    <span class="text-xl font-bold w-8">${i === 0 ? 'ü•á' : i === 1 ? 'ü•à' : i === 2 ? 'ü•â' : '#' + (i+1)}</span>
                                    <span class="flex-1 ${p.isMe ? 'font-bold text-sky-300' : ''}">${p.name}</span>
                                    <span class="text-sm">${getLeagueInfo(p.league).icon}</span>
                                    <span class="font-bold">${p.pts}</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
        }
        
        function renderChallengeCard(challenge, lang) {
            const progress = Math.min(challenge.current / challenge.target * 100, 100);
            const done = challenge.current >= challenge.target;
            const title = challenge.title[lang] || challenge.title.en;
            
            return `
                <div class="card p-3 ${done ? 'border-emerald-500/30 bg-emerald-500/5' : ''}">
                    <div class="flex items-center gap-3 mb-2">
                        <span class="text-2xl ${done ? '' : 'grayscale opacity-60'}">${challenge.icon}</span>
                        <div class="flex-1 min-w-0">
                            <p class="font-medium text-sm truncate">${title}</p>
                        </div>
                        ${done ? '<span class="text-emerald-400">‚úì</span>' : `<span class="badge badge-warning text-xs">+${challenge.reward}</span>`}
                    </div>
                    <div class="progress-bar" style="height: 4px;"><div class="progress-fill" style="width: ${progress}%"></div></div>
                    <p class="text-right text-xs text-slate-500 mt-1">${challenge.current}/${challenge.target}</p>
                </div>
            `;
        }

        function renderProfile() {
            const vipLevel = getUserVipLevel();
            return `
                <div class="space-y-4">
                    <!-- Header profil -->
                    <div class="card p-6 text-center fade-in">
                        <div class="text-7xl mb-4">${state.user?.avatar}</div>
                        <h2 class="text-2xl font-bold mb-1">${state.user?.username}</h2>
                        ${state.user?.email ? `<p class="text-slate-400 text-sm mb-2">${state.user.email}</p>` : ''}
                        <div class="flex items-center justify-center gap-3 mb-4">
                            <span class="badge badge-primary">${t('level')} ${state.user?.level || 1}</span>
                            <span class="badge badge-warning">üî• ${state.user?.streak || 0}j</span>
                            <span class="px-3 py-1 rounded-full bg-gradient-to-r ${vipLevel.color} text-white text-sm font-bold">${vipLevel.icon} ${t(vipLevel.name)}</span>
                        </div>
                        <p class="text-3xl font-bold gradient-text">${state.user?.score || 0} <span class="text-lg text-slate-400">${t('points')}</span></p>
                    </div>
                    
                    <!-- Statistiques -->
                    <div class="grid grid-cols-3 gap-3 fade-in stagger-1">
                        <div class="card p-4 text-center">
                            <div class="text-2xl mb-2">üìç</div>
                            <div class="text-xl font-bold">${state.user?.spotsShared || 0}</div>
                            <div class="text-xs text-slate-400">${t('spotsShared')}</div>
                        </div>
                        <div class="card p-4 text-center">
                            <div class="text-2xl mb-2">üì∏</div>
                            <div class="text-xl font-bold">${state.user?.checkinsCount || 0}</div>
                            <div class="text-xs text-slate-400">${t('checkinsCount')}</div>
                        </div>
                        <div class="card p-4 text-center">
                            <div class="text-2xl mb-2">‚≠ê</div>
                            <div class="text-xl font-bold">${state.user?.reviewsGiven || 0}</div>
                            <div class="text-xs text-slate-400">${t('reviewsGiven')}</div>
                        </div>
                    </div>
                    
                    <!-- Actions rapides -->
                    <div class="grid grid-cols-2 gap-3 fade-in stagger-2">
                        <!-- Boutique - Mise en avant -->
                        <button onclick="state.showShop=true;render();" class="card p-4 text-center hover:border-emerald-500/30 col-span-2 bg-gradient-to-r from-emerald-500/10 to-sky-500/10 border-emerald-500/20">
                            <div class="flex items-center justify-center gap-4">
                                <span class="text-3xl">üéÅ</span>
                                <div class="text-left">
                                    <p class="font-bold text-lg">${t('shop')}</p>
                                    <p class="text-sm text-slate-400">${state.lang === 'fr' ? '√âchange tes points contre des r√©ductions' : 'Trade points for discounts'}</p>
                                </div>
                                <span class="text-xl ml-auto">‚Üí</span>
                            </div>
                        </button>
                        
                        <button onclick="state.showBadges=true;render();" class="card p-4 text-center hover:border-sky-500/30">
                            <div class="text-2xl mb-2">üèÜ</div>
                            <p class="font-medium">${t('badges')}</p>
                            <p class="text-xs text-slate-400">${state.userBadges.length}/${allBadges.length}</p>
                        </button>
                        <button onclick="state.showChallenges=true;render();" class="card p-4 text-center hover:border-sky-500/30">
                            <div class="text-2xl mb-2">üéØ</div>
                            <p class="font-medium">${t('challenges')}</p>
                        </button>
                        <button onclick="state.showPrivateMessages=true;render();" class="card p-4 text-center hover:border-sky-500/30 relative">
                            <div class="text-2xl mb-2">‚úâÔ∏è</div>
                            <p class="font-medium">${t('messages')}</p>
                            ${state.privateMessages.filter(m => !m.read).length > 0 ? `
                                <span class="absolute top-2 right-2 w-5 h-5 bg-red-500 rounded-full text-xs flex items-center justify-center">${state.privateMessages.filter(m => !m.read).length}</span>
                            ` : ''}
                        </button>
                        <button onclick="state.showStats=true;render();" class="card p-4 text-center hover:border-sky-500/30">
                            <div class="text-2xl mb-2">üìä</div>
                            <p class="font-medium">${t('statistics')}</p>
                        </button>
                        <button onclick="state.activeTab='friends';render();" class="card p-4 text-center hover:border-sky-500/30">
                            <div class="text-2xl mb-2">üë•</div>
                            <p class="font-medium">${t('friends')}</p>
                        </button>
                        <button onclick="state.activeTab='guides';render();" class="card p-4 text-center hover:border-sky-500/30">
                            <div class="text-2xl mb-2">üìö</div>
                            <p class="font-medium">${t('guides')}</p>
                        </button>
                        <button onclick="state.activeTab='quiz';render();" class="card p-4 text-center hover:border-sky-500/30">
                            <div class="text-2xl mb-2">üß†</div>
                            <p class="font-medium">${t('quiz')}</p>
                        </button>
                    </div>
                    
                    <!-- Param√®tres -->
                    <div class="card p-5 fade-in stagger-3">
                        <h3 class="font-bold mb-4">‚öôÔ∏è ${t('settings')}</h3>
                        <div class="space-y-3">
                            <!-- Langue -->
                            <div class="flex items-center justify-between p-3 rounded-xl bg-white/5">
                                <span class="font-medium">üåê Langue / Language</span>
                                <div class="flex gap-2">
                                    <button onclick="changeLang('fr')" class="px-4 py-2 rounded-xl ${state.lang === 'fr' ? 'bg-sky-500/30 text-sky-300' : 'bg-white/5 text-slate-400'}">
                                        üá´üá∑ FR
                                    </button>
                                    <button onclick="changeLang('en')" class="px-4 py-2 rounded-xl ${state.lang === 'en' ? 'bg-sky-500/30 text-sky-300' : 'bg-white/5 text-slate-400'}">
                                        üá¨üáß EN
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Th√®me -->
                            <div class="flex items-center justify-between p-3 rounded-xl bg-white/5">
                                <span class="font-medium">${state.lang === 'fr' ? 'üé® Th√®me' : 'üé® Theme'}</span>
                                <div class="flex gap-2">
                                    <button onclick="changeTheme('dark')" class="px-4 py-2 rounded-xl ${state.theme === 'dark' ? 'bg-sky-500/30 text-sky-300' : 'bg-white/5 text-slate-400'}">
                                        üåô ${state.lang === 'fr' ? 'Sombre' : 'Dark'}
                                    </button>
                                    <button onclick="changeTheme('light')" class="px-4 py-2 rounded-xl ${state.theme === 'light' ? 'bg-amber-500/30 text-amber-300' : 'bg-white/5 text-slate-400'}">
                                        ‚òÄÔ∏è ${state.lang === 'fr' ? 'Clair' : 'Light'}
                                    </button>
                                </div>
                            </div>
                            <button onclick="exportData()" class="btn btn-ghost w-full justify-start">
                                üì• ${t('exportData')}
                            </button>
                            <button onclick="if(confirm('${state.lang === 'fr' ? 'Relancer le tutoriel ?' : 'Restart tutorial?'}')){ state.showTutorial=true; state.tutorialStep=0; Storage.set('tutorialDone',false); render(); }" class="btn btn-ghost w-full justify-start">
                                üìñ ${state.lang === 'fr' ? 'Revoir le tutoriel' : 'Review tutorial'}
                            </button>
                            <button onclick="if(confirm('${state.lang === 'fr' ? 'Se d√©connecter ?' : 'Log out?'}')){ handleLogout(); }" class="btn btn-ghost w-full justify-start text-amber-400">
                                üö™ ${t('logout')}
                            </button>
                            
                            <!-- Section Firebase -->
                            ${isFirebaseConfigured ? `
                                <div class="mt-4 pt-4 border-t border-white/10">
                                    <p class="text-xs text-slate-500 mb-2">üî• Firebase</p>
                                    <button onclick="importSpotsToFirebase()" class="btn btn-primary w-full justify-start mb-2">
                                        üì§ ${state.lang === 'fr' ? 'Importer spots vers Firebase' : 'Import spots to Firebase'}
                                    </button>
                                    <button onclick="loadSpotsFromFirebase().then(()=>render())" class="btn btn-ghost w-full justify-start">
                                        üì• ${state.lang === 'fr' ? 'Recharger depuis Firebase' : 'Reload from Firebase'}
                                    </button>
                                </div>
                            ` : ''}
                            
                            <button onclick="resetApp()" class="btn btn-ghost w-full justify-start text-red-400">
                                üóëÔ∏è ${t('resetApp')}
                            </button>
                        </div>
                    </div>
                    
                    <!-- Section L√©gale -->
                    <div class="card p-5 fade-in stagger-4">
                        <h3 class="font-bold mb-4">üìú ${t('legal')}</h3>
                        <div class="space-y-2">
                            <button onclick="state.legalPage='cgu';render();" class="w-full text-left px-4 py-3 rounded-xl bg-white/5 hover:bg-white/10 text-slate-300 flex items-center justify-between">
                                <span>üìú ${t('termsOfService')}</span><span class="text-slate-500">‚Üí</span>
                            </button>
                            <button onclick="state.legalPage='privacy';render();" class="w-full text-left px-4 py-3 rounded-xl bg-white/5 hover:bg-white/10 text-slate-300 flex items-center justify-between">
                                <span>üîí ${t('privacyPolicy')}</span><span class="text-slate-500">‚Üí</span>
                            </button>
                            <button onclick="state.legalPage='legal';render();" class="w-full text-left px-4 py-3 rounded-xl bg-white/5 hover:bg-white/10 text-slate-300 flex items-center justify-between">
                                <span>‚öñÔ∏è ${t('legalNotice')}</span><span class="text-slate-500">‚Üí</span>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Cr√©dits / √Ä propos -->
                    <div class="card p-5 fade-in stagger-4">
                        <h3 class="font-bold mb-4">‚ÑπÔ∏è ${state.lang === 'fr' ? '√Ä propos' : 'About'}</h3>
                        <div class="space-y-3 text-sm text-slate-400">
                            <p>
                                <strong class="text-white">SpotHitch</strong> - ${state.lang === 'fr' ? 'La communaut√© des autostoppeurs' : 'The hitchhikers community'}
                            </p>
                            <div class="p-3 rounded-xl bg-white/5 border border-white/10">
                                <p class="text-xs mb-2">üìä ${state.lang === 'fr' ? 'Donn√©es des spots' : 'Spots data'}:</p>
                                <p class="text-slate-300">
                                    <a href="https://hitchwiki.org" target="_blank" rel="noopener noreferrer" class="text-sky-400 hover:underline">Hitchwiki.org</a> / 
                                    <a href="https://hitchmap.com" target="_blank" rel="noopener noreferrer" class="text-sky-400 hover:underline">Hitchmap.com</a>
                                </p>
                                <p class="text-xs mt-2">üìú ${state.lang === 'fr' ? 'Licence' : 'License'}: <span class="text-emerald-400">ODBL</span> (Open Database License)</p>
                            </div>
                            <p class="text-xs">
                                ${state.lang === 'fr' 
                                    ? '40 spots v√©rifi√©s ‚Ä¢ 12 pays ‚Ä¢ Donn√©es communautaires libres' 
                                    : '40 verified spots ‚Ä¢ 12 countries ‚Ä¢ Free community data'}
                            </p>
                        </div>
                    </div>
                </div>
            `;
        }

        // ==================== NOUVELLES PAGES ====================
        
        function renderFiltersModal() {
            return `
                <div class="fixed inset-0 z-50 flex items-center justify-center p-4" onclick="if(event.target===this){state.showFilters=false;render();}">
                    <div class="absolute inset-0 bg-black/70"></div>
                    <div class="card p-6 max-w-md w-full relative z-10 fade-in">
                        <div class="flex items-center justify-between mb-6">
                            <h2 class="text-xl font-bold">‚öôÔ∏è ${t('filters')}</h2>
                            <button onclick="state.showFilters=false;render();" class="text-2xl text-slate-400" aria-label="Fermer">√ó</button>
                        </div>
                        <div class="space-y-6">
                            <div>
                                <label class="block text-sm font-medium mb-3">${t('minRating')}: ${state.filterMinRating}‚≠ê</label>
                                <input type="range" min="0" max="5" step="0.5" value="${state.filterMinRating}" 
                                    onchange="state.filterMinRating=parseFloat(this.value);render();" 
                                    class="w-full h-2 bg-white/10 rounded-lg appearance-none cursor-pointer" />
                            </div>
                            <div>
                                <label class="block text-sm font-medium mb-3">${t('maxWait')}: ${state.filterMaxWait}min</label>
                                <input type="range" min="5" max="60" step="5" value="${state.filterMaxWait}" 
                                    onchange="state.filterMaxWait=parseInt(this.value);render();" 
                                    class="w-full h-2 bg-white/10 rounded-lg appearance-none cursor-pointer" />
                            </div>
                            <div class="flex gap-3">
                                <button onclick="state.filterMinRating=0;state.filterMaxWait=60;render();" class="btn btn-ghost flex-1">
                                    ${t('resetFilters')}
                                </button>
                                <button onclick="state.showFilters=false;render();" class="btn btn-primary flex-1">
                                    ${t('applyFilters')}
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function renderBadgesModal() {
            const earnedBadges = state.userBadges || [];
            return `
                <div class="fixed inset-0 z-50 flex items-center justify-center p-4" onclick="if(event.target===this){state.showBadges=false;render();}">
                    <div class="absolute inset-0 bg-black/70"></div>
                    <div class="card p-6 max-w-md w-full max-h-[80vh] overflow-y-auto relative z-10 fade-in">
                        <div class="flex items-center justify-between mb-6">
                            <h2 class="text-xl font-bold">üèÜ ${t('badges')}</h2>
                            <button onclick="state.showBadges=false;render();" class="text-2xl text-slate-400" aria-label="Fermer">√ó</button>
                        </div>
                        <p class="text-slate-400 mb-4">${earnedBadges.length}/${allBadges.length} ${state.lang === 'fr' ? 'd√©bloqu√©s' : 'unlocked'}</p>
                        <div class="grid grid-cols-3 gap-3">
                            ${allBadges.map(badge => {
                                const earned = earnedBadges.includes(badge.id);
                                return `
                                    <div class="p-4 rounded-xl text-center ${earned ? 'bg-gradient-to-br from-amber-500/20 to-yellow-500/20 border border-amber-500/30' : 'bg-white/5 opacity-50'}">
                                        <div class="text-3xl mb-2 ${earned ? '' : 'grayscale'}">${badge.icon}</div>
                                        <p class="text-xs font-medium">${t(badge.name)}</p>
                                        ${earned ? `<p class="text-xs text-amber-400 mt-1">+${badge.reward}pts</p>` : ''}
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                </div>
            `;
        }
        
        function renderChallengesModal() {
            const progress = state.challengeProgress || {};
            return `
                <div class="fixed inset-0 z-50 flex items-center justify-center p-4" onclick="if(event.target===this){state.showChallenges=false;render();}">
                    <div class="absolute inset-0 bg-black/70"></div>
                    <div class="card p-6 max-w-md w-full max-h-[80vh] overflow-y-auto relative z-10 fade-in">
                        <div class="flex items-center justify-between mb-6">
                            <h2 class="text-xl font-bold">üéØ ${t('challenges')}</h2>
                            <button onclick="state.showChallenges=false;render();" class="text-2xl text-slate-400" aria-label="Fermer">√ó</button>
                        </div>
                        
                        <h3 class="font-bold mb-3 text-amber-400">üìÖ ${t('dailyChallenge')}</h3>
                        <div class="space-y-3 mb-6">
                            ${allChallenges.filter(c => c.type === 'daily').map(challenge => {
                                const current = progress[challenge.id] || 0;
                                const pct = Math.min((current / challenge.target) * 100, 100);
                                const done = current >= challenge.target;
                                return `
                                    <div class="p-4 rounded-xl ${done ? 'bg-emerald-500/20 border border-emerald-500/30' : 'bg-white/5'}">
                                        <div class="flex items-center gap-3 mb-2">
                                            <span class="text-2xl">${challenge.icon}</span>
                                            <div class="flex-1">
                                                <p class="font-medium">${challenge.desc[state.lang]}</p>
                                                <p class="text-xs text-slate-400">${current}/${challenge.target} ‚Ä¢ +${challenge.reward}pts</p>
                                            </div>
                                            ${done ? '<span class="text-emerald-400 text-xl">‚úì</span>' : ''}
                                        </div>
                                        <div class="progress-bar"><div class="progress-fill" style="width: ${pct}%"></div></div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                        
                        <h3 class="font-bold mb-3 text-sky-400">üìÜ ${t('weeklyChallenge')}</h3>
                        <div class="space-y-3">
                            ${allChallenges.filter(c => c.type === 'weekly').map(challenge => {
                                const current = progress[challenge.id] || 0;
                                const pct = Math.min((current / challenge.target) * 100, 100);
                                const done = current >= challenge.target;
                                return `
                                    <div class="p-4 rounded-xl ${done ? 'bg-emerald-500/20 border border-emerald-500/30' : 'bg-white/5'}">
                                        <div class="flex items-center gap-3 mb-2">
                                            <span class="text-2xl">${challenge.icon}</span>
                                            <div class="flex-1">
                                                <p class="font-medium">${challenge.desc[state.lang]}</p>
                                                <p class="text-xs text-slate-400">${current}/${challenge.target} ‚Ä¢ +${challenge.reward}pts</p>
                                            </div>
                                            ${done ? '<span class="text-emerald-400 text-xl">‚úì</span>' : ''}
                                        </div>
                                        <div class="progress-bar"><div class="progress-fill" style="width: ${pct}%"></div></div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                </div>
            `;
        }
        
        function renderMessagesModal() {
            return `
                <div class="fixed inset-0 z-50 flex items-center justify-center p-4" onclick="if(event.target===this){state.showPrivateMessages=false;render();}">
                    <div class="absolute inset-0 bg-black/70"></div>
                    <div class="card p-6 max-w-md w-full max-h-[80vh] overflow-y-auto relative z-10 fade-in">
                        <div class="flex items-center justify-between mb-6">
                            <h2 class="text-xl font-bold">‚úâÔ∏è ${t('messages')}</h2>
                            <button onclick="state.showPrivateMessages=false;render();" class="text-2xl text-slate-400" aria-label="Fermer">√ó</button>
                        </div>
                        ${state.privateMessages.length === 0 ? `
                            <div class="text-center py-8">
                                <div class="text-5xl mb-4">üì≠</div>
                                <p class="text-slate-400">${t('noMessages')}</p>
                            </div>
                        ` : `
                            <div class="space-y-3">
                                ${state.privateMessages.map(msg => `
                                    <div class="p-4 rounded-xl ${msg.read ? 'bg-white/5' : 'bg-sky-500/10 border border-sky-500/30'}" onclick="markMessageRead(${msg.id})">
                                        <div class="flex items-center gap-3 mb-2">
                                            <span class="text-2xl">${msg.fromAvatar}</span>
                                            <div class="flex-1">
                                                <p class="font-medium">${msg.from}</p>
                                                <p class="text-xs text-slate-400">${msg.date}</p>
                                            </div>
                                            ${!msg.read ? '<span class="w-3 h-3 bg-sky-500 rounded-full"></span>' : ''}
                                        </div>
                                        <p class="text-slate-300">${msg.text}</p>
                                    </div>
                                `).join('')}
                            </div>
                        `}
                    </div>
                </div>
            `;
        }
        
        function renderStatsModal() {
            const user = state.user || {};
            return `
                <div class="fixed inset-0 z-50 flex items-center justify-center p-4" onclick="if(event.target===this){state.showStats=false;render();}">
                    <div class="absolute inset-0 bg-black/70"></div>
                    <div class="card p-6 max-w-md w-full max-h-[80vh] overflow-y-auto relative z-10 fade-in">
                        <div class="flex items-center justify-between mb-6">
                            <h2 class="text-xl font-bold">üìä ${t('statistics')}</h2>
                            <button onclick="state.showStats=false;render();" class="text-2xl text-slate-400" aria-label="Fermer">√ó</button>
                        </div>
                        
                        <div class="grid grid-cols-2 gap-4 mb-6">
                            <div class="p-4 rounded-xl bg-gradient-to-br from-sky-500/20 to-blue-500/20 text-center">
                                <p class="text-3xl font-bold">${user.score || 0}</p>
                                <p class="text-sm text-slate-400">${t('points')}</p>
                            </div>
                            <div class="p-4 rounded-xl bg-gradient-to-br from-amber-500/20 to-orange-500/20 text-center">
                                <p class="text-3xl font-bold">${user.streak || 0}</p>
                                <p class="text-sm text-slate-400">${t('streak')} üî•</p>
                            </div>
                        </div>
                        
                        <h3 class="font-bold mb-3">${t('monthlyStats')}</h3>
                        <div class="space-y-3 mb-6">
                            <div class="flex items-center justify-between p-3 rounded-xl bg-white/5">
                                <span class="text-slate-400">üìç Spots partag√©s</span>
                                <span class="font-bold">${user.spotsShared || 0}</span>
                            </div>
                            <div class="flex items-center justify-between p-3 rounded-xl bg-white/5">
                                <span class="text-slate-400">üì∏ Check-ins</span>
                                <span class="font-bold">${user.checkinsCount || 0}</span>
                            </div>
                            <div class="flex items-center justify-between p-3 rounded-xl bg-white/5">
                                <span class="text-slate-400">‚≠ê √âvaluations</span>
                                <span class="font-bold">${user.reviewsGiven || 0}</span>
                            </div>
                            <div class="flex items-center justify-between p-3 rounded-xl bg-white/5">
                                <span class="text-slate-400">üß† Quiz jou√©s</span>
                                <span class="font-bold">${user.quizPlayed || 0}</span>
                            </div>
                        </div>
                        
                        <h3 class="font-bold mb-3">üèÜ ${t('badges')}</h3>
                        <div class="flex flex-wrap gap-2">
                            ${(state.userBadges || []).map(badgeId => {
                                const badge = allBadges.find(b => b.id === badgeId);
                                return badge ? `<span class="text-2xl" title="${t(badge.name)}">${badge.icon}</span>` : '';
                            }).join('') || '<span class="text-slate-500">Aucun badge</span>'}
                        </div>
                    </div>
                </div>
            `;
        }
        
        function renderOfflineSpots() {
            const savedSpots = state.spots.filter(s => state.savedSpots.includes(s.id));
            return `
                <div class="space-y-4">
                    <div class="flex items-center justify-between">
                        <h2 class="text-2xl font-bold fade-in">üì• ${t('offlineSpots')}</h2>
                        <button onclick="state.activeTab='spots';render();" class="btn btn-ghost">‚Üê ${t('spots')}</button>
                    </div>
                    ${savedSpots.length === 0 ? `
                        <div class="card p-12 text-center fade-in">
                            <div class="text-6xl mb-4">üì•</div>
                            <h3 class="text-xl font-bold mb-2">${state.lang === 'fr' ? 'Aucun spot sauvegard√©' : 'No saved spots'}</h3>
                            <p class="text-slate-400">${state.lang === 'fr' ? 'Sauvegarde des spots pour les consulter hors-ligne' : 'Save spots to view them offline'}</p>
                        </div>
                    ` : `
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            ${savedSpots.map((spot, i) => `
                                <div onclick="state.selectedSpot=${spot.id};render();" class="spot-card-simple fade-in stagger-${Math.min(i + 1, 4)}">
                                    <div class="relative">
                                        <img src="${spot.photoUrl}" class="w-full h-36 object-cover" />
                                        <span class="absolute top-3 right-3 text-emerald-400">üì•</span>
                                    </div>
                                    <div class="p-4">
                                        <h3 class="font-bold">${spot.from} ‚Üí ${spot.to}</h3>
                                        <p class="text-sm text-slate-400">‚≠ê ${spot.globalRating.toFixed(1)} ‚Ä¢ ‚è±Ô∏è ~${spot.avgWaitTime}min</p>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    `}
                </div>
            `;
        }
        
        function renderBadgePopup() {
            const badge = allBadges.find(b => b.id === state.showBadgePopup);
            if (!badge) return '';
            return `
                <div class="fixed inset-0 z-60 flex items-center justify-center p-4" onclick="state.showBadgePopup=null;render();">
                    <div class="absolute inset-0 bg-black/80"></div>
                    <div class="card p-8 max-w-sm w-full text-center relative z-10 fade-in border-2 border-amber-500/50">
                        <div class="text-6xl mb-4 bounce">${badge.icon}</div>
                        <h2 class="text-2xl font-bold mb-2 text-amber-400">${t('badgeUnlocked')}</h2>
                        <p class="text-xl font-bold mb-4">${t(badge.name)}</p>
                        <p class="text-emerald-400 text-lg">+${badge.reward} ${t('points')}</p>
                    </div>
                </div>
            `;
        }

        // ==================== BOUTIQUE ====================
        
        function getUserVipLevel() {
            const totalPoints = state.totalPointsEarned || 0;
            let level = vipLevels[0];
            for (const l of vipLevels) {
                if (totalPoints >= l.minPoints) level = l;
            }
            return level;
        }
        
        function getNextVipLevel() {
            const currentLevel = getUserVipLevel();
            const idx = vipLevels.findIndex(l => l.id === currentLevel.id);
            return vipLevels[idx + 1] || null;
        }
        
        function renderShopModal() {
            const userPoints = state.user?.score || 0;
            const vipLevel = getUserVipLevel();
            const nextLevel = getNextVipLevel();
            const category = state.shopCategory;
            
            let rewards = shopRewards;
            if (category !== 'all') {
                rewards = rewards.filter(r => r.category === category);
            }
            
            // Trier : disponibles en premier
            rewards.sort((a, b) => {
                const aAfford = userPoints >= a.cost;
                const bAfford = userPoints >= b.cost;
                if (aAfford && !bAfford) return -1;
                if (!aAfford && bAfford) return 1;
                return a.cost - b.cost;
            });
            
            return `
                <div class="fixed inset-0 z-50 flex items-end sm:items-center justify-center" onclick="if(event.target===this){state.showShop=false;render();}">
                    <div class="absolute inset-0 bg-black/80"></div>
                    <div class="card w-full sm:max-w-xl max-h-[90vh] overflow-y-auto relative z-10 slide-up sm:rounded-2xl rounded-t-3xl">
                        
                        <!-- Header -->
                        <div class="sticky top-0 bg-slate-900/95 backdrop-blur p-4 border-b border-white/10 z-10">
                            <div class="flex items-center justify-between mb-4">
                                <h2 class="text-xl font-bold">üéÅ ${t('shop')}</h2>
                                <button onclick="state.showShop=false;render();" class="text-2xl text-slate-400" aria-label="Fermer">√ó</button>
                            </div>
                            
                            <!-- Points & VIP -->
                            <div class="flex items-center gap-3 mb-4">
                                <div class="flex-1 p-3 rounded-xl bg-gradient-to-r ${vipLevel.color}">
                                    <div class="flex items-center gap-2">
                                        <span class="text-2xl">${vipLevel.icon}</span>
                                        <div>
                                            <p class="font-bold text-white">${t(vipLevel.name)}</p>
                                            ${vipLevel.discount > 0 ? `<p class="text-xs text-white/80">-${vipLevel.discount}% ${t('vipBonus')}</p>` : ''}
                                        </div>
                                    </div>
                                </div>
                                <div class="p-3 rounded-xl bg-white/10 text-center">
                                    <p class="text-2xl font-bold gradient-text">${userPoints}</p>
                                    <p class="text-xs text-slate-400">${t('points')}</p>
                                </div>
                            </div>
                            
                            <!-- Progress to next level -->
                            ${nextLevel ? `
                                <div class="mb-4">
                                    <div class="flex items-center justify-between text-xs mb-1">
                                        <span class="text-slate-400">${t('nextLevel')}: ${nextLevel.icon} ${t(nextLevel.name)}</span>
                                        <span class="text-slate-400">${state.totalPointsEarned || 0}/${nextLevel.minPoints}</span>
                                    </div>
                                    <div class="progress-bar">
                                        <div class="progress-fill" style="width: ${Math.min(((state.totalPointsEarned || 0) / nextLevel.minPoints) * 100, 100)}%"></div>
                                    </div>
                                </div>
                            ` : ''}
                            
                            <!-- Cat√©gories -->
                            <div class="flex gap-2 overflow-x-auto pb-2">
                                ${rewardCategories.map(cat => `
                                    <button onclick="state.shopCategory='${cat.id}';render();" class="badge ${state.shopCategory === cat.id ? 'badge-success' : 'badge-primary'} cursor-pointer whitespace-nowrap">
                                        ${cat.icon} ${cat.name[state.lang]}
                                    </button>
                                `).join('')}
                            </div>
                        </div>
                        
                        <!-- R√©compenses -->
                        <div class="p-4 space-y-3">
                            <!-- Bouton Mes R√©compenses -->
                            <button onclick="state.showShop=false;state.showMyRewards=true;render();" class="w-full p-4 rounded-xl bg-gradient-to-r from-emerald-500/20 to-sky-500/20 border border-emerald-500/30 flex items-center justify-between">
                                <div class="flex items-center gap-3">
                                    <span class="text-2xl">üéüÔ∏è</span>
                                    <div class="text-left">
                                        <p class="font-bold">${t('myRewards')}</p>
                                        <p class="text-sm text-slate-400">${state.earnedRewards.length} ${state.lang === 'fr' ? 'codes actifs' : 'active codes'}</p>
                                    </div>
                                </div>
                                <span class="text-xl">‚Üí</span>
                            </button>
                            
                            <!-- Liste des r√©compenses -->
                            ${rewards.map(reward => {
                                const canAfford = userPoints >= reward.cost;
                                const discountedCost = vipLevel.discount > 0 ? Math.floor(reward.cost * (1 - vipLevel.discount / 100)) : reward.cost;
                                const alreadyOwned = state.earnedRewards.some(r => r.id === reward.id);
                                const isVipLocked = reward.vipOnly && vipLevel.id === 'bronze';
                                
                                return `
                                    <div class="p-4 rounded-xl ${alreadyOwned ? 'bg-emerald-500/10 border border-emerald-500/30' : canAfford && !isVipLocked ? 'bg-white/5 border border-white/10' : 'bg-white/5 opacity-60'} transition-all">
                                        <div class="flex items-center gap-4">
                                            <div class="w-14 h-14 rounded-xl bg-white/10 flex items-center justify-center text-3xl">
                                                ${reward.logo}
                                            </div>
                                            <div class="flex-1">
                                                <div class="flex items-center gap-2">
                                                    <p class="font-bold">${reward.partner}</p>
                                                    ${reward.vipOnly ? '<span class="text-xs px-2 py-0.5 rounded bg-purple-500/30 text-purple-300">VIP</span>' : ''}
                                                </div>
                                                <p class="text-sm text-slate-300">${reward.title[state.lang]}</p>
                                                <div class="flex items-center gap-2 mt-1">
                                                    ${vipLevel.discount > 0 ? `
                                                        <span class="text-xs text-slate-500 line-through">${reward.cost}</span>
                                                        <span class="text-sm font-bold text-emerald-400">${discountedCost} pts</span>
                                                    ` : `
                                                        <span class="text-sm font-bold text-sky-400">${reward.cost} pts</span>
                                                    `}
                                                </div>
                                            </div>
                                            ${alreadyOwned ? `
                                                <span class="badge badge-success">‚úì</span>
                                            ` : isVipLocked ? `
                                                <span class="text-2xl">üîí</span>
                                            ` : `
                                                <button onclick="redeemReward(${reward.id})" class="btn ${canAfford ? 'btn-primary' : 'btn-ghost'} py-2 px-4" ${!canAfford ? 'disabled' : ''}>
                                                    ${t('redeem')}
                                                </button>
                                            `}
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                </div>
            `;
        }
        
        function renderMyRewardsModal() {
            const rewards = state.earnedRewards || [];
            
            return `
                <div class="fixed inset-0 z-50 flex items-end sm:items-center justify-center" onclick="if(event.target===this){state.showMyRewards=false;render();}">
                    <div class="absolute inset-0 bg-black/80"></div>
                    <div class="card w-full sm:max-w-md max-h-[85vh] overflow-y-auto relative z-10 slide-up sm:rounded-2xl rounded-t-3xl p-6">
                        
                        <div class="flex items-center justify-between mb-6">
                            <div class="flex items-center gap-3">
                                <button onclick="state.showMyRewards=false;state.showShop=true;render();" class="text-xl">‚Üê</button>
                                <h2 class="text-xl font-bold">üéüÔ∏è ${t('myRewards')}</h2>
                            </div>
                            <button onclick="state.showMyRewards=false;render();" class="text-2xl text-slate-400" aria-label="Fermer">√ó</button>
                        </div>
                        
                        ${rewards.length === 0 ? `
                            <div class="text-center py-12">
                                <div class="text-6xl mb-4">üéÅ</div>
                                <h3 class="text-xl font-bold mb-2">${t('noRewards')}</h3>
                                <p class="text-slate-400 mb-6">${t('earnMore')}</p>
                                <button onclick="state.showMyRewards=false;state.showShop=true;render();" class="btn btn-primary">
                                    ${t('shop')} ‚Üí
                                </button>
                            </div>
                        ` : `
                            <div class="space-y-4">
                                ${rewards.map(reward => `
                                    <div class="p-4 rounded-xl bg-gradient-to-r from-emerald-500/10 to-sky-500/10 border border-emerald-500/30">
                                        <div class="flex items-center gap-4 mb-3">
                                            <div class="w-12 h-12 rounded-xl bg-white/10 flex items-center justify-center text-2xl">
                                                ${reward.logo}
                                            </div>
                                            <div class="flex-1">
                                                <p class="font-bold">${reward.partner}</p>
                                                <p class="text-sm text-slate-300">${reward.title}</p>
                                            </div>
                                        </div>
                                        <div class="p-3 rounded-lg bg-black/30 flex items-center justify-between">
                                            <div>
                                                <p class="text-xs text-slate-400 mb-1">${t('rewardCode')}</p>
                                                <p class="font-mono font-bold text-lg text-emerald-400">${reward.code}</p>
                                            </div>
                                            <button onclick="copyRewardCode('${reward.code}')" class="btn btn-ghost py-2 px-4">
                                                üìã ${t('copyCode')}
                                            </button>
                                        </div>
                                        <p class="text-xs text-slate-500 mt-2">${t('expires')} ${reward.expiresAt}</p>
                                    </div>
                                `).join('')}
                            </div>
                        `}
                    </div>
                </div>
            `;
        }

        function renderAddSpotModal() {
            const step = state.addSpotStep;
            const data = state.addSpotData;
            
            return `
                <div class="fixed inset-0 z-50 flex items-end sm:items-center justify-center" onclick="if(event.target===this){closeAddSpot();}">
                    <div class="absolute inset-0 bg-black/70"></div>
                    <div class="card w-full sm:max-w-lg max-h-[90vh] overflow-y-auto relative z-10 slide-up sm:rounded-2xl rounded-t-3xl p-6">
                        
                        <!-- Header avec fermeture -->
                        <div class="flex items-center justify-between mb-4">
                            <h2 class="text-xl font-bold">üìç ${t('addSpot')}</h2>
                            <button onclick="closeAddSpot()" class="text-2xl text-slate-400 hover:text-white" aria-label="Fermer">√ó</button>
                        </div>
                        
                        <!-- Indicateur d'√©tapes -->
                        <div class="flex items-center gap-2 mb-6">
                            <div class="wizard-dot ${step >= 1 ? 'active' : ''} ${step > 1 ? 'done' : ''}">
                                ${step > 1 ? '‚úì' : '1'}
                            </div>
                            <div class="wizard-line ${step > 1 ? 'done' : ''}"></div>
                            <div class="wizard-dot ${step >= 2 ? 'active' : ''} ${step > 2 ? 'done' : ''}">
                                ${step > 2 ? '‚úì' : '2'}
                            </div>
                            <div class="wizard-line ${step > 2 ? 'done' : ''}"></div>
                            <div class="wizard-dot ${step >= 3 ? 'active' : ''}">3</div>
                        </div>
                        
                        <!-- √âtape 1 : Photo -->
                        ${step === 1 ? `
                            <div class="space-y-4 fade-in">
                                <div class="text-center mb-4">
                                    <p class="text-slate-400">${t('wizardTakePhoto')}</p>
                                </div>
                                <div class="photo-upload ${data.photo ? 'has-photo' : ''}" onclick="document.getElementById('photo-input').click();" style="min-height: 200px;">
                                    ${data.photo ? `
                                        <img src="${data.photo}" alt="Preview" />
                                    ` : `
                                        <div class="text-6xl mb-3">üì∏</div>
                                        <p class="text-slate-300 font-medium">${t('takePhoto')}</p>
                                        <p class="text-sm text-slate-500 mt-2">${t('chooseFromGallery')}</p>
                                    `}
                                </div>
                                <input type="file" id="photo-input" accept="image/*" capture="environment" onchange="handleWizardPhoto(event)" class="hidden" />
                                
                                <button onclick="nextWizardStep()" class="btn btn-primary w-full py-4" ${!data.photo ? 'disabled style="opacity:0.5"' : ''}>
                                    ${t('wizardNext')} ‚Üí
                                </button>
                            </div>
                        ` : ''}
                        
                        <!-- √âtape 2 : Infos -->
                        ${step === 2 ? `
                            <div class="space-y-4 fade-in">
                                <div class="text-center mb-4">
                                    <p class="text-slate-400">${t('wizardAddInfo')}</p>
                                </div>
                                
                                <div class="grid grid-cols-2 gap-3">
                                    <div>
                                        <label class="block text-sm font-medium text-slate-300 mb-2">${t('from')}</label>
                                        <input type="text" id="wizard-from" class="input-modern" placeholder="Paris" value="${data.from}" oninput="state.addSpotData.from=this.value" />
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-slate-300 mb-2">${t('to')}</label>
                                        <input type="text" id="wizard-to" class="input-modern" placeholder="Lyon" value="${data.to}" oninput="state.addSpotData.to=this.value" />
                                    </div>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-slate-300 mb-2">${t('description')}</label>
                                    <textarea id="wizard-desc" class="input-modern min-h-28" placeholder="${t('description')}" oninput="state.addSpotData.description=this.value">${data.description}</textarea>
                                </div>
                                
                                <div class="flex gap-3">
                                    <button onclick="prevWizardStep()" class="btn btn-ghost flex-1">
                                        ‚Üê ${t('wizardBack')}
                                    </button>
                                    <button onclick="nextWizardStep()" class="btn btn-primary flex-1" ${!data.from || !data.to ? 'disabled style="opacity:0.5"' : ''}>
                                        ${t('wizardNext')} ‚Üí
                                    </button>
                                </div>
                            </div>
                        ` : ''}
                        
                        <!-- √âtape 3 : Confirmation -->
                        ${step === 3 ? `
                            <div class="space-y-4 fade-in">
                                <div class="text-center mb-4">
                                    <p class="text-slate-400">${t('wizardConfirm')}</p>
                                </div>
                                
                                <!-- R√©capitulatif -->
                                <div class="card p-4 bg-white/5">
                                    <img src="${data.photo}" class="w-full h-40 object-cover rounded-xl mb-4" />
                                    <div class="flex items-center gap-2 mb-2">
                                        <span class="font-bold text-lg">${data.from}</span>
                                        <span class="text-sky-400">‚Üí</span>
                                        <span class="font-bold text-lg">${data.to}</span>
                                    </div>
                                    <p class="text-slate-400 text-sm">${data.description}</p>
                                </div>
                                
                                <div class="p-4 rounded-xl bg-emerald-500/20 border border-emerald-500/30 text-center">
                                    <p class="font-medium text-emerald-300">üéÅ +30 points</p>
                                </div>
                                
                                <div class="flex gap-3">
                                    <button onclick="prevWizardStep()" class="btn btn-ghost flex-1">
                                        ‚Üê ${t('wizardBack')}
                                    </button>
                                    <button onclick="submitWizardSpot()" class="btn btn-success flex-1">
                                        ${t('wizardPublish')} üöÄ
                                    </button>
                                </div>
                            </div>
                        ` : ''}
                        
                    </div>
                </div>
            `;
        }

        function renderRateModal() {
            const spot = state.spots.find(s => s.id === state.selectedSpot);
            if (!spot) return '';
            return `
                <div class="fixed inset-0 z-50 flex items-end sm:items-center justify-center">
                    <div class="absolute inset-0 bg-black/70" onclick="state.showRateSpot=false;render();"></div>
                    <div class="card w-full sm:max-w-lg max-h-[90vh] overflow-y-auto relative z-10 slide-up sm:rounded-2xl rounded-t-3xl p-6">
                        <div class="flex items-center justify-between mb-6">
                            <h2 class="text-xl font-bold">‚≠ê ${t('rateSpot')}</h2>
                            <button onclick="state.showRateSpot=false;render();" class="text-2xl text-slate-400" aria-label="Fermer">√ó</button>
                        </div>
                        <p class="text-slate-400 mb-6">${spot.from} ‚Üí ${spot.to}</p>
                        <form onsubmit="handleRate(event, ${spot.id})" class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-slate-300 mb-2">${t('waitTime')}</label>
                                <div class="flex gap-2">
                                    ${['5', '15', '30', '45', '60+'].map(time => `
                                        <label class="flex-1">
                                            <input type="radio" name="waitTime" value="${time}" class="hidden peer" required />
                                            <div class="p-3 rounded-xl bg-white/5 text-center cursor-pointer peer-checked:bg-sky-500/30 peer-checked:border-sky-500 border border-transparent transition-all">${time}min</div>
                                        </label>
                                    `).join('')}
                                </div>
                            </div>
                            ${['accessibility', 'safety', 'visibility', 'traffic'].map(key => `
                                <div>
                                    <label class="block text-sm font-medium text-slate-300 mb-2">${t(key === 'safety' ? 'safetyRating' : key)}</label>
                                    <div class="star-rating" id="rating-${key}">${[1,2,3,4,5].map(r => `<span class="star" onclick="setRating('${key}',${r})">‚≠ê</span>`).join('')}</div>
                                    <input type="hidden" name="${key}" id="input-${key}" value="0" required />
                                </div>
                            `).join('')}
                            <div><label class="block text-sm font-medium text-slate-300 mb-2">${t('comment')}</label><textarea name="comment" class="input-modern min-h-20" placeholder="..."></textarea></div>
                            <button type="submit" class="btn btn-primary w-full py-4">${t('submit')} ‚≠ê</button>
                        </form>
                    </div>
                </div>
            `;
        }

        function renderReminder() {
            const spot = state.spots.find(s => s.id === state.lastCheckinSpot);
            if (!spot) return '';
            return `
                <div class="reminder-popup fade-in">
                    <div class="flex items-start gap-4 mb-4">
                        <div class="text-4xl">‚≠ê</div>
                        <div>
                            <h3 class="font-bold text-lg">${t('reminderTitle')}</h3>
                            <p class="text-sm text-slate-400">${spot.from} ‚Üí ${spot.to}</p>
                            <p class="text-sm text-slate-400 mt-1">${t('reminderDesc')}</p>
                        </div>
                    </div>
                    <div class="flex gap-3">
                        <button onclick="state.showReminder=false;render();" class="btn btn-ghost flex-1">${t('remindLater')}</button>
                        <button onclick="state.showReminder=false;state.selectedSpot=${spot.id};state.showRateSpot=true;render();" class="btn btn-primary flex-1">‚≠ê ${t('rate')}</button>
                    </div>
                </div>
            `;
        }

        function renderTutorial() {
            const steps = [
                { title: t('tuto1Title'), desc: t('tuto1Desc'), icon: 'üè†', targetId: 'nav-home', tab: 'home' },
                { title: t('tuto2Title'), desc: t('tuto2Desc'), icon: 'üó∫Ô∏è', targetId: 'nav-spots', tab: 'spots' },
                { title: t('tuto3Title'), desc: t('tuto3Desc'), icon: '‚ûï', targetId: 'fab-add', tab: 'spots' },
                { title: t('tuto5Title'), desc: t('tuto5Desc'), icon: 'üí¨', targetId: 'nav-chat', tab: 'chat' },
                { title: t('tuto6Title'), desc: t('tuto6Desc'), icon: 'üß≠', targetId: 'nav-planner', tab: 'planner' },
                { title: t('tuto7Title'), desc: t('tuto7Desc'), icon: 'üë§', targetId: 'nav-profile', tab: 'profile' },
                { title: t('tuto8Title'), desc: t('tuto8Desc'), icon: 'üÜò', targetId: 'btn-sos', tab: 'home' }
            ];
            
            if (state.tutorialStep >= steps.length) {
                finishTutorial();
                return '';
            }
            
            const step = steps[state.tutorialStep];
            const isLast = state.tutorialStep === steps.length - 1;
            const isFirst = state.tutorialStep === 0;
            
            // Positionner apr√®s le rendu
            setTimeout(() => positionTutorial(step.targetId), 100);
            
            return `
                <div class="tuto-overlay" onclick="skipTutorial()"></div>
                <div id="tuto-highlight" class="tuto-highlight-box" style="display:none;"></div>
                <div id="tuto-bubble" class="tuto-bubble" onclick="event.stopPropagation()" style="opacity:0;">
                    <div class="flex items-center gap-3 mb-3">
                        <div class="w-12 h-12 rounded-xl bg-sky-500/20 flex items-center justify-center text-2xl">${step.icon}</div>
                        <h3 class="font-bold text-lg flex-1">${step.title}</h3>
                    </div>
                    <p class="text-slate-300 mb-5">${step.desc}</p>
                    
                    <div class="flex gap-2">
                        ${!isFirst ? `
                            <button onclick="prevTutoStep()" class="btn btn-ghost flex-1 py-3">‚Üê</button>
                        ` : `
                            <button onclick="skipTutorial()" class="btn btn-ghost flex-1 py-3">${t('tutoSkip')}</button>
                        `}
                        <button onclick="${isLast ? 'finishTutorial()' : 'nextTutoStep()'}" class="btn btn-primary flex-1 py-3">
                            ${isLast ? '‚úì ' + t('tutoFinish') : t('tutoNext') + ' ‚Üí'}
                        </button>
                    </div>
                    
                    <div class="tuto-dots mt-4">
                        ${steps.map((_, i) => `<div class="tuto-dot ${i === state.tutorialStep ? 'active' : i < state.tutorialStep ? 'done' : ''}"></div>`).join('')}
                    </div>
                </div>
            `;
        }
        
        function positionTutorial(targetId) {
            const target = document.getElementById(targetId);
            const bubble = document.getElementById('tuto-bubble');
            const highlight = document.getElementById('tuto-highlight');
            
            if (!target || !bubble || !highlight) return;
            
            const rect = target.getBoundingClientRect();
            const padding = 8;
            
            // Positionner le highlight autour de l'√©l√©ment cible
            highlight.style.display = 'block';
            highlight.style.position = 'fixed';
            highlight.style.left = (rect.left - padding) + 'px';
            highlight.style.top = (rect.top - padding) + 'px';
            highlight.style.width = (rect.width + padding * 2) + 'px';
            highlight.style.height = (rect.height + padding * 2) + 'px';
            
            // D√©terminer la position de la bulle
            const bubbleWidth = 300;
            const bubbleHeight = bubble.offsetHeight || 250;
            const screenWidth = window.innerWidth;
            const screenHeight = window.innerHeight;
            
            let bubbleLeft, bubbleTop;
            
            // Si l'√©l√©ment est en bas de l'√©cran (barre de nav)
            if (rect.top > screenHeight / 2) {
                // Bulle au-dessus
                bubbleTop = rect.top - bubbleHeight - 20;
                bubbleLeft = Math.max(20, Math.min(rect.left + rect.width/2 - bubbleWidth/2, screenWidth - bubbleWidth - 20));
            } 
            // Si l'√©l√©ment est en haut (header, SOS)
            else if (rect.top < 100) {
                // Bulle en dessous
                bubbleTop = rect.bottom + 20;
                bubbleLeft = Math.max(20, Math.min(rect.left + rect.width/2 - bubbleWidth/2, screenWidth - bubbleWidth - 20));
            }
            // Si l'√©l√©ment est √† droite (FAB)
            else if (rect.left > screenWidth / 2) {
                // Bulle √† gauche
                bubbleTop = rect.top + rect.height/2 - bubbleHeight/2;
                bubbleLeft = rect.left - bubbleWidth - 20;
            }
            // Sinon (carte de spot au milieu)
            else {
                // Bulle en dessous
                bubbleTop = rect.bottom + 20;
                bubbleLeft = Math.max(20, Math.min(screenWidth/2 - bubbleWidth/2, screenWidth - bubbleWidth - 20));
            }
            
            // S'assurer que la bulle reste dans l'√©cran
            bubbleTop = Math.max(20, Math.min(bubbleTop, screenHeight - bubbleHeight - 20));
            bubbleLeft = Math.max(20, Math.min(bubbleLeft, screenWidth - bubbleWidth - 20));
            
            bubble.style.position = 'fixed';
            bubble.style.left = bubbleLeft + 'px';
            bubble.style.top = bubbleTop + 'px';
            bubble.style.width = bubbleWidth + 'px';
            bubble.style.opacity = '1';
        }

        function renderCountryGuidePrompt() {
            const countryNames = {
                'FR': { fr: 'France', en: 'France', flag: 'üá´üá∑' },
                'DE': { fr: 'Allemagne', en: 'Germany', flag: 'üá©üá™' },
                'BE': { fr: 'Belgique', en: 'Belgium', flag: 'üáßüá™' },
                'ES': { fr: 'Espagne', en: 'Spain', flag: 'üá™üá∏' },
                'IT': { fr: 'Italie', en: 'Italy', flag: 'üáÆüáπ' },
                'NL': { fr: 'Pays-Bas', en: 'Netherlands', flag: 'üá≥üá±' },
                'PL': { fr: 'Pologne', en: 'Poland', flag: 'üáµüá±' },
                'PT': { fr: 'Portugal', en: 'Portugal', flag: 'üáµüáπ' },
                'AT': { fr: 'Autriche', en: 'Austria', flag: 'üá¶üáπ' },
                'CH': { fr: 'Suisse', en: 'Switzerland', flag: 'üá®üá≠' },
                'CZ': { fr: 'R√©p. Tch√®que', en: 'Czech Rep.', flag: 'üá®üáø' },
                'IE': { fr: 'Irlande', en: 'Ireland', flag: 'üáÆüá™' },
                'HR': { fr: 'Croatie', en: 'Croatia', flag: 'üá≠üá∑' }
            };
            
            const country = countryNames[state.countryGuidePromptCountry];
            if (!country) return '';
            
            const countryName = state.lang === 'fr' ? country.fr : country.en;
            
            return `
                <div class="fixed inset-0 z-50 flex items-center justify-center p-4">
                    <div class="absolute inset-0 bg-black/70" onclick="state.showCountryGuidePrompt=false;render();"></div>
                    <div class="card p-6 max-w-md w-full relative z-10 slide-up text-center">
                        <div class="text-6xl mb-4">${country.flag}</div>
                        <h2 class="text-2xl font-bold mb-3">
                            ${state.lang === 'fr' ? `Tu cherches en ${countryName} ?` : `Looking in ${countryName}?`}
                        </h2>
                        <p class="text-slate-400 mb-6">
                            ${state.lang === 'fr' ? 
                                'Consulte notre guide pour conna√Ætre les r√®gles et astuces de ce pays !' : 
                                'Check out our guide for rules and tips about this country!'}
                        </p>
                        
                        <div class="flex gap-3">
                            <button onclick="state.showCountryGuidePrompt=false;render();" class="btn btn-ghost flex-1 py-3">
                                ${state.lang === 'fr' ? 'Plus tard' : 'Later'}
                            </button>
                            <button onclick="openCountryGuide('${state.countryGuidePromptCountry}');state.showCountryGuidePrompt=false;" class="btn btn-primary flex-1 py-3">
                                üìö ${state.lang === 'fr' ? 'Voir le guide' : 'View guide'}
                            </button>
                        </div>
                        
                        <p class="text-xs text-slate-500 mt-4">
                            ${state.lang === 'fr' ? 
                                'üí° Demain, on te proposera un quiz sur ce pays !' : 
                                'üí° Tomorrow, we\'ll suggest a quiz about this country!'}
                        </p>
                    </div>
                </div>
            `;
        }

        function renderQuiz() {
            // Quiz not started - show menu
            if (!state.quizMode) {
                return `
                    <div class="space-y-4">
                        <h2 class="text-2xl font-bold fade-in">üß† ${t('quizTitle')}</h2>
                        <p class="text-slate-400 fade-in stagger-1">${t('quizDesc')}</p>
                        
                        <!-- Mode selection -->
                        <div class="grid grid-cols-3 gap-3 fade-in stagger-2">
                            <button onclick="selectQuizMode('solo')" class="card p-4 text-center hover:border-sky-500/50">
                                <div class="text-3xl mb-2">üéØ</div>
                                <p class="font-bold">${t('quizSolo')}</p>
                            </button>
                            <button onclick="selectQuizMode('friend')" class="card p-4 text-center hover:border-sky-500/50">
                                <div class="text-3xl mb-2">üë•</div>
                                <p class="font-bold">${t('quizVsFriend')}</p>
                            </button>
                            <button onclick="selectQuizMode('world')" class="card p-4 text-center hover:border-sky-500/50">
                                <div class="text-3xl mb-2">üåç</div>
                                <p class="font-bold">${t('quizWorld')}</p>
                            </button>
                        </div>
                        
                        <!-- Leaderboard -->
                        <div class="card p-5 fade-in stagger-3">
                            <h3 class="font-bold mb-4">üèÜ ${t('quizLeaderboard')}</h3>
                            <div class="space-y-3">
                                ${quizLeaderboard.slice(0, 5).map((p, i) => `
                                    <div class="flex items-center gap-3 p-3 rounded-xl bg-white/5">
                                        <span class="text-xl font-bold ${i === 0 ? 'text-amber-400' : i === 1 ? 'text-slate-300' : i === 2 ? 'text-amber-600' : 'text-slate-500'}">#${i + 1}</span>
                                        <span class="text-2xl">${p.avatar}</span>
                                        <div class="flex-1"><p class="font-medium">${p.username}</p></div>
                                        <span class="badge badge-primary">${p.score} pts</span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        
                        <!-- Best score -->
                        ${state.quizBestScore > 0 ? `
                            <div class="card p-4 bg-gradient-to-r from-amber-500/20 to-orange-500/20 border-amber-500/30 fade-in stagger-4">
                                <p class="text-center"><span class="text-amber-400">üèÖ ${t('quizBestScore')}:</span> <span class="font-bold">${state.quizBestScore} pts</span></p>
                            </div>
                        ` : ''}
                    </div>
                `;
            }
            
            // Category selection
            if (!state.quizCategory) {
                return `
                    <div class="space-y-4">
                        <div class="flex items-center gap-3">
                            <button onclick="resetQuiz()" class="btn btn-ghost px-3">‚Üê</button>
                            <h2 class="text-2xl font-bold">${t('quizCategories')}</h2>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            ${[
                                { id: 'capitals', icon: 'üèõÔ∏è', label: t('quizCapitals') },
                                { id: 'flags', icon: 'üö©', label: t('quizFlags') },
                                { id: 'geography', icon: 'üó∫Ô∏è', label: t('quizGeography') },
                                { id: 'culture', icon: 'üçΩÔ∏è', label: t('quizCulture') },
                                { id: 'hitchhiking', icon: 'üöó', label: t('quizHitchhiking') }
                            ].map((cat, i) => `
                                <button onclick="startQuiz('${cat.id}')" class="card p-5 text-center hover:border-sky-500/50 fade-in stagger-${i + 1}">
                                    <div class="text-4xl mb-3">${cat.icon}</div>
                                    <p class="font-bold">${cat.label}</p>
                                    <p class="text-xs text-slate-400 mt-1">5 questions</p>
                                </button>
                            `).join('')}
                        </div>
                    </div>
                `;
            }
            
            // Quiz finished
            if (state.quizFinished) {
                const points = state.quizScore * 10;
                return `
                    <div class="quiz-score-popup">
                        <div class="card p-8 max-w-md w-full text-center fade-in">
                            <div class="text-6xl mb-4">${state.quizScore >= 4 ? 'üèÜ' : state.quizScore >= 2 ? 'üëç' : 'üí™'}</div>
                            <h2 class="text-2xl font-bold mb-2">${t('quizFinished')}</h2>
                            <p class="text-4xl font-bold gradient-text mb-4">${state.quizScore}/5</p>
                            <p class="text-slate-400 mb-6">+${points} ${t('points')}</p>
                            <div class="flex gap-3">
                                <button onclick="resetQuiz()" class="btn btn-ghost flex-1">${t('quizCategories')}</button>
                                <button onclick="startQuiz('${state.quizCategory}')" class="btn btn-primary flex-1">${t('quizPlayAgain')}</button>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            // Quiz in progress
            const q = state.quizQuestions[state.quizCurrentIndex];
            return `
                <div class="space-y-4">
                    <div class="flex items-center justify-between">
                        <button onclick="resetQuiz()" class="btn btn-ghost px-3" aria-label="Fermer">‚úï</button>
                        <span class="badge badge-primary">${t('quizQuestion')} ${state.quizCurrentIndex + 1}/5</span>
                        <span class="badge badge-success">${t('quizScore')}: ${state.quizScore}</span>
                    </div>
                    
                    <!-- Timer -->
                    <div class="quiz-timer">
                        <div class="quiz-timer-fill" style="width: ${(state.quizTimeLeft / 15) * 100}%"></div>
                    </div>
                    
                    <!-- Question -->
                    <div class="card p-6 text-center">
                        <p class="text-xl font-bold mb-2">${q.q[state.lang]}</p>
                        <p class="text-sm text-slate-400 quiz-time-text">${state.quizTimeLeft}s</p>
                    </div>
                    
                    <!-- Options -->
                    <div class="grid grid-cols-2 gap-3">
                        ${q.options.map((opt, i) => {
                            let cls = '';
                            if (state.quizAnswered) {
                                if (i === q.correct) cls = 'correct';
                                else if (i === state.quizSelectedAnswer) cls = 'wrong';
                            } else if (i === state.quizSelectedAnswer) {
                                cls = 'selected';
                            }
                            return `
                                <button onclick="answerQuiz(${i})" class="quiz-option ${cls} fade-in stagger-${i + 1}" ${state.quizAnswered ? 'disabled' : ''}>
                                    ${opt}
                                </button>
                            `;
                        }).join('')}
                    </div>
                    
                    ${state.quizAnswered ? `
                        <div class="card p-4 text-center ${state.quizSelectedAnswer === q.correct ? 'bg-emerald-500/20 border-emerald-500/30' : 'bg-red-500/20 border-red-500/30'}">
                            <p class="font-bold">${state.quizSelectedAnswer === q.correct ? '‚úÖ ' + t('quizCorrect') : '‚ùå ' + t('quizWrong')}</p>
                        </div>
                        <button onclick="nextQuizQuestion()" class="btn btn-primary w-full py-4">${t('tutoNext')} ‚Üí</button>
                    ` : ''}
                </div>
            `;
        }

        // ==================== HANDLERS ====================
        
        // S√©lection avatar sans re-render complet
        window.selectAvatar = function(avatar) {
            state.selectedAvatar = avatar;
            document.querySelectorAll('.avatar-option').forEach(el => {
                el.classList.toggle('selected', el.textContent === avatar);
            });
        };
        
        // ==================== AUTH HANDLERS ====================
        
        window.handleLogin = async function() {
            const email = state.authEmail.trim();
            const password = state.authPassword;
            
            if (!email || !password) {
                state.authError = state.lang === 'fr' ? 'Remplis tous les champs' : 'Fill all fields';
                render();
                return;
            }
            
            state.authLoading = true;
            state.authError = null;
            render();
            
            // Mode d√©mo si Firebase non configur√©
            if (!isFirebaseConfigured) {
                setTimeout(() => {
                    state.user = { 
                        id: Date.now(), 
                        email: email,
                        username: null, // √Ä configurer apr√®s
                        avatar: state.selectedAvatar, 
                        score: 0, 
                        level: 1, 
                        streak: 1, 
                        spotsShared: 0, 
                        checkinsCount: 0, 
                        reviewsGiven: 0,
                        quizPlayed: 0,
                        quizWins: 0,
                        helpGiven: 0,
                        tripsCompleted: 0,
                        joinedAt: new Date().toISOString() 
                    };
                    state.authScreen = null;
                    state.showWelcome = true;
                    state.authLoading = false;
                    state.authPassword = '';
                    saveState();
                    render();
                }, 1000);
                return;
            }
            
            try {
                const userCredential = await firebaseAuth.signInWithEmailAndPassword(email, password);
                await handleAuthSuccess(userCredential.user);
            } catch (error) {
                state.authError = getAuthErrorMessage(error.code);
                state.authLoading = false;
                render();
            }
        };
        
        window.handleRegister = async function() {
            const email = state.authEmail.trim();
            const password = state.authPassword;
            const confirmPassword = state.authConfirmPassword;
            
            if (!email || !password || !confirmPassword) {
                state.authError = state.lang === 'fr' ? 'Remplis tous les champs' : 'Fill all fields';
                render();
                return;
            }
            
            if (password !== confirmPassword) {
                state.authError = t('passwordMismatch');
                render();
                return;
            }
            
            if (password.length < 6) {
                state.authError = t('weakPassword');
                render();
                return;
            }
            
            state.authLoading = true;
            state.authError = null;
            render();
            
            // Mode d√©mo si Firebase non configur√©
            if (!isFirebaseConfigured) {
                setTimeout(() => {
                    state.user = { 
                        id: Date.now(), 
                        email: email,
                        username: null,
                        avatar: state.selectedAvatar, 
                        score: 0, 
                        level: 1, 
                        streak: 1, 
                        spotsShared: 0, 
                        checkinsCount: 0, 
                        reviewsGiven: 0,
                        quizPlayed: 0,
                        quizWins: 0,
                        helpGiven: 0,
                        tripsCompleted: 0,
                        joinedAt: new Date().toISOString() 
                    };
                    state.authScreen = null;
                    state.showWelcome = true;
                    state.authLoading = false;
                    state.authPassword = '';
                    state.authConfirmPassword = '';
                    saveState();
                    showToast(state.lang === 'fr' ? 'Compte cr√©√© !' : 'Account created!');
                    render();
                }, 1000);
                return;
            }
            
            try {
                const userCredential = await firebaseAuth.createUserWithEmailAndPassword(email, password);
                await handleAuthSuccess(userCredential.user, true);
            } catch (error) {
                state.authError = getAuthErrorMessage(error.code);
                state.authLoading = false;
                render();
            }
        };
        
        window.handleGoogleLogin = async function() {
            if (!isFirebaseConfigured) {
                showToast(state.lang === 'fr' ? 'Configure Firebase pour utiliser Google' : 'Configure Firebase to use Google', 'error');
                return;
            }
            
            state.authLoading = true;
            state.authError = null;
            render();
            
            try {
                const provider = new firebase.auth.GoogleAuthProvider();
                const userCredential = await firebaseAuth.signInWithPopup(provider);
                await handleAuthSuccess(userCredential.user);
            } catch (error) {
                state.authError = getAuthErrorMessage(error.code);
                state.authLoading = false;
                render();
            }
        };
        
        window.handleForgotPassword = async function() {
            const email = state.authEmail.trim();
            
            if (!email) {
                state.authError = state.lang === 'fr' ? 'Entre ton email' : 'Enter your email';
                render();
                return;
            }
            
            state.authLoading = true;
            state.authError = null;
            render();
            
            if (!isFirebaseConfigured) {
                setTimeout(() => {
                    state.authError = t('passwordResetSent');
                    state.authLoading = false;
                    render();
                }, 1000);
                return;
            }
            
            try {
                await firebaseAuth.sendPasswordResetEmail(email);
                state.authError = t('passwordResetSent');
                state.authLoading = false;
                render();
            } catch (error) {
                state.authError = getAuthErrorMessage(error.code);
                state.authLoading = false;
                render();
            }
        };
        
        async function handleAuthSuccess(firebaseUser, isNewUser = false) {
            state.firebaseUser = firebaseUser;
            
            // Chercher si l'utilisateur existe d√©j√† dans Firestore
            let userData = null;
            if (firebaseDb) {
                try {
                    const doc = await firebaseDb.collection('users').doc(firebaseUser.uid).get();
                    if (doc.exists) {
                        userData = doc.data();
                    }
                } catch (e) {
                    console.warn('Erreur Firestore:', e);
                }
            }
            
            if (userData) {
                // Utilisateur existant
                state.user = userData;
                state.authScreen = null;
                state.showWelcome = false;
            } else {
                // Nouvel utilisateur - setup profil
                state.user = { 
                    id: firebaseUser.uid, 
                    email: firebaseUser.email,
                    username: null,
                    avatar: state.selectedAvatar, 
                    score: 0, 
                    level: 1, 
                    streak: 1, 
                    spotsShared: 0, 
                    checkinsCount: 0, 
                    reviewsGiven: 0,
                    quizPlayed: 0,
                    quizWins: 0,
                    helpGiven: 0,
                    tripsCompleted: 0,
                    joinedAt: new Date().toISOString() 
                };
                state.authScreen = null;
                state.showWelcome = true;
            }
            
            state.authLoading = false;
            state.authPassword = '';
            state.authConfirmPassword = '';
            saveState();
            render();
        }
        
        window.completeProfileSetup = async function() {
            const username = document.getElementById('username-input')?.value.trim() || state.tempUsername;
            if (!username) {
                showToast(state.lang === 'fr' ? 'Choisis un pseudo' : 'Choose a username', 'error');
                return;
            }
            
            state.user.username = username;
            state.user.avatar = state.selectedAvatar;
            state.showWelcome = false;
            
            // Sauvegarder dans Firestore si configur√©
            if (firebaseDb && state.firebaseUser) {
                try {
                    await firebaseDb.collection('users').doc(state.firebaseUser.uid).set(state.user);
                } catch (e) {
                    console.warn('Erreur sauvegarde Firestore:', e);
                }
            }
            
            saveState();
            showToast(state.lang === 'fr' ? 'Bienvenue ' + username + ' !' : 'Welcome ' + username + '!');
            showConfetti();
            render();
        };
        
        window.handleLogout = async function() {
            if (firebaseAuth) {
                try {
                    await firebaseAuth.signOut();
                } catch (e) {
                    console.warn('Erreur logout:', e);
                }
            }
            
            state.user = null;
            state.firebaseUser = null;
            state.authScreen = 'login';
            state.showWelcome = false;
            Storage.remove('user');
            showToast(state.lang === 'fr' ? 'D√©connect√©' : 'Logged out');
            render();
        };
        
        function getAuthErrorMessage(code) {
            const messages = {
                'auth/email-already-in-use': t('emailInUse'),
                'auth/invalid-email': t('invalidEmail'),
                'auth/user-not-found': t('userNotFound'),
                'auth/wrong-password': t('wrongPassword'),
                'auth/weak-password': t('weakPassword'),
                'auth/popup-closed-by-user': state.lang === 'fr' ? 'Connexion annul√©e' : 'Login cancelled',
                'auth/network-request-failed': state.lang === 'fr' ? 'Erreur r√©seau' : 'Network error'
            };
            return messages[code] || t('authError');
        }
        
        window.completeWelcome = function() {
            const username = document.getElementById('username-input')?.value.trim() || state.tempUsername;
            if (!username) return;
            state.user = { 
                id: Date.now(), 
                username, 
                avatar: state.selectedAvatar, 
                score: 0, 
                level: 1, 
                streak: 1, 
                spotsShared: 0, 
                checkinsCount: 0, 
                reviewsGiven: 0, 
                quizPlayed: 0,
                quizWins: 0,
                helpGiven: 0,
                tripsCompleted: 0,
                joinedAt: new Date().toISOString() 
            };
            state.showWelcome = false;
            state.authScreen = null;
            saveState();
            showToast(state.lang === 'fr' ? 'Bienvenue !' : 'Welcome!');
            showConfetti();
            render();
        };

        window.changeTab = function(tab) {
            // Supprimer la carte si on quitte l'onglet spots
            if (state.mapInstance && state.activeTab === 'spots') { 
                state.mapInstance.remove(); 
                state.mapInstance = null; 
            }
            state.activeTab = tab;
            state.showMenu = false;
            render();
        };

        window.changeLang = function(lang) { state.lang = lang; Storage.set('lang', lang); render(); };
        
        window.changeTheme = function(theme) { 
            state.theme = theme; 
            Storage.set('theme', theme); 
            document.body.classList.toggle('light-theme', theme === 'light');
            render(); 
        };
        
        // Appliquer le th√®me au chargement
        if (state.theme === 'light') {
            document.body.classList.add('light-theme');
        }
        
        
        // Version sans re-render complet pour les √©crans de setup
        window.changeLangNoRender = function(lang) { 
            state.lang = lang; 
            Storage.set('lang', lang); 
            // Mettre √† jour seulement les boutons de langue
            document.querySelectorAll('[onclick*="changeLangNoRender"]').forEach(btn => {
                const isActive = btn.textContent.includes(lang.toUpperCase());
                btn.className = `px-4 py-2 rounded-lg transition-all ${isActive ? 'bg-sky-500/30 text-sky-300' : 'text-slate-400 hover:text-white'}`;
            });
        };

        // Recherche avec d√©lai pour √©viter le clignotement
        let searchTimeout = null;
        window.handleSearch = function(value) {
            state.searchQuery = value;
            if (searchTimeout) clearTimeout(searchTimeout);
            searchTimeout = setTimeout(() => {
                // D√©tecter si recherche dans un pays √©tranger
                if (value.length > 2) {
                    const countryMap = {
                        'FR': ['france', 'paris', 'lyon', 'marseille', 'toulouse', 'bordeaux', 'lille', 'nantes', 'strasbourg', 'rennes', 'reims', 'montpellier', 'nice', 'dijon'],
                        'DE': ['allemagne', 'germany', 'berlin', 'munich', 'hamburg', 'cologne', 'frankfurt', 'stuttgart', 'd√ºsseldorf', 'dortmund'],
                        'BE': ['belgique', 'belgium', 'bruxelles', 'brussels', 'antwerp', 'anvers', 'gent', 'charleroi', 'li√®ge'],
                        'ES': ['espagne', 'spain', 'madrid', 'barcelona', 'valencia', 'sevilla', 'seville', 'malaga', 'bilbao'],
                        'IT': ['italie', 'italy', 'rome', 'milan', 'naples', 'turin', 'florence', 'venice', 'venise', 'bologna'],
                        'NL': ['pays-bas', 'netherlands', 'amsterdam', 'rotterdam', 'the hague', 'utrecht', 'eindhoven'],
                        'PL': ['pologne', 'poland', 'warsaw', 'varsovie', 'krakow', 'cracovie', 'wroclaw', 'poznan', 'gdansk'],
                        'PT': ['portugal', 'lisbon', 'lisbonne', 'porto', 'braga', 'coimbra'],
                        'AT': ['autriche', 'austria', 'vienna', 'vienne', 'salzburg', 'innsbruck', 'graz'],
                        'CH': ['suisse', 'switzerland', 'geneva', 'gen√®ve', 'zurich', 'bern', 'berne', 'lausanne', 'basel'],
                        'CZ': ['r√©publique tch√®que', 'czech', 'prague', 'brno', 'ostrava'],
                        'IE': ['irlande', 'ireland', 'dublin', 'cork', 'galway', 'limerick'],
                        'HR': ['croatie', 'croatia', 'zagreb', 'split', 'rijeka', 'dubrovnik']
                    };
                    
                    const userCountry = state.user?.country || 'FR'; // Par d√©faut France
                    const searchLower = value.toLowerCase();
                    
                    for (const [country, keywords] of Object.entries(countryMap)) {
                        if (country !== userCountry && keywords.some(k => searchLower.includes(k))) {
                            // Enregistrer le pays consult√©
                            if (!state.countriesViewed[country]) {
                                state.countriesViewed[country] = Date.now();
                                Storage.set('countriesViewed', state.countriesViewed);
                                
                                // Proposer le guide
                                state.showCountryGuidePrompt = true;
                                state.countryGuidePromptCountry = country;
                            }
                            break;
                        }
                    }
                }
                
                render();
                // Remettre le focus sur le champ de recherche
                const input = document.getElementById('search-input');
                if (input) { input.focus(); input.setSelectionRange(value.length, value.length); }
            }, 300);
        };

        window.setRating = function(cat, r) {
            document.getElementById(`input-${cat}`).value = r;
            document.querySelectorAll(`#rating-${cat} .star`).forEach((s, i) => s.classList.toggle('active', i < r));
        };

        window.handlePhotoSelect = function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (ev) => { state.pendingPhoto = ev.target.result; render(); };
                reader.readAsDataURL(file);
            }
        };

        // Ouvrir l'app de navigation vers le spot
        window.openNavigation = function(lat, lng) {
            // D√©tecte le syst√®me et ouvre l'app appropri√©e
            const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
            const isAndroid = /Android/.test(navigator.userAgent);
            
            let url;
            if (isIOS) {
                // Apple Plans sur iOS
                url = `maps://maps.apple.com/?q=${lat},${lng}`;
            } else if (isAndroid) {
                // Google Maps sur Android
                url = `geo:${lat},${lng}?q=${lat},${lng}`;
            } else {
                // Google Maps web par d√©faut
                url = `https://www.google.com/maps/search/?api=1&query=${lat},${lng}`;
            }
            
            window.open(url, '_blank');
            showToast(state.lang === 'fr' ? 'Ouverture de la navigation...' : 'Opening navigation...');
        };
        
        // Partager un spot
        window.shareSpot = function(spotId) {
            const spot = state.spots.find(s => s.id === spotId);
            if (!spot) return;
            
            const text = `${spot.from} ‚Üí ${spot.to}\n‚≠ê ${spot.globalRating}/5 | ‚è±Ô∏è ${spot.avgWaitTime}min\n\n${spot.description}`;
            
            if (navigator.share) {
                navigator.share({
                    title: 'SpotHitch - ' + spot.from + ' ‚Üí ' + spot.to,
                    text: text
                });
            } else {
                // Fallback: copier dans le presse-papier
                navigator.clipboard.writeText(text);
                showToast(state.lang === 'fr' ? 'Lien copi√© !' : 'Link copied!');
            }
        };
        
        // Sauvegarder un spot offline
        window.toggleSaveSpot = function(spotId) {
            if (state.savedSpots.includes(spotId)) {
                state.savedSpots = state.savedSpots.filter(id => id !== spotId);
                showToast(state.lang === 'fr' ? 'Spot retir√©' : 'Spot removed');
            } else {
                state.savedSpots.push(spotId);
                showToast(state.lang === 'fr' ? 'Spot sauvegard√© !' : 'Spot saved!');
            }
            Storage.set('savedSpots', state.savedSpots);
            render();
        };
        
        // Ouvrir le guide d'un pays
        window.openCountryGuide = function(countryCode) {
            // Trouver le guide du pays
            const guide = countryGuides.find(g => g.country === countryCode);
            if (guide) {
                state.selectedCountryGuide = countryCode;
                state.activeTab = 'guides';
                render();
            } else {
                showToast(state.lang === 'fr' ? 'Guide non disponible' : 'Guide not available');
            }
        };
        
        // Ouvrir le quiz d'un pays
        window.openCountryQuiz = function(countryCode) {
            state.quizCountry = countryCode;
            state.quizMode = 'country';
            state.activeTab = 'quiz';
            render();
        };

        // Wizard handlers
        window.handleWizardPhoto = function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (ev) => { 
                    state.addSpotData.photo = ev.target.result; 
                    render(); 
                };
                reader.readAsDataURL(file);
            }
        };
        
        window.nextWizardStep = function() {
            if (state.addSpotStep < 3) {
                state.addSpotStep++;
                render();
            }
        };
        
        window.prevWizardStep = function() {
            if (state.addSpotStep > 1) {
                state.addSpotStep--;
                render();
            }
        };
        
        window.closeAddSpot = function() {
            state.showAddSpot = false;
            state.addSpotStep = 1;
            state.addSpotData = { photo: null, from: '', to: '', description: '' };
            render();
        };
        
        window.submitWizardSpot = async function() {
            const data = state.addSpotData;
            if (!data.photo || !data.from || !data.to) return;
            
            showToast(state.lang === 'fr' ? '‚è≥ Envoi en cours...' : '‚è≥ Uploading...');
            
            let spot = {
                id: Date.now(), 
                from: data.from, 
                to: data.to, 
                description: data.description || '',
                photoUrl: data.photo, 
                creator: state.user.username, 
                creatorAvatar: state.user.avatar,
                creatorId: state.user.id || state.user.username,
                coordinates: state.userLocation || { lat: 48 + Math.random() * 4, lng: 2 + Math.random() * 4 },
                ratings: { accessibility: 4, safety: 4, visibility: 4, traffic: 4 }, 
                globalRating: 4,
                totalReviews: 0, 
                avgWaitTime: 25, 
                lastUsed: new Date().toISOString().split('T')[0],
                checkins: 0, 
                verified: false, 
                validationCount: 0,
                alerts: [], 
                source: 'user',
                createdAt: new Date().toISOString()
            };
            
            // Upload photo vers Firebase Storage si configur√©
            if (isFirebaseConfigured && firebaseStorage) {
                spot.photoUrl = await uploadPhotoToFirebase(data.photo, spot.id);
            }
            
            // Sauvegarder dans Firebase si configur√©
            if (isFirebaseConfigured && firebaseDb) {
                spot = await saveSpotToFirebase(spot);
            }
            
            state.spots.unshift(spot);
            state.user.spotsShared++;
            
            // Points r√©duits √† la cr√©ation (les vrais points viennent des validations)
            addPoints(10);
            
            closeAddSpot();
            saveState();
            
            // Mettre √† jour les d√©fis
            updateChallengeProgress('weekly_spots');
            
            // V√©rifier les badges
            checkBadges();
            
            showToast(state.lang === 'fr' ? 'Spot partag√© ! üéâ' : 'Spot shared! üéâ');
            showConfetti();
            render();
        };

        window.handleAddSpot = function(e) {
            e.preventDefault();
            if (!state.pendingPhoto) { showToast(t('photoRequired'), 'error'); return; }
            const fd = new FormData(e.target);
            const spot = {
                id: Date.now(), from: fd.get('from'), to: fd.get('to'), description: fd.get('description'),
                photoUrl: state.pendingPhoto, creator: state.user.username, creatorAvatar: state.user.avatar,
                coordinates: state.userLocation || { lat: 48 + Math.random() * 4, lng: 2 + Math.random() * 4 },
                ratings: { accessibility: 4, safety: 4, visibility: 4, traffic: 4 }, globalRating: 4,
                totalReviews: 0, avgWaitTime: 25, lastUsed: new Date().toISOString().split('T')[0],
                checkins: 0, verified: false, alerts: [], createdAt: new Date().toISOString()
            };
            state.spots.unshift(spot);
            state.user.spotsShared++;
            state.showAddSpot = false;
            state.pendingPhoto = null;
            saveState();
            addPoints(30);
            showToast(state.lang === 'fr' ? 'Spot partag√© !' : 'Spot shared!');
            showConfetti();
            render();
        };

        window.handleRate = function(e, spotId) {
            e.preventDefault();
            const fd = new FormData(e.target);
            const spot = state.spots.find(s => s.id === spotId);
            if (!spot) return;
            const newRatings = { accessibility: parseInt(fd.get('accessibility')) || 4, safety: parseInt(fd.get('safety')) || 4, visibility: parseInt(fd.get('visibility')) || 4, traffic: parseInt(fd.get('traffic')) || 4 };
            const n = spot.totalReviews;
            Object.keys(newRatings).forEach(k => { spot.ratings[k] = (spot.ratings[k] * n + newRatings[k]) / (n + 1); });
            spot.globalRating = Object.values(spot.ratings).reduce((a, b) => a + b, 0) / 4;
            spot.totalReviews++;
            const waitMap = { '5': 5, '15': 15, '30': 30, '45': 45, '60+': 70 };
            spot.avgWaitTime = Math.round((spot.avgWaitTime * n + (waitMap[fd.get('waitTime')] || 25)) / (n + 1));
            spot.lastUsed = new Date().toISOString().split('T')[0];
            state.user.reviewsGiven++;
            state.showRateSpot = false;
            saveState();
            addPoints(10);
            
            // Mettre √† jour les d√©fis
            updateChallengeProgress('daily_review');
            
            // V√©rifier les badges
            checkBadges();
            
            showToast(state.lang === 'fr' ? 'Avis publi√© !' : 'Review posted!');
            render();
        };

        window.doCheckin = function(spotId) {
            const spot = state.spots.find(s => s.id === spotId);
            if (!spot) return;
            spot.checkins++;
            spot.lastUsed = new Date().toISOString().split('T')[0];
            state.checkins.unshift({ id: Date.now(), spotId, date: new Date().toISOString() });
            state.user.checkinsCount++;
            state.lastCheckinSpot = spotId;
            saveState();
            addPoints(5);
            showToast(t('checkinSuccess'));
            
            // Mettre √† jour les d√©fis
            updateChallengeProgress('daily_checkin');
            updateChallengeProgress('weekly_checkins');
            
            // V√©rifier les badges
            checkBadges();
            
            setTimeout(() => { state.showReminder = true; render(); }, 30000);
            if (state.selectedSpot) state.selectedSpot = null;
            render();
        };

        window.sendMessage = function() {
            if (state.newMessage.trim()) {
                state.messages.push({ id: Date.now(), room: state.activeChatRoom, user: state.user.username, avatar: state.user.avatar, text: state.newMessage, time: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }), isMe: true });
                state.newMessage = '';
                saveState();
                render();
            }
        };

        // ==================== NOUVEAUX HANDLERS ====================
        
        window.toggleSaveSpot = function(spotId) {
            event.stopPropagation();
            if (state.savedSpots.includes(spotId)) {
                state.savedSpots = state.savedSpots.filter(id => id !== spotId);
                showToast(state.lang === 'fr' ? 'Spot retir√©' : 'Spot removed');
            } else {
                state.savedSpots.push(spotId);
                showToast(t('savedOffline') + ' ‚úì');
            }
            Storage.set('savedSpots', state.savedSpots);
            render();
        };
        
        window.shareSpot = function(spotId) {
            event.stopPropagation();
            const spot = state.spots.find(s => s.id === spotId);
            if (!spot) return;
            const text = `üöó ${spot.from} ‚Üí ${spot.to}\n‚≠ê ${spot.globalRating.toFixed(1)} ‚Ä¢ ‚è±Ô∏è ~${spot.avgWaitTime}min\n${spot.description}\n\nüìç SpotHitch`;
            if (navigator.share) {
                navigator.share({ title: 'SpotHitch', text: text }).catch(() => {});
            } else {
                navigator.clipboard.writeText(text);
                showToast(t('linkCopied'));
            }
        };
        
        window.addComment = function(spotId) {
            const input = document.getElementById('new-comment');
            if (!input || !input.value.trim()) return;
            const comment = {
                spotId: spotId,
                id: Date.now(),
                user: state.user.username,
                avatar: state.user.avatar,
                text: input.value.trim(),
                date: new Date().toISOString().split('T')[0],
                likes: 0
            };
            state.comments.push(comment);
            Storage.set('comments', state.comments);
            input.value = '';
            render();
        };
        
        window.likeComment = function(commentId) {
            event.stopPropagation();
            const comment = state.comments.find(c => c.id === commentId);
            if (comment) {
                comment.likes++;
                Storage.set('comments', state.comments);
                render();
            }
        };
        
        window.markMessageRead = function(msgId) {
            const msg = state.privateMessages.find(m => m.id === msgId);
            if (msg) {
                msg.read = true;
                Storage.set('privateMessages', state.privateMessages);
                render();
            }
        };
        
        window.checkBadges = function() {
            const user = state.user;
            if (!user) return;
            
            allBadges.forEach(badge => {
                if (!state.userBadges.includes(badge.id) && badge.condition(user)) {
                    state.userBadges.push(badge.id);
                    user.score += badge.reward;
                    state.showBadgePopup = badge.id;
                    Storage.set('userBadges', state.userBadges);
                    saveState();
                    showConfetti();
                }
            });
        };
        
        window.updateChallengeProgress = function(challengeId, amount = 1) {
            if (!state.challengeProgress[challengeId]) {
                state.challengeProgress[challengeId] = 0;
            }
            const challenge = allChallenges.find(c => c.id === challengeId);
            if (!challenge) return;
            
            const prevProgress = state.challengeProgress[challengeId];
            state.challengeProgress[challengeId] += amount;
            
            // Si d√©fi compl√©t√©
            if (prevProgress < challenge.target && state.challengeProgress[challengeId] >= challenge.target) {
                addPoints(challenge.reward);
                showToast(t('challengeComplete') + ' +' + challenge.reward + 'pts');
            }
            
            Storage.set('challengeProgress', state.challengeProgress);
        };

        // ==================== VALIDATION & BOUTIQUE ====================
        
        window.validateSpot = function(spotId) {
            event.stopPropagation();
            if (state.validatedByMe.includes(spotId)) return;
            
            const spot = state.spots.find(s => s.id === spotId);
            if (!spot || spot.creator === state.user?.username) return;
            
            // V√©rifier la localisation - max 100m ou visit√© dans les 12 derni√®res heures
            let canValidate = false;
            
            if (state.userLocation) {
                const distance = Geo.calculateDistance(
                    state.userLocation.lat, state.userLocation.lng,
                    spot.coordinates.lat, spot.coordinates.lng
                );
                
                // Doit √™tre √† moins de 100m actuellement
                if (distance <= 0.1) {
                    canValidate = true;
                }
            }
            
            // OU avoir √©t√© l√† dans les 12 derni√®res heures
            if (!canValidate && state.locationHistory) {
                const twelveHoursAgo = Date.now() - (12 * 60 * 60 * 1000);
                canValidate = state.locationHistory.some(loc => {
                    if (loc.timestamp < twelveHoursAgo) return false;
                    const distance = Geo.calculateDistance(
                        loc.lat, loc.lng,
                        spot.coordinates.lat, spot.coordinates.lng
                    );
                    return distance <= 0.1; // 100m
                });
            }
            
            if (!canValidate) {
                const msg = {
                    fr: '‚ö†Ô∏è Tu dois √™tre √† moins de 100m du spot (ou y avoir √©t√© dans les 12h)',
                    en: '‚ö†Ô∏è You must be within 100m of the spot (or have been there in the last 12h)',
                    es: '‚ö†Ô∏è Debes estar a menos de 100m del spot (o haber estado en las √∫ltimas 12h)'
                };
                showToast(msg[state.lang] || msg.en, 'error');
                return;
            }
            
            // Incr√©menter les validations
            if (!state.spotValidations[spotId]) state.spotValidations[spotId] = 0;
            state.spotValidations[spotId]++;
            state.validatedByMe.push(spotId);
            
            // Points pour le validateur
            addPoints(5);
            addSeasonPoints(5);
            
            // Points pour le cr√©ateur (simul√© - en vrai ce serait c√¥t√© serveur)
            showToast(t('spotValidated'));
            
            // Bonus si le spot atteint des paliers
            const validations = state.spotValidations[spotId];
            if (validations === 1) {
                showToast(state.lang === 'fr' ? 'üéâ 1√®re validation ! Cr√©ateur +20pts' : 'üéâ 1st validation! Creator +20pts');
            } else if (validations === 5) {
                showToast(state.lang === 'fr' ? '‚úÖ Spot v√©rifi√© ! Cr√©ateur +100pts' : '‚úÖ Verified spot! Creator +100pts');
                spot.verified = true;
            } else if (validations === 10) {
                showToast(state.lang === 'fr' ? 'üî• 10 validations ! Cr√©ateur +50pts bonus' : 'üî• 10 validations! Creator +50pts bonus');
            }
            
            Storage.set('spotValidations', state.spotValidations);
            Storage.set('validatedByMe', state.validatedByMe);
            saveState();
            render();
        };
        
        // Enregistrer tous les spots d'un itin√©raire
        window.saveAllRouteSpots = function() {
            const from = state.plannerSteps[0].city;
            const to = state.plannerSteps[state.plannerSteps.length - 1].city;
            const routeSpots = getSpotsBetween(from, to);
            
            routeSpots.forEach(spot => {
                if (!state.savedSpots.includes(spot.id)) {
                    state.savedSpots.push(spot.id);
                }
            });
            
            Storage.set('savedSpots', state.savedSpots);
            showToast(state.lang === 'fr' ? 
                `‚úÖ ${routeSpots.length} spots enregistr√©s !` : 
                state.lang === 'es' ? `‚úÖ ${routeSpots.length} spots guardados!` :
                `‚úÖ ${routeSpots.length} spots saved!`);
            render();
        };
        
        // Toggle carte planificateur
        window.togglePlannerMap = function() {
            state.showPlannerMap = !state.showPlannerMap;
            render();
            if (state.showPlannerMap) {
                setTimeout(initPlannerMap, 100);
            }
        };
        
        // Initialiser la carte du planificateur avec routing OSRM
        let plannerMapInstance = null;
        let plannerRouteLayer = null;
        let plannerRouteCoords = [];
        
        async function initPlannerMap() {
            const el = document.getElementById('planner-map');
            if (!el) return;
            
            if (plannerMapInstance) {
                plannerMapInstance.remove();
            }
            
            // Cr√©er la carte
            plannerMapInstance = L.map('planner-map').setView([48.85, 2.35], 5);
            
            L.tileLayer(getMapTileUrl(state.theme), { 
                attribution: getMapAttribution(),
                maxZoom: 19
            }).addTo(plannerMapInstance);
            
            // Obtenir les coordonn√©es des √©tapes
            const steps = state.plannerSteps.filter(s => s.city.trim());
            if (steps.length < 2) return;
            
            // G√©ocoder les villes et tracer la route
            try {
                const coords = await geocodeSteps(steps);
                if (coords.length >= 2) {
                    await drawRoute(coords);
                }
            } catch (e) {
                console.log('Route error:', e);
                // Fallback: afficher les spots entre villes
                displayFallbackSpots();
            }
        }
        
        // G√©ocoder les √©tapes du voyage
        async function geocodeSteps(steps) {
            const coords = [];
            for (const step of steps) {
                try {
                    const response = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(step.city)}&limit=1`);
                    const data = await response.json();
                    if (data.length > 0) {
                        coords.push([parseFloat(data[0].lat), parseFloat(data[0].lon)]);
                    }
                } catch (e) {
                    console.log('Geocode error for', step.city);
                }
            }
            return coords;
        }
        
        // Tracer la route avec OSRM
        async function drawRoute(coords) {
            if (!plannerMapInstance) return;
            
            // Construire l'URL OSRM
            const waypoints = coords.map(c => `${c[1]},${c[0]}`).join(';');
            const osrmUrl = `https://router.project-osrm.org/route/v1/driving/${waypoints}?overview=full&geometries=geojson`;
            
            try {
                const response = await fetch(osrmUrl);
                const data = await response.json();
                
                if (data.routes && data.routes.length > 0) {
                    const route = data.routes[0];
                    plannerRouteCoords = route.geometry.coordinates.map(c => [c[1], c[0]]);
                    
                    // Dessiner la route
                    if (plannerRouteLayer) {
                        plannerMapInstance.removeLayer(plannerRouteLayer);
                    }
                    plannerRouteLayer = L.polyline(plannerRouteCoords, {
                        color: '#0ea5e9',
                        weight: 4,
                        opacity: 0.8,
                        dashArray: null
                    }).addTo(plannerMapInstance);
                    
                    // Afficher dur√©e et distance
                    const duration = Math.round(route.duration / 60);
                    const distance = Math.round(route.distance / 1000);
                    const hours = Math.floor(duration / 60);
                    const mins = duration % 60;
                    
                    // Mettre √† jour l'estimation
                    const estimateDiv = document.getElementById('route-estimate');
                    if (estimateDiv) {
                        const hitchTime = Math.round(duration * 1.5); // Estimation autostop = 1.5x temps voiture
                        const hitchHours = Math.floor(hitchTime / 60);
                        const hitchMins = hitchTime % 60;
                        estimateDiv.innerHTML = `
                            <div class="flex items-center gap-4 text-sm">
                                <span>üöó ${distance}km</span>
                                <span>üïê ${hours}h${mins > 0 ? mins + 'min' : ''} (voiture)</span>
                                <span class="text-sky-400">üëç ~${hitchHours}h${hitchMins > 0 ? hitchMins + 'min' : ''} (autostop)</span>
                            </div>
                        `;
                    }
                    
                    // Trouver les spots √† moins de 2km de la route
                    const spotsOnRoute = findSpotsNearRoute(plannerRouteCoords, 2);
                    state.currentRouteSpots = spotsOnRoute;
                    
                    // Ajouter les marqueurs des √©tapes
                    coords.forEach((coord, i) => {
                        const isStart = i === 0;
                        const isEnd = i === coords.length - 1;
                        const color = isStart ? '#0ea5e9' : isEnd ? '#10b981' : '#f59e0b';
                        
                        const icon = L.divIcon({
                            className: 'step-marker',
                            html: `<div style="background:${color};color:white;width:36px;height:36px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:bold;font-size:16px;box-shadow:0 2px 8px rgba(0,0,0,0.3);border:3px solid white;">${isStart ? 'üöÄ' : isEnd ? 'üèÅ' : i}</div>`,
                            iconSize: [36, 36],
                            iconAnchor: [18, 18]
                        });
                        
                        L.marker(coord, { icon })
                            .addTo(plannerMapInstance)
                            .bindPopup(`<b>${state.plannerSteps[i]?.city || '√âtape ' + (i+1)}</b>`);
                    });
                    
                    // Ajouter les spots sur la route
                    spotsOnRoute.forEach((spot, i) => {
                        const type = getSpotType(spot);
                        const colors = { top: '#ef4444', good: '#10b981', new: '#f59e0b', old: '#6b7280' };
                        const color = colors[type] || '#6b7280';
                        
                        const icon = L.divIcon({
                            className: 'spot-marker',
                            html: `<div style="background:${color};color:white;width:28px;height:28px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:bold;font-size:11px;box-shadow:0 2px 6px rgba(0,0,0,0.3);">üìç</div>`,
                            iconSize: [28, 28],
                            iconAnchor: [14, 14]
                        });
                        
                        L.marker([spot.coordinates.lat, spot.coordinates.lng], { icon })
                            .addTo(plannerMapInstance)
                            .bindPopup(`
                                <div style="min-width:180px;">
                                    <b>${spot.from} ‚Üí ${spot.to}</b><br>
                                    <span style="font-size:12px;">‚≠ê ${spot.globalRating.toFixed(1)} ‚Ä¢ ‚è±Ô∏è ${spot.avgWaitTime}min</span><br>
                                    <button onclick="state.selectedSpot='${spot.id}';render();" style="width:100%;padding:6px;background:#0ea5e9;color:white;border:none;border-radius:6px;cursor:pointer;margin-top:6px;font-weight:600;">Voir</button>
                                </div>
                            `);
                    });
                    
                    // Ajuster la vue
                    plannerMapInstance.fitBounds(plannerRouteLayer.getBounds(), { padding: [30, 30] });
                    
                    // Mettre √† jour le compteur de spots
                    const spotCount = document.getElementById('route-spot-count');
                    if (spotCount) {
                        spotCount.textContent = spotsOnRoute.length;
                    }
                }
            } catch (e) {
                console.log('OSRM error:', e);
                displayFallbackSpots();
            }
        }
        
        // Trouver les spots √† moins de X km de la route
        function findSpotsNearRoute(routeCoords, maxDistanceKm) {
            const spotsNear = [];
            
            state.spots.forEach(spot => {
                let minDistance = Infinity;
                
                // V√©rifier la distance avec chaque point de la route (√©chantillonnage)
                for (let i = 0; i < routeCoords.length; i += 5) { // √âchantillonner tous les 5 points
                    const routePoint = routeCoords[i];
                    const distance = Geo.calculateDistance(
                        spot.coordinates.lat, spot.coordinates.lng,
                        routePoint[0], routePoint[1]
                    );
                    if (distance < minDistance) {
                        minDistance = distance;
                    }
                    if (minDistance < maxDistanceKm) break; // Optimisation
                }
                
                if (minDistance <= maxDistanceKm) {
                    spotsNear.push({ ...spot, distanceFromRoute: minDistance });
                }
            });
            
            // Trier par distance de la route
            return spotsNear.sort((a, b) => a.distanceFromRoute - b.distanceFromRoute);
        }
        
        // Affichage de secours si OSRM √©choue
        function displayFallbackSpots() {
            const from = state.plannerSteps[0].city;
            const to = state.plannerSteps[state.plannerSteps.length - 1].city;
            const routeSpots = getSpotsBetween(from, to);
            state.currentRouteSpots = routeSpots;
            
            if (routeSpots.length === 0) return;
            
            const bounds = [];
            routeSpots.forEach((spot, i) => {
                const type = getSpotType(spot);
                const colors = { top: '#ef4444', good: '#10b981', new: '#f59e0b', old: '#6b7280' };
                const color = colors[type] || '#6b7280';
                
                const icon = L.divIcon({
                    className: 'custom-marker',
                    html: `<div style="background:${color};color:white;width:30px;height:30px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:bold;font-size:12px;box-shadow:0 2px 8px rgba(0,0,0,0.3);">${i+1}</div>`,
                    iconSize: [30, 30],
                    iconAnchor: [15, 15]
                });
                
                L.marker([spot.coordinates.lat, spot.coordinates.lng], { icon })
                    .addTo(plannerMapInstance)
                    .bindPopup(`<b>${spot.from} ‚Üí ${spot.to}</b><br>‚≠ê ${spot.globalRating.toFixed(1)} ‚Ä¢ ‚è±Ô∏è ${spot.avgWaitTime}min`);
                
                bounds.push([spot.coordinates.lat, spot.coordinates.lng]);
            });
            
            if (bounds.length > 1) {
                plannerMapInstance.fitBounds(bounds, { padding: [20, 20] });
            }
        }
        
        // Focus sur un spot dans la carte planificateur
        window.focusSpotOnPlannerMap = function(spotId) {
            if (!state.showPlannerMap) {
                state.showPlannerMap = true;
                render();
                setTimeout(() => {
                    initPlannerMap();
                    focusSpotOnPlannerMap(spotId);
                }, 200);
                return;
            }
            
            const spot = state.spots.find(s => s.id === spotId);
            if (spot && plannerMapInstance) {
                plannerMapInstance.setView([spot.coordinates.lat, spot.coordinates.lng], 12);
            }
        };
        
        // Surveiller les visites de spots pour notification
        window.checkSpotVisit = function() {
            if (!state.userLocation) return;
            
            state.spots.forEach(spot => {
                const distance = Geo.calculateDistance(
                    state.userLocation.lat, state.userLocation.lng,
                    spot.coordinates.lat, spot.coordinates.lng
                );
                
                // Si on est sur un spot (< 500m)
                if (distance <= 0.5) {
                    if (!state.recentSpotVisits) state.recentSpotVisits = {};
                    state.recentSpotVisits[spot.id] = Date.now();
                }
                
                // Si on √©tait sur un spot et qu'on en est parti (> 1km)
                if (state.recentSpotVisits && state.recentSpotVisits[spot.id]) {
                    const timeSinceVisit = (Date.now() - state.recentSpotVisits[spot.id]) / 1000 / 60; // en minutes
                    
                    // Si on est parti depuis < 3h et > 1km
                    if (distance > 1 && timeSinceVisit < 180 && !state.reviewedSpots.includes(spot.id)) {
                        // Notification pour √©valuer le spot
                        if (confirm(state.lang === 'fr' ? 
                            `Tu viens de quitter ${spot.from} ‚Üí ${spot.to}. Veux-tu l'√©valuer ?` :
                            `You just left ${spot.from} ‚Üí ${spot.to}. Want to rate it?`)) {
                            state.selectedSpot = spot.id;
                            render();
                        }
                        state.reviewedSpots.push(spot.id);
                    }
                }
            });
        };
        
        // Appeler checkSpotVisit r√©guli√®rement si localisation activ√©e
        setInterval(() => {
            if (state.userLocation) checkSpotVisit();
        }, 60000); // Toutes les minutes
        
        window.redeemReward = function(rewardId) {
            event.stopPropagation();
            const reward = shopRewards.find(r => r.id === rewardId);
            if (!reward) return;
            
            const vipLevel = getUserVipLevel();
            const discountedCost = vipLevel.discount > 0 ? Math.floor(reward.cost * (1 - vipLevel.discount / 100)) : reward.cost;
            
            if (state.user.score < discountedCost) {
                showToast(t('notEnoughPoints'), 'error');
                return;
            }
            
            if (reward.vipOnly && vipLevel.id === 'bronze') {
                showToast(state.lang === 'fr' ? 'R√©serv√© aux membres VIP' : 'VIP members only', 'error');
                return;
            }
            
            // D√©duire les points
            state.user.score -= discountedCost;
            
            // G√©n√©rer une date d'expiration (30 jours)
            const expiresAt = new Date();
            expiresAt.setDate(expiresAt.getDate() + 30);
            
            // Ajouter la r√©compense
            state.earnedRewards.push({
                id: reward.id,
                partner: reward.partner,
                logo: reward.logo,
                title: reward.title[state.lang],
                code: reward.code + '_' + Math.random().toString(36).substring(2, 6).toUpperCase(),
                redeemedAt: new Date().toISOString(),
                expiresAt: expiresAt.toLocaleDateString()
            });
            
            Storage.set('earnedRewards', state.earnedRewards);
            saveState();
            
            showToast(t('redeemed') + ' üéâ');
            showConfetti();
            render();
        };
        
        window.copyRewardCode = function(code) {
            navigator.clipboard.writeText(code);
            showToast(t('codeCopied'));
        };
        
        // Mise √† jour de addPoints pour tracker les points totaux
        const originalAddPoints = window.addPoints;
        window.addPoints = function(amount) {
            state.user.score += amount;
            state.totalPointsEarned = (state.totalPointsEarned || 0) + amount;
            Storage.set('totalPointsEarned', state.totalPointsEarned);
            state.user.level = Math.floor(state.user.score / 200) + 1;
            saveState();
        };

        window.addEmergencyContact = function() {
            const name = prompt(state.lang === 'fr' ? 'Nom:' : 'Name:');
            const phone = prompt(state.lang === 'fr' ? 'T√©l√©phone:' : 'Phone:');
            if (name && phone) { state.emergencyContacts.push({ name, phone }); saveState(); render(); }
        };

        let plannerTimeout = null;
        window.updatePlannerStep = function(i, v) { 
            state.plannerSteps[i].city = v; 
            if (plannerTimeout) clearTimeout(plannerTimeout);
            plannerTimeout = setTimeout(() => render(), 500); // Attend 500ms
        };
        window.addPlannerStep = function() { state.plannerSteps.splice(state.plannerSteps.length - 1, 0, { city: '' }); render(); };
        window.removePlannerStep = function(i) { state.plannerSteps.splice(i, 1); render(); };
        window.saveTrip = function() {
            const steps = state.plannerSteps.filter(s => s.city).map(s => s.city);
            if (steps.length < 2) return;
            state.trips.push({ id: Date.now().toString(), steps, createdAt: new Date().toISOString() });
            state.plannerSteps = [{ city: '' }, { city: '' }];
            saveState();
            showToast(state.lang === 'fr' ? 'Voyage sauvegard√© !' : 'Trip saved!');
            render();
        };
        window.deleteTrip = function(id) { state.trips = state.trips.filter(t => t.id !== id); saveState(); render(); };

        window.exportData = function() {
            const data = { user: state.user, spots: state.spots.filter(s => s.creator === state.user?.username), trips: state.trips, checkins: state.checkins };
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = `spothitch-${Date.now()}.json`; a.click();
            showToast(state.lang === 'fr' ? 'Export√© !' : 'Exported!');
        };

        window.resetApp = function() {
            if (confirm('Reset?')) { Object.keys(localStorage).filter(k => k.startsWith('spothitch_v4_')).forEach(k => localStorage.removeItem(k)); location.reload(); }
        };
        
        // Import des spots vers Firebase
        window.importSpotsToFirebase = async function() {
            if (!firebaseDb) {
                showToast('‚ùå Firebase non configur√©', 'error');
                return;
            }
            
            const confirmation = confirm(state.lang === 'fr' ? 
                `Importer ${sampleSpots.length} spots vers Firebase ?\n\nCela va cr√©er une base de donn√©es partag√©e avec tous les utilisateurs.` :
                `Import ${sampleSpots.length} spots to Firebase?\n\nThis will create a shared database for all users.`);
            
            if (!confirmation) return;
            
            showToast(state.lang === 'fr' ? '‚è≥ Import en cours...' : '‚è≥ Importing...');
            
            let imported = 0;
            let errors = 0;
            
            for (const spot of sampleSpots) {
                try {
                    // V√©rifier si le spot existe d√©j√† (par coordonn√©es)
                    const existing = await firebaseDb.collection('spots')
                        .where('coordinates.lat', '==', spot.coordinates.lat)
                        .where('coordinates.lng', '==', spot.coordinates.lng)
                        .get();
                    
                    if (existing.empty) {
                        // Cr√©er le spot dans Firebase
                        const docRef = await firebaseDb.collection('spots').add({
                            ...spot,
                            id: null,
                            importedAt: firebase.firestore.FieldValue.serverTimestamp()
                        });
                        await docRef.update({ id: docRef.id });
                        imported++;
                    }
                } catch (e) {
                    console.warn('Erreur import spot:', spot.from, e);
                    errors++;
                }
            }
            
            showToast(state.lang === 'fr' ? 
                `‚úÖ ${imported} spots import√©s !${errors > 0 ? ` (${errors} erreurs)` : ''}` :
                `‚úÖ ${imported} spots imported!${errors > 0 ? ` (${errors} errors)` : ''}`);
            
            // Recharger les spots depuis Firebase
            await loadSpotsFromFirebase();
            render();
        };
        
        // Vider la base Firebase (admin only)
        window.clearFirebaseSpots = async function() {
            if (!firebaseDb) return;
            
            const confirmation = confirm('‚ö†Ô∏è ATTENTION: Supprimer TOUS les spots de Firebase ?');
            if (!confirmation) return;
            
            const doubleCheck = confirm('Es-tu VRAIMENT s√ªr ? Cette action est irr√©versible !');
            if (!doubleCheck) return;
            
            showToast('‚è≥ Suppression en cours...');
            
            try {
                const snapshot = await firebaseDb.collection('spots').get();
                const batch = firebaseDb.batch();
                snapshot.docs.forEach(doc => batch.delete(doc.ref));
                await batch.commit();
                
                showToast('‚úÖ Base Firebase vid√©e');
                state.spots = [...sampleSpots];
                render();
            } catch (e) {
                showToast('‚ùå Erreur: ' + e.message, 'error');
            }
        };

        // Tutorial handlers
        window.nextTutoStep = function() { 
            const steps = [
                { tab: 'home' },
                { tab: 'spots' },
                { tab: 'spots' },
                { tab: 'chat' },
                { tab: 'planner' },
                { tab: 'profile' },
                { tab: 'home' }
            ];
            
            // Supprimer la carte si on quitte l'onglet spots
            const oldTab = state.activeTab;
            
            state.tutorialStep++;
            
            if (state.tutorialStep >= steps.length) {
                finishTutorial();
                return;
            }
            
            const newTab = steps[state.tutorialStep].tab;
            
            // Si on quitte spots, supprimer la carte
            if (oldTab === 'spots' && newTab !== 'spots' && state.mapInstance) {
                state.mapInstance.remove();
                state.mapInstance = null;
            }
            
            state.activeTab = newTab;
            render(); 
        };
        window.prevTutoStep = function() {
            const steps = [
                { tab: 'home' },
                { tab: 'spots' },
                { tab: 'spots' },
                { tab: 'chat' },
                { tab: 'planner' },
                { tab: 'profile' },
                { tab: 'home' }
            ];
            
            // Supprimer la carte si on quitte l'onglet spots
            const oldTab = state.activeTab;
            
            state.tutorialStep--;
            
            if (state.tutorialStep < 0) {
                state.tutorialStep = 0;
            }
            
            const newTab = steps[state.tutorialStep].tab;
            
            // Si on quitte spots, supprimer la carte
            if (oldTab === 'spots' && newTab !== 'spots' && state.mapInstance) {
                state.mapInstance.remove();
                state.mapInstance = null;
            }
            
            state.activeTab = newTab;
            render(); 
        };
        window.skipTutorial = function() { state.showTutorial = false; Storage.set('tutorialDone', true); render(); };
        window.finishTutorial = function() { state.showTutorial = false; Storage.set('tutorialDone', true); showToast(state.lang === 'fr' ? 'Tuto termin√© ! üéâ' : 'Tutorial done! üéâ'); showConfetti(); render(); };

        // Quiz handlers
        window.selectQuizMode = function(mode) { state.quizMode = mode; render(); };
        window.resetQuiz = function() {
            if (state.quizTimerInterval) clearInterval(state.quizTimerInterval);
            state.quizMode = null; state.quizCategory = null; state.quizQuestions = [];
            state.quizCurrentIndex = 0; state.quizScore = 0; state.quizAnswered = false;
            state.quizSelectedAnswer = null; state.quizTimeLeft = 15; state.quizFinished = false;
            render();
        };
        window.startQuiz = function(category) {
            state.quizCategory = category;
            state.quizQuestions = [...quizQuestions[category]].sort(() => Math.random() - 0.5).slice(0, 5);
            state.quizCurrentIndex = 0; state.quizScore = 0; state.quizAnswered = false;
            state.quizSelectedAnswer = null; state.quizTimeLeft = 15; state.quizFinished = false;
            startQuizTimer();
            render();
        };
        window.answerQuiz = function(index) {
            if (state.quizAnswered) return;
            state.quizAnswered = true;
            state.quizSelectedAnswer = index;
            if (state.quizTimerInterval) clearInterval(state.quizTimerInterval);
            if (index === state.quizQuestions[state.quizCurrentIndex].correct) state.quizScore++;
            render();
        };
        window.nextQuizQuestion = function() {
            if (state.quizCurrentIndex < state.quizQuestions.length - 1) {
                state.quizCurrentIndex++; state.quizAnswered = false;
                state.quizSelectedAnswer = null; state.quizTimeLeft = 15;
                startQuizTimer();
            } else {
                finishQuiz();
            }
            render();
        };
        function startQuizTimer() {
            if (state.quizTimerInterval) clearInterval(state.quizTimerInterval);
            state.quizTimeLeft = 15;
            state.quizTimerInterval = setInterval(() => {
                state.quizTimeLeft--;
                // Mise √† jour SANS reconstruire tout l'√©cran
                const timerFill = document.querySelector('.quiz-timer-fill');
                const timerText = document.querySelector('.quiz-time-text');
                if (timerFill) timerFill.style.width = (state.quizTimeLeft / 15) * 100 + '%';
                if (timerText) timerText.textContent = state.quizTimeLeft + 's';
                
                if (state.quizTimeLeft <= 0) {
                    clearInterval(state.quizTimerInterval);
                    if (!state.quizAnswered) { 
                        state.quizAnswered = true; 
                        state.quizSelectedAnswer = -1; 
                        render(); // Seulement quand le temps est √©coul√©
                    }
                }
            }, 1000);
        }
        function finishQuiz() {
            if (state.quizTimerInterval) clearInterval(state.quizTimerInterval);
            state.quizFinished = true;
            const points = state.quizScore * 10;
            addPoints(points);
            if (state.quizScore * 10 > state.quizBestScore) {
                state.quizBestScore = state.quizScore * 10;
                Storage.set('quizBestScore', state.quizBestScore);
            }
            if (state.quizMode === 'world') {
                quizLeaderboard.push({ username: state.user.username, avatar: state.user.avatar, score: points, date: new Date().toISOString().split('T')[0] });
                quizLeaderboard.sort((a, b) => b.score - a.score);
                Storage.set('quizLeaderboard', quizLeaderboard);
            }
        }

        // ==================== INIT ====================
        const today = new Date().toDateString();
        const lastVisit = Storage.get('lastVisit');
        if (state.user && lastVisit !== today) {
            const yesterday = new Date(); yesterday.setDate(yesterday.getDate() - 1);
            if (lastVisit === yesterday.toDateString()) state.user.streak++;
            else if (lastVisit) state.user.streak = 1;
            Storage.set('lastVisit', today);
            saveState();
        }
        
        // V√©rifier les notifications quiz (pays consult√©s hier)
        if (state.user) {
            const yesterdayTimestamp = Date.now() - (24 * 60 * 60 * 1000);
            for (const [country, timestamp] of Object.entries(state.countriesViewed)) {
                const daysSince = Math.floor((Date.now() - timestamp) / (24 * 60 * 60 * 1000));
                
                // Si consult√© il y a 1 jour et pas encore notifi√©
                if (daysSince === 1 && !state.quizNotifications.includes(country)) {
                    state.quizNotifications.push(country);
                    Storage.set('quizNotifications', state.quizNotifications);
                    
                    // Afficher notification
                    const countryNames = {
                        'FR': { fr: 'France', en: 'France', flag: 'üá´üá∑' },
                        'DE': { fr: 'Allemagne', en: 'Germany', flag: 'üá©üá™' },
                        'BE': { fr: 'Belgique', en: 'Belgium', flag: 'üáßüá™' },
                        'ES': { fr: 'Espagne', en: 'Spain', flag: 'üá™üá∏' },
                        'IT': { fr: 'Italie', en: 'Italy', flag: 'üáÆüáπ' },
                        'NL': { fr: 'Pays-Bas', en: 'Netherlands', flag: 'üá≥üá±' },
                        'PL': { fr: 'Pologne', en: 'Poland', flag: 'üáµüá±' },
                        'PT': { fr: 'Portugal', en: 'Portugal', flag: 'üáµüáπ' },
                        'AT': { fr: 'Autriche', en: 'Austria', flag: 'üá¶üáπ' },
                        'CH': { fr: 'Suisse', en: 'Switzerland', flag: 'üá®üá≠' },
                        'CZ': { fr: 'R√©p. Tch√®que', en: 'Czech Rep.', flag: 'üá®üáø' },
                        'IE': { fr: 'Irlande', en: 'Ireland', flag: 'üáÆüá™' },
                        'HR': { fr: 'Croatie', en: 'Croatia', flag: 'üá≠üá∑' }
                    };
                    const countryInfo = countryNames[country];
                    if (countryInfo) {
                        const countryName = state.lang === 'fr' ? countryInfo.fr : countryInfo.en;
                        setTimeout(() => {
                            if (confirm((state.lang === 'fr' ? 
                                `üß† ${countryInfo.flag} Teste tes connaissances sur ${countryName} !` :
                                `üß† ${countryInfo.flag} Test your knowledge about ${countryName}!`))) {
                                openCountryQuiz(country);
                            }
                        }, 2000);
                    }
                }
            }
        }
        
        if (state.user && navigator.geolocation) setTimeout(() => getUserLocation(), 500);
        render();

        
        // Hide loader when app is ready
        function hideLoader() {
            const loader = document.getElementById('app-loader');
            const app = document.getElementById('app');
            if (loader) loader.classList.add('hidden');
            if (app) app.classList.add('loaded');
            
            // Log performance metrics
            if (window.performance) {
                const perf = performance.getEntriesByType('navigation')[0];
                console.log('üìä Performance:', {
                    'DOM Ready': Math.round(perf.domContentLoadedEventEnd) + 'ms',
                    'Full Load': Math.round(perf.loadEventEnd) + 'ms',
                    'First Paint': Math.round(performance.getEntriesByType('paint')[0]?.startTime || 0) + 'ms'
                });
            }
        }
        
        // Call hideLoader after first render
        setTimeout(hideLoader, 100);

    </script>

    <!-- Service Worker Registration -->
    <script>
        if ("serviceWorker" in navigator) {
            window.addEventListener("load", () => {
                navigator.serviceWorker.register("./sw.js")
                    .then(reg => {
                        console.log("‚úÖ Service Worker registered:", reg.scope);
                        
                        // V√©rifier les mises √† jour
                        reg.addEventListener("updatefound", () => {
                            const newWorker = reg.installing;
                            newWorker.addEventListener("statechange", () => {
                                if (newWorker.state === "installed" && navigator.serviceWorker.controller) {
                                    console.log("üîÑ New version available!");
                                }
                            });
                        });
                    })
                    .catch(err => console.error("‚ùå SW registration failed:", err));
            });
            
            // D√©tecter si hors ligne
            window.addEventListener("online", () => {
                console.log("üåê Back online");
                document.body.classList.remove("offline");
            });
            window.addEventListener("offline", () => {
                console.log("üì¥ Gone offline");
                document.body.classList.add("offline");
            });
        }
    </script>
</body>
</html>
